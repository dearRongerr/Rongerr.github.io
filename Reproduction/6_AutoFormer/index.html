
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="https://dearrongerr.github.io/Rongerr.github.io/Reproduction/6_AutoFormer/" rel="canonical"/>
<link href="../5_SegRNN_v4/" rel="prev"/>
<link href="../6_AutoFormer_v1/" rel="next"/>
<link href="../../assets/images/logo2.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.11" name="generator"/>
<title>Autoformer - æº¶err</title>
<link href="../../assets/stylesheets/main.4af4bdda.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<style>:root{--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20576%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%206.7.2%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202024%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M320%2096a32%2032%200%201%201-64%200%2032%2032%200%201%201%2064%200m21.1%2080C367%20158.8%20384%20129.4%20384%2096c0-53-43-96-96-96s-96%2043-96%2096c0%2033.4%2017%2062.8%2042.9%2080H224c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032h32v208h-48c-53%200-96-43-96-96v-6.1l7%207c9.4%209.4%2024.6%209.4%2033.9%200s9.4-24.6%200-33.9L97%20263c-9.4-9.4-24.6-9.4-33.9%200L7%20319c-9.4%209.4-9.4%2024.6%200%2033.9s24.6%209.4%2033.9%200l7-7v6.1c0%2088.4%2071.6%20160%20160%20160h160c88.4%200%20160-71.6%20160-160v-6.1l7%207c9.4%209.4%2024.6%209.4%2033.9%200s9.4-24.6%200-33.9l-56-56c-9.4-9.4-24.6-9.4-33.9%200l-56%2056c-9.4%209.4-9.4%2024.6%200%2033.9s24.6%209.4%2033.9%200l7-7v6.1c0%2053-43%2096-96%2096h-48V240h32c17.7%200%2032-14.3%2032-32s-14.3-32-32-32h-10.9z%22/%3E%3C/svg%3E');--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%206.7.2%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202024%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22m368.4%2018.3-55.7%2055.8%20125.2%20125.2%2055.7-55.7c21.9-21.9%2021.9-57.3%200-79.2l-46-46.1c-21.9-21.9-57.3-21.9-79.2%200M288%2094.6l-9.2%202.8-144.1%2043.2c-19.9%206-35.7%2021.2-42.3%2041L3.8%20445.8c-3.8%2011.3-1%2023.9%207.3%2032.4l153.6-153.5c-3-6.3-4.7-13.3-4.7-20.7%200-26.5%2021.5-48%2048-48s48%2021.5%2048%2048-21.5%2048-48%2048c-7.4%200-14.4-1.7-20.7-4.7L33.7%20500.9c8.6%208.3%2021.1%2011.2%2032.4%207.3l264.3-88.6c19.7-6.6%2035-22.4%2041-42.3l43.2-144.1%202.7-9.2z%22/%3E%3C/svg%3E');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%206.7.2%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202024%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M40%2048c-13.3%200-24%2010.7-24%2024v48c0%2013.3%2010.7%2024%2024%2024h48c13.3%200%2024-10.7%2024-24V72c0-13.3-10.7-24-24-24zm152%2016c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032h288c17.7%200%2032-14.3%2032-32s-14.3-32-32-32zm0%20160c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032h288c17.7%200%2032-14.3%2032-32s-14.3-32-32-32zm0%20160c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032h288c17.7%200%2032-14.3%2032-32s-14.3-32-32-32zM16%20232v48c0%2013.3%2010.7%2024%2024%2024h48c13.3%200%2024-10.7%2024-24v-48c0-13.3-10.7-24-24-24H40c-13.3%200-24%2010.7-24%2024m24%20136c-13.3%200-24%2010.7-24%2024v48c0%2013.3%2010.7%2024%2024%2024h48c13.3%200%2024-10.7%2024-24v-48c0-13.3-10.7-24-24-24z%22/%3E%3C/svg%3E');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20384%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%206.7.2%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202024%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M272%20384c9.6-31.9%2029.5-59.1%2049.2-86.2%205.2-7.1%2010.4-14.2%2015.4-21.4%2019.8-28.5%2031.4-63%2031.4-100.3C368%2078.8%20289.2%200%20192%200S16%2078.8%2016%20176c0%2037.3%2011.6%2071.9%2031.4%20100.3%205%207.2%2010.2%2014.3%2015.4%2021.4%2019.8%2027.1%2039.7%2054.4%2049.2%2086.2h160zm-80%20128c44.2%200%2080-35.8%2080-80v-16H112v16c0%2044.2%2035.8%2080%2080%2080m-80-336c0%208.8-7.2%2016-16%2016s-16-7.2-16-16c0-61.9%2050.1-112%20112-112%208.8%200%2016%207.2%2016%2016s-7.2%2016-16%2016c-44.2%200-80%2035.8-80%2080%22/%3E%3C/svg%3E');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%206.7.2%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202024%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M438.6%20105.4c12.5%2012.5%2012.5%2032.8%200%2045.3l-256%20256c-12.5%2012.5-32.8%2012.5-45.3%200l-128-128c-12.5-12.5-12.5-32.8%200-45.3s32.8-12.5%2045.3%200L160%20338.7l233.4-233.3c12.5-12.5%2032.8-12.5%2045.3%200z%22/%3E%3C/svg%3E');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%206.7.2%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202024%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M256%20512a256%20256%200%201%200%200-512%20256%20256%200%201%200%200%20512m-86.2-346.7c7.9-22.3%2029.1-37.3%2052.8-37.3h58.3c34.9%200%2063.1%2028.3%2063.1%2063.1%200%2022.6-12.1%2043.5-31.7%2054.8L280%20264.4c-.2%2013-10.9%2023.6-24%2023.6-13.3%200-24-10.7-24-24v-13.5c0-8.6%204.6-16.5%2012.1-20.8l44.3-25.4c4.7-2.7%207.6-7.7%207.6-13.1%200-8.4-6.8-15.1-15.1-15.1h-58.3c-3.4%200-6.4%202.1-7.5%205.3l-.4%201.2c-4.4%2012.5-18.2%2019-30.6%2014.6s-19-18.2-14.6-30.6l.4-1.2zM224%20352a32%2032%200%201%201%2064%200%2032%2032%200%201%201-64%200%22/%3E%3C/svg%3E');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%206.7.2%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202024%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M256%2032c14.2%200%2027.3%207.5%2034.5%2019.8l216%20368c7.3%2012.4%207.3%2027.7.2%2040.1S486.3%20480%20472%20480H40c-14.3%200-27.6-7.7-34.7-20.1s-7-27.8.2-40.1l216-368C228.7%2039.5%20241.8%2032%20256%2032m0%20128c-13.3%200-24%2010.7-24%2024v112c0%2013.3%2010.7%2024%2024%2024s24-10.7%2024-24V184c0-13.3-10.7-24-24-24m32%20224a32%2032%200%201%200-64%200%2032%2032%200%201%200%2064%200%22/%3E%3C/svg%3E');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M12%203c4.97%200%209%203.58%209%208s-6%2010-9%2010-9-5.58-9-10%204.03-8%209-8m-1.69%207.93C9.29%209.29%207.47%208.58%206.25%209.34s-1.38%202.71-.36%204.35c1.03%201.64%202.85%202.35%204.07%201.59%201.22-.78%201.37-2.71.35-4.35m3.38%200c-1.02%201.64-.87%203.57.35%204.35%201.22.76%203.04.05%204.07-1.59%201.02-1.64.86-3.59-.36-4.35s-3.04-.05-4.06%201.59M12%2017.75c-2%200-2.5-.75-2.5-.75%200%20.03.5%202%202.5%202s2.5-2%202.5-2-.5.75-2.5.75%22/%3E%3C/svg%3E');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%206.7.2%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202024%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M288%2032c0-17.7-14.3-32-32-32s-32%2014.3-32%2032v11.5c0%2049.9-60.3%2074.9-95.6%2039.6l-8.2-8.1C107.7%2062.5%2087.5%2062.5%2075%2075s-12.5%2032.8%200%2045.3l8.2%208.2c35.2%2035.2%2010.2%2095.5-39.7%2095.5H32c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032h11.5c49.9%200%2074.9%2060.3%2039.6%2095.6l-8.1%208.2c-12.5%2012.5-12.5%2032.8%200%2045.3s32.8%2012.5%2045.3%200l8.2-8.2c35.3-35.3%2095.6-10.3%2095.6%2039.6V480c0%2017.7%2014.3%2032%2032%2032s32-14.3%2032-32v-11.5c0-49.9%2060.3-74.9%2095.6-39.6l8.2%208.2c12.5%2012.5%2032.8%2012.5%2045.3%200s12.5-32.8%200-45.3l-8.2-8.2c-35.3-35.3-10.3-95.6%2039.6-95.6h11.5c17.7%200%2032-14.3%2032-32s-14.3-32-32-32h-11.5c-49.9%200-74.9-60.3-39.6-95.6l8.2-8.2c12.5-12.5%2012.5-32.8%200-45.3s-32.8-12.5-45.3%200l-8.2%208.2C348.3%20118.4%20288%2093.4%20288%2043.5zM176%20224a48%2048%200%201%201%2096%200%2048%2048%200%201%201-96%200m128%2056a24%2024%200%201%201%200%2048%2024%2024%200%201%201%200-48%22/%3E%3C/svg%3E');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20640%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%206.7.2%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202024%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M320%200c17.7%200%2032%2014.3%2032%2032v64h120c39.8%200%2072%2032.2%2072%2072v272c0%2039.8-32.2%2072-72%2072H168c-39.8%200-72-32.2-72-72V168c0-39.8%2032.2-72%2072-72h120V32c0-17.7%2014.3-32%2032-32M208%20384c-8.8%200-16%207.2-16%2016s7.2%2016%2016%2016h32c8.8%200%2016-7.2%2016-16s-7.2-16-16-16zm96%200c-8.8%200-16%207.2-16%2016s7.2%2016%2016%2016h32c8.8%200%2016-7.2%2016-16s-7.2-16-16-16zm96%200c-8.8%200-16%207.2-16%2016s7.2%2016%2016%2016h32c8.8%200%2016-7.2%2016-16s-7.2-16-16-16zM264%20256a40%2040%200%201%200-80%200%2040%2040%200%201%200%2080%200m152%2040a40%2040%200%201%200%200-80%2040%2040%200%201%200%200%2080M48%20224h16v192H48c-26.5%200-48-21.5-48-48v-96c0-26.5%2021.5-48%2048-48m544%200c26.5%200%2048%2021.5%2048%2048v96c0%2026.5-21.5%2048-48%2048h-16V224z%22/%3E%3C/svg%3E');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%206.7.2%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202024%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M288%200H128c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032v132.8c0%2011.8-3.3%2023.5-9.5%2033.5L10.3%20406.2C3.6%20417.2%200%20429.7%200%20442.6%200%20480.9%2031.1%20512%2069.4%20512h309.2c38.3%200%2069.4-31.1%2069.4-69.4%200-12.8-3.6-25.4-10.3-36.4L329.5%20230.4c-6.2-10.1-9.5-21.7-9.5-33.5V64c17.7%200%2032-14.3%2032-32S337.7%200%20320%200zm-96%20196.8V64h64v132.8c0%2023.7%206.6%2046.9%2019%2067.1l34.5%2056.1h-171l34.5-56.1c12.4-20.2%2019-43.4%2019-67.1%22/%3E%3C/svg%3E');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20640%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%206.7.2%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202024%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M579.8%20267.7c56.5-56.5%2056.5-148%200-204.5-50-50-128.8-56.5-186.3-15.4l-1.6%201.1c-14.4%2010.3-17.7%2030.3-7.4%2044.6s30.3%2017.7%2044.6%207.4l1.6-1.1c32.1-22.9%2076-19.3%20103.8%208.6%2031.5%2031.5%2031.5%2082.5%200%20114L422.3%20334.8c-31.5%2031.5-82.5%2031.5-114%200-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4%206.9-34.4-7.4-44.6s-34.4-6.9-44.6%207.4l-1.1%201.6C206.5%20251.2%20213%20330%20263%20380c56.5%2056.5%20148%2056.5%20204.5%200zM60.2%20244.3c-56.5%2056.5-56.5%20148%200%20204.5%2050%2050%20128.8%2056.5%20186.3%2015.4l1.6-1.1c14.4-10.3%2017.7-30.3%207.4-44.6s-30.3-17.7-44.6-7.4l-1.6%201.1c-32.1%2022.9-76%2019.3-103.8-8.6C74%20372%2074%20321%20105.5%20289.5l112.2-112.3c31.5-31.5%2082.5-31.5%20114%200%2027.9%2027.9%2031.5%2071.8%208.6%20103.9l-1.1%201.6c-10.3%2014.4-6.9%2034.4%207.4%2044.6s34.4%206.9%2044.6-7.4l1.1-1.6C433.5%20260.8%20427%20182%20377%20132c-56.5-56.5-148-56.5-204.5%200z%22/%3E%3C/svg%3E');}</style>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=LXGW+WenKai+Screen+GB+Screen:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"LXGW WenKai Screen GB Screen";--md-code-font:"JetBrains Mono"}</style>
<link href="../../css/timeline.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css" rel="stylesheet"/>
<link href="../../mkdocs/css/no-footer.css" rel="stylesheet"/>
<link href="../../mkdocs/css/unordered-list-symbols.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/cards.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/flink.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/rounded_corner.css" rel="stylesheet"/>
<link href="https://gcore.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.1.0/style.css" rel="stylesheet"/>
<link href="https://gcore.jsdelivr.net/npm/lxgw-wenkai-webfont@1.1.0/style.css" rel="stylesheet"/>
<link href="https://cdn.tonycrane.cc/jbmono/jetbrainsmono.css" rel="stylesheet"/>
<link href="https://cdn.tonycrane.cc/lxgw/lxgwscreen.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/custom.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/tasklist.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/fold_toc.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/changelog_extra.css" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
<link href="../../assets/document_dates.css" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
 <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script><style>/* èªå®ä¹åéçº¿æ ·å¼ */
hr.custom-hr {
    position: relative;
    text-align: center;
    border: 0;
    height: 1px;
    background: none;
    /* ä½¿ç¨ä¸»é¢çè¾¹æ¡é¢è² */
    border-top: 2px solid var(--md-default-fg-color--lighter, currentColor);
    margin: 100px 0 !important;
}

hr.custom-hr:before {
    content: attr(data-content);
    position: absolute;
    /* ä½¿ç¨ä¸»é¢çèæ¯è²ï¼fallback å°é¡µé¢èæ¯è² */
    background: var(--md-default-bg-color, var(--md-primary-bg-color, inherit));
    /* ä½¿ç¨ä¸»é¢çææ¬é¢è² */
    color: var(--md-default-fg-color, currentColor);
    padding: 0 0.5em;
    line-height: 1;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 2em;
    font-weight: bold;
}

/* ç®å½ä¸­åéçº¿æ¡ç®çæ ·å¼ */
.md-nav__item.hr-nav-item {
    text-align: center;
    margin: 1.16em 0;
    /* å¢å ä¸ä¸é´è· */
}

.md-nav__item.hr-nav-item .md-nav__link {
    justify-content: center;
    font-weight: bold;
    font-size: 1.1em;
    color: var(--md-typeset-color) !important;
}

/* æ¬åææ */
.md-nav__item.hr-nav-item .md-nav__link:hover {
    color: var(--md-accent-fg-color) !important;
}

/* ä¿®æ¹åéçº¿çæ ·å¼ */
.md-content__inner hr.custom-hr {
    border: none !important;
    height: 2px !important;
    background-color: var(--md-typeset-color) !important;
    margin: 8em 0 !important;
    /* å¢å åéçº¿çä¸ä¸é´è· */
}

/* ç¡®ä¿åéçº¿æå­å¯è§ */
.md-content__inner hr.custom-hr[data-content]::before {
    color: var(--md-typeset-color) !important;
}</style></head>
<body data-md-color-accent="light-green" data-md-color-primary="green" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#autoformer">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="æº¶err" class="md-header__button md-logo" data-md-component="logo" href="../.." title="æº¶err">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 8C8 10 5.9 16.17 3.82 21.34l1.89.66.95-2.3c.48.17.98.3 1.34.3C19 20 22 3 22 3c-1 2-8 2.25-13 3.25S2 11.5 2 13.5s1.75 3.75 1.75 3.75C7 8 17 8 17 8"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            æº¶err
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Autoformer
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="light-green" data-md-color-media="" data-md-color-primary="green" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="indigo" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 320 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256l137.3-137.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
</a>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/dearRongerr/Rongerr.github.io" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</div>
<div class="md-source__repository">
    Rongerr.github.io
  </div>
</a>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../sticks/mkdocs_learn/">
          
  
  
    
  
  ä¾¿ç­¾

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../bagu/">
          
  
  
    
  
  é¢è¯

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../Error/github/">
          
  
  
    
  
  æä¸ªè«

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../learning/0_pdfNotes/">
          
  
  
    
  
  æ·±åº¦å­¦ä¹ 

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../literature/">
          
  
  
    
  
  æç®

        </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../">
          
  
  
    
  
  å¤ç°&amp;ä»£ç 

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../Statistics/">
          
  
  
    
  
  ç»è®¡å­¦

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../logs/">
          
  
  
    
  
  æ¶çº³ç®±

        </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="æº¶err" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="æº¶err">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 8C8 10 5.9 16.17 3.82 21.34l1.89.66.95-2.3c.48.17.98.3 1.34.3C19 20 22 3 22 3c-1 2-8 2.25-13 3.25S2 11.5 2 13.5s1.75 3.75 1.75 3.75C7 8 17 8 17 8"></path></svg>
</a>
    æº¶err
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/dearRongerr/Rongerr.github.io" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</div>
<div class="md-source__repository">
    Rongerr.github.io
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
<span class="md-ellipsis">
    ä¾¿ç­¾
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_1_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_1">
<span class="md-nav__icon md-icon"></span>
            ä¾¿ç­¾
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../sticks/mkdocs_learn/">
<span class="md-ellipsis">
    MkDocs
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sticks/markdwon_learn/">
<span class="md-ellipsis">
    markdown
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sticks/latex/">
<span class="md-ellipsis">
    LaTex
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sticks/GitHub/">
<span class="md-ellipsis">
    GitHub
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sticks/MacOS/">
<span class="md-ellipsis">
    MacOS
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sticks/shell/">
<span class="md-ellipsis">
    Shell
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sticks/linux/">
<span class="md-ellipsis">
    linux
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sticks/screen/">
<span class="md-ellipsis">
    screen
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sticks/docker/">
<span class="md-ellipsis">
    Docker
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sticks/writting/">
<span class="md-ellipsis">
    åä½
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sticks/1_github_v1/">
<span class="md-ellipsis">
    github v1.0
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sticks/2_python/">
<span class="md-ellipsis">
    python
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sticks/3_vscode/">
<span class="md-ellipsis">
    VSCode
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sticks/4_mkdocs/">
<span class="md-ellipsis">
    mkdocs å¸¸ç¨å½ä»¤
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../bagu/">
<span class="md-ellipsis">
    é¢è¯
    
  </span>
</a>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            é¢è¯
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
<span class="md-ellipsis">
    é¢ç®
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_2">
<span class="md-nav__icon md-icon"></span>
            é¢ç®
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../bagu/questions/1_questions/">
<span class="md-ellipsis">
    é¢è¯é®é¢
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../bagu/leetcode/">
<span class="md-ellipsis">
    åæ£
    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_3">
<span class="md-nav__icon md-icon"></span>
            åæ£
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../bagu/leetcode/1/">
<span class="md-ellipsis">
    1 ä¸¤æ°ä¹å
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../bagu/leetcode/2/">
<span class="md-ellipsis">
    2 ä¸¤æ°ç¸å 
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../bagu/deeplearning/">
<span class="md-ellipsis">
    æ·±åº¦å­¦ä¹ 
    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_4">
<span class="md-nav__icon md-icon"></span>
            æ·±åº¦å­¦ä¹ 
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../bagu/deeplearning/transformer/">
<span class="md-ellipsis">
    ææTransformerä»£ç 
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../bagu/deeplearning/pytorch_shape_function/">
<span class="md-ellipsis">
    pytorchçç»´åº¦åæ¢å½æ°
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../bagu/deeplearning/1/">
<span class="md-ellipsis">
    visionTransformerä»£ç 
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
<span class="md-ellipsis">
    æºå¨å­¦ä¹ 
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_5">
<span class="md-nav__icon md-icon"></span>
            æºå¨å­¦ä¹ 
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../bagu/machinelearning/kmeans/">
<span class="md-ellipsis">
    æækmeans
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../bagu/machinelearning/2/">
<span class="md-ellipsis">
    ææååä¼ æ­
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    æä¸ªè«
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            æä¸ªè«
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../Error/github/">
<span class="md-ellipsis">
    github
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Error/latex/">
<span class="md-ellipsis">
    Latex
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Error/python/">
<span class="md-ellipsis">
    python
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Error/macos/">
<span class="md-ellipsis">
    macOS
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Error/docker/">
<span class="md-ellipsis">
    docker
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    æ·±åº¦å­¦ä¹ 
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            æ·±åº¦å­¦ä¹ 
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/0_pdfNotes/">
<span class="md-ellipsis">
    ð
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/3_ViT/">
<span class="md-ellipsis">
    ViT
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/1_clip/">
<span class="md-ellipsis">
    CLIP
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/2_MOCO/">
<span class="md-ellipsis">
    MOCO
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/2/">
<span class="md-ellipsis">
    å¾è§£LayerNorm &amp; BatchNorm
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/1/">
<span class="md-ellipsis">
    5ç§å½ä¸åæ¹æ³
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/vit/">
<span class="md-ellipsis">
    vision Transformerçåçä¸é¾ç¹æºç å®ç°
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/pe/">
<span class="md-ellipsis">
    4ç§ä½ç½®ç¼ç 
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/convs/">
<span class="md-ellipsis">
    å·ç§¯
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/3/">
<span class="md-ellipsis">
    ææ² ç®æ æ£æµé¨å
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/4_GAN/">
<span class="md-ellipsis">
    GAN
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/5_Bert/">
<span class="md-ellipsis">
    BERTä»é¶è¯¦ç»è§£è¯»
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/6_Diffusion/">
<span class="md-ellipsis">
    DDPM
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/6_Diffusion1/">
<span class="md-ellipsis">
    VDM
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/8_WeightNorm/">
<span class="md-ellipsis">
    WeightNorm
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/9_cGAN/">
<span class="md-ellipsis">
    GAN åä½
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/12_KLdivergence/">
<span class="md-ellipsis">
    KL divergence
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/13_RNN/">
<span class="md-ellipsis">
    RNN
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/14_LSTM/">
<span class="md-ellipsis">
    LSTM
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../literature/">
<span class="md-ellipsis">
    æç®
    
  </span>
</a>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            æç®
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../literature/TSP/">
<span class="md-ellipsis">
    æ¶é´åºåé¢æµ
    
  </span>
</a>
<label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_2">
<span class="md-nav__icon md-icon"></span>
            æ¶é´åºåé¢æµ
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/TSP/0_note/">
<span class="md-ellipsis">
    NOTE
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/TSP/1_SegRNN/">
<span class="md-ellipsis">
    2023ãSegRNN
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/TSP/2_DLinear/">
<span class="md-ellipsis">
    2022ãDLinear
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/TSP/3_TimesNet/">
<span class="md-ellipsis">
    2023ãTimesNet
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/TSP/4_Informer/">
<span class="md-ellipsis">
    2021ã Informer
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/TSP/5_Autoformer/">
<span class="md-ellipsis">
    2021ãAutoformer
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../literature/ObejectCounting/">
<span class="md-ellipsis">
    ç®æ è®¡æ°
    
  </span>
</a>
<label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_3">
<span class="md-nav__icon md-icon"></span>
            ç®æ è®¡æ°
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/ObejectCounting/rank1%20CountGD/">
<span class="md-ellipsis">
    rank1 CountGD
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/ObejectCounting/rank2%20GeCo/">
<span class="md-ellipsis">
    rank2 GeCo
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/ObejectCounting/rank3%20DAVE/">
<span class="md-ellipsis">
    rank3 DAVE
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/ObejectCounting/rank4%20CACViT/">
<span class="md-ellipsis">
    rank4 CACViT
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/ObejectCounting/rank5%20SSD/">
<span class="md-ellipsis">
    rank5 SSD
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/ObejectCounting/rank6%20LOCA/">
<span class="md-ellipsis">
    rank6 LOCA
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/ObejectCounting/rank7%20SemAug_CountTR/">
<span class="md-ellipsis">
    rank7 SemAug CountTR
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/ObejectCounting/rank8%20CounTR/">
<span class="md-ellipsis">
    rank8 CounTR
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/ObejectCounting/rank9%20SemAug_SAFECount/">
<span class="md-ellipsis">
    rank9 SemAug SAFECount
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/ObejectCounting/rank10%20SPDCN/">
<span class="md-ellipsis">
    rank10 SPDCN
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/ObejectCounting/rank11%20GCA_SUN/">
<span class="md-ellipsis">
    rank11 GCA SUN
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/ObejectCounting/rank12%20SAFECount/">
<span class="md-ellipsis">
    rank12 SAFECount
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../literature/ObjectDetection/">
<span class="md-ellipsis">
    ç®æ æ£æµ
    
  </span>
</a>
<label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_4">
<span class="md-nav__icon md-icon"></span>
            ç®æ æ£æµ
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/ObjectDetection/2/">
<span class="md-ellipsis">
    ç®æ æ£æµåºç¡ç¥è¯
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/ObjectDetection/1/">
<span class="md-ellipsis">
    DETRè®ºæç³»å
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/ObjectDetection/3/">
<span class="md-ellipsis">
    ï¼DETRï¼End-to-End Object Detection with Transformer
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../">
<span class="md-ellipsis">
    å¤ç°&amp;ä»£ç 
    
  </span>
</a>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            å¤ç°&amp;ä»£ç 
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../7_summary/">
<span class="md-ellipsis">
    æ±æ»å¤ç°è°ç¨å¾
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../DAVE/">
<span class="md-ellipsis">
    DAVEå¤ç°
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../5_SegRNN_index/">
<span class="md-ellipsis">
    SegRNN
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../5_SegRNN_v1/">
<span class="md-ellipsis">
    å¤ç°SegRNN
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../5_SegRNN_v2/">
<span class="md-ellipsis">
    ï¼è¡¥åï¼å¤ç° SegRNN
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../5_SegRNN_v3/">
<span class="md-ellipsis">
    (æåç¬è®°)SegRNN
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../5_SegRNN_v4/">
<span class="md-ellipsis">
    SegRNNå®éªè¿ç¨
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Autoformer
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Autoformer
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#github">
<span class="md-ellipsis">
      github æºç ä¸»é¡µ
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_1">
<span class="md-ellipsis">
      åå¤
    </span>
</a>
<nav aria-label="åå¤" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#git-clone">
<span class="md-ellipsis">
      git clone
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#readme">
<span class="md-ellipsis">
      readme
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_2">
<span class="md-ellipsis">
      è°è¯éç½®
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#python">
<span class="md-ellipsis">
      æ°å»º python èæç¯å¢
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#requirements">
<span class="md-ellipsis">
      requirements
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_3">
<span class="md-ellipsis">
      å¼å§è°è¯
    </span>
</a>
<nav aria-label="å¼å§è°è¯" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#encoder-embedding">
<span class="md-ellipsis">
      encoder embedding
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_4">
<span class="md-ellipsis">
      æ¨¡åå®ä¹
    </span>
</a>
<nav aria-label="æ¨¡åå®ä¹" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_5">
<span class="md-ellipsis">
      ç¼ç å¨ è§£ç å¨é¨å
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_6">
<span class="md-ellipsis">
      è®­ç»è¿ç¨ï¼å½¢ç¶åæ¢
    </span>
</a>
<nav aria-label="è®­ç»è¿ç¨ï¼å½¢ç¶åæ¢" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#autoformer-forward">
<span class="md-ellipsis">
      Autoformer forward
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_7">
<span class="md-ellipsis">
      åºååè§£
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#model-inputs">
<span class="md-ellipsis">
      model inputs
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#encoder">
<span class="md-ellipsis">
      Encoder
    </span>
</a>
<nav aria-label="Encoder" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_8">
<span class="md-ellipsis">
      è®ºæ
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#encoder-embedding_1">
<span class="md-ellipsis">
      Encoder Embedding
    </span>
</a>
<nav aria-label="Encoder Embedding" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_9">
<span class="md-ellipsis">
      ç±»å¾
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#encoder-forward">
<span class="md-ellipsis">
      Encoder forward
    </span>
</a>
<nav aria-label="Encoder forward" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_10">
<span class="md-ellipsis">
      ç±»å¾
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#encoderlayer">
<span class="md-ellipsis">
      EncoderLayer
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#decoder">
<span class="md-ellipsis">
      Decoder
    </span>
</a>
<nav aria-label="Decoder" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_11">
<span class="md-ellipsis">
      ç±»å¾
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_12">
<span class="md-ellipsis">
      è®ºæ
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_13">
<span class="md-ellipsis">
      ä»£ç 
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#decoderlayer-forward">
<span class="md-ellipsis">
      DecoderLayer forward
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_14">
<span class="md-ellipsis">
      æ°æ®æµå¨å¾
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#autoformer-forward_1">
<span class="md-ellipsis">
      æ±æ» Autoformer forward
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_15">
<span class="md-ellipsis">
      éå½
    </span>
</a>
<nav aria-label="éå½" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#conv2">
<span class="md-ellipsis">
      çé®ä¸ ä¸ºä»ä¹Conv2ä¹åæ²¡æè¿è¡æ¿æ´»å½æ°çåºç¨
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-conv1d-nnlinear">
<span class="md-ellipsis">
      çé® 2 ä¸ºä»ä¹æ¯ conv1dï¼èä¸æ¯ nn.Linear
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_16">
<span class="md-ellipsis">
      åºååè§£çç°å®æä¹
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_17">
<span class="md-ellipsis">
      çè§£å¤å¤´æ³¨æåæºå¶
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#k-v-q">
<span class="md-ellipsis">
      ç¼ç å¨çè¾åºä½ä¸º K å Vï¼è§£ç å¨çè¾å¥ä½ä¸º Q
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_18">
<span class="md-ellipsis">
      å¾ªç¯å¡«å
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_19">
<span class="md-ellipsis">
      ä¸ºä»ä¹å­£èæååè¶å¿æåä¸åçè¿åç»´åº¦æ¹æ³
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../6_AutoFormer_v1/">
<span class="md-ellipsis">
    (ç»­) Autoformer
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../6_AutoFormer_v2_eg/">
<span class="md-ellipsis">
    AutoFormer å¯è§åç»æ
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../8_ThuML/">
<span class="md-ellipsis">
    thumlå¤ç°
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_6_13" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../CodeRepo/">
<span class="md-ellipsis">
    ä¸äºä»£ç 
    
  </span>
</a>
<label class="md-nav__link" for="__nav_6_13" id="__nav_6_13_label" tabindex="">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_6_13_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_13">
<span class="md-nav__icon md-icon"></span>
            ä¸äºä»£ç 
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../1/">
<span class="md-ellipsis">
    ä¸äºæ¨¡å
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../2/">
<span class="md-ellipsis">
    ç¹å¾èåæ¹å¼
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../3/">
<span class="md-ellipsis">
    ä¸äºææ
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../4/">
<span class="md-ellipsis">
    é¢è®­ç»æé
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../CodeRepo/1_MultiHeadAttention/">
<span class="md-ellipsis">
    å¤å¤´æ³¨æåæºå¶å½¢ç¶åå
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../CodeRepo/2_transformer/">
<span class="md-ellipsis">
    ä»ç°å®çæ´»çè§åº¦ç Transformer
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../CodeRepo/3_fourier/">
<span class="md-ellipsis">
    DFTä¾é¢
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../CodeRepo/1_0_Autoformer/">
<span class="md-ellipsis">
    Autoformer
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_7" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../Statistics/">
<span class="md-ellipsis">
    ç»è®¡å­¦
    
  </span>
</a>
<label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
            ç»è®¡å­¦
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../Statistics/1_FFT/">
<span class="md-ellipsis">
    Fourierçº§æ°
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Statistics/2_FFT/">
<span class="md-ellipsis">
    Fourieråºç¡ç¥è¯
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Statistics/1_0_fourier/">
<span class="md-ellipsis">
    å¤å¹³é¢æè½¬&amp;DFT
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Statistics/1_1_fourier/">
<span class="md-ellipsis">
    ç´è§çè§£åéå¶åæ¢
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Statistics/1_2_signal/">
<span class="md-ellipsis">
    ä¿¡å·çåæä¸åè§£
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Statistics/1_4_signal/">
<span class="md-ellipsis">
    FSãFTãDTFSãDTFT
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Statistics/1_3_complexExp/">
<span class="md-ellipsis">
    å¤ææ°çæ§è´¨
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_8" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../logs/">
<span class="md-ellipsis">
    æ¶çº³ç®±
    
  </span>
</a>
<label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_8_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_8">
<span class="md-nav__icon md-icon"></span>
            æ¶çº³ç®±
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../logs/1_date/">
<span class="md-ellipsis">
    ä¸äºæ¥æ
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../logs/2_updatelog/">
<span class="md-ellipsis">
    æ´æ°æ¥å¿
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../logs/4_flink/">
<span class="md-ellipsis">
    æ´å¤é¾æ¥
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../logs/6_waline/">
<span class="md-ellipsis">
    çææ¬²è¨
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_8_6" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../logs/1_0_diary/">
<span class="md-ellipsis">
    ç¢ç¢å¿µ
    
  </span>
</a>
<label class="md-nav__link" for="__nav_8_6" id="__nav_8_6_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_8_6_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_8_6">
<span class="md-nav__icon md-icon"></span>
            ç¢ç¢å¿µ
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../logs/1_0_diary/2025/03/">
<span class="md-ellipsis">
    3 æ
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../logs/1_0_diary/2025/04/">
<span class="md-ellipsis">
    4æ
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../logs/diary/">
<span class="md-ellipsis">
    æ´æ©ä»¥å
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#github">
<span class="md-ellipsis">
      github æºç ä¸»é¡µ
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_1">
<span class="md-ellipsis">
      åå¤
    </span>
</a>
<nav aria-label="åå¤" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#git-clone">
<span class="md-ellipsis">
      git clone
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#readme">
<span class="md-ellipsis">
      readme
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_2">
<span class="md-ellipsis">
      è°è¯éç½®
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#python">
<span class="md-ellipsis">
      æ°å»º python èæç¯å¢
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#requirements">
<span class="md-ellipsis">
      requirements
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_3">
<span class="md-ellipsis">
      å¼å§è°è¯
    </span>
</a>
<nav aria-label="å¼å§è°è¯" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#encoder-embedding">
<span class="md-ellipsis">
      encoder embedding
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_4">
<span class="md-ellipsis">
      æ¨¡åå®ä¹
    </span>
</a>
<nav aria-label="æ¨¡åå®ä¹" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_5">
<span class="md-ellipsis">
      ç¼ç å¨ è§£ç å¨é¨å
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_6">
<span class="md-ellipsis">
      è®­ç»è¿ç¨ï¼å½¢ç¶åæ¢
    </span>
</a>
<nav aria-label="è®­ç»è¿ç¨ï¼å½¢ç¶åæ¢" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#autoformer-forward">
<span class="md-ellipsis">
      Autoformer forward
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_7">
<span class="md-ellipsis">
      åºååè§£
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#model-inputs">
<span class="md-ellipsis">
      model inputs
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#encoder">
<span class="md-ellipsis">
      Encoder
    </span>
</a>
<nav aria-label="Encoder" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_8">
<span class="md-ellipsis">
      è®ºæ
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#encoder-embedding_1">
<span class="md-ellipsis">
      Encoder Embedding
    </span>
</a>
<nav aria-label="Encoder Embedding" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_9">
<span class="md-ellipsis">
      ç±»å¾
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#encoder-forward">
<span class="md-ellipsis">
      Encoder forward
    </span>
</a>
<nav aria-label="Encoder forward" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_10">
<span class="md-ellipsis">
      ç±»å¾
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#encoderlayer">
<span class="md-ellipsis">
      EncoderLayer
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#decoder">
<span class="md-ellipsis">
      Decoder
    </span>
</a>
<nav aria-label="Decoder" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_11">
<span class="md-ellipsis">
      ç±»å¾
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_12">
<span class="md-ellipsis">
      è®ºæ
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_13">
<span class="md-ellipsis">
      ä»£ç 
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#decoderlayer-forward">
<span class="md-ellipsis">
      DecoderLayer forward
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_14">
<span class="md-ellipsis">
      æ°æ®æµå¨å¾
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#autoformer-forward_1">
<span class="md-ellipsis">
      æ±æ» Autoformer forward
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_15">
<span class="md-ellipsis">
      éå½
    </span>
</a>
<nav aria-label="éå½" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#conv2">
<span class="md-ellipsis">
      çé®ä¸ ä¸ºä»ä¹Conv2ä¹åæ²¡æè¿è¡æ¿æ´»å½æ°çåºç¨
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-conv1d-nnlinear">
<span class="md-ellipsis">
      çé® 2 ä¸ºä»ä¹æ¯ conv1dï¼èä¸æ¯ nn.Linear
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_16">
<span class="md-ellipsis">
      åºååè§£çç°å®æä¹
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_17">
<span class="md-ellipsis">
      çè§£å¤å¤´æ³¨æåæºå¶
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#k-v-q">
<span class="md-ellipsis">
      ç¼ç å¨çè¾åºä½ä¸º K å Vï¼è§£ç å¨çè¾å¥ä½ä¸º Q
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_18">
<span class="md-ellipsis">
      å¾ªç¯å¡«å
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_19">
<span class="md-ellipsis">
      ä¸ºä»ä¹å­£èæååè¶å¿æåä¸åçè¿åç»´åº¦æ¹æ³
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/dearRongerr/Rongerr.github.io/edit/main/docs/Reproduction/6_AutoFormer.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"></path></svg>
</a>
<a class="md-content__button md-icon" href="https://github.com/dearRongerr/Rongerr.github.io/raw/main/docs/Reproduction/6_AutoFormer.md" title="View source of this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"></path></svg>
</a>
<h1 id="autoformer">Autoformer<a class="headerlink" href="#autoformer" title="Permanent link">Â¶</a></h1>
<div style="margin-top: -30px; font-size: 0.75em; opacity: 0.7;">
<p><span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10h-2a8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8zm6.78 1a.7.7 0 0 0-.48.2l-1.22 1.21 2.5 2.5L20.8 5.7c.26-.26.26-.7 0-.95L19.25 3.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L9 12.5V15h2.5l7.37-7.38z"></path></svg></span> çº¦ 17665 ä¸ªå­ <span class="twemoji"><svg viewbox="0 0 640 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M392.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6m80.6 120.1c-12.5 12.5-12.5 32.8 0 45.3l89.3 89.4-89.4 89.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l112-112c12.5-12.5 12.5-32.8 0-45.3l-112-112c-12.5-12.5-32.8-12.5-45.3 0zm-306.7 0c-12.5-12.5-32.8-12.5-45.3 0l-112 112c-12.5 12.5-12.5 32.8 0 45.3l112 112c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l89.4-89.4c12.5-12.5 12.5-32.8 0-45.3"></path></svg></span> 583 è¡ä»£ç  <span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21 17H7V3h14m0-2H7a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2M3 5H1v16a2 2 0 0 0 2 2h16v-2H3m12.96-10.71-2.75 3.54-1.96-2.36L8.5 15h11z"></path></svg></span> 100 å¼ å¾ç <span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 20c4.42 0 8-3.58 8-8s-3.58-8-8-8-8 3.58-8 8 3.58 8 8 8m0-18c5.5 0 10 4.5 10 10s-4.5 10-10 10C6.47 22 2 17.5 2 12S6.5 2 12 2m.5 11H11V7h1.5v4.26l3.7-2.13.75 1.3z"></path></svg></span> é¢è®¡éè¯»æ¶é´ 96 åé</p>
</div>
<h2 id="github">github æºç ä¸»é¡µ<a class="headerlink" href="#github" title="Permanent link">Â¶</a></h2>
<p>Autoformer (NeurIPS 2021) èªå¨æåæº (NeurIPS 2021)</p>
<p>Autoformer: Decomposition Transformers with Auto-Correlation for Long-Term Series Forecasting
Autoformerï¼ç¨äºé¿æåºåé¢æµçå·æèªç¸å³çåè§£ååå¨</p>
<p>Time series forecasting is a critical demand for real applications. Enlighted by the classic time series analysis and stochastic process theory, we propose the Autoformer as a general series forecasting model [<a href="https://arxiv.org/abs/2106.13008">paper</a>]. <strong>Autoformer goes beyond the Transformer family and achieves the series-wise connection for the first time.</strong>
æ¶é´åºåé¢æµæ¯å®éåºç¨çå³é®éæ±ãåç»å¸æ¶é´åºååæåéæºè¿ç¨çè®ºçå¯åï¼æä»¬æåºäº Autoformer ä½ä¸ºéç¨åºåé¢æµæ¨¡å [<a href="https://arxiv.org/abs/2106.13008">è®ºæ</a>]ãAutoformer**è¶è¶äº Transformer å®¶æï¼é¦æ¬¡å®ç°äºåºåè¿æ¥ã**</p>
<p>In long-term forecasting, Autoformer achieves SOTA, with a <strong>38% relative improvement</strong> on six benchmarks, covering five practical applications: <strong>energy, traffic, economics, weather and disease</strong>.
å¨é¿æé¢æµä¸­ï¼Autoformer å®ç°äº SOTAï¼å¨å­ä¸ªåºåä¸**ç¸å¯¹æåäº 38%** ï¼æ¶µçäº**è½æºãäº¤éãç»æµãå¤©æ°åç¾ç**äºä¸ªå®éåºç¨ã</p>
<p><strong>News</strong> (2023.08) Autoformer has been included in <a href="https://huggingface.co/models?search=autoformer">Hugging Face</a>. See <a href="https://huggingface.co/blog/autoformer">blog</a>.
ð©<strong>æ°é»</strong>(2023.08) Autoformer å·²åå«å¨<a href="https://huggingface.co/models?search=autoformer">Hugging Face</a>ä¸­ãæ¥ç<a href="https://huggingface.co/blog/autoformer">åå®¢</a>ã</p>
<p>ð©<strong>News</strong> (2023.06) The extension version of Autoformer (<a href="https://www.nature.com/articles/s42256-023-00667-9">Interpretable weather forecasting for worldwide stations with a unified deep model</a>) has been published in Nature Machine Intelligence as the <a href="https://www.nature.com/natmachintell/volumes/5/issues/6">Cover Article</a>.
ð©<strong>æ°é»</strong>(2023.06) Autoformer çæ©å±çæ¬ (<a href="https://www.nature.com/articles/s42256-023-00667-9">ä½¿ç¨ç»ä¸æ·±åº¦æ¨¡åä¸ºå¨çç«ç¹æä¾å¯è§£éçå¤©æ°é¢æ¥</a>) å¨ãèªç¶æºå¨æºè½ãæå¿ä¸ä½ä¸º<a href="https://www.nature.com/natmachintell/volumes/5/issues/6">å°é¢æç« </a>åè¡¨ã</p>
<p>ð©<strong>News</strong> (2023.02) Autoformer has been included in our [<a href="https://github.com/thuml/Time-Series-Library">Time-Series-Library]</a>, which covers long- and short-term forecasting, imputation, anomaly detection, and classification.
ð©<strong>æ°é»</strong>(2023.02) Autoformer å·²åå«å¨æä»¬ç[<a href="https://github.com/thuml/Time-Series-Library">æ¶é´åºååº]</a>ä¸­ï¼å®æ¶µçé¿æåç­æé¢æµãå½çº³ãå¼å¸¸æ£æµååç±»ã</p>
<p>ð©<strong>News</strong> (2022.02-2022.03) Autoformer has been deployed in <a href="https://en.wikipedia.org/wiki/2022_Winter_Olympics">2022 Winter Olympics</a> to provide weather forecasting for competition venues, including wind speed and temperature.
ð©<strong>æ°é»</strong>ï¼2022.02-2022.03ï¼Autoformer å·²é¨ç½²å¨<a href="https://en.wikipedia.org/wiki/2022_Winter_Olympics">2022 å¹´å¬å¥¥ä¼ï¼</a>ä¸ºæ¯èµåºé¦æä¾å¤©æ°é¢æ¥ï¼åæ¬é£éãæ¸©åº¦ç­ã</p>
<h2 id="_1">åå¤<a class="headerlink" href="#_1" title="Permanent link">Â¶</a></h2>
<h3 id="git-clone">git clone<a class="headerlink" href="#git-clone" title="Permanent link">Â¶</a></h3>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250317144505215.png"><img alt="image-20250317144505215" src="../images/image-20250317144505215.png"/></a> </p>
<p>åéè¿ç¨ä»åºçæ¹æ³ï¼</p>
<p>ï¼1ï¼HTTPSï¼å¨ææ¬å°ä»åºçä»£ç  push å°è¿ç¨ä»åºçæ¶åï¼éè¦éªè¯ç¨æ·ååå¯ç </p>
<p>ï¼2ï¼SSHï¼git å¼å¤´çæ¯ SSH åè®®ï¼è¿ç§æ¹å¼å¨æ¨éçæ¶åï¼ä¸éè¦éªè¯ç¨æ·ååå¯ç ï¼ä½æ¯éè¦å¨ github ä¸æ·»å SSHå¬é¥çéç½®ï¼æ¨èï¼</p>
<p>ï¼3ï¼zip download</p>
<p>æè¿éä½¿ç¨äº SSH éç½®ï¼</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250317144903028.png"><img alt="image-20250317144903028" src="../images/image-20250317144903028.png"/></a> </p>
<p>æå¡å¨ç´æ¥ git clone æ¯å¾æ¢ãæä»¥æ¬å° git cloneï¼ç¶ååä¸ä¼ æå¡å¨ã</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250317145242243.png"><img alt="image-20250317145242243" src="../images/image-20250317145242243.png"/></a> </p>
<p>æ¬å°ä¸è½½å¥½ä»¥åï¼ä½¿ç¨ FileZillaä¸ä¼ å°è¿ç¨æå¡å¨</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250317145427044.png"><img alt="image-20250317145427044" src="../images/image-20250317145427044.png"/></a> </p>
<p>downå°æ¬å°ä»¥åï¼å é¤ .gitæä»¶ï¼åæ¶è¿æ¥çè¿ç¨ä»åº</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250317145705700.png"><img alt="image-20250317145705700" src="../images/image-20250317145705700.png"/></a> </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250317145752968.png"><img alt="image-20250317145752968" src="../images/image-20250317145752968.png"/></a> </p>
<h3 id="readme">readme<a class="headerlink" href="#readme" title="Permanent link">Â¶</a></h3>
<p>ä¸è½½æ°æ®é</p>
<p>è®¾ç½®æ°æ®éè·¯å¾</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250317150739551.png"><img alt="image-20250317150739551" src="../images/image-20250317150739551.png"/></a> </p>
<h3 id="_2">è°è¯éç½®<a class="headerlink" href="#_2" title="Permanent link">Â¶</a></h3>
<p>æ°å»ºéç½®æä»¶</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250317150852423.png"><img alt="image-20250317150852423" src="../images/image-20250317150852423.png"/></a> </p>
<p>ä¿®æ¹éç½®æä»¶</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250317151048416.png"><img alt="image-20250317151048416" src="../images/image-20250317151048416.png"/></a> </p>
<p>ä¿®æ¹éç½®æä»¶</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a><a href="#__codelineno-0-1"><span class="linenos" data-linenos="1 "></span></a>        {
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a><a href="#__codelineno-0-2"><span class="linenos" data-linenos="2 "></span></a>            "name": "Autoformer",
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3"></a><a href="#__codelineno-0-3"><span class="linenos" data-linenos="3 "></span></a>            "type": "python",
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4"></a><a href="#__codelineno-0-4"><span class="linenos" data-linenos="4 "></span></a>            "request": "attach",
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5"></a><a href="#__codelineno-0-5"><span class="linenos" data-linenos="5 "></span></a>            "connect": {
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><a href="#__codelineno-0-6"><span class="linenos" data-linenos="6 "></span></a>                "host": "localhost",
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><a href="#__codelineno-0-7"><span class="linenos" data-linenos="7 "></span></a>                "port": 5997
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a><a href="#__codelineno-0-8"><span class="linenos" data-linenos="8 "></span></a>            }
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a><a href="#__codelineno-0-9"><span class="linenos" data-linenos="9 "></span></a>        },
</span></code></pre></div>
<p>ä¿®æ¹ sh æä»¶</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a><a href="#__codelineno-1-1"><span class="linenos" data-linenos="1 "></span></a>python -m debugpy --listen 5997 --wait-for-client run.py \
</span></code></pre></div>
<h3 id="python">æ°å»º python èæç¯å¢<a class="headerlink" href="#python" title="Permanent link">Â¶</a></h3>
<p>æ¬å®éªæéè¦çå®éªç¯å¢</p>
<blockquote>
<p>Install Python 3.6, PyTorch 1.9.0.</p>
</blockquote>
<p>åèå½ä»¤</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1"></a><a href="#__codelineno-2-1"><span class="linenos" data-linenos="1 "></span></a>conda create -n dave python==3.8
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2"></a><a href="#__codelineno-2-2"><span class="linenos" data-linenos="2 "></span></a>conda activate dave
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3"></a><a href="#__codelineno-2-3"><span class="linenos" data-linenos="3 "></span></a>conda install pytorch==2.1.2 torchvision==0.16.2 torchaudio==2.1.2 pytorch-cuda=11.8 -c pytorch -c nvidia
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4"></a><a href="#__codelineno-2-4"><span class="linenos" data-linenos="4 "></span></a>conda install numpy
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5"></a><a href="#__codelineno-2-5"><span class="linenos" data-linenos="5 "></span></a>conda install scikit-image
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6"></a><a href="#__codelineno-2-6"><span class="linenos" data-linenos="6 "></span></a>conda install scikit-learn
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7"></a><a href="#__codelineno-2-7"><span class="linenos" data-linenos="7 "></span></a>conda install tqdm
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8"></a><a href="#__codelineno-2-8"><span class="linenos" data-linenos="8 "></span></a>conda install pycocotools
</span></code></pre></div>
<p>æ¿æ´»ãéåºï¼</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1"></a><a href="#__codelineno-3-1"><span class="linenos" data-linenos="1 "></span></a># To activate this environment, use               
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2"></a><a href="#__codelineno-3-2"><span class="linenos" data-linenos="2 "></span></a>#     $ conda activate Autoformer
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3"></a><a href="#__codelineno-3-3"><span class="linenos" data-linenos="3 "></span></a>#
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4"></a><a href="#__codelineno-3-4"><span class="linenos" data-linenos="4 "></span></a># To deactivate an active environment, use
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5"></a><a href="#__codelineno-3-5"><span class="linenos" data-linenos="5 "></span></a>#
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6"></a><a href="#__codelineno-3-6"><span class="linenos" data-linenos="6 "></span></a>#     $ conda deactivate
</span></code></pre></div>
<p>ç¨ requirements.txt å®è£éè¦çåº</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1"></a><a href="#__codelineno-4-1"><span class="linenos" data-linenos="1 "></span></a>conda create -n SegRNN python=3.8
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2"></a><a href="#__codelineno-4-2"><span class="linenos" data-linenos="2 "></span></a>conda activate SegRNN
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3"></a><a href="#__codelineno-4-3"><span class="linenos" data-linenos="3 "></span></a>pip install -r requirements.txt
</span></code></pre></div>
<p>å¯å¨ sh æä»¶ï¼</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1"></a><a href="#__codelineno-5-1"><span class="linenos" data-linenos="1 "></span></a>sh run_main.sh
</span></code></pre></div>
<p><strong>éç¨äºæ¬å®éªçææå½ä»¤ :</strong></p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1"></a><a href="#__codelineno-6-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">conda</span> <span class="n">create</span> <span class="o">-</span><span class="n">n</span> <span class="n">Autoformer</span> <span class="n">python</span><span class="o">=</span><span class="mf">3.6</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2"></a><a href="#__codelineno-6-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">conda</span> <span class="n">activate</span> <span class="n">Autoformer</span>
</span></code></pre></div>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1"></a><a href="#__codelineno-7-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">conda</span> <span class="n">env</span> <span class="nb">list</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2"></a><a href="#__codelineno-7-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">conda</span> <span class="n">actiavte</span> <span class="n">ç¯å¢å</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3"></a><a href="#__codelineno-7-3"><span class="linenos" data-linenos="3 "></span></a><span class="n">conda</span> <span class="n">deactivate</span>
</span></code></pre></div>
<p><a href="https://pytorch.org/">pytorch å®ç½</a>æ¥çæéå½ä»¤</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250317154037815.png"><img alt="image-20250317154037815" src="../images/image-20250317154037815.png"/></a> </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250317153952283.png"><img alt="image-20250317153952283" src="../images/image-20250317153952283.png"/></a></p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1"></a><a href="#__codelineno-8-1"><span class="linenos" data-linenos="1 "></span></a>conda install pytorch==1.9.0 torchvision==0.10.0 torchaudio==0.9.0 cudatoolkit=10.2 -c pytorch
</span></code></pre></div>
<h3 id="requirements">requirements<a class="headerlink" href="#requirements" title="Permanent link">Â¶</a></h3>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1"></a><a href="#__codelineno-9-1"><span class="linenos" data-linenos="1 "></span></a>pip install -r requirements.txt
</span></code></pre></div>
<p>æèï¼</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1"></a><a href="#__codelineno-10-1"><span class="linenos" data-linenos="1 "></span></a>conda create -n Autoformer python=3.6
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2"></a><a href="#__codelineno-10-2"><span class="linenos" data-linenos="2 "></span></a>conda activate Autoformer
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3"></a><a href="#__codelineno-10-3"><span class="linenos" data-linenos="3 "></span></a>conda install pytorch==1.9.0 torchvision==0.10.0 torchaudio==0.9.0 cudatoolkit=10.2 -c pytorch
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4"></a><a href="#__codelineno-10-4"><span class="linenos" data-linenos="4 "></span></a>conda install pandas
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5"></a><a href="#__codelineno-10-5"><span class="linenos" data-linenos="5 "></span></a>conda install scikit-learn
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6"></a><a href="#__codelineno-10-6"><span class="linenos" data-linenos="6 "></span></a>conda install debugpy
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7"></a><a href="#__codelineno-10-7"><span class="linenos" data-linenos="7 "></span></a>conda install matplotlib
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8"></a><a href="#__codelineno-10-8"><span class="linenos" data-linenos="8 "></span></a>conda install reformer_pytorch
</span></code></pre></div>
<p>éç½®å¥½ä»¥åï¼æåè¿å¥è°è¯ï¼</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250317155629524.png"><img alt="image-20250317155629524" src="../images/image-20250317155629524.png"/></a> </p>
<h2 id="_3">å¼å§è°è¯<a class="headerlink" href="#_3" title="Permanent link">Â¶</a></h2>
<p>ä»£ç ç¸ä¼¼åº¦æé«ã</p>
<p><strong>Autoformer initï¼36ï¼18ï¼-ã24</strong></p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250317160059801.png"><img alt="image-20250317160059801" src="../images/image-20250317160059801.png"/></a></p>
<p>setting:</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1"></a><a href="#__codelineno-11-1"><span class="linenos" data-linenos="1 "></span></a>ili_36_24_Autoformer_custom_ftM_sl36_ll18_pl24_dm512_nh8_el2_dl1_df2048_fc3_ebtimeF_dtTrue_Exp_0
</span></code></pre></div>
<p>model_id  36 é¢æµ 24 æ­¥é¿ï¼label=18ï¼ãAutoFormer æ¨¡åï¼èªå®ä¹æ°æ®éï¼é¢æµå¤åéï¼è¾å¥åºå 36ï¼æ ç­¾åºå 18ï¼é¢æµåºå 24ï¼åµå¥ç»´åº¦ 512ï¼æ³¨æåå¤´æ° 8ï¼2å±ç¼ç å±ï¼1 å±è§£ç å±ï¼</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1"></a><a href="#__codelineno-12-1"><span class="linenos" data-linenos="1 "></span></a>df2048_fc3_ebtimeF_dtTrue_Exp_0
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2"></a><a href="#__codelineno-12-2"><span class="linenos" data-linenos="2 "></span></a>                args.d_ff,
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3"></a><a href="#__codelineno-12-3"><span class="linenos" data-linenos="3 "></span></a>                args.factor,
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4"></a><a href="#__codelineno-12-4"><span class="linenos" data-linenos="4 "></span></a>                args.embed,
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5"></a><a href="#__codelineno-12-5"><span class="linenos" data-linenos="5 "></span></a>                args.distil,
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6"></a><a href="#__codelineno-12-6"><span class="linenos" data-linenos="6 "></span></a>                args.des, ii)
</span></code></pre></div>
<p><strong>Autoformer model</strong></p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1"></a><a href="#__codelineno-13-1"><span class="linenos" data-linenos="  1 "></span></a><span class="n">Model</span><span class="p">(</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2"></a><a href="#__codelineno-13-2"><span class="linenos" data-linenos="  2 "></span></a>  <span class="p">(</span><span class="n">decomp</span><span class="p">):</span> <span class="n">series_decomp</span><span class="p">(</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3"></a><a href="#__codelineno-13-3"><span class="linenos" data-linenos="  3 "></span></a>    <span class="p">(</span><span class="n">moving_avg</span><span class="p">):</span> <span class="n">moving_avg</span><span class="p">(</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4"></a><a href="#__codelineno-13-4"><span class="linenos" data-linenos="  4 "></span></a>      <span class="p">(</span><span class="n">avg</span><span class="p">):</span> <span class="n">AvgPool1d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5"></a><a href="#__codelineno-13-5"><span class="linenos" data-linenos="  5 "></span></a>    <span class="p">)</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6"></a><a href="#__codelineno-13-6"><span class="linenos" data-linenos="  6 "></span></a>  <span class="p">)</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7"></a><a href="#__codelineno-13-7"><span class="linenos" data-linenos="  7 "></span></a>  <span class="p">(</span><span class="n">enc_embedding</span><span class="p">):</span> <span class="n">DataEmbedding_wo_pos</span><span class="p">(</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8"></a><a href="#__codelineno-13-8"><span class="linenos" data-linenos="  8 "></span></a>    <span class="p">(</span><span class="n">value_embedding</span><span class="p">):</span> <span class="n">TokenEmbedding</span><span class="p">(</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9"></a><a href="#__codelineno-13-9"><span class="linenos" data-linenos="  9 "></span></a>      <span class="p">(</span><span class="n">tokenConv</span><span class="p">):</span> <span class="n">Conv1d</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">padding_mode</span><span class="o">=</span><span class="n">circular</span><span class="p">)</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10"></a><a href="#__codelineno-13-10"><span class="linenos" data-linenos=" 10 "></span></a>    <span class="p">)</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11"></a><a href="#__codelineno-13-11"><span class="linenos" data-linenos=" 11 "></span></a>    <span class="p">(</span><span class="n">position_embedding</span><span class="p">):</span> <span class="n">PositionalEmbedding</span><span class="p">()</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12"></a><a href="#__codelineno-13-12"><span class="linenos" data-linenos=" 12 "></span></a>    <span class="p">(</span><span class="n">temporal_embedding</span><span class="p">):</span> <span class="n">TimeFeatureEmbedding</span><span class="p">(</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13"></a><a href="#__codelineno-13-13"><span class="linenos" data-linenos=" 13 "></span></a>      <span class="p">(</span><span class="n">embed</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14"></a><a href="#__codelineno-13-14"><span class="linenos" data-linenos=" 14 "></span></a>    <span class="p">)</span>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15"></a><a href="#__codelineno-13-15"><span class="linenos" data-linenos=" 15 "></span></a>    <span class="p">(</span><span class="n">dropout</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16"></a><a href="#__codelineno-13-16"><span class="linenos" data-linenos=" 16 "></span></a>  <span class="p">)</span>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17"></a><a href="#__codelineno-13-17"><span class="linenos" data-linenos=" 17 "></span></a>  <span class="p">(</span><span class="n">dec_embedding</span><span class="p">):</span> <span class="n">DataEmbedding_wo_pos</span><span class="p">(</span>
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18"></a><a href="#__codelineno-13-18"><span class="linenos" data-linenos=" 18 "></span></a>    <span class="p">(</span><span class="n">value_embedding</span><span class="p">):</span> <span class="n">TokenEmbedding</span><span class="p">(</span>
</span><span id="__span-13-19"><a id="__codelineno-13-19" name="__codelineno-13-19"></a><a href="#__codelineno-13-19"><span class="linenos" data-linenos=" 19 "></span></a>      <span class="p">(</span><span class="n">tokenConv</span><span class="p">):</span> <span class="n">Conv1d</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">padding_mode</span><span class="o">=</span><span class="n">circular</span><span class="p">)</span>
</span><span id="__span-13-20"><a id="__codelineno-13-20" name="__codelineno-13-20"></a><a href="#__codelineno-13-20"><span class="linenos" data-linenos=" 20 "></span></a>    <span class="p">)</span>
</span><span id="__span-13-21"><a id="__codelineno-13-21" name="__codelineno-13-21"></a><a href="#__codelineno-13-21"><span class="linenos" data-linenos=" 21 "></span></a>    <span class="p">(</span><span class="n">position_embedding</span><span class="p">):</span> <span class="n">PositionalEmbedding</span><span class="p">()</span>
</span><span id="__span-13-22"><a id="__codelineno-13-22" name="__codelineno-13-22"></a><a href="#__codelineno-13-22"><span class="linenos" data-linenos=" 22 "></span></a>    <span class="p">(</span><span class="n">temporal_embedding</span><span class="p">):</span> <span class="n">TimeFeatureEmbedding</span><span class="p">(</span>
</span><span id="__span-13-23"><a id="__codelineno-13-23" name="__codelineno-13-23"></a><a href="#__codelineno-13-23"><span class="linenos" data-linenos=" 23 "></span></a>      <span class="p">(</span><span class="n">embed</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-24"><a id="__codelineno-13-24" name="__codelineno-13-24"></a><a href="#__codelineno-13-24"><span class="linenos" data-linenos=" 24 "></span></a>    <span class="p">)</span>
</span><span id="__span-13-25"><a id="__codelineno-13-25" name="__codelineno-13-25"></a><a href="#__codelineno-13-25"><span class="linenos" data-linenos=" 25 "></span></a>    <span class="p">(</span><span class="n">dropout</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-26"><a id="__codelineno-13-26" name="__codelineno-13-26"></a><a href="#__codelineno-13-26"><span class="linenos" data-linenos=" 26 "></span></a>  <span class="p">)</span>
</span><span id="__span-13-27"><a id="__codelineno-13-27" name="__codelineno-13-27"></a><a href="#__codelineno-13-27"><span class="linenos" data-linenos=" 27 "></span></a>  <span class="p">(</span><span class="n">encoder</span><span class="p">):</span> <span class="n">Encoder</span><span class="p">(</span>
</span><span id="__span-13-28"><a id="__codelineno-13-28" name="__codelineno-13-28"></a><a href="#__codelineno-13-28"><span class="linenos" data-linenos=" 28 "></span></a>    <span class="p">(</span><span class="n">attn_layers</span><span class="p">):</span> <span class="n">ModuleList</span><span class="p">(</span>
</span><span id="__span-13-29"><a id="__codelineno-13-29" name="__codelineno-13-29"></a><a href="#__codelineno-13-29"><span class="linenos" data-linenos=" 29 "></span></a>      <span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">EncoderLayer</span><span class="p">(</span>
</span><span id="__span-13-30"><a id="__codelineno-13-30" name="__codelineno-13-30"></a><a href="#__codelineno-13-30"><span class="linenos" data-linenos=" 30 "></span></a>        <span class="p">(</span><span class="n">attention</span><span class="p">):</span> <span class="n">AutoCorrelationLayer</span><span class="p">(</span>
</span><span id="__span-13-31"><a id="__codelineno-13-31" name="__codelineno-13-31"></a><a href="#__codelineno-13-31"><span class="linenos" data-linenos=" 31 "></span></a>          <span class="p">(</span><span class="n">inner_correlation</span><span class="p">):</span> <span class="n">AutoCorrelation</span><span class="p">(</span>
</span><span id="__span-13-32"><a id="__codelineno-13-32" name="__codelineno-13-32"></a><a href="#__codelineno-13-32"><span class="linenos" data-linenos=" 32 "></span></a>            <span class="p">(</span><span class="n">dropout</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-33"><a id="__codelineno-13-33" name="__codelineno-13-33"></a><a href="#__codelineno-13-33"><span class="linenos" data-linenos=" 33 "></span></a>          <span class="p">)</span>
</span><span id="__span-13-34"><a id="__codelineno-13-34" name="__codelineno-13-34"></a><a href="#__codelineno-13-34"><span class="linenos" data-linenos=" 34 "></span></a>          <span class="p">(</span><span class="n">query_projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-35"><a id="__codelineno-13-35" name="__codelineno-13-35"></a><a href="#__codelineno-13-35"><span class="linenos" data-linenos=" 35 "></span></a>          <span class="p">(</span><span class="n">key_projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-36"><a id="__codelineno-13-36" name="__codelineno-13-36"></a><a href="#__codelineno-13-36"><span class="linenos" data-linenos=" 36 "></span></a>          <span class="p">(</span><span class="n">value_projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-37"><a id="__codelineno-13-37" name="__codelineno-13-37"></a><a href="#__codelineno-13-37"><span class="linenos" data-linenos=" 37 "></span></a>          <span class="p">(</span><span class="n">out_projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-38"><a id="__codelineno-13-38" name="__codelineno-13-38"></a><a href="#__codelineno-13-38"><span class="linenos" data-linenos=" 38 "></span></a>        <span class="p">)</span>
</span><span id="__span-13-39"><a id="__codelineno-13-39" name="__codelineno-13-39"></a><a href="#__codelineno-13-39"><span class="linenos" data-linenos=" 39 "></span></a>        <span class="p">(</span><span class="n">conv1</span><span class="p">):</span> <span class="n">Conv1d</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">2048</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-40"><a id="__codelineno-13-40" name="__codelineno-13-40"></a><a href="#__codelineno-13-40"><span class="linenos" data-linenos=" 40 "></span></a>        <span class="p">(</span><span class="n">conv2</span><span class="p">):</span> <span class="n">Conv1d</span><span class="p">(</span><span class="mi">2048</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-41"><a id="__codelineno-13-41" name="__codelineno-13-41"></a><a href="#__codelineno-13-41"><span class="linenos" data-linenos=" 41 "></span></a>        <span class="p">(</span><span class="n">decomp1</span><span class="p">):</span> <span class="n">series_decomp</span><span class="p">(</span>
</span><span id="__span-13-42"><a id="__codelineno-13-42" name="__codelineno-13-42"></a><a href="#__codelineno-13-42"><span class="linenos" data-linenos=" 42 "></span></a>          <span class="p">(</span><span class="n">moving_avg</span><span class="p">):</span> <span class="n">moving_avg</span><span class="p">(</span>
</span><span id="__span-13-43"><a id="__codelineno-13-43" name="__codelineno-13-43"></a><a href="#__codelineno-13-43"><span class="linenos" data-linenos=" 43 "></span></a>            <span class="p">(</span><span class="n">avg</span><span class="p">):</span> <span class="n">AvgPool1d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
</span><span id="__span-13-44"><a id="__codelineno-13-44" name="__codelineno-13-44"></a><a href="#__codelineno-13-44"><span class="linenos" data-linenos=" 44 "></span></a>          <span class="p">)</span>
</span><span id="__span-13-45"><a id="__codelineno-13-45" name="__codelineno-13-45"></a><a href="#__codelineno-13-45"><span class="linenos" data-linenos=" 45 "></span></a>        <span class="p">)</span>
</span><span id="__span-13-46"><a id="__codelineno-13-46" name="__codelineno-13-46"></a><a href="#__codelineno-13-46"><span class="linenos" data-linenos=" 46 "></span></a>        <span class="p">(</span><span class="n">decomp2</span><span class="p">):</span> <span class="n">series_decomp</span><span class="p">(</span>
</span><span id="__span-13-47"><a id="__codelineno-13-47" name="__codelineno-13-47"></a><a href="#__codelineno-13-47"><span class="linenos" data-linenos=" 47 "></span></a>          <span class="p">(</span><span class="n">moving_avg</span><span class="p">):</span> <span class="n">moving_avg</span><span class="p">(</span>
</span><span id="__span-13-48"><a id="__codelineno-13-48" name="__codelineno-13-48"></a><a href="#__codelineno-13-48"><span class="linenos" data-linenos=" 48 "></span></a>            <span class="p">(</span><span class="n">avg</span><span class="p">):</span> <span class="n">AvgPool1d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
</span><span id="__span-13-49"><a id="__codelineno-13-49" name="__codelineno-13-49"></a><a href="#__codelineno-13-49"><span class="linenos" data-linenos=" 49 "></span></a>          <span class="p">)</span>
</span><span id="__span-13-50"><a id="__codelineno-13-50" name="__codelineno-13-50"></a><a href="#__codelineno-13-50"><span class="linenos" data-linenos=" 50 "></span></a>        <span class="p">)</span>
</span><span id="__span-13-51"><a id="__codelineno-13-51" name="__codelineno-13-51"></a><a href="#__codelineno-13-51"><span class="linenos" data-linenos=" 51 "></span></a>        <span class="p">(</span><span class="n">dropout</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-52"><a id="__codelineno-13-52" name="__codelineno-13-52"></a><a href="#__codelineno-13-52"><span class="linenos" data-linenos=" 52 "></span></a>      <span class="p">)</span>
</span><span id="__span-13-53"><a id="__codelineno-13-53" name="__codelineno-13-53"></a><a href="#__codelineno-13-53"><span class="linenos" data-linenos=" 53 "></span></a>      <span class="p">(</span><span class="mi">1</span><span class="p">):</span> <span class="n">EncoderLayer</span><span class="p">(</span>
</span><span id="__span-13-54"><a id="__codelineno-13-54" name="__codelineno-13-54"></a><a href="#__codelineno-13-54"><span class="linenos" data-linenos=" 54 "></span></a>        <span class="p">(</span><span class="n">attention</span><span class="p">):</span> <span class="n">AutoCorrelationLayer</span><span class="p">(</span>
</span><span id="__span-13-55"><a id="__codelineno-13-55" name="__codelineno-13-55"></a><a href="#__codelineno-13-55"><span class="linenos" data-linenos=" 55 "></span></a>          <span class="p">(</span><span class="n">inner_correlation</span><span class="p">):</span> <span class="n">AutoCorrelation</span><span class="p">(</span>
</span><span id="__span-13-56"><a id="__codelineno-13-56" name="__codelineno-13-56"></a><a href="#__codelineno-13-56"><span class="linenos" data-linenos=" 56 "></span></a>            <span class="p">(</span><span class="n">dropout</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-57"><a id="__codelineno-13-57" name="__codelineno-13-57"></a><a href="#__codelineno-13-57"><span class="linenos" data-linenos=" 57 "></span></a>          <span class="p">)</span>
</span><span id="__span-13-58"><a id="__codelineno-13-58" name="__codelineno-13-58"></a><a href="#__codelineno-13-58"><span class="linenos" data-linenos=" 58 "></span></a>          <span class="p">(</span><span class="n">query_projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-59"><a id="__codelineno-13-59" name="__codelineno-13-59"></a><a href="#__codelineno-13-59"><span class="linenos" data-linenos=" 59 "></span></a>          <span class="p">(</span><span class="n">key_projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-60"><a id="__codelineno-13-60" name="__codelineno-13-60"></a><a href="#__codelineno-13-60"><span class="linenos" data-linenos=" 60 "></span></a>          <span class="p">(</span><span class="n">value_projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-61"><a id="__codelineno-13-61" name="__codelineno-13-61"></a><a href="#__codelineno-13-61"><span class="linenos" data-linenos=" 61 "></span></a>          <span class="p">(</span><span class="n">out_projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-62"><a id="__codelineno-13-62" name="__codelineno-13-62"></a><a href="#__codelineno-13-62"><span class="linenos" data-linenos=" 62 "></span></a>        <span class="p">)</span>
</span><span id="__span-13-63"><a id="__codelineno-13-63" name="__codelineno-13-63"></a><a href="#__codelineno-13-63"><span class="linenos" data-linenos=" 63 "></span></a>        <span class="p">(</span><span class="n">conv1</span><span class="p">):</span> <span class="n">Conv1d</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">2048</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-64"><a id="__codelineno-13-64" name="__codelineno-13-64"></a><a href="#__codelineno-13-64"><span class="linenos" data-linenos=" 64 "></span></a>        <span class="p">(</span><span class="n">conv2</span><span class="p">):</span> <span class="n">Conv1d</span><span class="p">(</span><span class="mi">2048</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-65"><a id="__codelineno-13-65" name="__codelineno-13-65"></a><a href="#__codelineno-13-65"><span class="linenos" data-linenos=" 65 "></span></a>        <span class="p">(</span><span class="n">decomp1</span><span class="p">):</span> <span class="n">series_decomp</span><span class="p">(</span>
</span><span id="__span-13-66"><a id="__codelineno-13-66" name="__codelineno-13-66"></a><a href="#__codelineno-13-66"><span class="linenos" data-linenos=" 66 "></span></a>          <span class="p">(</span><span class="n">moving_avg</span><span class="p">):</span> <span class="n">moving_avg</span><span class="p">(</span>
</span><span id="__span-13-67"><a id="__codelineno-13-67" name="__codelineno-13-67"></a><a href="#__codelineno-13-67"><span class="linenos" data-linenos=" 67 "></span></a>            <span class="p">(</span><span class="n">avg</span><span class="p">):</span> <span class="n">AvgPool1d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
</span><span id="__span-13-68"><a id="__codelineno-13-68" name="__codelineno-13-68"></a><a href="#__codelineno-13-68"><span class="linenos" data-linenos=" 68 "></span></a>          <span class="p">)</span>
</span><span id="__span-13-69"><a id="__codelineno-13-69" name="__codelineno-13-69"></a><a href="#__codelineno-13-69"><span class="linenos" data-linenos=" 69 "></span></a>        <span class="p">)</span>
</span><span id="__span-13-70"><a id="__codelineno-13-70" name="__codelineno-13-70"></a><a href="#__codelineno-13-70"><span class="linenos" data-linenos=" 70 "></span></a>        <span class="p">(</span><span class="n">decomp2</span><span class="p">):</span> <span class="n">series_decomp</span><span class="p">(</span>
</span><span id="__span-13-71"><a id="__codelineno-13-71" name="__codelineno-13-71"></a><a href="#__codelineno-13-71"><span class="linenos" data-linenos=" 71 "></span></a>          <span class="p">(</span><span class="n">moving_avg</span><span class="p">):</span> <span class="n">moving_avg</span><span class="p">(</span>
</span><span id="__span-13-72"><a id="__codelineno-13-72" name="__codelineno-13-72"></a><a href="#__codelineno-13-72"><span class="linenos" data-linenos=" 72 "></span></a>            <span class="p">(</span><span class="n">avg</span><span class="p">):</span> <span class="n">AvgPool1d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
</span><span id="__span-13-73"><a id="__codelineno-13-73" name="__codelineno-13-73"></a><a href="#__codelineno-13-73"><span class="linenos" data-linenos=" 73 "></span></a>          <span class="p">)</span>
</span><span id="__span-13-74"><a id="__codelineno-13-74" name="__codelineno-13-74"></a><a href="#__codelineno-13-74"><span class="linenos" data-linenos=" 74 "></span></a>        <span class="p">)</span>
</span><span id="__span-13-75"><a id="__codelineno-13-75" name="__codelineno-13-75"></a><a href="#__codelineno-13-75"><span class="linenos" data-linenos=" 75 "></span></a>        <span class="p">(</span><span class="n">dropout</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-76"><a id="__codelineno-13-76" name="__codelineno-13-76"></a><a href="#__codelineno-13-76"><span class="linenos" data-linenos=" 76 "></span></a>      <span class="p">)</span>
</span><span id="__span-13-77"><a id="__codelineno-13-77" name="__codelineno-13-77"></a><a href="#__codelineno-13-77"><span class="linenos" data-linenos=" 77 "></span></a>    <span class="p">)</span>
</span><span id="__span-13-78"><a id="__codelineno-13-78" name="__codelineno-13-78"></a><a href="#__codelineno-13-78"><span class="linenos" data-linenos=" 78 "></span></a>    <span class="p">(</span><span class="n">norm</span><span class="p">):</span> <span class="n">my_Layernorm</span><span class="p">(</span>
</span><span id="__span-13-79"><a id="__codelineno-13-79" name="__codelineno-13-79"></a><a href="#__codelineno-13-79"><span class="linenos" data-linenos=" 79 "></span></a>      <span class="p">(</span><span class="n">layernorm</span><span class="p">):</span> <span class="n">LayerNorm</span><span class="p">((</span><span class="mi">512</span><span class="p">,),</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">elementwise_affine</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-80"><a id="__codelineno-13-80" name="__codelineno-13-80"></a><a href="#__codelineno-13-80"><span class="linenos" data-linenos=" 80 "></span></a>    <span class="p">)</span>
</span><span id="__span-13-81"><a id="__codelineno-13-81" name="__codelineno-13-81"></a><a href="#__codelineno-13-81"><span class="linenos" data-linenos=" 81 "></span></a>  <span class="p">)</span>
</span><span id="__span-13-82"><a id="__codelineno-13-82" name="__codelineno-13-82"></a><a href="#__codelineno-13-82"><span class="linenos" data-linenos=" 82 "></span></a>  <span class="p">(</span><span class="n">decoder</span><span class="p">):</span> <span class="n">Decoder</span><span class="p">(</span>
</span><span id="__span-13-83"><a id="__codelineno-13-83" name="__codelineno-13-83"></a><a href="#__codelineno-13-83"><span class="linenos" data-linenos=" 83 "></span></a>    <span class="p">(</span><span class="n">layers</span><span class="p">):</span> <span class="n">ModuleList</span><span class="p">(</span>
</span><span id="__span-13-84"><a id="__codelineno-13-84" name="__codelineno-13-84"></a><a href="#__codelineno-13-84"><span class="linenos" data-linenos=" 84 "></span></a>      <span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">DecoderLayer</span><span class="p">(</span>
</span><span id="__span-13-85"><a id="__codelineno-13-85" name="__codelineno-13-85"></a><a href="#__codelineno-13-85"><span class="linenos" data-linenos=" 85 "></span></a>        <span class="p">(</span><span class="n">self_attention</span><span class="p">):</span> <span class="n">AutoCorrelationLayer</span><span class="p">(</span>
</span><span id="__span-13-86"><a id="__codelineno-13-86" name="__codelineno-13-86"></a><a href="#__codelineno-13-86"><span class="linenos" data-linenos=" 86 "></span></a>          <span class="p">(</span><span class="n">inner_correlation</span><span class="p">):</span> <span class="n">AutoCorrelation</span><span class="p">(</span>
</span><span id="__span-13-87"><a id="__codelineno-13-87" name="__codelineno-13-87"></a><a href="#__codelineno-13-87"><span class="linenos" data-linenos=" 87 "></span></a>            <span class="p">(</span><span class="n">dropout</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-88"><a id="__codelineno-13-88" name="__codelineno-13-88"></a><a href="#__codelineno-13-88"><span class="linenos" data-linenos=" 88 "></span></a>          <span class="p">)</span>
</span><span id="__span-13-89"><a id="__codelineno-13-89" name="__codelineno-13-89"></a><a href="#__codelineno-13-89"><span class="linenos" data-linenos=" 89 "></span></a>          <span class="p">(</span><span class="n">query_projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-90"><a id="__codelineno-13-90" name="__codelineno-13-90"></a><a href="#__codelineno-13-90"><span class="linenos" data-linenos=" 90 "></span></a>          <span class="p">(</span><span class="n">key_projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-91"><a id="__codelineno-13-91" name="__codelineno-13-91"></a><a href="#__codelineno-13-91"><span class="linenos" data-linenos=" 91 "></span></a>          <span class="p">(</span><span class="n">value_projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-92"><a id="__codelineno-13-92" name="__codelineno-13-92"></a><a href="#__codelineno-13-92"><span class="linenos" data-linenos=" 92 "></span></a>          <span class="p">(</span><span class="n">out_projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-93"><a id="__codelineno-13-93" name="__codelineno-13-93"></a><a href="#__codelineno-13-93"><span class="linenos" data-linenos=" 93 "></span></a>        <span class="p">)</span>
</span><span id="__span-13-94"><a id="__codelineno-13-94" name="__codelineno-13-94"></a><a href="#__codelineno-13-94"><span class="linenos" data-linenos=" 94 "></span></a>        <span class="p">(</span><span class="n">cross_attention</span><span class="p">):</span> <span class="n">AutoCorrelationLayer</span><span class="p">(</span>
</span><span id="__span-13-95"><a id="__codelineno-13-95" name="__codelineno-13-95"></a><a href="#__codelineno-13-95"><span class="linenos" data-linenos=" 95 "></span></a>          <span class="p">(</span><span class="n">inner_correlation</span><span class="p">):</span> <span class="n">AutoCorrelation</span><span class="p">(</span>
</span><span id="__span-13-96"><a id="__codelineno-13-96" name="__codelineno-13-96"></a><a href="#__codelineno-13-96"><span class="linenos" data-linenos=" 96 "></span></a>            <span class="p">(</span><span class="n">dropout</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-97"><a id="__codelineno-13-97" name="__codelineno-13-97"></a><a href="#__codelineno-13-97"><span class="linenos" data-linenos=" 97 "></span></a>          <span class="p">)</span>
</span><span id="__span-13-98"><a id="__codelineno-13-98" name="__codelineno-13-98"></a><a href="#__codelineno-13-98"><span class="linenos" data-linenos=" 98 "></span></a>          <span class="p">(</span><span class="n">query_projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-99"><a id="__codelineno-13-99" name="__codelineno-13-99"></a><a href="#__codelineno-13-99"><span class="linenos" data-linenos=" 99 "></span></a>          <span class="p">(</span><span class="n">key_projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-100"><a id="__codelineno-13-100" name="__codelineno-13-100"></a><a href="#__codelineno-13-100"><span class="linenos" data-linenos="100 "></span></a>          <span class="p">(</span><span class="n">value_projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-101"><a id="__codelineno-13-101" name="__codelineno-13-101"></a><a href="#__codelineno-13-101"><span class="linenos" data-linenos="101 "></span></a>          <span class="p">(</span><span class="n">out_projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-102"><a id="__codelineno-13-102" name="__codelineno-13-102"></a><a href="#__codelineno-13-102"><span class="linenos" data-linenos="102 "></span></a>        <span class="p">)</span>
</span><span id="__span-13-103"><a id="__codelineno-13-103" name="__codelineno-13-103"></a><a href="#__codelineno-13-103"><span class="linenos" data-linenos="103 "></span></a>        <span class="p">(</span><span class="n">conv1</span><span class="p">):</span> <span class="n">Conv1d</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">2048</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-104"><a id="__codelineno-13-104" name="__codelineno-13-104"></a><a href="#__codelineno-13-104"><span class="linenos" data-linenos="104 "></span></a>        <span class="p">(</span><span class="n">conv2</span><span class="p">):</span> <span class="n">Conv1d</span><span class="p">(</span><span class="mi">2048</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-105"><a id="__codelineno-13-105" name="__codelineno-13-105"></a><a href="#__codelineno-13-105"><span class="linenos" data-linenos="105 "></span></a>        <span class="p">(</span><span class="n">decomp1</span><span class="p">):</span> <span class="n">series_decomp</span><span class="p">(</span>
</span><span id="__span-13-106"><a id="__codelineno-13-106" name="__codelineno-13-106"></a><a href="#__codelineno-13-106"><span class="linenos" data-linenos="106 "></span></a>          <span class="p">(</span><span class="n">moving_avg</span><span class="p">):</span> <span class="n">moving_avg</span><span class="p">(</span>
</span><span id="__span-13-107"><a id="__codelineno-13-107" name="__codelineno-13-107"></a><a href="#__codelineno-13-107"><span class="linenos" data-linenos="107 "></span></a>            <span class="p">(</span><span class="n">avg</span><span class="p">):</span> <span class="n">AvgPool1d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
</span><span id="__span-13-108"><a id="__codelineno-13-108" name="__codelineno-13-108"></a><a href="#__codelineno-13-108"><span class="linenos" data-linenos="108 "></span></a>          <span class="p">)</span>
</span><span id="__span-13-109"><a id="__codelineno-13-109" name="__codelineno-13-109"></a><a href="#__codelineno-13-109"><span class="linenos" data-linenos="109 "></span></a>        <span class="p">)</span>
</span><span id="__span-13-110"><a id="__codelineno-13-110" name="__codelineno-13-110"></a><a href="#__codelineno-13-110"><span class="linenos" data-linenos="110 "></span></a>        <span class="p">(</span><span class="n">decomp2</span><span class="p">):</span> <span class="n">series_decomp</span><span class="p">(</span>
</span><span id="__span-13-111"><a id="__codelineno-13-111" name="__codelineno-13-111"></a><a href="#__codelineno-13-111"><span class="linenos" data-linenos="111 "></span></a>          <span class="p">(</span><span class="n">moving_avg</span><span class="p">):</span> <span class="n">moving_avg</span><span class="p">(</span>
</span><span id="__span-13-112"><a id="__codelineno-13-112" name="__codelineno-13-112"></a><a href="#__codelineno-13-112"><span class="linenos" data-linenos="112 "></span></a>            <span class="p">(</span><span class="n">avg</span><span class="p">):</span> <span class="n">AvgPool1d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
</span><span id="__span-13-113"><a id="__codelineno-13-113" name="__codelineno-13-113"></a><a href="#__codelineno-13-113"><span class="linenos" data-linenos="113 "></span></a>          <span class="p">)</span>
</span><span id="__span-13-114"><a id="__codelineno-13-114" name="__codelineno-13-114"></a><a href="#__codelineno-13-114"><span class="linenos" data-linenos="114 "></span></a>        <span class="p">)</span>
</span><span id="__span-13-115"><a id="__codelineno-13-115" name="__codelineno-13-115"></a><a href="#__codelineno-13-115"><span class="linenos" data-linenos="115 "></span></a>        <span class="p">(</span><span class="n">decomp3</span><span class="p">):</span> <span class="n">series_decomp</span><span class="p">(</span>
</span><span id="__span-13-116"><a id="__codelineno-13-116" name="__codelineno-13-116"></a><a href="#__codelineno-13-116"><span class="linenos" data-linenos="116 "></span></a>          <span class="p">(</span><span class="n">moving_avg</span><span class="p">):</span> <span class="n">moving_avg</span><span class="p">(</span>
</span><span id="__span-13-117"><a id="__codelineno-13-117" name="__codelineno-13-117"></a><a href="#__codelineno-13-117"><span class="linenos" data-linenos="117 "></span></a>            <span class="p">(</span><span class="n">avg</span><span class="p">):</span> <span class="n">AvgPool1d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
</span><span id="__span-13-118"><a id="__codelineno-13-118" name="__codelineno-13-118"></a><a href="#__codelineno-13-118"><span class="linenos" data-linenos="118 "></span></a>          <span class="p">)</span>
</span><span id="__span-13-119"><a id="__codelineno-13-119" name="__codelineno-13-119"></a><a href="#__codelineno-13-119"><span class="linenos" data-linenos="119 "></span></a>        <span class="p">)</span>
</span><span id="__span-13-120"><a id="__codelineno-13-120" name="__codelineno-13-120"></a><a href="#__codelineno-13-120"><span class="linenos" data-linenos="120 "></span></a>        <span class="p">(</span><span class="n">dropout</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-121"><a id="__codelineno-13-121" name="__codelineno-13-121"></a><a href="#__codelineno-13-121"><span class="linenos" data-linenos="121 "></span></a>        <span class="p">(</span><span class="n">projection</span><span class="p">):</span> <span class="n">Conv1d</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">padding_mode</span><span class="o">=</span><span class="n">circular</span><span class="p">)</span>
</span><span id="__span-13-122"><a id="__codelineno-13-122" name="__codelineno-13-122"></a><a href="#__codelineno-13-122"><span class="linenos" data-linenos="122 "></span></a>      <span class="p">)</span>
</span><span id="__span-13-123"><a id="__codelineno-13-123" name="__codelineno-13-123"></a><a href="#__codelineno-13-123"><span class="linenos" data-linenos="123 "></span></a>    <span class="p">)</span>
</span><span id="__span-13-124"><a id="__codelineno-13-124" name="__codelineno-13-124"></a><a href="#__codelineno-13-124"><span class="linenos" data-linenos="124 "></span></a>    <span class="p">(</span><span class="n">norm</span><span class="p">):</span> <span class="n">my_Layernorm</span><span class="p">(</span>
</span><span id="__span-13-125"><a id="__codelineno-13-125" name="__codelineno-13-125"></a><a href="#__codelineno-13-125"><span class="linenos" data-linenos="125 "></span></a>      <span class="p">(</span><span class="n">layernorm</span><span class="p">):</span> <span class="n">LayerNorm</span><span class="p">((</span><span class="mi">512</span><span class="p">,),</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">elementwise_affine</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-126"><a id="__codelineno-13-126" name="__codelineno-13-126"></a><a href="#__codelineno-13-126"><span class="linenos" data-linenos="126 "></span></a>    <span class="p">)</span>
</span><span id="__span-13-127"><a id="__codelineno-13-127" name="__codelineno-13-127"></a><a href="#__codelineno-13-127"><span class="linenos" data-linenos="127 "></span></a>    <span class="p">(</span><span class="n">projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-128"><a id="__codelineno-13-128" name="__codelineno-13-128"></a><a href="#__codelineno-13-128"><span class="linenos" data-linenos="128 "></span></a>  <span class="p">)</span>
</span><span id="__span-13-129"><a id="__codelineno-13-129" name="__codelineno-13-129"></a><a href="#__codelineno-13-129"><span class="linenos" data-linenos="129 "></span></a><span class="p">)</span>
</span></code></pre></div>
<p>æ°æ®éçå è½½æ¯å®å¨ä¸æ ·çã</p>
<h3 id="encoder-embedding">encoder embedding<a class="headerlink" href="#encoder-embedding" title="Permanent link">Â¶</a></h3>
<p>ç®çï¼ç»åæ¶é´ç¹å¾ï¼å° æ°æ®ç¹å¾åµå¥å°æå®ç»´åº¦</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1"></a><a href="#__codelineno-14-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">enc_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">enc_embedding</span><span class="p">(</span><span class="n">x_enc</span><span class="p">,</span> <span class="n">x_mark_enc</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1"></a><a href="#__codelineno-15-1"><span class="linenos" data-linenos="1 "></span></a><span class="bp">self</span><span class="o">.</span><span class="n">enc_embedding</span> <span class="o">=</span> <span class="n">DataEmbedding_wo_pos</span><span class="p">(</span><span class="n">configs</span><span class="o">.</span><span class="n">enc_in</span><span class="p">,</span> <span class="n">configs</span><span class="o">.</span><span class="n">d_model</span><span class="p">,</span> <span class="n">configs</span><span class="o">.</span><span class="n">embed</span><span class="p">,</span> <span class="n">configs</span><span class="o">.</span><span class="n">freq</span><span class="p">,</span><span class="n">configs</span><span class="o">.</span><span class="n">dropout</span><span class="p">)</span>
</span></code></pre></div>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250317204752276.png"><img alt="image-20250317204752276" src="../images/image-20250317204752276.png"/></a></p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250317205258626.png"><img alt="image-20250317205258626" src="../images/image-20250317205258626.png"/></a></p>
<p><strong>æµç¨å¾</strong></p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1"></a><a href="#__codelineno-16-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="n">è¾å¥</span><span class="p">:</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2"></a><a href="#__codelineno-16-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="n">x_enc</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">D</span><span class="p">]</span>        <span class="n">x_mark_enc</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">time_features</span><span class="p">]</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3"></a><a href="#__codelineno-16-3"><span class="linenos" data-linenos=" 3 "></span></a>    <span class="o">|</span>                        <span class="o">|</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4"></a><a href="#__codelineno-16-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="n">v</span>                        <span class="n">v</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5"></a><a href="#__codelineno-16-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="o">+-----------------------------------------------+</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6"></a><a href="#__codelineno-16-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="o">|</span>           <span class="n">Model</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span><span class="n">è°ç¨</span>                  <span class="o">|</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7"></a><a href="#__codelineno-16-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="o">|</span>      <span class="bp">self</span><span class="o">.</span><span class="n">enc_embedding</span><span class="p">(</span><span class="n">x_enc</span><span class="p">,</span> <span class="n">x_mark_enc</span><span class="p">)</span>    <span class="o">|</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8"></a><a href="#__codelineno-16-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="o">+-----------------------------------------------+</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9"></a><a href="#__codelineno-16-9"><span class="linenos" data-linenos=" 9 "></span></a>            <span class="o">|</span>                <span class="o">|</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10"></a><a href="#__codelineno-16-10"><span class="linenos" data-linenos="10 "></span></a>            <span class="n">v</span>                <span class="n">v</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11"></a><a href="#__codelineno-16-11"><span class="linenos" data-linenos="11 "></span></a><span class="o">+------------------------+</span>  <span class="o">+---------------------------+</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12"></a><a href="#__codelineno-16-12"><span class="linenos" data-linenos="12 "></span></a><span class="o">|</span> <span class="n">TokenEmbedding</span> <span class="p">(</span><span class="n">å¼åµå¥</span><span class="p">)</span> <span class="o">|</span>  <span class="o">|</span> <span class="n">TemporalEmbedding</span> <span class="p">(</span><span class="n">æ¶é´åµå¥</span><span class="p">)</span><span class="o">|</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13"></a><a href="#__codelineno-16-13"><span class="linenos" data-linenos="13 "></span></a><span class="o">+------------------------+</span>  <span class="o">+---------------------------+</span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14"></a><a href="#__codelineno-16-14"><span class="linenos" data-linenos="14 "></span></a><span class="o">|</span> <span class="n">è¾å¥</span><span class="p">:</span> <span class="n">x</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">D</span><span class="p">]</span>      <span class="o">|</span>  <span class="o">|</span> <span class="n">è¾å¥</span><span class="p">:</span> <span class="n">x_mark</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">time_f</span><span class="p">]</span><span class="o">|</span>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15"></a><a href="#__codelineno-16-15"><span class="linenos" data-linenos="15 "></span></a><span class="o">|</span>                        <span class="o">|</span>  <span class="o">|</span>                           <span class="o">|</span>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16"></a><a href="#__codelineno-16-16"><span class="linenos" data-linenos="16 "></span></a><span class="o">|</span> <span class="n">æä½</span><span class="p">:</span>                  <span class="o">|</span>  <span class="o">|</span> <span class="n">æä½</span><span class="p">:</span>                     <span class="o">|</span>
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17"></a><a href="#__codelineno-16-17"><span class="linenos" data-linenos="17 "></span></a><span class="o">|</span> <span class="mf">1.</span><span class="n">è½¬ç½®</span><span class="p">:</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">L</span><span class="p">]</span>      <span class="o">|</span>  <span class="o">|</span> <span class="mf">1.</span><span class="n">è½¬æ¢ä¸ºlongç±»å</span>          <span class="o">|</span>
</span><span id="__span-16-18"><a id="__codelineno-16-18" name="__codelineno-16-18"></a><a href="#__codelineno-16-18"><span class="linenos" data-linenos="18 "></span></a><span class="o">|</span> <span class="mf">2.1</span><span class="n">Då·ç§¯</span><span class="p">:</span> <span class="n">D</span> <span class="o">-&gt;</span> <span class="n">d_model</span> <span class="o">|</span>  <span class="o">|</span> <span class="mf">2.</span><span class="n">æåæ¶é´ç¹å¾</span><span class="p">:</span>           <span class="o">|</span>
</span><span id="__span-16-19"><a id="__codelineno-16-19" name="__codelineno-16-19"></a><a href="#__codelineno-16-19"><span class="linenos" data-linenos="19 "></span></a><span class="o">|</span> <span class="mf">3.</span><span class="n">è½¬ç½®å</span><span class="p">:</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">d_model</span><span class="p">]</span><span class="o">|</span>  <span class="o">|</span>   <span class="o">-</span> <span class="n">month_x</span> <span class="p">(</span><span class="n">x</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">])</span>   <span class="o">|</span>
</span><span id="__span-16-20"><a id="__codelineno-16-20" name="__codelineno-16-20"></a><a href="#__codelineno-16-20"><span class="linenos" data-linenos="20 "></span></a><span class="o">|</span>                        <span class="o">|</span>  <span class="o">|</span>   <span class="o">-</span> <span class="n">day_x</span> <span class="p">(</span><span class="n">x</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">])</span>      <span class="o">|</span>
</span><span id="__span-16-21"><a id="__codelineno-16-21" name="__codelineno-16-21"></a><a href="#__codelineno-16-21"><span class="linenos" data-linenos="21 "></span></a><span class="o">|</span> <span class="n">è¾åº</span><span class="p">:</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">d_model</span><span class="p">]</span>  <span class="o">|</span>  <span class="o">|</span>   <span class="o">-</span> <span class="n">weekday_x</span> <span class="p">(</span><span class="n">x</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">])</span>  <span class="o">|</span>
</span><span id="__span-16-22"><a id="__codelineno-16-22" name="__codelineno-16-22"></a><a href="#__codelineno-16-22"><span class="linenos" data-linenos="22 "></span></a><span class="o">|</span>                        <span class="o">|</span>  <span class="o">|</span>   <span class="o">-</span> <span class="n">hour_x</span> <span class="p">(</span><span class="n">x</span><span class="p">[:,:,</span><span class="mi">3</span><span class="p">])</span>     <span class="o">|</span>
</span><span id="__span-16-23"><a id="__codelineno-16-23" name="__codelineno-16-23"></a><a href="#__codelineno-16-23"><span class="linenos" data-linenos="23 "></span></a><span class="o">+------------------------+</span>  <span class="o">|</span>   <span class="o">-</span> <span class="n">minute_x</span> <span class="p">(</span><span class="n">å¯é</span><span class="p">)</span>       <span class="o">|</span>
</span><span id="__span-16-24"><a id="__codelineno-16-24" name="__codelineno-16-24"></a><a href="#__codelineno-16-24"><span class="linenos" data-linenos="24 "></span></a>            <span class="o">|</span>               <span class="o">|</span>                           <span class="o">|</span>
</span><span id="__span-16-25"><a id="__codelineno-16-25" name="__codelineno-16-25"></a><a href="#__codelineno-16-25"><span class="linenos" data-linenos="25 "></span></a>            <span class="o">|</span>               <span class="o">|</span> <span class="mf">3.</span><span class="n">æ¥è¡¨è·ååæ¶é´ç¹å¾çåµå¥</span>  <span class="o">|</span>
</span><span id="__span-16-26"><a id="__codelineno-16-26" name="__codelineno-16-26"></a><a href="#__codelineno-16-26"><span class="linenos" data-linenos="26 "></span></a>            <span class="o">|</span>               <span class="o">|</span> <span class="mf">4.</span><span class="n">å°æææ¶é´åµå¥ç¸å </span>       <span class="o">|</span>
</span><span id="__span-16-27"><a id="__codelineno-16-27" name="__codelineno-16-27"></a><a href="#__codelineno-16-27"><span class="linenos" data-linenos="27 "></span></a>            <span class="o">|</span>               <span class="o">|</span>                           <span class="o">|</span>
</span><span id="__span-16-28"><a id="__codelineno-16-28" name="__codelineno-16-28"></a><a href="#__codelineno-16-28"><span class="linenos" data-linenos="28 "></span></a>            <span class="o">|</span>               <span class="o">|</span> <span class="n">è¾åº</span><span class="p">:</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">d_model</span><span class="p">]</span>     <span class="o">|</span>
</span><span id="__span-16-29"><a id="__codelineno-16-29" name="__codelineno-16-29"></a><a href="#__codelineno-16-29"><span class="linenos" data-linenos="29 "></span></a>            <span class="o">|</span>               <span class="o">+---------------------------+</span>
</span><span id="__span-16-30"><a id="__codelineno-16-30" name="__codelineno-16-30"></a><a href="#__codelineno-16-30"><span class="linenos" data-linenos="30 "></span></a>            <span class="o">|</span>                        <span class="o">|</span>
</span><span id="__span-16-31"><a id="__codelineno-16-31" name="__codelineno-16-31"></a><a href="#__codelineno-16-31"><span class="linenos" data-linenos="31 "></span></a>            <span class="o">+------------+------------+</span>
</span><span id="__span-16-32"><a id="__codelineno-16-32" name="__codelineno-16-32"></a><a href="#__codelineno-16-32"><span class="linenos" data-linenos="32 "></span></a>                         <span class="n">v</span>
</span><span id="__span-16-33"><a id="__codelineno-16-33" name="__codelineno-16-33"></a><a href="#__codelineno-16-33"><span class="linenos" data-linenos="33 "></span></a>            <span class="o">+---------------------------+</span>
</span><span id="__span-16-34"><a id="__codelineno-16-34" name="__codelineno-16-34"></a><a href="#__codelineno-16-34"><span class="linenos" data-linenos="34 "></span></a>            <span class="o">|</span> <span class="n">ç¸å å¹¶åºç¨Dropout</span>         <span class="o">|</span>
</span><span id="__span-16-35"><a id="__codelineno-16-35" name="__codelineno-16-35"></a><a href="#__codelineno-16-35"><span class="linenos" data-linenos="35 "></span></a>            <span class="o">|</span> <span class="n">value_emb</span> <span class="o">+</span> <span class="n">temporal_emb</span> <span class="o">|</span>
</span><span id="__span-16-36"><a id="__codelineno-16-36" name="__codelineno-16-36"></a><a href="#__codelineno-16-36"><span class="linenos" data-linenos="36 "></span></a>            <span class="o">+---------------------------+</span>
</span><span id="__span-16-37"><a id="__codelineno-16-37" name="__codelineno-16-37"></a><a href="#__codelineno-16-37"><span class="linenos" data-linenos="37 "></span></a>                         <span class="o">|</span>
</span><span id="__span-16-38"><a id="__codelineno-16-38" name="__codelineno-16-38"></a><a href="#__codelineno-16-38"><span class="linenos" data-linenos="38 "></span></a>                         <span class="n">v</span>
</span><span id="__span-16-39"><a id="__codelineno-16-39" name="__codelineno-16-39"></a><a href="#__codelineno-16-39"><span class="linenos" data-linenos="39 "></span></a>                  <span class="n">è¾åº</span><span class="p">:</span> <span class="n">enc_out</span>
</span><span id="__span-16-40"><a id="__codelineno-16-40" name="__codelineno-16-40"></a><a href="#__codelineno-16-40"><span class="linenos" data-linenos="40 "></span></a>                 <span class="p">[</span><span class="n">B</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">d_model</span><span class="p">]</span>
</span></code></pre></div>
<ol>
<li><strong>å¼åµå¥ (TokenEmbedding)</strong>:
   - éè¿å·ç§¯æä½å°åå§ç¹å¾ [B, L, D] æ å°å°æ´é«ç»´åº¦è¡¨ç¤º [B, L, d_model]
   - ä½¿ç¨å¾ªç¯å¡«åç1Då·ç§¯æè·å±é¨ç¹å¾æ¨¡å¼</li>
<li><strong>æ¶é´åµå¥ (TemporalEmbedding)</strong>:
   - å°æ¶é´æ è®° [B, L, time_features] è½¬æ¢ä¸º [B, L, d_model] çåµå¥åé
   - åå«ä¸ºæãæ¥ãææãå°æ¶ç­æ¶é´ç¹å¾æ¥è¡¨è·ååµå¥ï¼ç¶åç¸å 
   - æ¶é´åµå¥å¸®å©æ¨¡åè¯å«æ¶é´æ¨¡å¼(å­£èæ§ãæ¯æ¥/æ¯å¨å¨æç­)</li>
<li><strong>ç»ååµå¥</strong>:
   - å°å¼åµå¥åæ¶é´åµå¥ç¸å ï¼å½¢ææç»ç¼ç å¨è¾å¥ [B, L, d_model]
   - æ³¨ææ­¤çæ¬ä¸åå«ä½ç½®åµå¥(DataEmbedding_wo_pos)</li>
</ol>
<p>è¿ç§å¤éåµå¥æ¹å¼ä½¿æ¨¡åè½åæ¶å©ç¨æ¶é´åºåçå¼ä¿¡æ¯åæ¶é´ç¹å¾ä¿¡æ¯ï¼ä¸ºåç»­çæ³¨æåæºå¶åæ¶é´åºåå»ºæ¨¡æä¾ä¸°å¯çä¸ä¸æã</p>
<h2 id="_4">æ¨¡åå®ä¹<a class="headerlink" href="#_4" title="Permanent link">Â¶</a></h2>
<h3 id="_5">ç¼ç å¨ è§£ç å¨é¨å<a class="headerlink" href="#_5" title="Permanent link">Â¶</a></h3>
<pre class="mermaid"><code>classDiagram
    class Model {
        +DataEmbedding_wo_pos enc_embedding
        +DataEmbedding_wo_pos dec_embedding
        +Encoder encoder
        +Decoder decoder
        +series_decomp decomp
        +forward(x_enc, x_mark_enc, x_dec, x_mark_dec, enc_self_mask, dec_self_mask, dec_enc_mask)
    }

    class Encoder {
        +List~EncoderLayer~ layers
        +my_Layernorm norm_layer
        +forward(x, attn_mask)
    }

    class EncoderLayer {
        +AutoCorrelationLayer attention
        +Conv1d conv1
        +Conv1d conv2
        +series_decomp decomp1
        +series_decomp decomp2
        +Dropout dropout
        +activation
        +forward(x, attn_mask)
    }

    class AutoCorrelationLayer {
        +AutoCorrelation attention
        +Linear query_projection
        +Linear key_projection
        +Linear value_projection
        +Linear out_projection
        +forward(queries, keys, values, attn_mask)
    }

    class AutoCorrelation {
        +bool mask_flag
        +int factor
        +float scale
        +Dropout dropout
        +bool output_attention
        +time_delay_agg_training(values, corr)
        +time_delay_agg_inference(values, corr)
        +forward(queries, keys, values, attn_mask)
    }

    class Decoder {
        +List~DecoderLayer~ layers
        +my_Layernorm norm_layer
        +Linear projection
        +forward(x, enc_out, x_mask, cross_mask, trend)
    }

    class DecoderLayer {
        +AutoCorrelationLayer self_attention
        +AutoCorrelationLayer cross_attention
        +Conv1d conv1
        +Conv1d conv2
        +series_decomp decomp1
        +series_decomp decomp2
        +Dropout dropout
        +activation
        +forward(x, enc_out, x_mask, cross_mask, trend)
    }

    Model --&gt; Encoder
    Model --&gt; Decoder
    Encoder --&gt; EncoderLayer
    EncoderLayer --&gt; AutoCorrelationLayer
    EncoderLayer --&gt; Conv1d
    EncoderLayer --&gt; series_decomp
    AutoCorrelationLayer --&gt; AutoCorrelation
    Decoder --&gt; DecoderLayer
    DecoderLayer --&gt; AutoCorrelationLayer
    DecoderLayer --&gt; Conv1d
    DecoderLayer --&gt; series_decomp
</code></pre>
<h2 id="_6">è®­ç»è¿ç¨ï¼å½¢ç¶åæ¢<a class="headerlink" href="#_6" title="Permanent link">Â¶</a></h2>
<p>ï¼1ï¼</p>
<p>ä»£ç ï¼</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250319202142537.png"><img alt="image-20250319202142537" src="../images/image-20250319202142537.png"/></a> </p>
<p>éå­è®²è§£ï¼</p>
<p>model è®­ç»ä» exp_main.pyç train å½æ°å¼å§ï¼epoch è¡¨ç¤ºæ´ä¸ªè®­ç»éè¿­ä»£å æ¬¡ï¼for batchxãbatchyãbatch x markãbatch y mark ä¸ä¸ªæ¹æ¬¡ä¸ä¸ªæ¹æ¬¡çè®­ç»ï¼ç¬¬ä¸ä¸ª for è®­ç»ç epoch æ¯æä»¬èªå·±å¯ä»¥è®¾ç½®çï¼ç¬¬äºä¸ª for è®­ç»ç iteration è¿­ä»£æ¬¡æ°æ¯ <code>æ°æ®éé¿åº¦ â batch size</code></p>
<p>æ¥ä¸æ¥ï¼è°ç¨ <code>self._predict</code> æ¹æ³è¿è¡é¢æµï¼è¿é predict å½æ°éè¦çåæ° batchxãbatchyãbatch x markãbatch y mark å½¢ç¶åå«æ¯ <code>batch_x = [32,36,7], batch_y = [32,42(18+24),7],batch_x_mark=[32,36,4],batch_y_mark = [32,42,4]</code></p>
<p>32 è¡¨ç¤º ä¸ä¸ª batch æ ·æ¬çä¸ªæ°ï¼</p>
<p>36 è¡¨ç¤ºæ¯ä¸ªæ ·æ¬çæ¶é´æ­¥ï¼ä¹å¯ä»¥è¯´æ¯åæº¯çªå£çå¤§å°ï¼æèå«è¾å¥åºåçé¿åº¦</p>
<p>7 è¡¨ç¤º illness æ°æ®éçç¹å¾æ°</p>
<p>batchy ç 42 è¡¨ç¤º 18 ç label lengthï¼æ¯åç åå§è¾å¥åºåç äºåä¹ä¸ï¼è¿ä¸ªå¨è®ºæä¸­æè¯´</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250319202958076.png"><img alt="image-20250319202958076" src="../images/image-20250319202958076.png"/></a> </p>
<p>ç¼ç å¨çè¾å¥ æ¯ <code>I times d</code> <span class="arithmatex">\(I\)</span> è¡¨ç¤º è¾å¥åºåé¿åº¦ï¼å¨è¿éä¾å­å°±æ¯ 36ï¼<span class="arithmatex">\(d\)</span> æ¯ç¹å¾æ°ï¼è¿éçç¹å¾æ°ï¼é½å»æäºæ¶é´æ³ï¼ä¹å°±æ¯ 7</p>
<p>è§£ç å¨çè¾å¥æ¯ <code>äºåä¹ I + O</code>ï¼<code>äºåä¹ I</code>è¡¨ç¤º è¾å¥åºåé¿åº¦çä¸åï¼<code>O</code> è¡¨ç¤ºé¢æµæ­¥é¿ï¼ä¹å°±æ¯è¾åºåºåçé¿åº¦</p>
<p>batch x markï¼batch y mark å°±æ¯å¤ççæ¶é´æ³ç¹å¾äºï¼åå«ä¸å¤©çç¬¬å ä¸ªå°æ¶ï¼ä¸ä¸ªæçç¬¬å å¤©ï¼ä¸å¨çç¬¬å å¤©ï¼ä¸ä¸ªæçç¬¬å å¤©ï¼å°±æ¯æä»¬ä¹åè®²è¿ç SegRNNï¼è¿éå¤çè¿æ¶åäº å½ä¸å åä¸­å¿åï¼ä¸åéå¤å¦ã</p>
<hr/>
<p><strong>å¥½äºï¼æ¥ä¸æ¥è¿å¥ é¢æµé¨åï¼<mark>æ­¥è¿</mark>ï¼ä¹å°±æ¯ predict å½æ°</strong> </p>
<p>é¦åï¼æé å®æ´çè§£ç å¨è¾å¥ï¼å·ä½çæä½æ¯ï¼åç batch y ä¸­çé¢æµæ­¥é¿ï¼å¡«å 0ï¼å¹¶ä¸ ä¹åç label length è¿è¡æ¼æ¥ãä¹å°±æ¯è¿ä¸¤è¡ä»£ç </p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1"></a><a href="#__codelineno-17-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># decoder input </span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2"></a><a href="#__codelineno-17-2"><span class="linenos" data-linenos="2 "></span></a><span class="c1"># åå»ºè§£ç å¨è¾å¥çé¶å¼ éé¨åï¼ç¨äºé¢æµæªæ¥æ¶é´æ­¥</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3"></a><a href="#__codelineno-17-3"><span class="linenos" data-linenos="3 "></span></a><span class="c1"># batch_y[B, label_len+pred_len, D] -&gt; åç -&gt; [B, pred_len, D] -&gt; åå»ºç¸åå½¢ç¶å¨é¶å¼ é -&gt; dec_inp[B, pred_len, D]</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4"></a><a href="#__codelineno-17-4"><span class="linenos" data-linenos="4 "></span></a><span class="n">dec_inp</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">batch_y</span><span class="p">[:,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">pred_len</span><span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5"></a><a href="#__codelineno-17-5"><span class="linenos" data-linenos="5 "></span></a>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6"></a><a href="#__codelineno-17-6"><span class="linenos" data-linenos="6 "></span></a><span class="c1"># å°åå²æ°æ®(æ ç­¾åºå)ä¸é¶å¼ éè¿æ¥ï¼å½¢æå®æ´çè§£ç å¨è¾å¥ï¼å¹¶ç§»å¨å°æå®è®¾å¤</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7"></a><a href="#__codelineno-17-7"><span class="linenos" data-linenos="7 "></span></a><span class="c1"># [B, label_len, D] + [B, pred_len, D] -&gt; torch.catæ²¿ç»´åº¦1æ¼æ¥ -&gt; [B, label_len+pred_len, D] -&gt; to(device) -&gt; å¨GPUä¸çdec_inp</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8"></a><a href="#__codelineno-17-8"><span class="linenos" data-linenos="8 "></span></a><span class="n">dec_inp</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">batch_y</span><span class="p">[:,</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">label_len</span><span class="p">,</span> <span class="p">:],</span> <span class="n">dec_inp</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span></code></pre></div>
<p>æé çå®æ´è§£ç å¨çè¾å¥ï¼å½¢ç¶è¿æ¯ 32,42,7ã</p>
<p>ï¼è¿éçä»£ç å¹¶ä¸æ¯é£ä¹éè¦ï¼æä»¥å°±ä¸ç²è´´äºï¼å å°æ¹ï¼æ¥ä¸æ¥æ¯ä¸ä¸ªåé¨æ¹æ³ run modelï¼ç±»ä¼¼ forwardï¼ä½å ä¸ºä¸æ¯ä¸ä¸ªå·ä½çæ¨¡åï¼æä»¥å°±å« run modeläºï¼ç±»åè°ç¨äºè¿ä¸ªå½æ°ï¼æä¼æ§è¡ï¼è¿éæ²¡æè°ç¨ï¼è¿å¥ä¸ä¸æ­¥ï¼å¤æ­æ¯å¦éç¨äºèªå¨ç²¾åº¦è®­ç»ï¼æä¹ä¸æç½ï¼å¤§æ¦æ¯æ¨¡åå éæï¼æ»ä¹æ¯ falseï¼æ§è¡ elseã</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1"></a><a href="#__codelineno-18-1"><span class="linenos" data-linenos="1 "></span></a><span class="k">else</span><span class="p">:</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2"></a><a href="#__codelineno-18-2"><span class="linenos" data-linenos="2 "></span></a>    <span class="c1"># ä½¿ç¨æ®éç²¾åº¦æ§è¡æ¨¡åè®¡ç®</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3"></a><a href="#__codelineno-18-3"><span class="linenos" data-linenos="3 "></span></a>    <span class="c1"># _run_model() -&gt; outputs[B, label_len+pred_len, D]</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4"></a><a href="#__codelineno-18-4"><span class="linenos" data-linenos="4 "></span></a>    <span class="n">outputs</span> <span class="o">=</span> <span class="n">_run_model</span><span class="p">()</span>
</span></code></pre></div>
<p>è°ç¨çåé¨æ¹æ³ <code>_run_model()</code>ï¼æ­¥è¿ï¼è¿å¥å° run model åé¨ã</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250319211512141.png"><img alt="image-20250319211512141" src="../images/image-20250319211512141.png"/></a></p>
<p>é¦åï¼è¿éç self.model æ¯ <code>Exp_Basic</code>ä¸­ç <code>build_model</code> å®ä¹æ¥çï¼èä¸<code>exp_main</code> ï¼ <code>Basic</code> çå­ç±» éåäº ç¶ç±»çæ¹æ³ï¼å¹¶éè¿å­å¸ï¼é®æ¯å­ç¬¦ä¸²ï¼å¼çç±»ï¼ç´¢å¼è¿è¡ç±»çåå§åï¼è¿ä¸ªä¹æ¯ SegRNN ä¸­ä»ç»è¿çãæ»ä¹ï¼è¿éç <code>self.model</code> æ¯ <code>Autoformer</code> </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250319211736243.png"><img alt="image-20250319211736243" src="../images/image-20250319211736243.png"/></a></p>
<p><strong>ç¹å»æ­¥è¿ï¼è¿å¥ Autoformer ç forward ä¸­ãä¸ä¸ª batch ä¸­æ ·æ¬çå¤ç</strong> </p>
<hr/>
<h3 id="autoformer-forward">Autoformer  forward<a class="headerlink" href="#autoformer-forward" title="Permanent link">Â¶</a></h3>
<p>é¦åï¼è¿éAutoformer  forward æ¥æ¶çåæ°ï¼</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1"></a><a href="#__codelineno-19-1"><span class="linenos" data-linenos="1 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_enc</span><span class="p">,</span> <span class="n">x_mark_enc</span><span class="p">,</span> <span class="n">x_dec</span><span class="p">,</span> <span class="n">x_mark_dec</span><span class="p">,</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2"></a><a href="#__codelineno-19-2"><span class="linenos" data-linenos="2 "></span></a>            <span class="n">enc_self_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3"></a><a href="#__codelineno-19-3"><span class="linenos" data-linenos="3 "></span></a>            <span class="n">dec_self_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4"></a><a href="#__codelineno-19-4"><span class="linenos" data-linenos="4 "></span></a>            <span class="n">dec_enc_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></code></pre></div>
<p>å¿é¡»ä¼ å¥çåæ° æ¯  <code>x_enc, x_mark_enc, x_dec, x_mark_dec</code> æä»¬è¿éå°±æ¯ <code>batch xï¼batch yï¼batch x markï¼batch y mark</code>ï¼ä¸å½¢ç¶åå«æ¯ <code>[32,36,7]ã[32,42,7]ã[32,36,4]ã[32,42,4]</code></p>
<p>å¯éåæ°æ¯ Transformer ä¸­ç 3 ä¸ª maskï¼é»è®¤æ¯ Noneãè§£éä¸ä¸ Transformer ä¸­çä¸ä¸ª mask åå«æ¯ä»ä¹ï¼</p>
<blockquote>
<p>ä¸ä¸ªmaskæºå¶ï¼åå«æçæ¯</p>
<ul>
<li>ç¬¬ä¸ä¸ª ç¼ç ç«¯è¾â¼ ç±äºpaddingå­ç¬¦çmaskï¼ä¸ºäºâ¼ä¸ªbatchsizeä¸­ï¼ææé¿åº¦ä¸ç¸åçæ ·æ¬ï¼è½ææâ¼ä¸ªç©éµï¼æä»¥æpadå­ç¬¦ï¼ä½æ¯å¨åâ¾¯è¿â¾inputencoderçâ¾æ³¨æâ¼è®¡ç®æ¶ï¼padå­ç¬¦ä¸è½å½±åè®¡ç®ç»æï¼æä»¥éè¦maskï¼</li>
<li>ç¬¬â¼ä¸ªmaskæ¯è§£ç ç«¯çmaskï¼è¿ä¸ªmaskæ¯æ¶åå°å æçmaskï¼å ä¸ºTransformeræ¯â¼ä¸ªâ¾åå½æ¨¡åï¼å¨è¿â¾è¿ç®æ¶ï¼ä¸ºäºå¹¶â¾è®¡ç®ï¼æä»¬æ¯æinputsåoutputsâ¼èµ·åç»æ¨¡åçï¼inputsç´æ¥ç»æ¨¡åæ²¡äºï¼ä½æ¯outputså¨å¾å°æåçè¾åºæ¶ï¼ä¸è½åå©æªæ¥ä¿¡æ¯ï¼åªè½æ¯å½åæ¶å»åå¶ä¹åæ¶å»çè¾åºï¼æä»¥éè¦â¼ä¸ªmaskæºå¶ï¼è¿ä¸ªmaskæ¯â¼ä¸ªä¸ä¸è§ç©éµï¼ä¿è¯å¨é¢æµå½åè¾åºæ¶ï¼ä¸ä¼åå©æªæ¥ä¿¡æ¯ã</li>
<li>ç¬¬ä¸ä¸ªmaskï¼æ¯ç¼ç å¨åè§£ç å¨çäº¤äºæ³¨æâ¼ï¼ç¼ç å¨çè¾åºä½ä¸ºkeyåvalueï¼è§£ç å¨çè¾åºä½ä¸ºqueryï¼å ä¸ºâ½¬æ åºå æ¯ä¸ªæ ·æ¬çé¿åº¦æ¯ä¸â¼æ ·çï¼åæ¶ååºåçæ ·æ¬é¿åº¦ä¹æ¯ä¸â¼æ ·çï¼â½½ä¸â¼å¯¹ä¹é´ é¿åº¦ä¹æ¯ä¸â¼æ ·çï¼æä»¥éè¦â¼ä¸ªmask å°ååºåä¸­æä¸ªåè¯æä¸ªä½ç½® è· â½¬æ åºåä¸­ æä¸ªä½ç½® å¦æå®ä»¬ä¹é´ æâ¼ä¸ªpadçè¯ è¯´ææ¯â½æå­ç¬¦ï¼å¾å°è¿æ ·çæ©ç ç©éµã</li>
</ul>
<p>ç¼ç å¨ä»¥å ç¼ç å¨åè§£ç å¨ç mask æ¯ä¸ºäºä¿è¯é¿åº¦çå¯¹é½ï¼è§£ç å¨ç mask æ¯ä¸ºäºå¨é¢æµæ¶ é¿åçå°æªæ¥çä¿¡æ¯</p>
</blockquote>
<p>åå° Autoformer è¿éï¼çè¿ä¸ªæ¨¡åæ¯æä¹å¤çï¼è¾å¥æ°æ®åè¾åºæ°æ®ï¼ä»¥åæ¨¡åçåæ°æ¯æä¹å®ç°çã</p>
<p>é¦åï¼çå°ä¸é¢è¿å è¡ä»£ç ã</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250319214129515.png"><img alt="image-20250319214129515" src="../images/image-20250319214129515.png"/></a></p>
<p>è¿å è¡ä»£ç çç®çæ¯ä¸ºäºè§£ç å¨çè¾å¥çåå§åï¼ç¼ç å¨é¶æ®µæ¯ç¨ä¸å°ã</p>
<hr/>
<h3 id="_7">åºååè§£<a class="headerlink" href="#_7" title="Permanent link">Â¶</a></h3>
<p><strong>çè®ºæ è¾å¥åºåçè¶å¿åºååå­£èè¶å¿æ¯æä¹æåçã</strong> </p>
<p>æ¬æå°æ¶é´åºååè§£ä¸º è¶å¿åºååå­£èåé</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250319214344038.png"><img alt="image-20250319214344038" src="../images/image-20250319214344038.png"/></a></p>
<p>è¶å¿åéåæ äºæ°æ®çé¿æååè¶å¿åå­£èè¶å¿ãå¹¶ä¸è®ºæä¸­æå° å¯¹äºæªæ¥åºåè¿è¡åè§£æ¯ä¸ç°å®çï¼å ä¸ºæªæ¥çææåºåé½æ¯ä¸ç¥éçãå æ­¤ï¼ä¸ºäºè§£å³è¿ä¸ªé®é¢ï¼åææåºäº åºååè§£æ¨¡åï¼ææ³æ¯ ä»é¢æµçä¸­é´éèåéä¸­ éæ­¥æå é¿æç¨³å®çè¶å¿ ã</p>
<p>å·ä½çåæ³ï¼ä½¿ç¨ç§»å¨å¹³åæ¥å¹³æ»å¨ææ§æ³¢å¨æ¥çªåºé¿æè¶å¿ã</p>
<p>æä¸­ä¹ç»åºäºå¬å¼ï¼</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250319220946468.png"><img alt="image-20250319220946468" src="../images/image-20250319220946468.png"/></a></p>
<p>å¬å¼çè§£éï¼å¯¹äºé¿åº¦ ä¸º L çè¾å¥åºå X ï¼å½¢ç¶æ¯ LÃdï¼ä½¿ç¨å¹³åæ± åè¿è¡ç§»å¨å¹³åï¼å¹¶ä¸ä½¿ç¨å¡«åæä½ä¿æåºåé¿åº¦ä¸åãåé¢ç¨ä¸ä¸ª SeriesDecomp(X)æ¥è¡¨ç¤º ä¸é¢çè¿ç¨ï¼ç®åä¸ä¸è®°å·ã</p>
<p><strong>è®ºæä¸­çæ¨¡åç»æå¾ä¹æç»åºè¿é¨å</strong></p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250319221443646.png"><img alt="image-20250319221443646" src="../images/image-20250319221443646.png"/></a></p>
<p>é¦å ç®­å¤´æçå°æ¹æ¶ ç´è§å°æ¾ç¤ºäº è¾å¥åºå è¶å¿åºå å å­£èåºåæ¯æä¹æ¥çãè¾å¥åºå ç è¶å¿åºå æ¯å¯¹ è¾å¥åºå å»åå¼ï¼å­£èä¿¡æ¯ï¼ä¹å°±æ¯å¨ææ³¢å¨ä¿¡æ¯æ¯ è¾å¥åºå - åå¼ ï¼è¿ä¸ªå¨ææ³¢å¨ä¿¡æ¯ æ¯å´ç» 0 è¿è¡æ³¢å¨çãåºäºå¯¹è¾å¥åºåçåè§£çè®¤è¯ï¼å¯¹äºè§£ç å¨ è¶å¿åºå å å­£èåºåç åå§åä¹æ¯å¾æéççã</p>
<p>å¾ççä¸åé¨åï¼æ¯è§£ç å¨çè¾å¥ï¼æ¾ç¤ºäº é¢æµåºå è¶å¿åºååå­£èåºåçåå§åï¼å¶ä¸­è¶å¿åºåä½¿ç¨è¾å¥åºåçåå¼è¿è¡åå§åï¼å­£èæ³¢å¨ä¿¡æ¯ç¨ 0 æ¥åå§å</p>
<hr/>
<p><strong>æ¥ä¸æ¥ï¼çä»£ç ä¸­ï¼å¯¹é¢æµåºå ç è¶å¿åºå å å­£èåºåçæåã</strong></p>
<p>é¦å æ åå²æ°æ® x_enc [B, L, D]çï¼é¢æµåæ ç­¾æ°æ® x_dec [B, L+P, D]ï¼æ¥çè¿è¡æ¶é´åºååè§£ å°åå²åºååè§£ä¸ºå­£èæ§åè¶å¿ä¸¤ä¸ªæå</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1"></a><a href="#__codelineno-20-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">seasonal_init</span><span class="p">,</span> <span class="n">trend_init</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decomp</span><span class="p">(</span><span class="n">x_enc</span><span class="p">)</span>
</span></code></pre></div>
<p>å¾å° è¶å¿åå§å¼ï¼åå²åºååå¼ï¼å­£èæ§åå§å¼ï¼å¨é¶å¼ é</p>
<p>åºäº è¾å¥åºåç åºååè§£ç»æï¼æé  è§£ç å¨çè¾å¥ï¼å·ä½æ¥è¯´ï¼</p>
<ul>
<li>
<p>è¾åºåºå è¶å¿è¾å¥= åå²è¶å¿æ«å°¾ + è¶å¿åå§å¼</p>
</li>
<li>
<p>è¾åºåºå å­£èæ§è¾å¥ = åå²å­£èæ§æ«å°¾ + å­£èæ§åå§å¼(é¶)</p>
</li>
</ul>
<p>ä¹å°±æ¯æºç ä¸­çè¿å è¡ï¼</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1"></a><a href="#__codelineno-21-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">mean</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x_enc</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pred_len</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2"></a><a href="#__codelineno-21-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">zeros</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">x_dec</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pred_len</span><span class="p">,</span> <span class="n">x_dec</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="n">device</span><span class="o">=</span><span class="n">x_enc</span><span class="o">.</span><span class="n">device</span><span class="p">)</span> 
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3"></a><a href="#__codelineno-21-3"><span class="linenos" data-linenos="3 "></span></a><span class="n">trend_init</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">trend_init</span><span class="p">[:,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">label_len</span><span class="p">:,</span> <span class="p">:],</span> <span class="n">mean</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4"></a><a href="#__codelineno-21-4"><span class="linenos" data-linenos="4 "></span></a><span class="n">seasonal_init</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">seasonal_init</span><span class="p">[:,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">label_len</span><span class="p">:,</span> <span class="p">:],</span> <span class="n">zeros</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></code></pre></div>
<p>è¿ä¸ªæ¨¡åçç»æç®åæ¥è¯´æ¯ å©ç¨ **ç¼ç å¨**å¤çåå²æ°æ®ï¼**è§£ç å¨**å©ç¨ç¼ç å¨è¾åºåç»è£çåå§è¾å¥çæé¢æµï¼å°±æ¯ä¸ä¸ªå¾æ åç Transformer å¤çæ°æ®çæ¶æãæä»¬å¾å°çæç»è¾åºæ¯ è¶å¿åå­£èæ§é¢æµç¸å ï¼å ä¸ºæ label lengthï¼æä»¥å¯¹äºè¾åº æ¯ æåæ«å°¾ pred_len é¿åº¦ä½ä¸ºæç»é¢æµç»æ</p>
<p>Autoformer çæ ¸å¿ææ³å°±æ¯ å°æ¶é´åºååè§£ä¸ºä¸åé¢çæåå¹¶åå«å»ºæ¨¡ï¼åç»åçææç»é¢æµã</p>
<p><strong>åæä¸ªå¤§ä½çå°è±¡ï¼åé¢çå°ä»£ç  è¯¦ç»çè®²è§£ã</strong></p>
<hr/>
<p>å¨è¿è¡åé¢çEncoder å Decoderä¹åï¼<strong>åç è¶å¿é¡¹ å å­£èé¡¹ çå·ä½å®ç°æ¹æ³ã</strong> æç¹å¤æï¼ä½æ¯ä¸æ­¥æ­¥æ¥ã</p>
<p>â¶ï¸ é¦åæ¯è°ç¨ ç   self.decomp</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1"></a><a href="#__codelineno-22-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">seasonal_init</span><span class="p">,</span> <span class="n">trend_init</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decomp</span><span class="p">(</span><span class="n">x_enc</span><span class="p">)</span>
</span></code></pre></div>
<p>â¶ï¸ è self.decomp åæ¯ åå§å series_decomp ç±»</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1"></a><a href="#__codelineno-23-1"><span class="linenos" data-linenos="1 "></span></a><span class="bp">self</span><span class="o">.</span><span class="n">decomp</span> <span class="o">=</span> <span class="n">series_decomp</span><span class="p">(</span><span class="n">kernel_size</span><span class="p">)</span>
</span></code></pre></div>
<p>â¶ï¸ çå° series_decomp ç±»çå®ä¹</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1"></a><a href="#__codelineno-24-1"><span class="linenos" data-linenos="1 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">series_decomp</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span></code></pre></div>
<p>ð¢ ç±»çå®ä¹</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1"></a><a href="#__codelineno-25-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">series_decomp</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2"></a><a href="#__codelineno-25-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3"></a><a href="#__codelineno-25-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="sd">    Series decomposition block</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4"></a><a href="#__codelineno-25-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="sd">    """</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5"></a><a href="#__codelineno-25-5"><span class="linenos" data-linenos=" 5 "></span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kernel_size</span><span class="p">):</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6"></a><a href="#__codelineno-25-6"><span class="linenos" data-linenos=" 6 "></span></a>        <span class="nb">super</span><span class="p">(</span><span class="n">series_decomp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7"></a><a href="#__codelineno-25-7"><span class="linenos" data-linenos=" 7 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">moving_avg</span> <span class="o">=</span> <span class="n">moving_avg</span><span class="p">(</span><span class="n">kernel_size</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8"></a><a href="#__codelineno-25-8"><span class="linenos" data-linenos=" 8 "></span></a>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9"></a><a href="#__codelineno-25-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10"></a><a href="#__codelineno-25-10"><span class="linenos" data-linenos="10 "></span></a>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11"></a><a href="#__codelineno-25-11"><span class="linenos" data-linenos="11 "></span></a>        <span class="c1"># è®¡ç®ç§»å¨å¹³åï¼æååºåè¶å¿åé</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12"></a><a href="#__codelineno-25-12"><span class="linenos" data-linenos="12 "></span></a>        <span class="c1"># x å½¢ç¶[B, L, D] -&gt; moving_meanå½¢ç¶[B, L, D]</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13"></a><a href="#__codelineno-25-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="c1">#  moving_avgåé¨ä¼è¿è¡å¡«åï¼ä¿è¯è¾åºå½¢ç¶ä¸è¾å¥ç¸å</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14"></a><a href="#__codelineno-25-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="n">moving_mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moving_avg</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15"></a><a href="#__codelineno-25-15"><span class="linenos" data-linenos="15 "></span></a>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16"></a><a href="#__codelineno-25-16"><span class="linenos" data-linenos="16 "></span></a>        <span class="c1"># éè¿åå§åºååå»è¶å¿åéï¼å¾å°æ®å·®(å­£èæ§åé)ï¼éåç´ åæ³æä½</span>
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17"></a><a href="#__codelineno-25-17"><span class="linenos" data-linenos="17 "></span></a>        <span class="c1"># xå½¢ç¶[B, L, D] - moving_meanå½¢ç¶[B, L, D] -&gt; reså½¢ç¶[B, L, D]</span>
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18"></a><a href="#__codelineno-25-18"><span class="linenos" data-linenos="18 "></span></a>        <span class="n">res</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">moving_mean</span>
</span><span id="__span-25-19"><a id="__codelineno-25-19" name="__codelineno-25-19"></a><a href="#__codelineno-25-19"><span class="linenos" data-linenos="19 "></span></a>
</span><span id="__span-25-20"><a id="__codelineno-25-20" name="__codelineno-25-20"></a><a href="#__codelineno-25-20"><span class="linenos" data-linenos="20 "></span></a>        <span class="c1"># è¿åå­£èæ§åéåè¶å¿åéï¼åä¿æåå§å½¢ç¶[B, L, D]</span>
</span><span id="__span-25-21"><a id="__codelineno-25-21" name="__codelineno-25-21"></a><a href="#__codelineno-25-21"><span class="linenos" data-linenos="21 "></span></a>        <span class="c1"># ç¬¬ä¸ä¸ªè¿åå¼resæ¯å­£èæ§åéï¼ç¬¬äºä¸ªè¿åå¼moving_meanæ¯è¶å¿åé</span>
</span><span id="__span-25-22"><a id="__codelineno-25-22" name="__codelineno-25-22"></a><a href="#__codelineno-25-22"><span class="linenos" data-linenos="22 "></span></a>        <span class="k">return</span> <span class="n">res</span><span class="p">,</span> <span class="n">moving_mean</span>
</span></code></pre></div>
<p>â¶ï¸ ç±»å è°ç¨ <code>moving_avg</code> </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250317202431440.png"><img alt="image-20250317202431440" src="../images/image-20250317202431440.png"/></a></p>
<p>â¶ï¸ çå° <code>moving_avg</code> ç±»çå®ä¹</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1"></a><a href="#__codelineno-26-1"><span class="linenos" data-linenos="1 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">moving_avg</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span></code></pre></div>
<p>ð¢ <code>moving_avg</code> å®ä¹</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1"></a><a href="#__codelineno-27-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">moving_avg</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2"></a><a href="#__codelineno-27-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3"></a><a href="#__codelineno-27-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="sd">    Moving average block to highlight the trend of time series</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4"></a><a href="#__codelineno-27-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="sd">    """</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5"></a><a href="#__codelineno-27-5"><span class="linenos" data-linenos=" 5 "></span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kernel_size</span><span class="p">,</span> <span class="n">stride</span><span class="p">):</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6"></a><a href="#__codelineno-27-6"><span class="linenos" data-linenos=" 6 "></span></a>        <span class="nb">super</span><span class="p">(</span><span class="n">moving_avg</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7"></a><a href="#__codelineno-27-7"><span class="linenos" data-linenos=" 7 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span> <span class="o">=</span> <span class="n">kernel_size</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8"></a><a href="#__codelineno-27-8"><span class="linenos" data-linenos=" 8 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">avg</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">AvgPool1d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="n">kernel_size</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="n">stride</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9"></a><a href="#__codelineno-27-9"><span class="linenos" data-linenos=" 9 "></span></a>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10"></a><a href="#__codelineno-27-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11"></a><a href="#__codelineno-27-11"><span class="linenos" data-linenos="11 "></span></a>        <span class="c1"># padding on the both ends of time series</span>
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12"></a><a href="#__codelineno-27-12"><span class="linenos" data-linenos="12 "></span></a>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13"></a><a href="#__codelineno-27-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="c1"># æåç¬¬ä¸ä¸ªæ¶é´æ­¥å¹¶éå¤ï¼ç¨äºåç«¯å¡«å</span>
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14"></a><a href="#__codelineno-27-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="c1">#  [B, L, D] -&gt; [B, 1, D] -&gt; [B, (kernel_size-1)//2, D]</span>
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15"></a><a href="#__codelineno-27-15"><span class="linenos" data-linenos="15 "></span></a>        <span class="n">front</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> 
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16"></a><a href="#__codelineno-27-16"><span class="linenos" data-linenos="16 "></span></a>
</span><span id="__span-27-17"><a id="__codelineno-27-17" name="__codelineno-27-17"></a><a href="#__codelineno-27-17"><span class="linenos" data-linenos="17 "></span></a>        <span class="c1"># æåæåä¸ä¸ªæ¶é´æ­¥å¹¶éå¤ï¼ç¨äºåç«¯å¡«å</span>
</span><span id="__span-27-18"><a id="__codelineno-27-18" name="__codelineno-27-18"></a><a href="#__codelineno-27-18"><span class="linenos" data-linenos="18 "></span></a>        <span class="c1"># [B, L, D] -&gt; [B, 1, D] -&gt; [B, (kernel_size-1)//2, D]</span>
</span><span id="__span-27-19"><a id="__codelineno-27-19" name="__codelineno-27-19"></a><a href="#__codelineno-27-19"><span class="linenos" data-linenos="19 "></span></a>        <span class="n">end</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-27-20"><a id="__codelineno-27-20" name="__codelineno-27-20"></a><a href="#__codelineno-27-20"><span class="linenos" data-linenos="20 "></span></a>
</span><span id="__span-27-21"><a id="__codelineno-27-21" name="__codelineno-27-21"></a><a href="#__codelineno-27-21"><span class="linenos" data-linenos="21 "></span></a>        <span class="c1"># è¿æ¥å¡«åé¨åä¸ååºå</span>
</span><span id="__span-27-22"><a id="__codelineno-27-22" name="__codelineno-27-22"></a><a href="#__codelineno-27-22"><span class="linenos" data-linenos="22 "></span></a>        <span class="c1"># [B, (k-1)//2, D] + [B, L, D] + [B, (k-1)//2, D] -&gt; [B, L+(k-1), D]</span>
</span><span id="__span-27-23"><a id="__codelineno-27-23" name="__codelineno-27-23"></a><a href="#__codelineno-27-23"><span class="linenos" data-linenos="23 "></span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">front</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">end</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-27-24"><a id="__codelineno-27-24" name="__codelineno-27-24"></a><a href="#__codelineno-27-24"><span class="linenos" data-linenos="24 "></span></a>
</span><span id="__span-27-25"><a id="__codelineno-27-25" name="__codelineno-27-25"></a><a href="#__codelineno-27-25"><span class="linenos" data-linenos="25 "></span></a>        <span class="c1"># è½¬ç½®å¹¶åºç¨ä¸ç»´å¹³åæ± å</span>
</span><span id="__span-27-26"><a id="__codelineno-27-26" name="__codelineno-27-26"></a><a href="#__codelineno-27-26"><span class="linenos" data-linenos="26 "></span></a>        <span class="c1"># [B, L+(k-1), D] -&gt; [B, D, L+(k-1)] -&gt; [B, D, L]</span>
</span><span id="__span-27-27"><a id="__codelineno-27-27" name="__codelineno-27-27"></a><a href="#__codelineno-27-27"><span class="linenos" data-linenos="27 "></span></a>        <span class="c1"># æ± åçªå£å¤§å°ä¸ºkernel_sizeï¼æ­¥é¿ä¸º1ï¼è¾åºé¿åº¦ä¸º(L+(k-1)-k+1)=L ï¼length + 2P - K + 1ï¼</span>
</span><span id="__span-27-28"><a id="__codelineno-27-28" name="__codelineno-27-28"></a><a href="#__codelineno-27-28"><span class="linenos" data-linenos="28 "></span></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="__span-27-29"><a id="__codelineno-27-29" name="__codelineno-27-29"></a><a href="#__codelineno-27-29"><span class="linenos" data-linenos="29 "></span></a>
</span><span id="__span-27-30"><a id="__codelineno-27-30" name="__codelineno-27-30"></a><a href="#__codelineno-27-30"><span class="linenos" data-linenos="30 "></span></a>        <span class="c1"># è½¬ç½®ååå§ç»´åº¦é¡ºåº [B, D, L] -&gt; [B, L, D]</span>
</span><span id="__span-27-31"><a id="__codelineno-27-31" name="__codelineno-27-31"></a><a href="#__codelineno-27-31"><span class="linenos" data-linenos="31 "></span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-27-32"><a id="__codelineno-27-32" name="__codelineno-27-32"></a><a href="#__codelineno-27-32"><span class="linenos" data-linenos="32 "></span></a>        <span class="k">return</span> <span class="n">x</span>
</span></code></pre></div>
<p>æ»ç»ï¼å°±æ¯ 3 æ¬¡è°ç¨ï¼</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1"></a><a href="#__codelineno-28-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="n">seasonal_init</span><span class="p">,</span> <span class="n">trend_init</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decomp</span><span class="p">(</span><span class="n">x_enc</span><span class="p">)</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2"></a><a href="#__codelineno-28-2"><span class="linenos" data-linenos=" 2 "></span></a>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3"></a><a href="#__codelineno-28-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="bp">self</span><span class="o">.</span><span class="n">decomp</span> <span class="o">=</span> <span class="n">series_decomp</span><span class="p">(</span><span class="n">kernel_size</span><span class="p">)</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4"></a><a href="#__codelineno-28-4"><span class="linenos" data-linenos=" 4 "></span></a>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5"></a><a href="#__codelineno-28-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">series_decomp</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6"></a><a href="#__codelineno-28-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kernel_size</span><span class="p">):</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7"></a><a href="#__codelineno-28-7"><span class="linenos" data-linenos=" 7 "></span></a>        <span class="nb">super</span><span class="p">(</span><span class="n">series_decomp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8"></a><a href="#__codelineno-28-8"><span class="linenos" data-linenos=" 8 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">moving_avg</span> <span class="o">=</span> <span class="n">moving_avg</span><span class="p">(</span><span class="n">kernel_size</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9"></a><a href="#__codelineno-28-9"><span class="linenos" data-linenos=" 9 "></span></a>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10"></a><a href="#__codelineno-28-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11"></a><a href="#__codelineno-28-11"><span class="linenos" data-linenos="11 "></span></a>        <span class="n">moving_mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moving_avg</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12"></a><a href="#__codelineno-28-12"><span class="linenos" data-linenos="12 "></span></a>
</span><span id="__span-28-13"><a id="__codelineno-28-13" name="__codelineno-28-13"></a><a href="#__codelineno-28-13"><span class="linenos" data-linenos="13 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">moving_avg</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-28-14"><a id="__codelineno-28-14" name="__codelineno-28-14"></a><a href="#__codelineno-28-14"><span class="linenos" data-linenos="14 "></span></a>     <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="__span-28-15"><a id="__codelineno-28-15" name="__codelineno-28-15"></a><a href="#__codelineno-28-15"><span class="linenos" data-linenos="15 "></span></a>        <span class="n">front</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> 
</span><span id="__span-28-16"><a id="__codelineno-28-16" name="__codelineno-28-16"></a><a href="#__codelineno-28-16"><span class="linenos" data-linenos="16 "></span></a>        <span class="n">end</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-28-17"><a id="__codelineno-28-17" name="__codelineno-28-17"></a><a href="#__codelineno-28-17"><span class="linenos" data-linenos="17 "></span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">front</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">end</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-28-18"><a id="__codelineno-28-18" name="__codelineno-28-18"></a><a href="#__codelineno-28-18"><span class="linenos" data-linenos="18 "></span></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="__span-28-19"><a id="__codelineno-28-19" name="__codelineno-28-19"></a><a href="#__codelineno-28-19"><span class="linenos" data-linenos="19 "></span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-28-20"><a id="__codelineno-28-20" name="__codelineno-28-20"></a><a href="#__codelineno-28-20"><span class="linenos" data-linenos="20 "></span></a>        <span class="k">return</span> <span class="n">x</span>    
</span></code></pre></div>
<p>ç¨ä¸å¼ å¾è¡¨ç¤º Autoformer åºååè§£ççè¿ç¨ï¼è¿ä¸ªåè§£è¿ç¨å°åå§åºå x_enc åè§£ä¸ºä¸¤ä¸ªç¸åå½¢ç¶ [B,L,D] çå¼ éï¼è¶å¿æååå­£èæ§æåï¼</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1"></a><a href="#__codelineno-29-1"><span class="linenos" data-linenos=" 1 "></span></a>                    è¾å¥: x_enc [B, L, D]
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2"></a><a href="#__codelineno-29-2"><span class="linenos" data-linenos=" 2 "></span></a>                          |
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3"></a><a href="#__codelineno-29-3"><span class="linenos" data-linenos=" 3 "></span></a>                          v
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4"></a><a href="#__codelineno-29-4"><span class="linenos" data-linenos=" 4 "></span></a>            +---------------------------+
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5"></a><a href="#__codelineno-29-5"><span class="linenos" data-linenos=" 5 "></span></a>            | Model.forward()           |
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6"></a><a href="#__codelineno-29-6"><span class="linenos" data-linenos=" 6 "></span></a>            | è°ç¨: self.decomp(x_enc)  |
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7"></a><a href="#__codelineno-29-7"><span class="linenos" data-linenos=" 7 "></span></a>            +---------------------------+
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8"></a><a href="#__codelineno-29-8"><span class="linenos" data-linenos=" 8 "></span></a>                          |
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9"></a><a href="#__codelineno-29-9"><span class="linenos" data-linenos=" 9 "></span></a>                          v
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10"></a><a href="#__codelineno-29-10"><span class="linenos" data-linenos="10 "></span></a>            +---------------------------+
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11"></a><a href="#__codelineno-29-11"><span class="linenos" data-linenos="11 "></span></a>            | series_decomp(kernel_size)|
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12"></a><a href="#__codelineno-29-12"><span class="linenos" data-linenos="12 "></span></a>            | self.decompå®ä¾           |
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13"></a><a href="#__codelineno-29-13"><span class="linenos" data-linenos="13 "></span></a>            +---------------------------+
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14"></a><a href="#__codelineno-29-14"><span class="linenos" data-linenos="14 "></span></a>                          |
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15"></a><a href="#__codelineno-29-15"><span class="linenos" data-linenos="15 "></span></a>                          v
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16"></a><a href="#__codelineno-29-16"><span class="linenos" data-linenos="16 "></span></a>            +---------------------------+
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17"></a><a href="#__codelineno-29-17"><span class="linenos" data-linenos="17 "></span></a>            | series_decomp.forward(x)  |
</span><span id="__span-29-18"><a id="__codelineno-29-18" name="__codelineno-29-18"></a><a href="#__codelineno-29-18"><span class="linenos" data-linenos="18 "></span></a>            | 1. è°ç¨ç§»å¨å¹³åè®¡ç®è¶å¿   |
</span><span id="__span-29-19"><a id="__codelineno-29-19" name="__codelineno-29-19"></a><a href="#__codelineno-29-19"><span class="linenos" data-linenos="19 "></span></a>            | 2. ååºååå»è¶å¿å¾å°å­£èæ§|
</span><span id="__span-29-20"><a id="__codelineno-29-20" name="__codelineno-29-20"></a><a href="#__codelineno-29-20"><span class="linenos" data-linenos="20 "></span></a>            +---------------------------+
</span><span id="__span-29-21"><a id="__codelineno-29-21" name="__codelineno-29-21"></a><a href="#__codelineno-29-21"><span class="linenos" data-linenos="21 "></span></a>                          |
</span><span id="__span-29-22"><a id="__codelineno-29-22" name="__codelineno-29-22"></a><a href="#__codelineno-29-22"><span class="linenos" data-linenos="22 "></span></a>                  +-------+-------+
</span><span id="__span-29-23"><a id="__codelineno-29-23" name="__codelineno-29-23"></a><a href="#__codelineno-29-23"><span class="linenos" data-linenos="23 "></span></a>                  |               |
</span><span id="__span-29-24"><a id="__codelineno-29-24" name="__codelineno-29-24"></a><a href="#__codelineno-29-24"><span class="linenos" data-linenos="24 "></span></a>                  v               v
</span><span id="__span-29-25"><a id="__codelineno-29-25" name="__codelineno-29-25"></a><a href="#__codelineno-29-25"><span class="linenos" data-linenos="25 "></span></a>    +---------------------------+  +---------------------------+
</span><span id="__span-29-26"><a id="__codelineno-29-26" name="__codelineno-29-26"></a><a href="#__codelineno-29-26"><span class="linenos" data-linenos="26 "></span></a>    | moving_avg.forward(x)     |  | å­£èæ§è®¡ç®                |
</span><span id="__span-29-27"><a id="__codelineno-29-27" name="__codelineno-29-27"></a><a href="#__codelineno-29-27"><span class="linenos" data-linenos="27 "></span></a>    | æ­¥éª¤:                     |  | res = x - moving_mean     |
</span><span id="__span-29-28"><a id="__codelineno-29-28" name="__codelineno-29-28"></a><a href="#__codelineno-29-28"><span class="linenos" data-linenos="28 "></span></a>    | 1.ååå¡«ååºå           |  |                           |
</span><span id="__span-29-29"><a id="__codelineno-29-29" name="__codelineno-29-29"></a><a href="#__codelineno-29-29"><span class="linenos" data-linenos="29 "></span></a>    | 2.åºç¨å¹³åæ± å           |  |                           |
</span><span id="__span-29-30"><a id="__codelineno-29-30" name="__codelineno-29-30"></a><a href="#__codelineno-29-30"><span class="linenos" data-linenos="30 "></span></a>    | 3.è¿åè¶å¿åé           |  |                           |
</span><span id="__span-29-31"><a id="__codelineno-29-31" name="__codelineno-29-31"></a><a href="#__codelineno-29-31"><span class="linenos" data-linenos="31 "></span></a>    +---------------------------+  +---------------------------+
</span><span id="__span-29-32"><a id="__codelineno-29-32" name="__codelineno-29-32"></a><a href="#__codelineno-29-32"><span class="linenos" data-linenos="32 "></span></a>                  |               |
</span><span id="__span-29-33"><a id="__codelineno-29-33" name="__codelineno-29-33"></a><a href="#__codelineno-29-33"><span class="linenos" data-linenos="33 "></span></a>                  v               v
</span><span id="__span-29-34"><a id="__codelineno-29-34" name="__codelineno-29-34"></a><a href="#__codelineno-29-34"><span class="linenos" data-linenos="34 "></span></a>             è¶å¿åé        å­£èæ§åé
</span><span id="__span-29-35"><a id="__codelineno-29-35" name="__codelineno-29-35"></a><a href="#__codelineno-29-35"><span class="linenos" data-linenos="35 "></span></a>          trend_init [B,L,D]  seasonal_init [B,L,D]
</span><span id="__span-29-36"><a id="__codelineno-29-36" name="__codelineno-29-36"></a><a href="#__codelineno-29-36"><span class="linenos" data-linenos="36 "></span></a>                  |               |
</span><span id="__span-29-37"><a id="__codelineno-29-37" name="__codelineno-29-37"></a><a href="#__codelineno-29-37"><span class="linenos" data-linenos="37 "></span></a>                  +       +       +
</span><span id="__span-29-38"><a id="__codelineno-29-38" name="__codelineno-29-38"></a><a href="#__codelineno-29-38"><span class="linenos" data-linenos="38 "></span></a>                          |
</span><span id="__span-29-39"><a id="__codelineno-29-39" name="__codelineno-29-39"></a><a href="#__codelineno-29-39"><span class="linenos" data-linenos="39 "></span></a>                          v
</span><span id="__span-29-40"><a id="__codelineno-29-40" name="__codelineno-29-40"></a><a href="#__codelineno-29-40"><span class="linenos" data-linenos="40 "></span></a>                è¿åå°Model.forward()
</span><span id="__span-29-41"><a id="__codelineno-29-41" name="__codelineno-29-41"></a><a href="#__codelineno-29-41"><span class="linenos" data-linenos="41 "></span></a>                è¿è¡åç»­å¤ç
</span></code></pre></div>
<p>è®²å¾ éå­ç¨¿ï¼</p>
<p>ï¼1ï¼<strong>Model.forward()</strong> è°ç¨ self.decomp(x_enc)è¿è¡åºååè§£</p>
<p>ï¼2ï¼<strong>series_decomp.forward(x)</strong></p>
<blockquote>
<p>åå«ä¸¤ä¸ªä¸»è¦æ­¥éª¤:</p>
<ul>
<li>è°ç¨ self.moving_avg(x)è®¡ç®ç§»å¨å¹³åï¼å¾å°è¶å¿åé</li>
<li>è®¡ç®ååºåä¸è¶å¿åéçå·®å¼ï¼å¾å°å­£èæ§åé</li>
</ul>
</blockquote>
<p>ï¼3ï¼<strong>moving_avg.forward(x)</strong></p>
<blockquote>
<p>æ§è¡ç§»å¨å¹³åè®¡ç®:</p>
<ul>
<li>éè¿éå¤é¦å°¾åç´ è¿è¡åºåå¡«å</li>
</ul>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1"></a><a href="#__codelineno-30-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">front</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> 
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2"></a><a href="#__codelineno-30-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">end</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3"></a><a href="#__codelineno-30-3"><span class="linenos" data-linenos="3 "></span></a> <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">front</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">end</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></code></pre></div>
<ul>
<li>åºç¨ä¸ç»´å¹³åæ± åæä½</li>
</ul>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1"></a><a href="#__codelineno-31-1"><span class="linenos" data-linenos="1 "></span></a>x = self.avg(x.permute(0, 2, 1))
</span></code></pre></div>
<p><strong>è¯´æ ä¸ºä»ä¹å¡«åï¼æ¯ä¸ºäº ä¿è¯åºåå¨å¹³åæ± åå é¿åº¦ä¸å</strong></p>
<ul>
<li>è¿åå¹³æ»åçè¶å¿åé</li>
</ul>
<p>è¿é¨åçå½¢ç¶ååï¼ </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250319224010427.png"><img alt="image-20250319224010427" src="../images/image-20250319224010427.png"/></a> </p>
</blockquote>
<p>ç°å¨å¼å§ è¿å <strong>moving_avg.forward(x)</strong> æ¯å©ç¨ 1D å¹³åæ± å å¾å° è¶å¿åºåï¼å°ç»æè¿åç» <strong>series_decomp</strong> ï¼ä¹å°±æ¯è¿å¥ä»£ç  <code>moving_mean = self.moving_avg(x)</code>ï¼å¾å°è¶å¿åºåä»¥åï¼æ°¸è¿åºååè¶å¿åºå <code>res = x - moving_mean</code> ï¼å¾å°å­£èåéï¼ä¹å°±æ¯å¨ææ§ä¿¡æ¯ãå·ä½çä»£ç ï¼</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250319224315222.png"><img alt="image-20250319224315222" src="../images/image-20250319224315222.png"/></a></p>
<p>æç» å°ç»æ è¿åç» Autoformer forward ä¸­ç seasonal_init, trend_init</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250319224700908.png"><img alt="image-20250319224700908" src="../images/image-20250319224700908.png"/></a></p>
<p>å¹¶ä¸ ç¨è¿ä¸¤ä¸ª init åå§å è§£ç å¨çè¾å¥ã</p>
<p>è¿éå¾æ³¨æä¸ä¸ï¼å¯¹äº æ ç­¾åºåï¼ä¹å°±æ¯ è¾å¥åºåçè¶å¿ä¿¡æ¯çæåç¨çæ¯ 1Då¹³åæ± åï¼èå¯¹é¢æµ predict length çè¶å¿ä¿¡æ¯åå§å å°±ç´æ¥ç¨ç è¾å¥åºåçåå¼</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1"></a><a href="#__codelineno-32-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">mean</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x_enc</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pred_len</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></code></pre></div>
<p>å¨ææ§è¶å¿ä¹æ¯ï¼label length çå­£èè¶å¿æ¯ æ®å·®ï¼ä¹å°±æ¯ åå§åºå åå» è¶å¿åºåï¼è predict length ç å­£èè¶å¿å°±æ¯ç´æ¥åå§åä¸º 0 äºã</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1"></a><a href="#__codelineno-33-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">zeros</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">x_dec</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pred_len</span><span class="p">,</span> <span class="n">x_dec</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="n">device</span><span class="o">=</span><span class="n">x_enc</span><span class="o">.</span><span class="n">device</span><span class="p">)</span> 
</span></code></pre></div>
<p>è¿éæ¯ å°å°çåºå«ï¼å°å°çæ³¨æã</p>
<p>å¥½äº è¿é¨åï¼åºååè§£è¯´å®äºï¼ä»£ç è®²äºï¼åæè®²äºï¼å¬å¼å¯¹åºä¸äºï¼å¾ä¹è¯´äºãåæ <code>Series decomposition block</code>  å°±è¿å¦</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250319225341745.png"><img alt="image-20250319225341745" src="../images/image-20250319225341745.png"/></a> </p>
<p>åºååè§£ over</p>
<hr/>
<h3 id="model-inputs">model inputs<a class="headerlink" href="#model-inputs" title="Permanent link">Â¶</a></h3>
<p>ä¸é¢å¼å§ æ¨¡åçè¾å¥ï¼åä»è®ºæå¼å§è®²è§£ï¼</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250319225433558.png"><img alt="image-20250319225433558" src="../images/image-20250319225433558.png"/></a> </p>
<p>æ¨¡åçè¾å¥é¨åï¼æ¨¡åçè¾å¥åæ¬ç¼ç å¨çè¾å¥åè§£ç å¨çè¾å¥ãå·ä½æ¥è¯´ï¼</p>
<p>ç¼ç å¨çè¾å¥æ¯è¿å» <span class="arithmatex">\(I\)</span> ä¸ªæ¶é´æ­¥ï¼æä¸­ç»åºçç¬¦å·è¡¨ç¤º <span class="arithmatex">\(\mathcal{X}^{I \times d}\)</span> ï¼<span class="arithmatex">\(I\)</span> è¡¨ç¤ºæ¶é´æ­¥é¿ï¼<span class="arithmatex">\(d\)</span> è¡¨ç¤ºæ¯ä¸ªæ¶é´æ­¥çç¹å¾æ°ã</p>
<p>è§£ç å¨çè¾å¥åæ¬äº å­£èæ§åºå å è¶å¿æ§åºåï¼å·ä½çç¬¦å·è¡¨ç¤ºåå«æ¯ <span class="arithmatex">\(\mathcal{X}_{des}\)</span>  å <span class="arithmatex">\(\mathcal{X}_{det}\)</span>    å½¢ç¶æ¯ä¸æ ·çï¼<span class="arithmatex">\((\frac{I}{2}+O)\)</span>  ã<span class="arithmatex">\(\frac{I}{2}\)</span> æ¯ label length çé¿åº¦ï¼åçæ¯åå§è¾å¥åºåé¿åº¦ç ä¸åãO æ¯ é¢æµæ­¥é¿ predict lengthãd åæ ·æ¯æ¯ä¸ªæ¶é´æ­¥çç¹å¾æ°ãæ¥ä¸æ¥ï¼æä»¬æ¥çå¬å¼æ¯æä¹è¡¨ç¤ºçï¼</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320085551155.png"><img alt="image-20250320085551155" src="../images/image-20250320085551155.png"/></a></p>
<p><span class="arithmatex">\(\mathcal{X}_{ens}ã\mathcal{X}_{ent}\)</span>  åå«è¡¨ç¤º ä» åå§ è¾å¥åºå <span class="arithmatex">\(\mathcal{X}_{en}\)</span> åè§£åºçå­£èæååè¶å¿æåï¼æªååºååé¨å <span class="arithmatex">\(\frac{I}{2}:I\)</span> ä½ä¸º label lengthï¼ä¸é¿åº¦ä¸º predict  length çæ¶é´æ­¥è¿è¡æ¼æ¥ï¼ç¨ 0 å¡«åçé¿åº¦ä¸º predict lengthçåéè®°ä½ <span class="arithmatex">\(\mathcal{X}_0\)</span> ï¼ç¨è¾å¥æ¶é´åºåæ¶é´æ­¥åå¼å¡«åçé¿åº¦ä¸º predict length çåéè®°ä½ <span class="arithmatex">\(\mathcal{X}_{mean}\)</span></p>
<p>ç¶åï¼<span class="arithmatex">\(\mathcal{X}_{ens}\)</span> ä¸ <span class="arithmatex">\(\mathcal{X}_0\)</span> è¿è¡ concat å¾å° è§£ç å¨å­£èæåçåå§å¼  <span class="arithmatex">\(\mathcal{X}_{des}\)</span></p>
<p>å¯¹åºçç <span class="arithmatex">\(\mathcal{X}_{ent}\)</span> ä¸ <span class="arithmatex">\(\mathcal{X}_{mean}\)</span> concat å¾å°è§£ç å¨è¶å¿æåçåå§å¼ <span class="arithmatex">\(\mathcal{X}_{mean}\)</span></p>
<p><strong>åå¼ºè°ä¸ä¸ï¼è¿éææ¶åçåéçè®°å·åå½¢ç¶ï¼</strong> </p>
<ul>
<li>ç¼ç å¨çè¾å¥æ¯ è¿å» <span class="arithmatex">\(I\)</span> ä¸ªæ¶é´æ­¥ï¼è¡¨ç¤º <span class="arithmatex">\(\mathcal{X}^{I \times d}\)</span> ï¼<span class="arithmatex">\(I\)</span> è¡¨ç¤ºæ¶é´æ­¥é¿ï¼<span class="arithmatex">\(d\)</span> è¡¨ç¤ºæ¯ä¸ªæ¶é´æ­¥çç¹å¾æ°ã</li>
<li>è§£ç å¨å­£èæåçè¾å¥æ¯ <span class="arithmatex">\(\mathcal{X}_{des} ^{(\frac{I}{2}+O)\times d}\)</span> ãè§£ç å¨è¶å¿æåçè¾å¥æ¯ <span class="arithmatex">\(\mathcal{X}_{det} ^{(\frac{I}{2}+O)\times d}\)</span> </li>
<li>æ¶åå°çä¸­é´åéï¼<span class="arithmatex">\(\mathcal{X}^{\frac{I}{2} \times d}_{ens}\)</span> ï¼<span class="arithmatex">\(\mathcal{X}^{\frac{I}{2} \times d}_{ent}\)</span> å¯ä»¥çè§£ä¸ºæ ç­¾åºåçå­£èæååè¶å¿æåï¼å°±æ¯ä»è¾å¥åºååè§£çå­£èæååè¶å¿æåä¸­æªåçååæ®µã</li>
<li>é¢æµåºåå­£èæåçåå§å¼æ¯ <span class="arithmatex">\(\mathcal{X}_0 ^{O \times d}\)</span> ï¼è¶å¿æååå§å¼æ¯ <span class="arithmatex">\(\mathcal{X}^{O \times d} _{Mean}\)</span></li>
</ul>
<p>ä¹å°±æ¯è®ºæä¸­æ¨¡åç»æå¾çï¼</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320091412914.png"><img alt="image-20250320091412914" src="../images/image-20250320091412914.png"/></a></p>
<p>å·ä½å°ä»£ç ï¼å°±æ¯ autoformer forwardçå 5 è¡ï¼å¶ä¸­ self.decompæ¯æä»¬ååä»ç»è®²è¿ç åºååè§£æ¨¡å Series decomposition blockï¼</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320091921116.png"><img alt="image-20250320091921116" src="../images/image-20250320091921116.png"/></a></p>
<p>è¿é¨åä»£ç æ¯è¾å¥½çè§£ï¼å°±è¿æ ·ï¼ä»¥ä¸é¨åå®æäºå¯¹åæ model inputs é¨åçè®²è§£ï¼ä»£ç ï¼è®ºæï¼å¾ï¼å¬å¼é½è®²äºã</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320092158923.png"><img alt="image-20250320092158923" src="../images/image-20250320092158923.png"/></a></p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320092214513.png"><img alt="image-20250320092214513" src="../images/image-20250320092214513.png"/></a></p>
<h3 id="encoder">Encoder<a class="headerlink" href="#encoder" title="Permanent link">Â¶</a></h3>
<p><strong>æ¥ä¸æ¥è¿å¥è®ºæç Encoder é¨å</strong> </p>
<p>ä¼åæ ·æç§ï¼è®ºæãå¾ãå¬å¼ãä»£ç ä¸ä¸å¯¹åºçé»è¾è¿è¡è®²è§£</p>
<p><strong>é¦åï¼Autoformer éµå¾ªåå§ Transformer çç»æï¼</strong> </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320092445230.png"><img alt="image-20250320092445230" src="../images/image-20250320092445230.png"/></a></p>
<p>ç¼ç å¨ï¼è§£ç å¨ï¼ç¼ç å¨æ¥æ¶ç input æ¯ word embedding + positional embeddingï¼ç¶åéè¿èªæ³¨æåæºå¶ååé¦ç¥ç»ç½ç»ãè§£ç å¨æ¥æ¶ç è¾å¥æ¯ outputï¼é¢æµé¨åï¼åæ ·æ¯ word embedding+positional embeddingï¼ç¶ååå«ç»è¿è§£ç å¨è¾å¥ç èªæ³¨æåæºå¶ï¼ä»¥ååç¼ç å¨è¾åº ç äº¤åæ³¨æåï¼æåç»è¿ å¨è¿æ¥å±ï¼å¾å°æç»çè¾åºã</p>
<p>é¦åå¼ºè°ä¸ä¸å³äºTransformer ä¸ºä»ä¹æ¯æ³¨æåæºå¶åå¨è¿æ¥å±çè®¾è®¡ï¼</p>
<blockquote>
<p>é¦åï¼Transformer å¨ NLPä¸­æ¥æ¶çæ°æ®æ ¼å¼ æ¯ [B,L,D]ï¼batch sizeï¼ä¸ä¸ª batch ä¸­æå¤å°ä¸ªå¥å­ï¼ä¸ä¸ªå¥å­ä¸­æå ä¸ªè¯ Lï¼æ¯ä¸ªè¯çåµå¥Dï¼ä¹å°±æ¯æ¯ä¸ªè¯ç¨é¿åº¦ä¸ºå¤å°çåéè¡¨ç¤º</p>
<p>æç´è§çè®²è§£ï¼å°±æ¯ æ³¨æåæºå¶è¿è¡ L å±é¢çäº¤äºï¼åé¦ç¥ç»ç½ç»è¿è¡ D å±é¢çäº¤äºã</p>
<p><strong>L å±é¢ä¹å°±æ¯æ³¨æå°äº è¯ä¸è¯ä¹é´çäº¤äºï¼D å±é¢å°±æ¯è¯ä¸è¯ä¹é´ç¹å¾çäº¤äº</strong> </p>
<blockquote>
<p>å¨Lå±é¢ï¼åè¯å±é¢ï¼è¿è¡äº¤äºï¼è®¡ç®æ¯ä¸ªåè¯å¯¹å¶ä»åè¯çæ³¨æåæéï¼ææè¯ä¸è¯ä¹é´çå³ç³»ï¼</p>
<p>å¨Då±é¢ï¼å³åè¯åµå¥çç¹å¾å±é¢ï¼è¿è¡äº¤äºï¼å¯¹æ¯ä¸ªåè¯çåµå¥åéè¿è¡éçº¿æ§åæ¢ï¼ææè¯ä¸è¯ä¹é´çç¹å¾äº¤äº </p>
</blockquote>
<p><strong>å¯¹åºå°æ¶é´åºåä¸­</strong></p>
<p>1ï¸â£ æ å <mark>è¾å¥</mark> æ ¼å¼ä¹æ¯ BLDï¼å·ä½çè§£éï¼ </p>
<blockquote>
<p>B = 32 (æ¹éå¤§å°ï¼32ä¸ªæ¶é´åºåæ ·æ¬)
L = 36 (æ¯ä¸ªæ ·æ¬æ36ä¸ªæ¶é´æ­¥ï¼å¦è¿å»36å¤©çæ°æ®)
D = 7 (æ¯ä¸ªæ¶é´æ­¥æ7ä¸ªç¹å¾ï¼å¦å¯¹äºè¡ç¥¨å¯è½åæ¬å¼çä»·ãæ¶çä»·ãæé«ä»·ãæä½ä»·ãäº¤æéç­)</p>
</blockquote>
<p>2ï¸â£ <mark>å¤ç</mark>   æ³¨æåæºå¶</p>
<p>ç¼ç å¨ä¸­ï¼æ³¨æåå¨ææ36ä¸ªæ¶é´æ­¥ä¹é´å»ºç«è¿æ¥
è§£ç å¨ä¸­ï¼æ³¨æåæ¢å¨é¢æµåºååé¨å»ºç«è¿æ¥ï¼ä¹ä¸ç¼ç å¨è¾åºå»ºç«è¿æ¥</p>
<p>æ¶é´æ­¥ä¹é´çå»ºæ¨¡ å¯ä»¥ åç°è¡ç¥¨ä»·æ ¼æ¯å¨äºå¯è½ä¸è·ï¼æèæ¯æåå¯è½ä¸æ¶¨çæ¨¡å¼</p>
<p>3ï¸â£ <mark>å¤ç</mark>  åé¦å¨è¿æ¥å±</p>
<p>å¤çæ¯ä¸ªæ¶é´æ­¥å7ä¸ªç¹å¾ä¹é´çå³ç³»</p>
<p>ä¾å¦ï¼äº¤æéä¸ä»·æ ¼åå¨çå³ç³»ï¼æå¼çä»·ä¸æ¶çä»·çå³ç³»</p>
</blockquote>
<p>è¯¶ï¼è¯´èµ·è¿ä¸ªï¼å³äºç¨ç°å®ä¾å­çè§£è¿äºæ¨¡åï¼</p>
<p><strong>é¦åï¼å·ç§¯æ¯ä»ä¹ææï¼</strong> </p>
<p>åå¦æä»¬è¦è®¤è¯ä¸ä¸ªäººAï¼B æ¯ A çç´æ¥æåï¼å½¢æäºB å¯¹ A çç¬¬ä¸æ¬¡è®¤è¯ï¼B å°±ç¸å½äºå·ç§¯æ ¸äºï¼é£ç´æ¥è®¤è¯ Açè¯å®ä¸æ­¢ä¸ä¸ªäººï¼è¿æB1ï¼B2ï¼B3...ç­ï¼æ¯ä¸ªäººå¯¹å½¢æäºå¯¹ A çç¬¬ä¸æ¬¡è®¤è¯ï¼ç¶æ¯è®¤è¯ Aæ´å³æ³¨çæ´»å±é¢ï¼å­¦æ ¡ä¸­ç´æ¥è®¤è¯ç A æ´å³äºä¸ºäººå¤äºé¨åï¼å·¥ä½ä¸­ç´æ¥è®¤è¯ç A æ´å³äº A ççäº§æ§ãè¿éç´æ¥è®¤è¯ A çB1ï¼B2ï¼B3...å°±æ¯æ¯ä¸å±ä¸­ å·ç§¯æ ¸çä¸ªæ°ãé¤äºç´æ¥è®¤è¯ A çï¼è¿æéè¿ç´æ¥è®¤è¯ A çäººB è®¤è¯ Aï¼è¿æ³¢äººå« Cï¼é£è¿æéè¿ C è®¤è¯ A çï¼é£ C åè®¤è¯ Dï¼D åéè¿ C è®¤è¯ Aãé¤äºå«äººè®¤è¯ Aï¼A èªå·±ä¹æå¯¹èªå·±çè®¤è¯ã</p>
<p><strong>Transformeræ¯ä»ä¹ææï¼</strong></p>
<p>é¤äºååè¯´ç æ³¨æåæºå¶ååé¦å¨è¿æ¥å±ççè§£ï¼è¿æ Encoder ãDecoder ãå¤å¤´æ³¨æåæºå¶ççè§£ã</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></input></label> Encoder&amp;Decoder çäº¤äºæä¹çè§£ï¼</li>
</ul>
<p>é¦åï¼æ´ä½ä¸çè¿ä¸ªå¾ï¼</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320095403477.png"><img alt="image-20250320095403477" src="../images/image-20250320095403477.png"/></a></p>
<p>ç¼ç å¨ç¸å½äºç²æ¹ï¼è§£ç å¨ç¸å½äºä¹æ¹ï¼ç²æ¹æéæ±ï¼èªå·±å¬å¸åé¨ä¸çº§ä¸çº§æ²éï¼ä»æå¼å§çæ³æ³æç»å½¢ææ¹æ³äº¤ç»æåä¸ä¸ªäººï¼è¿ä¸ªäººå»åä¹å¬å¸æ²éï¼ä¹å¬å¸åæå¾å¤ä¸ªé¨åï¼æ¯ä¸ªé¨ååå«å®æç²å¬å¸æåºçæ¹æ¡çä¸é¨åï¼è¿ä¸ä¸ªè¿ç¨ä¸­éè¦ä¸æ­çä¸ç²å¬å¸ææ¿æç»æ¹æ¡çäººä¸æ­æ²éï¼æç»ä¹å¬å¸å®ææ¹æ¡ã</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></input></label> å¤å¤´æ³¨æåæºå¶æä¹çè§£</li>
</ul>
<p>å¯¹äº BLD çåºåï¼é¦åæç½çæ¯ï¼é£ä¸ªç»´åº¦åå¤å¤´äºï¼æ¯ D ç»´åº¦åæ num headç»´åº¦å head dimï¼å¶ä¸­ num head Ã head dim = embedding dimï¼Dï¼ï¼ç¸å½äºä»ä¹ææï¼ä¸ä¸ªäººå­¦ç¥è¯ï¼B =1ï¼ï¼L æ¯è¦å­¦çå æ¬ä¹¦ï¼D æ¯æ¯æ¬ä¹¦æå ä¸ªç« èï¼ä¸è¬æ¯ä¸ä¸ªèå¸ææä»¬å­¦ä¸æ´æ¬ä¹¦ï¼ä½å¤å¤´æ³¨æåæºå¶çæææ¯ï¼ä¸æ¬ä¹¦çå ä¸ªç« èï¼åå¼ï¼æ¯å¦ç¬¬ä¸ä¸ªèå¸æç¬¬ä¸ç« åç¬¬äºç« ï¼ç¬¬äºä¸ªèå¸æç¬¬ä¸ç« åç¬¬åç« ï¼æåä¸¤å¼ ç¬¬ä¸ä¸ªèå¸æï¼è¿æ ·å­¦ä¹ çæ¶åï¼åæ ·æ¯ä¸ä¸ªå­¦æï¼ä¸ä¸ªèå¸åªéè¦å³æ³¨ä¸¤ç« çåå®¹ï¼å¯¹äºè¯¾ç¨èå¥çææ¡ç¥è¯çè§£çæ´éå½»ï¼ææä¼æ¯ä¸ä¸ªèå¸æä¸æ´æ¬ä¹¦çåå®¹è¦å¥½ä¸äºã</p>
<p>B=3ï¼å°±æ¯ç­éç 3 ä¸ªäººï¼æ¯ä¸ªäººè¿å­¦æé½è¦ä¸è¿å æ¬è¯¾ï¼åæ ·ç LDã</p>
<blockquote>
<p>æåä¸ä¸ª linear å±ï¼åºè¯¥æ¯ä¸ºäºè¿ååå§ç»´åº¦çã</p>
</blockquote>
<h4 id="_8">è®ºæ<a class="headerlink" href="#_8" title="Permanent link">Â¶</a></h4>
<p><strong>å¥½äºï¼æ©å±çè¿äºï¼åå°è®ºæä¸­Encoder é¨å</strong> </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320092249326.png"><img alt="image-20250320092249326" src="../images/image-20250320092249326.png"/></a></p>
<p>åæä¸­è¯´ï¼é¦åç¼ç å¨æ´ä¸æ³¨å­£èé¨åçå»ºæ¨¡ï¼ç¼ç å¨çè¾åºåå«è¿å»çå­£èæ§ä¿¡æ¯ï¼å¹¶å°ä½ä¸ºäº¤åä¿¡æ¯å¸®å©è§£ç å¨ç»åé¢æµç»æï¼åè®¾æ N ä¸ªç¼ç å¨ï¼åç¬¬ i å±ç¼ç å¨çæ»ä½æ¹ç¨å¯ä»¥è¡¨ç¤ºä¸º <span class="arithmatex">\(\mathcal{X}_{en}^l = Encoder(\mathcal{X}_{en}^{l-1})\)</span> ï¼å°±æ¯è¯´ ç¬¬ <span class="arithmatex">\(l\)</span> å±ç¼ç å¨æ¥æ¶ ç¬¬ <span class="arithmatex">\(l-1\)</span> å±ç¼ç å¨çè¾åºä½ä¸ºè¾å¥ï¼å·ä½çç»èæ¯åæçå¬å¼(3)</p>
<p><strong>ä¸é¢å¯¹ å¬å¼ 3 è¿è¡è®²è§£</strong></p>
<p>é¦åï¼ç­å·å·¦è¾¹ï¼ä¸åçº¿è¡¨ç¤ºå¿½ç¥æå­£èæåï¼åªå³æ³¨å­£èæåã</p>
<p><span class="arithmatex">\(\mathcal{X}_{en}^l = \mathcal{S}_{en}^{l,2},l \in {1,...,N}\)</span>  è¡¨ç¤º ç¬¬ <span class="arithmatex">\(l\)</span> å±ç¼ç å¨çè¾åºã</p>
<ul class="task-list">
<li>
<p>åå§å¼ï¼ä¹å°±æ¯ç¼ç å¨çè¾å¥æ¯ <span class="arithmatex">\(\mathcal{X}_{en}^0\)</span> æ¯ è¾å¥æ¶é´åºåç <span class="arithmatex">\(\mathcal{X}_{en}\)</span> ç word embedding</p>
</li>
<li class="task-list-item">
<p><label class="task-list-control"><input disabled="" type="checkbox"><span class="task-list-indicator"></span></input></label> <span class="arithmatex">\(\mathcal{S}_{en}^{l,i},i \in {1,2}\)</span> è¡¨ç¤º ç¬¬ <span class="arithmatex">\(l\)</span>å±ä¸­ ç¬¬ i ä¸ªåºååè§£æ¨¡åä¹åçå­£èæ§æåï¼ç¶åå¬å¼ä¸­ç Auto-correlation åé¢åè¯´ï¼è¿æ¯æ¬æçä¸ä¸ªåæ°ç¹ãï¼psï¼åé¢è¦éç¹çè¿ä¸ªæ¯ä»ä¹ææãï¼</p>
</li>
</ul>
<blockquote>
<p>ï¼ææå¼å§çè§è¿éççé®ï¼ä¸ç¨è®²ï¼å¿½ç¥æå³å¯ï¼åçå¬å¼ç­å·çå·¦è¾¹ï¼ <span class="arithmatex">\(\mathcal{S}_{en}^{l,1}\)</span> é¦åï¼ä¸æ  <span class="arithmatex">\(en\)</span> å°±æ¯è¡¨ç¤º ç¼ç å¨ï¼<span class="arithmatex">\(l\)</span> è¡¨ç¤ºç¬¬å ä¸ªç¼ç å¨ï¼é£è¿ä¸ª <span class="arithmatex">\(1\)</span>æ¯ä»ä¹ææï¼</p>
</blockquote>
<p><strong>åæåå¬å¼è¯´äºï¼æ¥ä¸æ¥æ¥çä»£ç ï¼Encoder æ¯æä¹å®ç°çã</strong></p>
<h4 id="encoder-embedding_1">Encoder Embedding<a class="headerlink" href="#encoder-embedding_1" title="Permanent link">Â¶</a></h4>
<p><mark>é¦åï¼æé  Encoder çè¾å¥</mark> ï¼ç¼ç å¨åµå¥ã</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320143146767.png"><img alt="image-20250320143146767" src="../images/image-20250320143146767.png"/></a></p>
<p>å·ä½æä¹åççautoformer ç init é¨åï¼</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320143228968.png"><img alt="image-20250320143228968" src="../images/image-20250320143228968.png"/></a></p>
<p>çå°è¿è¾¹è°ç¨ç <code>DataEmbedding_wo_pos</code> è¿ä¸ªç±»ï¼å¶ä¸­å·ä½å° valueEmbedding åTemporaryEmbedding ååå«å¨ init ä¸­æ¾ç¤ºè°ç¨äº <code>TokenEmbedding</code> ç±»å <code>TemporalEmbedding</code> ç±»</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320143256379.png"><img alt="image-20250320143256379" src="../images/image-20250320143256379.png"/></a></p>
<h5 id="_9">ç±»å¾<a class="headerlink" href="#_9" title="Permanent link">Â¶</a></h5>
<p>åµå¥é¨åçè°ç¨å³ç³»ç¨æµç¨å¾æ¥è¡¨ç¤ºï¼</p>
<pre class="mermaid"><code>classDiagram
    class DataEmbedding_wo_pos {
        +TokenEmbedding value_embedding
        +PositionalEmbedding position_embedding
        +TemporalEmbedding temporal_embedding
        +Dropout dropout
        +forward(x, x_mark)
    }

    class TokenEmbedding {
        +Conv1d tokenConv
        +forward(x)
    }

    class PositionalEmbedding {
        +Tensor pe
        +forward(x)
    }

    class TemporalEmbedding {
        +Embedding minute_embed
        +Embedding hour_embed
        +Embedding weekday_embed
        +Embedding day_embed
        +Embedding month_embed
        +forward(x)
    }

    class TimeFeatureEmbedding {
        +Linear embed
        +forward(x)
    }

    DataEmbedding_wo_pos --&gt; TokenEmbedding
    DataEmbedding_wo_pos --&gt; PositionalEmbedding
    DataEmbedding_wo_pos --&gt; TemporalEmbedding
    TemporalEmbedding --&gt; TimeFeatureEmbedding
</code></pre>
<p>é¦åï¼è·å¤§å®¶è¯´è¿ä¸ªå¾æä¹ç»ï¼é¦åå¨è°è¯çè¿ç¨ä¸­ï¼çå°è°ç¨ç¸å³çä»£ç ï¼å°±ç²è´´ç» gptï¼ç¶åè®© gpt ç»ãè¿ä¸ªå¾å°±æ¯ gpt ç»æç»çï¼å®ç¨ç mermaid ï¼çæä»£ç ï¼ç¶åæç²è´´å°æç markdown ææ¡£ä¸­ï¼æç¨ç markdown ç¼è¾å¨æ¯ Typoraï¼å¯ä»¥è§£æ mermaidï¼ç¨å¨çº¿mermaid ä¹å¯ä»¥æ¾ç¤ºåºå¾ãç´æ¥æ å¨çº¿ mermaidãæèè· gpt è¯´ï¼ç¨ç®åçæµç¨å¾ç»ï¼ä¸ç¨ mermaidï¼é½è½å¸®ä½ æèªå·±çä»£ç çæ¸æ¥ã</p>
<p>mermaid ç»åºçç±»è°ç¨å¾ï¼ä¸ä¸ªç±»ç¨ä¸è¡è¡¨ç¤ºï¼ç¬¬ä¸è¡ ç±»åãç¬¬äºè¡ï¼init é¨åçå®ä¹ãç¬¬ä¸è¡ç±»ä¸­æ¹æ³çå®ä¹</p>
<p><strong>å¥½äºï¼ç°å¨å¼å§è®²å¾ï¼</strong> </p>
<p>å¯ä»¥çå° <code>DataEmbedding_wo_pos</code> ç±» ç init åå«è°ç¨äº <code>TokenEmbedding</code>ç±»ã<code>PositionalEmbedding</code>ç±»å <code>TemporalEmbedding</code>ç±»ï¼åæ¶è¿å®ä¹äºä¸ä¸ª dropout å±ã</p>
<p>ðµ è°ç¨ <code>tokenEmbedding</code>ç±»ï¼init é¨åæ¯ä½¿ç¨ä¸ä¸ª <code>nn.Conv1d</code> åå§åäºä¸ä¸ªå·ç§¯å±ï¼ä¼ ç» <code>self.tokenConv</code> ï¼åé¢å¨ è¿ä¸ªç±»ä¸­ç forward æ¹æ³ä¸­ç¨ã</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320144456851.png"><img alt="image-20250320144456851" src="../images/image-20250320144456851.png"/></a></p>
<p>éä¿ç¹è¯´ï¼è¿éç tokenEmbedding å°±æ¯éè¿ä¸ä¸ª1D å·ç§¯å®ç°çï¼å·ä½çå½¢ç¶ååæ³¨éä¸­ä¹ç»åºäºã</p>
<blockquote>
<p>æä¹çææ³¨éï¼</p>
<p>é¦åæä»£ç ç²ç» gptï¼ç¶åï¼è·å®è¯´ï¼<code>ä¸ºæ¯è¡ä»£ç  æ·»å  ä¸¤è¡æ³¨éï¼ä¸è¡è¯´æè¿è¡ä»£ç çç®çï¼ä¸è¡è¯´æ å½¢ç¶çåååæä½ å½¢ç¶-&gt;æä½-&gt;å½¢ç¶çæ ¼å¼ï¼æä½çæ ¼å¼ç±»ä¼¼ DecoderLayer.forward æ¾ç¤ºåºè°ç¨çä»ä¹ç±»å.æ¹æ³</code></p>
</blockquote>
<p>ðµ æ¥ä¸æ¥ç ä½ç½®ç¼ç  Positional Embeddingï¼ç±äºè¿éæ²¡æç¨ï¼å°±ä¸è¯´äºã</p>
<p>ðµ æåï¼æ¶é´æ³ç¼ç ï¼</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320145727249.png"><img alt="image-20250320145727249" src="../images/image-20250320145727249.png"/></a></p>
<p>æ³¨æè¿éçæ¶é´æ³ç¼ç æ¯æä¸ä¸ªå¤æ­çï¼ç»è¿è°è¯ï¼æä»¬è¿éè°ç¨çæ¯ <code>TimeFeatureEmbedding</code> ç±»ã</p>
<p>ä¹å°±æ¯è¯´ä»ä¹ææï¼è¿ä¸ªå¾ç»çæé®é¢ï¼ä¸è¿ææä¹æ¯å¯¹çï¼å°±ä¸æ·±ç©¶äºã</p>
<p>æ¥ä¸æ¥ï¼æä»¬è·³å° <code>TimeFeatureEmbedding</code> è¿ä¸ªç±»çå®ä¹ã</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320150012753.png"><img alt="image-20250320150012753" src="../images/image-20250320150012753.png"/></a> </p>
<p>å°±æ¯éè¿ä¸ä¸ªçº¿æ§å±ï¼å° æ¶é´æ³ç¹å¾åµå¥å°æå®ç»´åº¦ã</p>
<p>é¦åï¼åµå¥å°æå®ç»´åº¦æ¯å ä¸ºé«ç»´åéè¡¨ç¤ºç¹å¾æ´ç²¾ç»ã</p>
<p>å¶æ¬¡ï¼æä»¬è¿éä½¿ç¨çæ¯ç¾çæ°æ®éï¼æ¯å°æ¶çï¼æä»¥ç»´åº¦ 4ï¼è¡¨ç¤ºççæ¯ï¼å°æ¶-å¤©ï¼å¤©-å¨ï¼å¤©-æï¼å¤©-å¹´ãè¿ä¸é¨åä¹è¯´è¿å¾å¤æ¬¡äºï¼åè¯´ä¸æ¬¡ï¼å æ·±å°è±¡ã</p>
<p>å·ä½æ¥è¯´è¾å¥ç <code>x_mark.shape=32,36,4 â nn.Linear â 32,36,512</code></p>
<p>æ¥ä¸æ¥ï¼æ»ç»ä¸ä¸è¿éçåµå¥ãé¦å æ¬æç¨å°çææåµå¥é½å®ä¹å¨äº  <code>Embed.py</code>æä»¶ä¸­</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320150552474.png"><img alt="image-20250320150552474" src="../images/image-20250320150552474.png"/></a></p>
<p>èè¿ä¸ªæä»¶ä¸­ï¼åå®ä¹äºææçåµå¥ç±»ï¼åæ 8 ä¸ªã</p>
<blockquote>
<p>é¢å¤è¯ï¼è¿ä¸ªæä¹çï¼æ¯ vscode çå¤§çº²è§å¾ï¼æ¾åºæ¥ï¼å°±è½çå°äº</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320150811010.png"><img alt="image-20250320150811010" src="../images/image-20250320150811010.png"/></a></p>
<p>å¤§çº²è§å¾ä¸­ï¼ç«æ¹ä½è¡¨ç¤ºå®ä¹çå½æ°ï¼å°æ æçä¸è¥¿æ¯ç±»ï¼ç±»ä¸­æå°ç«æ¹ä½ï¼æ¯ç±»ä¸­å®ä¹çå½æ°ï¼ç±»ä¸­å®ä¹çå½æ°ï¼ä¹å°±æ¯å°ç«æ¹ä½ä¸­ï¼æå çé¨åæ¯ ä½¿ç¨è¿ä¸ªå½æ°æèç±»æéè¦çåå§ååæ°ãæ¹æ¬å·+å°ç«æ¹ä½åæ¬çé¨åæ¯ ç±»ä¸­è°ç¨çç±»çå¯¹è±¡åï¼æ¯å¦è¿éï¼</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320151133019.png"><img alt="image-20250320151133019" src="../images/image-20250320151133019.png"/></a></p>
<p>ä»¥è¿ä¸ª TemporalEmbedding ç±»ä¸ºä¾ï¼ è¿ä¸ªTemporalEmbedding ç±»ä¸­æä¸¤ä¸ªæ¹æ³æ¹æ³ï¼åå«æ¯ init å forwardã</p>
<p>init æå çé¨åæ¯ åå§åè¿ä¸ªç±»æéè¦çåæ°ï¼ forward æå çé¨åæ¯è°ç¨è¿ä¸ªæ¶æéè¦çåæ°ï¼å¶ä¸­ init é¨åè¿å®ä¾åäº 5 ä¸ªå¯¹è±¡ï¼å¯¹è±¡ååå«æ¯ mintue_embedãhour_embedãweekday_embedãday_embedãmonth_embedï¼ä½æ¯è¿éå·ä½å®ä¾åçåªä¸ªç±»ãè¿éæ¯æ²¡ææ¾ç¤ºçï¼å¾ç¹è¿å»èªå·±çï¼å¯ä»¥çå°è¿ä¸ªå¯¹è±¡å¶å®é½æ¯å®ä¾åçEmbed è¿ä¸ªç±»ï¼å¾ææ¾æ¯ä¸ä¸ªèªå®ä¹çï¼æ³çè¿å¾æ­¥è¿çå·ä½å®ä¾åçåªä¸ªç±»ã</p>
</blockquote>
<p>ä»¥ä¸å®æäº Encoder Input ç Embedding é¨åï¼åå«è¿è¡äº token Embedding å TemporaryEmbeddingæ¥å¯¹åå²æ¶é´æ­¥ç¹å¾è¿è¡åµå¥åæ¶é´ç¹å¾è¿è¡åµå¥ã</p>
<p>æ±æ»è¿éçç»´åº¦å½¢ç¶ååï¼</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1"></a><a href="#__codelineno-34-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># x [B, L, D] â permute â [B, D, L] â å·ç§¯ â [B, d_model, L] â transpose â [B, L, d_model]</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2"></a><a href="#__codelineno-34-2"><span class="linenos" data-linenos="2 "></span></a><span class="c1"># x_mark [B, L, d_inp] â çº¿æ§å±åæ¢(æ¶é´ç¹å¾æ´ä½æ å°) â [B, L, d_model]</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3"></a><a href="#__codelineno-34-3"><span class="linenos" data-linenos="3 "></span></a><span class="c1"># [B, L, d_model] + [B, L, d_model] â [B, L, d_model]</span>
</span></code></pre></div>
<p><strong>æ¥ä¸æ¥æ³ç»å¤§å®¶è¯´çæ¯ï¼ 1D å·ç§¯æä¹è¿è¡ç tokenEmbeddingï¼</strong> </p>
<p>å°å°çç¹ï¼å°å°çæ³¨æã</p>
<p>æ¥æ¶çæ åè¾å¥æ¯ BLD</p>
<ul>
<li>é¦åè¿è¡çæ¯ permuteï¼å°æ³è¦åµå¥çç»´åº¦<code>D</code> ç§»å°ä¸­é´ï¼ç¶åè¿è¡ 1D å·ç§¯ï¼åµå¥å° <code>d_model</code>  ï¼ <code>Embedding dim</code>ï¼ï¼å¯¹åºå° 1D å·ç§¯ä¸­ï¼å°±æ¯è¾å¥ééæ¯ Dï¼è¾åºééæ¯ <code>d_model</code></li>
</ul>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320152707837.png"><img alt="image-20250320152707837" src="../images/image-20250320152707837.png"/></a></p>
<ul>
<li>ä¸ºä»ä¹è¿ä¹åï¼å ä¸ºå·ç§¯æå¼å§ä¸»è¦ç¨äºå¾åï¼å¾åçæ åæ ¼å¼æ¯ BCHWï¼å¾åä¸­ç HW å°±è¡¨ç¤ºå¾åçç¹å¾ï¼åªä¸è¿æ¯ç¨ 2Dçç©éµ è¡¨ç¤ºçï¼èä¸è¿ä¸ª 2D ç©éµä¿å­äºä½ç½®ä¿¡æ¯ï¼ä¸è½éæå±å¹³ãé£æ­¤æ¶ï¼C ä¹å°±å¯ä»¥çè§£ä¸ºæ¯ä¸ªåç´ çç¹å¾æ°ãæ¯å¦æ¯ä¸ªåç´ ç¨å½©è²ç RGB ä¸ä¸ªåç´ è¡¨ç¤ºã</li>
<li>æä»¥æä»¬è¿éçæ¶é´åºåä¸­ç 1D å·ç§¯ï¼ä¹ä»¿ç§å¾åä¸­å·ç§¯çå®ä¹ï¼æ¯ä¸ªæ¶é´æ­¥çç¹å¾æ°æ¾å°ä¸­é´ï¼è¡¨ç¤ºè¾å¥ééæ°ï¼ç¶åå°æ¯ä¸ªæ¶é´æ­¥çç¹å¾ï¼æ å°å°è¾åºç»´åº¦å¤§å°ï¼è¿éè¡¨ç¤ºä¸º <code>Embedding dim</code>ï¼ä¹å°±æ¯ <code>d_model</code>ã</li>
</ul>
<p>ç¨ä¸å¼ å¾æ¥è¡¨ç¤ºï¼(è¿éå¶å®å¾å SegRNN çè§è§è½¬æ¢)ï¼</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320154515642.png"><img alt="image-20250320154515642" src="../images/image-20250320154515642.png"/></a></p>
<p>è æ¶é´æ³ç¹å¾ç nn.Linearå°±æ¯ç´æ¥å¯¹æåä¸ä¸ªç»´åº¦è¿è¡åµå¥äº</p>
<p><code>x_mark [B, L, d_inp] â çº¿æ§å±åæ¢(æ¶é´ç¹å¾æ´ä½æ å°) â [B, L, d_model]</code></p>
<p>pytorchä¸­å¸¸ç¨çæ¯ç»´åº¦åæ¢å½æ° permuteãtransposeãview é½æ¯ç´æ¥åç»´åº¦åæ¢ã</p>
<p>å¸¦çèµ°ä¸éä»£ç ã</p>
<h4 id="encoder-forward">Encoder forward<a class="headerlink" href="#encoder-forward" title="Permanent link">Â¶</a></h4>
<p><strong>è¡äºï¼åµå¥è®²å®äºï¼æ¥ä¸æ¥ï¼è¿å¥æ­£å¼ç Encoder çé¨åçæ°æ®æµå¨ã</strong></p>
<p>ï¼ç»äºï¼</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320160444391.png"><img alt="image-20250320160444391" src="../images/image-20250320160444391.png"/></a></p>
<p>ä» Autoformer forward ç self.encoder è¿å¥ã</p>
<p>å¨æ­¥è¿ä¹åçä¸ç¼æä¹åå§åçãéå¸¸å¤æï¼</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320160615516.png"><img alt="image-20250320160615516" src="../images/image-20250320160615516.png"/></a></p>
<p>æ¥ç´æ¥çå¾å§ï¼å·ä½æä¹å¤æã</p>
<h5 id="_10">ç±»å¾<a class="headerlink" href="#_10" title="Permanent link">Â¶</a></h5>
<pre class="mermaid"><code>classDiagram
    class Model {
        +Encoder encoder
    }

    class Encoder {
        +List~EncoderLayer~ layers
        +my_Layernorm norm_layer
        +forward(x, attn_mask)
    }

    class EncoderLayer {
        +AutoCorrelationLayer attention
        +Conv1d conv1
        +Conv1d conv2
        +series_decomp decomp1
        +series_decomp decomp2
        +Dropout dropout
        +activation
        +forward(x, attn_mask)
    }

    class AutoCorrelationLayer {
        +AutoCorrelation attention
        +Linear query_projection
        +Linear key_projection
        +Linear value_projection
        +Linear out_projection
        +forward(queries, keys, values, attn_mask)
    }

    class AutoCorrelation {
        +bool mask_flag
        +int factor
        +float scale
        +Dropout dropout
        +bool output_attention
        +time_delay_agg_training(values, corr)
        +time_delay_agg_inference(values, corr)
        +forward(queries, keys, values, attn_mask)
    }

    Model --&gt; Encoder
    Encoder --&gt; EncoderLayer
    EncoderLayer --&gt; AutoCorrelationLayer
    EncoderLayer --&gt; Conv1d
    EncoderLayer --&gt; series_decomp
    AutoCorrelationLayer --&gt; AutoCorrelation
</code></pre>
<p>é¦åå¾ä¸­æ¸æ¥çå±ç¤ºäºï¼å°±å¾æ¥è¯´ï¼</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320161544932.png"><img alt="image-20250320161544932" src="../images/image-20250320161544932.png"/></a> </p>
<p>éè¿ Autoformer å®ä¹ç model ä¸­ï¼å®ä¹äºè¿ä¸ª Encoder ç±»ï¼ä¼ ç»äº self.encoder ã</p>
<p>æ¥ççè¿ä¸ª Encoder ç±»çå®ä¹ï¼è¿ä¸ª Encoder çåå§åè°ç¨äºEncoderLayerç±»ï¼ä¼ ç»äº layersï¼å°±æ¯EncoderLayerç±»çå®ä¾åå¯¹è±¡ï¼ã</p>
<p>å¯¹åºå°ä»£ç ï¼</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320161505407.png"><img alt="image-20250320161505407" src="../images/image-20250320161505407.png"/></a></p>
<p>æ¥çï¼Encoder ç±»è°ç¨äº EncoderLayer ç±»ï¼é£æ¥ä¸æ¥å°±ç EncoderLayer çå®ä¹ï¼</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320161704846.png"><img alt="image-20250320161704846" src="../images/image-20250320161704846.png"/></a></p>
<p>çå¾ä»¥åä»£ç ï¼</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320162010963.png"><img alt="image-20250320162010963" src="../images/image-20250320162010963.png"/></a></p>
<p>ï¼çä»£ç ï¼ï¼çº¢æ¡æ¯ä¸é¢è®²çï¼<code>Encoder</code> çåå§åéè¦è°ç¨ <code>EncoderLayer</code> ç±»</p>
<p>ç¬¬ä¸ä¸ªçº¢æ¡è¡¨ç¤ºï¼<code>EncoderLayer</code> ä¸­ç <code>init</code> åå§åä¸­åè°ç¨äº <code>AutoCorrelationLayer</code> ç±»ï¼å¹¶ä¸ä¼ å¥äº  <code>EncoderLayer</code> åå§åè¿ç¨ä¸­æéè¦çåæ° ï¼å» <code>EncoderLayer</code> è¿ä¸ªç±»ã</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320162631428.png"><img alt="image-20250320162631428" src="../images/image-20250320162631428.png"/></a></p>
<p>ç»å å¾ å ä»£ç ï¼è¿é¨åå°±å¯ä»¥çè§£äºã</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320163036643.png"><img alt="image-20250320163036643" src="../images/image-20250320163036643.png"/></a> </p>
<p>ä¸»è¦çå¤æç¹å°±æ¯åå§åä¸ä¸ªç±»çåæ¶åéè¦åå§åå¦ä¸ä¸ªç±»ï¼åå§åå¦ä¸ä¸ªç±»åéè¦åå§åç±»ãå¥½å¥½ççæ¯å¯ä»¥çè§£çã</p>
<p>åé¢è¿æ AutoCorrelationLayer çåå§åï¼åè¦è°ç¨ AutoCorrelation ç±»</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320163322154.png"><img alt="image-20250320163322154" src="../images/image-20250320163322154.png"/></a></p>
<p>çè§£çé»è¾æ¯ä¸æ ·çã</p>
<p>é¦åä»£ç  Autoformer forward Encoderçåå§åè¿ç¨ä¸­ï¼ç»åºäºæ¯ä¸ªç±»åå§åæéè¦çä¼ å¥åæ°</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320163438704.png"><img alt="image-20250320163438704" src="../images/image-20250320163438704.png"/></a></p>
<p>èä¸é¢ mermaid ç»çå¾ï¼å±ç¤ºäºæ¯ä¸ªç±»ä¸­ init ä¸­å·ä½è°ç¨çç±»åå®ä¾åçå¯¹è±¡åãä»¥åé¤äº init æ¹æ³å¤ï¼è¿æç±»ä¸­å¯ä»¥è°ç¨çæ¹æ³ï¼æ¯å¦ AutoCorrelationä¸­ï¼é¤äº initãforward ä»¥å¤ï¼è¿æ <code>time_delay_agg_training</code>  å <code>time_delay_agg_inference</code> </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320163849697.png"><img alt="image-20250320163849697" src="../images/image-20250320163849697.png"/></a></p>
<p>è¿é¨åè°ç¨å³ç³»å¸ææè®²æç½äºï¼åç¨ä¸å¼ å¾è¯´æä¸ä¸ï¼</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="https://i-blog.csdnimg.cn/direct/f98d7865ca134201a76ece97f66b7e51.png"><img alt="img" src="https://i-blog.csdnimg.cn/direct/f98d7865ca134201a76ece97f66b7e51.png"/></a></p>
<p>å°±æ¯è¯´å¨æä»¬å¨ Encoder forward ä¸­ä¼ å¥å°çxï¼ä¼ä¼ å¥å° EncoderLayer ä¸­ç forward ä¸­è¿è¡å¤çï¼è   EncoderLayer forward ä¸­åè°ç¨äº AutoCorrelation Layer ä¸­ç forwardï¼ç¶åå¢ï¼AutoCorrelation Layer ä¸­ç forwardåè°ç¨äº AutoCorrelationç forwardï¼æåAutoCorrelationåè°ç¨äºèªå·± AutoCorrelation time delay agg tranning æè inferenceã</p>
<p>ï¼è°æåãå½åéæ­¥è°è¯çæ¶åï¼æ­¥è¿ä¸ä¸ªåæ­¥è¿ä¸ä¸ªï¼é½æ¾ä¸å°å¤´ T_Tï¼ï¼ä¸ºä»ä¹è¯´è¿é¨åè°ç¨ä¸å¥½çè§£ï¼æ¯å ä¸ºæçè¯´ï¼forward ä¸­æè°ç¨ï¼å» init ä¸­æ¾ã</p>
<p>å·ä½æ¥è¯´ï¼Autoformer ç forward ä¸­è°ç¨äº <code>self.encoder</code> ï¼å¨ init ä¸­æ¾å°äº</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320164728075.png"><img alt="image-20250320164728075" src="../images/image-20250320164728075.png"/></a></p>
<p>é£æä½ commandï¼è·³è¿Encoder çå®ä¹ï¼ä¸ç®¡æ¯ init è¿æ¯ forward ä¸­é½æ²¡ææ¾ç¤ºçè¯´æ attn_layeræ¯è°ç¨çä»ä¹ã</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320164939255.png"><img alt="image-20250320164939255" src="../images/image-20250320164939255.png"/></a></p>
<p>æä»¥æå¼å§æ­¥è¿è¿éçæ¶åï¼å°±å¾æãå¶å®è¿éææçåå§åä»¥åè°ç¨é½å¨ææå¼å§ç  Autoformer ç self.encoderçåå§åä¸­ç»äºãå¨åé¢å®ä¹çç±»ä¸­ï¼æä½ command ä¸è½è·³å°ç±»çå®ä¹ãå¾ä»å¤´å¼å§ãå½ç¶äºï¼æ­¥è¿å°±ä¸ç¨ç®¡è¿äºäºãèªå·±å°±è·³æ¥è·³å»äºã</p>
<p><strong>å¥½äº ä»¥ä¸å®æäº self.encoderçåå§åï¼ååæ¯å¯¹ ç¼ç å¨ææ¥æ¶çè¾å¥è¿è¡åµå¥ï¼è¿éæ¯æ¨¡åçå®ä¹</strong></p>
<p>åºäºä»¥ä¸çè®¤è¯ï¼æ¥ä¸æ¥è¿å¥ forward ä¸­ï¼çæ°æ®çæµå¨è¿ç¨ã</p>
<h4 id="encoderlayer">EncoderLayer<a class="headerlink" href="#encoderlayer" title="Permanent link">Â¶</a></h4>
<p>é¦åï¼ä» â¬ï¸ å¼å§æ­¥è¿ã</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1"></a><a href="#__codelineno-35-1"><span class="linenos" data-linenos="1 "></span></a> <span class="n">enc_out</span><span class="p">,</span> <span class="n">attns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">(</span><span class="n">enc_out</span><span class="p">,</span> <span class="n">attn_mask</span><span class="o">=</span><span class="n">enc_self_mask</span><span class="p">)</span>
</span></code></pre></div>
<p>å¦æä»¬ææï¼æ­¥è¿å°äº Encoder ç±»ç forwardï¼</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320165637015.png"><img alt="image-20250320165637015" src="../images/image-20250320165637015.png"/></a></p>
<p>ç»§ç»­æ­¥è¿ï¼ä¸æ­¥æ­¥æ§è¡ï¼</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320165724095.png"><img alt="image-20250320165724095" src="../images/image-20250320165724095.png"/></a></p>
<p>æ¡ä»¶å¤æ­æ§è¡ elseï¼è·³å°</p>
<blockquote>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></input></label> æ¯ä¸æ­¥çç°å®æä¹å¨åä»ä¹</li>
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></input></label> å½¢ç¶ååãè°ç¨å³ç³»</li>
</ul>
</blockquote>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320211248706.png"><img alt="image-20250320211248706" src="../images/image-20250320211248706.png"/></a></p>
<p>EncoderLayer ç forward ä¸­è°ç¨äºèªç¸å³æºå¶ï¼èªç¸å³æºå¶=AutoCorrelation Layer + AutoCorrelationï¼ï¼è¿æ¯æ¬æçåæ°ç¹ï¼åé¢åè¯´ãè®ºæä¸­ä¹æ¯è¯´äºåé¢åè¯´ï¼ä½èè®¾è®¡äºè¿ä¸ªæ¨¡åå°±å°±æ¯ä»£æ¿äºåå§ Transformer ç self attention çè®¡ç®ï¼ä½ çè¿ä¸ªå½åï¼è½ç¶è°ç¨çæ¯AutoCorrelation Layerï¼ä½æ¯åéå½åæ¶ï¼ä»ç¶æ¯ self.attention ä¹å°±å¯ä»¥çè§£ä¸ºä½èæ¯æ¹è¿äºåå§ Transformer ä¸­çèªæ³¨æåæºå¶ã</p>
<p>å æ­¤æä»¬è¿éå¨è°è¯ Encoder çå·ä½è¿ç¨æ¶ï¼ææ¶ä¸æ­¥è¿å° self.attentionçå·ä½çæ§è¡è¿ç¨ä¸­ã</p>
<p>åä¸ª Encoder çæ§è¡å°±æ¯ æ§è¡ä¸æ¬¡ EncoderLayerï¼æå ä¸ª Encoderå°±æ§è¡å æ¬¡ EncoderLayerã</p>
<p>ç°å¨è¯´æè¿ä¸ª EncoderLayer çæ§è¡è¿ç¨ï¼</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1"></a><a href="#__codelineno-36-1"><span class="linenos" data-linenos="1 "></span></a>def forward(self, x, attn_mask=None)
</span></code></pre></div>
<p>é¦å EncoderLayer æ¥æ¶çè¾å¥æ¯ xï¼mask æ¯å¯éåæ°ã</p>
<p>è¾å¥<code>x</code>å½¢ç¶ä¸º[B, L, d_model]</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1"></a><a href="#__codelineno-37-1"><span class="linenos" data-linenos="1 "></span></a>       new_x, attn = self.attention(
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2"></a><a href="#__codelineno-37-2"><span class="linenos" data-linenos="2 "></span></a>            x, x, x,
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3"></a><a href="#__codelineno-37-3"><span class="linenos" data-linenos="3 "></span></a>            attn_mask=attn_mask
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4"></a><a href="#__codelineno-37-4"><span class="linenos" data-linenos="4 "></span></a>        )
</span></code></pre></div>
<p>æ¥ä¸æ¥è¿è¡ Encoder é¨åçèªæ³¨æåæºå¶çè®¡ç®ï¼è¿éå®éè°ç¨çæ¯ä½èçåæ°æ¨¡åï¼èªç¸å³å±ãåé¢ä¸ååºåå«æ³ã</p>
<p>èªæ³¨æåæºå¶==æ¥æ¶==çåæ° qkvé½ç­äº xï¼å ä¸ºæ¯èªæ³¨æåæºå¶ï¼å½¢ç¶æ¯ä¸æ ·ç [B, L, d_model]ã</p>
<p>è¿éç <code>attn_mask=None</code></p>
<p>èªæ³¨æåæºå¶è¿åç åéæ <code>new_x</code>, <code>attn</code>ï¼å½¢ç¶åå«æ¯</p>
<p>new_x<code>[B, L, d_model]</code>åæ³¨æåæéattn<code>[B, n_heads, L, L]</code></p>
<p>è¿éç new_x æææ¯ æäºå¯¹å¶ä»æ¶é´æ­¥æéç xï¼attn å­çæ¯ä¸¤ä¸¤æ¶é´æ­¥ä¹é´çæ³¨æåå¾åãï¼å½ç¶äºï¼è¿æ¯åå§ èªæ³¨æåæºå¶ <span class="arithmatex">\(softmax(\frac{QK^T}{\sqrt{d_k}})V\)</span> çè®¡ç®ï¼è®ºæå®ç°çè¿éé¢æ¯å¥åè¯´ï¼</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1"></a><a href="#__codelineno-38-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="n">new_x</span><span class="p">)</span>
</span></code></pre></div>
<p>æ¥ä¸æ¥ï¼åä¸ª Encoder çè¾åº æ¯ <code>dropout(new_x)</code> ï¼åç»è¿æ®å·®è¿æ¥ãè¿éå°±æ¯<span id="åå§ Transformer æ¶æ">åå§ Transformer æ¶æ</span>ãè§<a href="#éå½">éå½</a>ãä¸­çä¸è¥¿ï¼ä¹å°±æ¯ç»è¿èªæ³¨æåæºå¶ä»¥åè¿è¡ æ®å·®è¿æ¥åå½ä¸åã</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1"></a><a href="#__codelineno-39-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">x</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decomp1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></code></pre></div>
<p>æ¥ä¸æ¥ï¼æ¯åºååè§£</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320214539531.png"><img alt="image-20250320214539531" src="../images/image-20250320214539531.png"/></a></p>
<p>åºååè§£çç¬¬ä¸ä¸ªè¿åå¼æ¯å­£èæåï¼ç¬¬äºä¸ªè¿åå¼æ¯ä½¿ç¨ç§»å¨å¹³åå¾å°è¶å¿æ§æå</p>
<p>å¨ Encoder ä¸­ä½¿ç¨çåºååè§£æ¶ï¼ä¸è¦è¶å¿æåï¼åªçä¸å­£èæå</p>
<p>æ¥æ¶çåæ° x æ¯è¦åè§£çåå§åºåï¼å½¢ç¶æ¯ [B, L, d_model]</p>
<p>è¿åçåæ° x æ¯åè§£ä»¥åçå­£èæåï¼å½¢ç¶ä¾ç¶æ¯ [B, L, d_model]</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320215159566.png"><img alt="image-20250320215159566" src="../images/image-20250320215159566.png"/></a> </p>
<p>è¿é¨åä»£ç å°±æ¯åæå¬å¼ 3 çç¬¬ä¸è¡å¬å¼ã</p>
<p>æä»£ç è´´å°è¿éåä½ä¼ä¸ä¸ï¼</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320215324397.png"><img alt="image-20250320215324397" src="../images/image-20250320215324397.png"/></a></p>
<p>å¯¹ç¬¬ <code>l-1</code> å± Encoder çè¾åºè¿è¡èªç¸å³æºå¶çè®¡ç®ï¼å¾å°çè¾åºä¸åå§ç x è¿è¡æ®å·®è¿æ¥ï¼æåå¯¹æ®å·®è¿æ¥ä»¥åçè¾åºè¿è¡è¶å¿åè§£ï¼åæ¶åªä¿ç å­£èæåï¼å¿½ç¥æè¶å¿æåã</p>
<p><strong>æ¥ä¸æ¥ï¼è¿è¡å¬å¼ 3 çç¬¬äºè¡å¬å¼æå¯¹åºçä»£ç è®²è§£ï¼</strong> </p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1"></a><a href="#__codelineno-40-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">y</span> <span class="o">=</span> <span class="n">x</span>
</span></code></pre></div>
<p>ä¸ä¸å¥ï¼æ°å»º x çå¯æ¬ï¼ä¿å­æ yï¼åé¢é½å¯¹ x çå¯æ¬ ä¹å°±æ¯è¿ä¸ª y æä½ï¼x åæ¾çä¸ç¨ï¼åé¢ç¨äº FFN ä»¥åç æ®å·®è¿æ¥ã</p>
<p>é£å·ä½è¿éç FFN æ¯æä¹åçå¢ï¼</p>
<p>çå°ä»£ç </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320215804289.png"><img alt="image-20250320215804289" src="../images/image-20250320215804289.png"/></a></p>
<p>ä¸çdropout åæ¿æ´»å±ï¼å ä¸ºè¿ä¸¤ä¸ªæä½å¹¶ä¸ä¼æ¹åè¾å¥å¼ éçå½¢ç¶ï¼æ¥ä¸æ¥çå°FFN æ¯ç±ä¸¤ä¸ª 1d å·ç§¯ä¹å°±æ¯conv1d å®ç°çã</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320215914272.png"><img alt="image-20250320215914272" src="../images/image-20250320215914272.png"/></a></p>
<p>æ¥ä¸æ¥ï¼åç Encoder ç init é¨åï¼è¿ä¸¤ä¸ª 1d å·ç§¯æ¯æä¹å®ä¹çï¼è¯¶ï¼å°±æ¯ä¸ä¸ªååç»´åéç»´çæä½ï¼å°±å®æäº FFNã</p>
<p>å°±æ¯è¯´ self.conv1æ¯å°åä¸ªæ¶é´æ­¥åµå¥ç»´åº¦ <code>d_model</code>åç»´å° <code>d_ff</code>ï¼æ¥ä¸æ¥ self.conv2å°±æ¯å° <code>d_ff</code> åæ¢å¤æåå§å½¢ç¶ <code>d_model</code>ãå¤è¯´ä¸å¥ï¼å¥½åæ²¡æä¹ï¼å¶å®ææä¹ï¼ç¬¬äºæ¬¡æ¢å¤ç <code>d_model</code> å¶å®æ¯ç²¾ç»åçå­¦ä¹ äº ç¹å¾ä¸ç¹å¾ä¹é´çç¸å³å³ç³»ï¼å¹¶è¿åç»äº <code>d_model</code> ä¸­è¿è¡ä¿å­ã</p>
<p>çå°ä»£ç ï¼</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320220835532.png"><img alt="image-20250320220835532" src="../images/image-20250320220835532.png"/></a></p>
<p>å³äºè¿éï¼ææä»¥ä¸å ç¹æ³è¯´ï¼</p>
<p>ç¬¬ä¸ç¹ï¼åç»´çæä½ï¼ç»è¿ conv1d ä»¥åï¼ç¸å½äºè¿è¡äºå¨è¿æ¥ï¼ä¹å°±æ¯ç¸å½äºnn.Linearçä½ç¨ï¼é£åè¿ä»£ç çé½æ¯å°ï¼nn.Linearä»¥åè¿è¡æ¿æ´»ï¼ç®çæ¯ä¸ºäºå¢å æ¨¡åçéçº¿æ§è¡¨è¾¾è½åï¼è¿ç¹ææ²çä¹¦ä¸ä¹æå°è¿ãè¿éå°±ä»¿ç§ç conv1d çè¾åºä¹å ä¸äºæ¿æ´»å½æ°ãå çææ dropout é½æ¯ä¸ºäºé²æ­¢è¿æåï¼éæºå¤±æ´»ä¸äºèç¹ã</p>
<blockquote>
<p>æ ååé¦ç¥ç»ç½ç»çè®¾è®¡æ¨¡å¼ï¼çº¿æ§åæ¢âéçº¿æ§æ¿æ´»âçº¿æ§åæ¢ï¼</p>
<p>å¨Transformeråå§è®¾è®¡ä¸­ï¼FFNé¨åè¡¨ç¤ºä¸ºï¼</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1"></a><a href="#__codelineno-41-1"><span class="linenos" data-linenos="1 "></span></a>FFN(x) = max(0, xWâ + bâ)Wâ + bâ
</span></code></pre></div>
<p>ReLU æ¿æ´»å½æ°åä¸¤ä¸ª nn.Linear</p>
</blockquote>
<p>ç¬¬äºç¹ï¼åé¢å·²ç»è¯´è¿ï¼1d å·ç§¯åç»´éç»´æçæ¯ééç»´åº¦ï¼ä¹å°±æ¯ dim=1ï¼æä»¥è¿éè¿è¡ 1d å·ç§¯ä¹åä¹æ¯è¿è¡äº transposeã</p>
<p><del>ç¬¬ä¸ç¹ï¼ä¸ºä»ä¹è¿éæ¯ conv1dï¼èä¸æ¯ nn.Linearï¼å ä¸ºæ¶é´åºåè¦ä¿ææ¶é´æ­¥çååå³ç³»ï¼æä»¥ç¨ conv1dï¼ç±»ä¼¼æ»å¨çªå£ï¼æ²¿çæ¶é´æ­¥çååé¡ºåºéæ­¥æ»å¨ï¼æ¯æ¬¡ç§»å¨ stride ä¸ªæ­¥é¿ã</del> ï¼æçè§£çä¸å¯¹ï¼åè½ä¸å°±æ¯ä¸æ ·çï¼åªæ¯æ°æ®çç»ç»å½¢å¼ä¸åï¼ä¸ç¨å»æçåºåã</p>
<p>ç¬¬åç¹ï¼è¿éç d_ff åé¦ç¥ç»ç½ç»çåµå¥æ¯ 2048ã</p>
<blockquote>
<p>d_fféå¸¸è®¾ç½®ä¸ºd_modelç4åï¼å¯¹äºd_model=512çæåµï¼d_ffå°±æ¯2048ãè¿ä¹æ¯Transformeråå§è®ºæä¸­çè®¾ç½®ãå¢å¤§ä¸­é´å±ç»´åº¦å¯ä»¥æé«æ¨¡åçè¡¨è¾¾è½åã</p>
</blockquote>
<p>ç¬¬äºç¹ï¼self.conv2dçè¾åºï¼å¨è¿è¡å½¢ç¶åæ¢<code>transpose</code>çç®çæ¯ä¸ºäºæ¢å¤ææ¶é´åºåçæ åæ°æ®æ ¼å¼ã</p>
<blockquote>
<p>å°æ°æ®æ ¼å¼ä»å·ç§¯åå¥½ç<code>[B, C, L]</code>è½¬åå°Transformeræ¶æéç¨ç<code>[B, L, D]</code>æ ¼å¼</p>
</blockquote>
<p>åæ¬¡ç´è§å°è¯´æè¿ä¸é¨åå°±æ¯è¿æ ·çï¼</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1"></a><a href="#__codelineno-42-1"><span class="linenos" data-linenos=" 1 "></span></a># ç¬¬ä¸æ­¥ï¼è½¬ç½®ä½¿ç¹å¾ç»´åº¦æä¸ºééç»´åº¦
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2"></a><a href="#__codelineno-42-2"><span class="linenos" data-linenos=" 2 "></span></a>y.transpose(-1, 1)  # [B, L, d_model] -&gt; [B, d_model, L]
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3"></a><a href="#__codelineno-42-3"><span class="linenos" data-linenos=" 3 "></span></a>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4"></a><a href="#__codelineno-42-4"><span class="linenos" data-linenos=" 4 "></span></a># ç¬¬äºæ­¥ï¼åºç¨ç¬¬ä¸ä¸ªå·ç§¯æ©å±ééç»´åº¦
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5"></a><a href="#__codelineno-42-5"><span class="linenos" data-linenos=" 5 "></span></a>self.conv1(...)  # [B, d_model, L] -&gt; [B, d_ff, L]
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6"></a><a href="#__codelineno-42-6"><span class="linenos" data-linenos=" 6 "></span></a>
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7"></a><a href="#__codelineno-42-7"><span class="linenos" data-linenos=" 7 "></span></a># ç¬¬ä¸æ­¥ï¼åºç¨ç¬¬äºä¸ªå·ç§¯æ¢å¤åå§ééç»´åº¦
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8"></a><a href="#__codelineno-42-8"><span class="linenos" data-linenos=" 8 "></span></a>self.conv2(...)  # [B, d_ff, L] -&gt; [B, d_model, L]
</span><span id="__span-42-9"><a id="__codelineno-42-9" name="__codelineno-42-9"></a><a href="#__codelineno-42-9"><span class="linenos" data-linenos=" 9 "></span></a>
</span><span id="__span-42-10"><a id="__codelineno-42-10" name="__codelineno-42-10"></a><a href="#__codelineno-42-10"><span class="linenos" data-linenos="10 "></span></a># ç¬¬åæ­¥ï¼è½¬ç½®ååå§åºåæ ¼å¼
</span><span id="__span-42-11"><a id="__codelineno-42-11" name="__codelineno-42-11"></a><a href="#__codelineno-42-11"><span class="linenos" data-linenos="11 "></span></a>(...).transpose(-1, 1)  # [B, d_model, L] -&gt; [B, L, d_model]
</span></code></pre></div>
<p><strong>åè®°ï¼</strong> </p>
<blockquote>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></input></label> <span id="ä¸ºä»ä¹Conv2ä¹åæ²¡æè¿è¡æ¿æ´»å½æ°çåºç¨">äº§çççé®</span>ï¼<a href="#éå½">ä¸ºä»ä¹Conv2ä¹åæ²¡æè¿è¡æ¿æ´»å½æ°çåºç¨</a> </li>
</ul>
<p>ç´è§ççè§£æççé®ï¼</p>
<p><strong>ç°æè®¾è®¡ (ç¬¬äºå±æ æ¿æ´»)ï¼</strong></p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1"></a><a href="#__codelineno-43-1"><span class="linenos" data-linenos="1 "></span></a>y = Conv1 -&gt; ReLU -&gt; Dropout -&gt; Conv2 -&gt; Dropout
</span></code></pre></div>
<p><strong>æ¿ä»£è®¾è®¡ (ä¸¤å±é½ææ¿æ´»)</strong> </p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1"></a><a href="#__codelineno-44-1"><span class="linenos" data-linenos="1 "></span></a>y = Conv1 -&gt; ReLU -&gt; Dropout -&gt; Conv2 -&gt; ReLU -&gt; Dropout
</span></code></pre></div>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></input></label> ä¸ºä»ä¹æ¯ conv1dï¼èä¸æ¯ nn.Linear</li>
</ul>
<p>æ²¡å¥å¿è¦äºï¼ä¸»è¦æ¯å¨æ°æ®ç»ç»åè®¡ç®æçæ¹é¢æå·®å¼ï¼Autoformeréæ©Conv1DèéLinearï¼æ¯åºäºæ¶æä¸è´æ§ãè®¡ç®æçåæªæ¥æ©å±æ§ï¼è®¾ç½® kernel size ä»¥åå¯ä»¥æææ¶é´æ­¥ä¹é´çå±é¨ç¸å³æ§ï¼çèèï¼åè½ä¸æ¯å®å¨ä¸æ ·çã</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></input></label> æå°äºåä¸ª EncoderLayerçæ¨¡ååæ°</li>
</ul>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321163630773.png"><img alt="image-20250321163630773" src="../images/image-20250321163630773.png"/></a> </p>
</blockquote>
<p>æåè¿æä¸å¥ï¼å°åå§ç¹å¾xä¸åæ¢åçç¹å¾yç¸å ï¼åæ¬¡åºç¨åºååè§£æåå­£èæ§é¨å</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1"></a><a href="#__codelineno-45-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># å°åå§ç¹å¾xä¸åæ¢åçç¹å¾yç¸å ï¼åæ¬¡åºç¨åºååè§£æåå­£èæ§é¨å</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2"></a><a href="#__codelineno-45-2"><span class="linenos" data-linenos="2 "></span></a><span class="c1"># (x + y)[B, L, d_model] -&gt; åºååè§£ -&gt; è¾åºres[B, L, d_model]åæªä½¿ç¨çè¶å¿åé_[B, L, d_model]</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3"></a><a href="#__codelineno-45-3"><span class="linenos" data-linenos="3 "></span></a><span class="n">res</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decomp2</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>
</span></code></pre></div>
<p><strong>å°äºè¿ä¸æ­¥ï¼å¶å®ä»£ç è¯¥è®²çä¹è®²å®äºï¼æ´éè¦çå¨äºå¼å§æèï¼ä¸ºä»ä¹è¿æ ·è®¾è®¡ï¼</strong></p>
<ul>
<li>ç²è´´èª gpt çç­æ¡è´´å¨éå½ä¸­äºï¼è§£éå¾æºå¥½çï¼è¿æåä¼ ç» Transformer çå¯¹æ¯</li>
<li>ï¼æçè§£çé¨åèªå·±å¤è¿°ï¼ä½¿å¾ç¼ç å¨å¨éå±ç¼ç çè¿ç¨ä¸­ï¼æ´å³æ³¨é«é¢çå­£èæåï¼æä»¥æ¯æ¬¡ä¼ è¿ç¼ç å¨çæ¯ï¼æå¼äºè¶å¿æåçå­£èæåã</li>
</ul>
<p>ç¼ç å¨ä¸­å³äºå­£èæåãè¶å¿æåççè§£ï¼</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1"></a><a href="#__codelineno-46-1"><span class="linenos" data-linenos=" 1 "></span></a>è¾å¥ x [B,L,D] (æ··åå­£èæ§åè¶å¿)
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2"></a><a href="#__codelineno-46-2"><span class="linenos" data-linenos=" 2 "></span></a>  â
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3"></a><a href="#__codelineno-46-3"><span class="linenos" data-linenos=" 3 "></span></a>èªæ³¨æåå¤ç
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4"></a><a href="#__codelineno-46-4"><span class="linenos" data-linenos=" 4 "></span></a>  â
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5"></a><a href="#__codelineno-46-5"><span class="linenos" data-linenos=" 5 "></span></a>æ®å·®è¿æ¥ x + dropout(new_x) (ä»å«æ··åæå)
</span><span id="__span-46-6"><a id="__codelineno-46-6" name="__codelineno-46-6"></a><a href="#__codelineno-46-6"><span class="linenos" data-linenos=" 6 "></span></a>  â
</span><span id="__span-46-7"><a id="__codelineno-46-7" name="__codelineno-46-7"></a><a href="#__codelineno-46-7"><span class="linenos" data-linenos=" 7 "></span></a>åºååè§£1 
</span><span id="__span-46-8"><a id="__codelineno-46-8" name="__codelineno-46-8"></a><a href="#__codelineno-46-8"><span class="linenos" data-linenos=" 8 "></span></a>  â          â
</span><span id="__span-46-9"><a id="__codelineno-46-9" name="__codelineno-46-9"></a><a href="#__codelineno-46-9"><span class="linenos" data-linenos=" 9 "></span></a>å­£èæ§åéx    è¶å¿åé (ä¸¢å¼)
</span><span id="__span-46-10"><a id="__codelineno-46-10" name="__codelineno-46-10"></a><a href="#__codelineno-46-10"><span class="linenos" data-linenos="10 "></span></a>  â
</span><span id="__span-46-11"><a id="__codelineno-46-11" name="__codelineno-46-11"></a><a href="#__codelineno-46-11"><span class="linenos" data-linenos="11 "></span></a>åé¦ç½ç»å¤ç (Conv1D â ReLU â Conv1D)
</span><span id="__span-46-12"><a id="__codelineno-46-12" name="__codelineno-46-12"></a><a href="#__codelineno-46-12"><span class="linenos" data-linenos="12 "></span></a>  â
</span><span id="__span-46-13"><a id="__codelineno-46-13" name="__codelineno-46-13"></a><a href="#__codelineno-46-13"><span class="linenos" data-linenos="13 "></span></a>åé¦è¾åº y (å­£èæ§ç¹å¾)
</span><span id="__span-46-14"><a id="__codelineno-46-14" name="__codelineno-46-14"></a><a href="#__codelineno-46-14"><span class="linenos" data-linenos="14 "></span></a>  â
</span><span id="__span-46-15"><a id="__codelineno-46-15" name="__codelineno-46-15"></a><a href="#__codelineno-46-15"><span class="linenos" data-linenos="15 "></span></a>å­£èæ§åéx + åé¦è¾åºy (æ··åå­£èæ§)
</span><span id="__span-46-16"><a id="__codelineno-46-16" name="__codelineno-46-16"></a><a href="#__codelineno-46-16"><span class="linenos" data-linenos="16 "></span></a>  â
</span><span id="__span-46-17"><a id="__codelineno-46-17" name="__codelineno-46-17"></a><a href="#__codelineno-46-17"><span class="linenos" data-linenos="17 "></span></a>åºååè§£2
</span><span id="__span-46-18"><a id="__codelineno-46-18" name="__codelineno-46-18"></a><a href="#__codelineno-46-18"><span class="linenos" data-linenos="18 "></span></a>  â          â
</span><span id="__span-46-19"><a id="__codelineno-46-19" name="__codelineno-46-19"></a><a href="#__codelineno-46-19"><span class="linenos" data-linenos="19 "></span></a>å­£èæ§åéres  è¶å¿åé (ä¸¢å¼)
</span><span id="__span-46-20"><a id="__codelineno-46-20" name="__codelineno-46-20"></a><a href="#__codelineno-46-20"><span class="linenos" data-linenos="20 "></span></a>  â
</span><span id="__span-46-21"><a id="__codelineno-46-21" name="__codelineno-46-21"></a><a href="#__codelineno-46-21"><span class="linenos" data-linenos="21 "></span></a>è¾åºå°ä¸ä¸å± res (çº¯å­£èæ§)
</span></code></pre></div>
<p>æåè®°ä¸ä¸¤å¥è¯æï¼</p>
<ul>
<li>é¢çååæï¼ä»é¢çè§åº¦çï¼è¶å¿å¯¹åºä½é¢æåï¼å­£èæ§å¯¹åºé«é¢æåï¼åå¼å¤çæå©äºæååèªçç¹ç¹ã</li>
<li>ç¼ç å¨ï¼ä¸æ³¨äºæè·å¨ææ§åå­£èæ§æ¨¡å¼ï¼é«é¢æåï¼</li>
<li>è½ç¶å¨ç¼ç å¨å±åé¨ä¸¢å¼äºè¶å¿ä¿¡æ¯ï¼ä½Autoformerå¹¶æ²¡æå®å¨å¿½ç¥è¶å¿ã</li>
<li>éè¿å¨æ¯ä¸å±é½ä¸¢å¼è¶å¿æåï¼æ¨¡åè½å¤å¨å¤å±å å è¿ç¨ä¸­æç»­å³æ³¨å­£èæ§ååï¼èä¸è¢«è¶å¿ååå¹²æ°ã</li>
<li>è§£ç å¨ä¸­åç¬ç´¯ç§¯è¶å¿ï¼é¿åè¶å¿é¢æµå¯¹å­£èæ§é¢æµçå¹²æ°</li>
<li>æ¸è¿å¼åè§£æ¶æ</li>
<li>æ¯å±é½åºç¨åºååè§£ï¼éæ­¥æç¼å­£èæ§ç¹å¾ï¼å¤å±å å å¯ä»¥æè·ä¸åå°ºåº¦çå­£èæ§æ¨¡å¼</li>
</ul>
<p>è¡äºï¼ä¸é¢å³äºç¼ç å¨çé¨åè®²çå·®ä¸å¤äº</p>
<p><strong>å¬å¼</strong> </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321103256921.png"><img alt="image-20250321103256921" src="../images/image-20250321103256921.png"/></a></p>
<p>æå¼å§ä¸æ ç 1 å 2 ä¸æç½ï¼ç°å¨ä¹æç½äºï¼å¯ä»¥çè§£ä¸º 1 æ¯èªæ³¨æåæºå¶çè¾åºï¼åªä¿ççå­£èæåï¼2 æ¯ç»è¿åé¦ç½çè¾åºï¼åªä¿çäºå­£èæåã</p>
<p>è¿äºèªæ³¨æåæºå¶ å åé¦ç½ åé¢é½ææ®å·®è¿æ¥ãè¿ä¸­é´è¿æ dropoutãæ¿æ´»ç­ã</p>
<p><strong>ä»£ç </strong></p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1"></a><a href="#__codelineno-47-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">attn_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2"></a><a href="#__codelineno-47-2"><span class="linenos" data-linenos=" 2 "></span></a>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3"></a><a href="#__codelineno-47-3"><span class="linenos" data-linenos=" 3 "></span></a>    <span class="n">new_x</span><span class="p">,</span> <span class="n">attn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attention</span><span class="p">(</span>
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4"></a><a href="#__codelineno-47-4"><span class="linenos" data-linenos=" 4 "></span></a>        <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span>
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5"></a><a href="#__codelineno-47-5"><span class="linenos" data-linenos=" 5 "></span></a>        <span class="n">attn_mask</span><span class="o">=</span><span class="n">attn_mask</span>
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6"></a><a href="#__codelineno-47-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="p">)</span>
</span><span id="__span-47-7"><a id="__codelineno-47-7" name="__codelineno-47-7"></a><a href="#__codelineno-47-7"><span class="linenos" data-linenos=" 7 "></span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="n">new_x</span><span class="p">)</span>
</span><span id="__span-47-8"><a id="__codelineno-47-8" name="__codelineno-47-8"></a><a href="#__codelineno-47-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="n">x</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decomp1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-47-9"><a id="__codelineno-47-9" name="__codelineno-47-9"></a><a href="#__codelineno-47-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">x</span>
</span><span id="__span-47-10"><a id="__codelineno-47-10" name="__codelineno-47-10"></a><a href="#__codelineno-47-10"><span class="linenos" data-linenos="10 "></span></a>
</span><span id="__span-47-11"><a id="__codelineno-47-11" name="__codelineno-47-11"></a><a href="#__codelineno-47-11"><span class="linenos" data-linenos="11 "></span></a>
</span><span id="__span-47-12"><a id="__codelineno-47-12" name="__codelineno-47-12"></a><a href="#__codelineno-47-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">activation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conv1</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))))</span>
</span><span id="__span-47-13"><a id="__codelineno-47-13" name="__codelineno-47-13"></a><a href="#__codelineno-47-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conv2</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="__span-47-14"><a id="__codelineno-47-14" name="__codelineno-47-14"></a><a href="#__codelineno-47-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="n">res</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decomp2</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>
</span><span id="__span-47-15"><a id="__codelineno-47-15" name="__codelineno-47-15"></a><a href="#__codelineno-47-15"><span class="linenos" data-linenos="15 "></span></a>
</span><span id="__span-47-16"><a id="__codelineno-47-16" name="__codelineno-47-16"></a><a href="#__codelineno-47-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="k">return</span> <span class="n">res</span><span class="p">,</span> <span class="n">attn</span>
</span></code></pre></div>
<p>åæ¥çä¸ç¼**æä¸­æ¨¡åç»æå¾**ï¼</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321103610423.png"><img alt="image-20250321103610423" src="../images/image-20250321103610423.png"/></a> </p>
<p>å¯ä»¥çå° é½æ¯ä¸ä¸å¯¹åºçã</p>
<p>å¯¹ï¼è¿æä¸ä¸ªï¼åæå å  Encoder çå±æ°=2ã</p>
<hr/>
<h3 id="decoder">Decoder<a class="headerlink" href="#decoder" title="Permanent link">Â¶</a></h3>
<p><strong>ä¸é¢è¿å¥è§£ç å¨é¨åï¼ç¦ç¨æææ­ç¹ï¼åªä¿çè°ç¨è§£ç çé¨åï¼</strong> </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321104519139.png"><img alt="image-20250321104519139" src="../images/image-20250321104519139.png"/></a></p>
<p>å¯å¨å½ä»¤ï¼</p>
<div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1"></a><a href="#__codelineno-48-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="o">(</span>base<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>conda<span class="w"> </span>env<span class="w"> </span>list
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2"></a><a href="#__codelineno-48-2"><span class="linenos" data-linenos=" 2 "></span></a>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3"></a><a href="#__codelineno-48-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="c1"># conda environments:</span>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4"></a><a href="#__codelineno-48-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="c1">#</span>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5"></a><a href="#__codelineno-48-5"><span class="linenos" data-linenos=" 5 "></span></a>base<span class="w">                 </span>*<span class="w"> </span>/home/student2023/xiehr2023/miniconda3
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6"></a><a href="#__codelineno-48-6"><span class="linenos" data-linenos=" 6 "></span></a>Autoformer<span class="w">             </span>/home/student2023/xiehr2023/miniconda3/envs/Autoformer
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7"></a><a href="#__codelineno-48-7"><span class="linenos" data-linenos=" 7 "></span></a>SegRNN<span class="w">                 </span>/home/student2023/xiehr2023/miniconda3/envs/SegRNN
</span><span id="__span-48-8"><a id="__codelineno-48-8" name="__codelineno-48-8"></a><a href="#__codelineno-48-8"><span class="linenos" data-linenos=" 8 "></span></a>timesNet<span class="w">               </span>/home/student2023/xiehr2023/miniconda3/envs/timesNet
</span><span id="__span-48-9"><a id="__codelineno-48-9" name="__codelineno-48-9"></a><a href="#__codelineno-48-9"><span class="linenos" data-linenos=" 9 "></span></a>
</span><span id="__span-48-10"><a id="__codelineno-48-10" name="__codelineno-48-10"></a><a href="#__codelineno-48-10"><span class="linenos" data-linenos="10 "></span></a><span class="o">(</span>base<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>conda<span class="w"> </span>activate<span class="w"> </span>Autoformer
</span><span id="__span-48-11"><a id="__codelineno-48-11" name="__codelineno-48-11"></a><a href="#__codelineno-48-11"><span class="linenos" data-linenos="11 "></span></a><span class="o">(</span>Autoformer<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>sh<span class="w"> </span>scripts/ILI_script/Autoformer.sh
</span></code></pre></div>
<p>å¨æ­¥è¿ä»£ç ä¹åï¼åçmermaid ç»çç±»å¾ï¼çæ¸è§£ç å¨çè°ç¨æµç¨ï¼  </p>
<h4 id="_11">ç±»å¾<a class="headerlink" href="#_11" title="Permanent link">Â¶</a></h4>
<pre class="mermaid"><code>
classDiagram
    class Model {
        +int seq_len
        +int label_len
        +int pred_len
        +bool output_attention
        +series_decomp decomp
        +DataEmbedding_wo_pos enc_embedding
        +DataEmbedding_wo_pos dec_embedding
        +Encoder encoder
        +Decoder decoder
        +forward(x_enc, x_mark_enc, x_dec, x_mark_dec, enc_self_mask, dec_self_mask, dec_enc_mask)
    }

    class series_decomp {
        +moving_avg moving_avg
        +forward(x) res, moving_mean
    }
    class moving_avg {
        +int kernel_size
        +AvgPool1d avg
        +forward(x)
    }

    class DataEmbedding_wo_pos {
        +TokenEmbedding value_embedding
        +PositionalEmbedding position_embedding
        +TemporalEmbedding temporal_embedding
        +Dropout dropout
        +forward(x, x_mark)
    }

    class Encoder {
        +List~EncoderLayer~ layers
        +my_Layernorm norm_layer
        +forward(x, attn_mask)
    }

    class EncoderLayer {
        +AutoCorrelationLayer attention
        +Conv1d conv1
        +Conv1d conv2
        +series_decomp decomp1
        +series_decomp decomp2
        +Dropout dropout
        +activation
        +forward(x, attn_mask)
    }

    class AutoCorrelationLayer {
        +AutoCorrelation attention
        +Linear query_projection
        +Linear key_projection
        +Linear value_projection
        +Linear out_projection
        +forward(queries, keys, values, attn_mask)
    }

    class AutoCorrelation {
        +bool mask_flag
        +int factor
        +float scale
        +Dropout dropout
        +bool output_attention
        +time_delay_agg_training(values, corr)
        +time_delay_agg_inference(values, corr)
        +forward(queries, keys, values, attn_mask)
    }

    class Decoder {
        +List~DecoderLayer~ layers
        +my_Layernorm norm_layer
        +Linear projection
        +forward(x, enc_out, x_mask, cross_mask, trend)
    }

    class DecoderLayer {
        +AutoCorrelationLayer self_attention
        +AutoCorrelationLayer cross_attention
        +Conv1d conv1
        +Conv1d conv2
        +series_decomp decomp1
        +series_decomp decomp2
        +series_decomp decomp3
        +Dropout dropout
        +activation
        +forward(x, enc_out, x_mask, cross_mask, trend)
    }

    Model --&gt; series_decomp
    Model --&gt; DataEmbedding_wo_pos
    Model --&gt; Encoder
    Model --&gt; Decoder
    Encoder --&gt; EncoderLayer
    EncoderLayer --&gt; AutoCorrelationLayer
    EncoderLayer --&gt; Conv1d
    EncoderLayer --&gt; series_decomp
    AutoCorrelationLayer --&gt; AutoCorrelation
    Decoder --&gt; DecoderLayer
    DecoderLayer --&gt; AutoCorrelationLayer
    DecoderLayer --&gt; Conv1d
    DecoderLayer --&gt; series_decomp   
    series_decomp --&gt; moving_avg
    moving_avg --&gt; AvgPool1d
</code></pre>
<p>ä¸é¢å¼å§è®²å¾ã</p>
<p><strong>Mode init</strong> </p>
<p>é¦åï¼ä»ç¬¬ä¸æ¡å¼å§ï¼model å°±æ¯æç Autoformerï¼é¦å Autoformer ç init é¨åæ è¾å¥åºåé¿åº¦ï¼sequence lengthï¼æ ç­¾åºåçé¿åº¦ label lengthï¼æ ç­¾åºåç¨äºæå¯¼é¢æµï¼æ¬ææªåè¾å¥åºåé¿åº¦çä¸åï¼é¢æµåºåé¿åº¦ predict lengthï¼å ä¸ºæ¬æè®¾ç½®çæ ç­¾åºåï¼æä»¥è§£ç å¨å®éçè¾åºæ¶é´æ­¥æ¯ label length+predict lengthï¼æä»¥é¢æµçé¨åï¼è¿è¦æ label length æªæãattention ææ¶ä¸çï¼æä¹ä¸æç½æå¥ç¨ï¼å¤§æ¦å°±æ¯ä¸ä¸ªåå§åå§ã</p>
<p>ç¶åå°±æ¯åºååè§£å½æ°ï¼åè§£å­£èæååè¶å¿æåãè¶å¿æåæ¯ä½é¢æåï¼è¡¨ç¤ºæ¶é´åºåé¿æç¨³å®çè¶å¿ï¼ç¨çæ¯ç§»å¨å¹³åï¼å¨ä»£ç å®ç°ä¸­ï¼å·ä½ç¨çæ¯ 1D å¹³åæ± åãå­£èæåæ¯é«é¢æåï¼è¡¨ç¤ºå¨ææ§ä¿¡æ¯ï¼åè§£ä¸­çåæ³æ¯ åå§åºååå»å­£èæåãres = åå§åºå <code>x</code> - è¶å¿æå <code>move_average</code></p>
<p>ä¸é¢æ¯ä¸¤ä¸ªåµå¥å±ï¼ç®çæ¯è¿è¡ token Embedding å temporal Embeddingï¼å°åå§æ¶é´æ­¥ç¹å¾åµå¥å°æå®ç»´åº¦ï¼æ´ç²¾ç»çè¡¨ç¤ºç¹å¾ãä¸¾ä¸ªä¾å­ï¼æ¶é´æ­¥ç¹å¾[32,36,7] â [32,36,512]   [32,42,7] â[32,42,512] ï¼ï¼æ¶é´æ­¥ï¼æ¶é´ç¹å¾[32,36,4] â [32,36,512]   [32,42,4] â[32,42,512] </p>
<p>æ¥ä¸æ¥å°±æ¯ Encoder å Decoderï¼å¶ä¸­ Encoder ä¼å å  EncoderLayerï¼Decoder å å  DecoderLayerï¼</p>
<p>å¶ä¸­ EncoderLayer å å äº 2 å±ï¼ç»åå¾åä»£ç ï¼çåå± EncoderLayer å DecoderLayer ç ç¸åä¸ä¸åã</p>
<p>ï¼1ï¼Decoder æ¯ Encoder å¤äºä¸ä¸ªçº¿æ§å± <code>nn.Linear</code> ï¼éµå¾ªäºæ å Transformer æ¶æï¼</p>
<p>ï¼2ï¼DecoderLayer è°ç¨äºä¸¤æ¬¡ èªç¸å³å±ï¼è¿æ¯å ä¸º Decoder ä¸­è¿è¡ä¸¤ç§æ³¨æåæºå¶çè¿ç®ï¼èªæ³¨æåæºå¶åäº¤åæ³¨ææºå¶ï¼å¹¶ä¸åæ¬¡è¯´æï¼èªæ³¨æåå±ãäº¤åæ³¨æåå±ãFFN ä»¥åï¼ä¼è¿è¡æ®å·®è¿æ¥ã</p>
<p>ï¼3ï¼DecoderLayer è¿è¡äºä¸æ¬¡åºååè§£ï¼çæµï¼åå«æ¯å¨èªæ³¨ææºå¶ãäº¤åæ³¨æåæºå¶ä»¥å FFN ä»¥åï¼åå«è¿è¡åè§£</p>
<p>ï¼4ï¼åæ¶å¨ DecoderLayer ä¸­ï¼åºè¯¥å°¤å¶æ³¨æ è¶å¿æåæ¯æä¹å¤ççï¼å ä¸º EncoderLayer ä¸­ï¼å¿½ç¥æäºè¶å¿æåã</p>
<p>ï¼5ï¼æ¥ä¸æ¥å±åè°ç¨ç èªç¸å³å±ï¼åä¸ªèªç¸å³å±ãä»¥ååºååè§£æ¯å®å¨ä¸æ ·çã</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321160449357.png"><img alt="image-20250321160449357" src="../images/image-20250321160449357.png"/></a></p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1"></a><a href="#__codelineno-49-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="bp">self</span><span class="o">.</span><span class="n">encoder</span> <span class="o">=</span> <span class="n">Encoder</span><span class="p">(</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2"></a><a href="#__codelineno-49-2"><span class="linenos" data-linenos=" 2 "></span></a>    <span class="p">[</span>
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3"></a><a href="#__codelineno-49-3"><span class="linenos" data-linenos=" 3 "></span></a>        <span class="n">EncoderLayer</span><span class="p">(</span>
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4"></a><a href="#__codelineno-49-4"><span class="linenos" data-linenos=" 4 "></span></a>            <span class="n">AutoCorrelationLayer</span><span class="p">(</span>
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5"></a><a href="#__codelineno-49-5"><span class="linenos" data-linenos=" 5 "></span></a>                <span class="n">AutoCorrelation</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">configs</span><span class="o">.</span><span class="n">factor</span><span class="p">,</span> <span class="n">attention_dropout</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">dropout</span><span class="p">,</span>
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6"></a><a href="#__codelineno-49-6"><span class="linenos" data-linenos=" 6 "></span></a>                                <span class="n">output_attention</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">output_attention</span><span class="p">),</span>
</span><span id="__span-49-7"><a id="__codelineno-49-7" name="__codelineno-49-7"></a><a href="#__codelineno-49-7"><span class="linenos" data-linenos=" 7 "></span></a>                <span class="n">configs</span><span class="o">.</span><span class="n">d_model</span><span class="p">,</span> <span class="n">configs</span><span class="o">.</span><span class="n">n_heads</span><span class="p">),</span>
</span><span id="__span-49-8"><a id="__codelineno-49-8" name="__codelineno-49-8"></a><a href="#__codelineno-49-8"><span class="linenos" data-linenos=" 8 "></span></a>            <span class="n">configs</span><span class="o">.</span><span class="n">d_model</span><span class="p">,</span>
</span><span id="__span-49-9"><a id="__codelineno-49-9" name="__codelineno-49-9"></a><a href="#__codelineno-49-9"><span class="linenos" data-linenos=" 9 "></span></a>            <span class="n">configs</span><span class="o">.</span><span class="n">d_ff</span><span class="p">,</span>
</span><span id="__span-49-10"><a id="__codelineno-49-10" name="__codelineno-49-10"></a><a href="#__codelineno-49-10"><span class="linenos" data-linenos="10 "></span></a>            <span class="n">moving_avg</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">moving_avg</span><span class="p">,</span>
</span><span id="__span-49-11"><a id="__codelineno-49-11" name="__codelineno-49-11"></a><a href="#__codelineno-49-11"><span class="linenos" data-linenos="11 "></span></a>            <span class="n">dropout</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">dropout</span><span class="p">,</span>
</span><span id="__span-49-12"><a id="__codelineno-49-12" name="__codelineno-49-12"></a><a href="#__codelineno-49-12"><span class="linenos" data-linenos="12 "></span></a>            <span class="n">activation</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">activation</span>
</span><span id="__span-49-13"><a id="__codelineno-49-13" name="__codelineno-49-13"></a><a href="#__codelineno-49-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">configs</span><span class="o">.</span><span class="n">e_layers</span><span class="p">)</span>
</span><span id="__span-49-14"><a id="__codelineno-49-14" name="__codelineno-49-14"></a><a href="#__codelineno-49-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="p">],</span>
</span><span id="__span-49-15"><a id="__codelineno-49-15" name="__codelineno-49-15"></a><a href="#__codelineno-49-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="n">norm_layer</span><span class="o">=</span><span class="n">my_Layernorm</span><span class="p">(</span><span class="n">configs</span><span class="o">.</span><span class="n">d_model</span><span class="p">)</span>
</span><span id="__span-49-16"><a id="__codelineno-49-16" name="__codelineno-49-16"></a><a href="#__codelineno-49-16"><span class="linenos" data-linenos="16 "></span></a><span class="p">)</span>
</span><span id="__span-49-17"><a id="__codelineno-49-17" name="__codelineno-49-17"></a><a href="#__codelineno-49-17"><span class="linenos" data-linenos="17 "></span></a><span class="c1"># Decoder</span>
</span><span id="__span-49-18"><a id="__codelineno-49-18" name="__codelineno-49-18"></a><a href="#__codelineno-49-18"><span class="linenos" data-linenos="18 "></span></a><span class="bp">self</span><span class="o">.</span><span class="n">decoder</span> <span class="o">=</span> <span class="n">Decoder</span><span class="p">(</span>
</span><span id="__span-49-19"><a id="__codelineno-49-19" name="__codelineno-49-19"></a><a href="#__codelineno-49-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="p">[</span>
</span><span id="__span-49-20"><a id="__codelineno-49-20" name="__codelineno-49-20"></a><a href="#__codelineno-49-20"><span class="linenos" data-linenos="20 "></span></a>        <span class="n">DecoderLayer</span><span class="p">(</span>
</span><span id="__span-49-21"><a id="__codelineno-49-21" name="__codelineno-49-21"></a><a href="#__codelineno-49-21"><span class="linenos" data-linenos="21 "></span></a>            <span class="n">AutoCorrelationLayer</span><span class="p">(</span>
</span><span id="__span-49-22"><a id="__codelineno-49-22" name="__codelineno-49-22"></a><a href="#__codelineno-49-22"><span class="linenos" data-linenos="22 "></span></a>                <span class="n">AutoCorrelation</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">configs</span><span class="o">.</span><span class="n">factor</span><span class="p">,</span> <span class="n">attention_dropout</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">dropout</span><span class="p">,</span>
</span><span id="__span-49-23"><a id="__codelineno-49-23" name="__codelineno-49-23"></a><a href="#__codelineno-49-23"><span class="linenos" data-linenos="23 "></span></a>                                <span class="n">output_attention</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
</span><span id="__span-49-24"><a id="__codelineno-49-24" name="__codelineno-49-24"></a><a href="#__codelineno-49-24"><span class="linenos" data-linenos="24 "></span></a>                <span class="n">configs</span><span class="o">.</span><span class="n">d_model</span><span class="p">,</span> <span class="n">configs</span><span class="o">.</span><span class="n">n_heads</span><span class="p">),</span>
</span><span id="__span-49-25"><a id="__codelineno-49-25" name="__codelineno-49-25"></a><a href="#__codelineno-49-25"><span class="linenos" data-linenos="25 "></span></a>            <span class="n">AutoCorrelationLayer</span><span class="p">(</span>
</span><span id="__span-49-26"><a id="__codelineno-49-26" name="__codelineno-49-26"></a><a href="#__codelineno-49-26"><span class="linenos" data-linenos="26 "></span></a>                <span class="n">AutoCorrelation</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">configs</span><span class="o">.</span><span class="n">factor</span><span class="p">,</span> <span class="n">attention_dropout</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">dropout</span><span class="p">,</span>
</span><span id="__span-49-27"><a id="__codelineno-49-27" name="__codelineno-49-27"></a><a href="#__codelineno-49-27"><span class="linenos" data-linenos="27 "></span></a>                                <span class="n">output_attention</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
</span><span id="__span-49-28"><a id="__codelineno-49-28" name="__codelineno-49-28"></a><a href="#__codelineno-49-28"><span class="linenos" data-linenos="28 "></span></a>                <span class="n">configs</span><span class="o">.</span><span class="n">d_model</span><span class="p">,</span> <span class="n">configs</span><span class="o">.</span><span class="n">n_heads</span><span class="p">),</span>
</span><span id="__span-49-29"><a id="__codelineno-49-29" name="__codelineno-49-29"></a><a href="#__codelineno-49-29"><span class="linenos" data-linenos="29 "></span></a>            <span class="n">configs</span><span class="o">.</span><span class="n">d_model</span><span class="p">,</span>
</span><span id="__span-49-30"><a id="__codelineno-49-30" name="__codelineno-49-30"></a><a href="#__codelineno-49-30"><span class="linenos" data-linenos="30 "></span></a>            <span class="n">configs</span><span class="o">.</span><span class="n">c_out</span><span class="p">,</span>
</span><span id="__span-49-31"><a id="__codelineno-49-31" name="__codelineno-49-31"></a><a href="#__codelineno-49-31"><span class="linenos" data-linenos="31 "></span></a>            <span class="n">configs</span><span class="o">.</span><span class="n">d_ff</span><span class="p">,</span>
</span><span id="__span-49-32"><a id="__codelineno-49-32" name="__codelineno-49-32"></a><a href="#__codelineno-49-32"><span class="linenos" data-linenos="32 "></span></a>            <span class="n">moving_avg</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">moving_avg</span><span class="p">,</span>
</span><span id="__span-49-33"><a id="__codelineno-49-33" name="__codelineno-49-33"></a><a href="#__codelineno-49-33"><span class="linenos" data-linenos="33 "></span></a>            <span class="n">dropout</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">dropout</span><span class="p">,</span>
</span><span id="__span-49-34"><a id="__codelineno-49-34" name="__codelineno-49-34"></a><a href="#__codelineno-49-34"><span class="linenos" data-linenos="34 "></span></a>            <span class="n">activation</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">activation</span><span class="p">,</span>
</span><span id="__span-49-35"><a id="__codelineno-49-35" name="__codelineno-49-35"></a><a href="#__codelineno-49-35"><span class="linenos" data-linenos="35 "></span></a>        <span class="p">)</span>
</span><span id="__span-49-36"><a id="__codelineno-49-36" name="__codelineno-49-36"></a><a href="#__codelineno-49-36"><span class="linenos" data-linenos="36 "></span></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">configs</span><span class="o">.</span><span class="n">d_layers</span><span class="p">)</span>
</span><span id="__span-49-37"><a id="__codelineno-49-37" name="__codelineno-49-37"></a><a href="#__codelineno-49-37"><span class="linenos" data-linenos="37 "></span></a>    <span class="p">],</span>
</span><span id="__span-49-38"><a id="__codelineno-49-38" name="__codelineno-49-38"></a><a href="#__codelineno-49-38"><span class="linenos" data-linenos="38 "></span></a>    <span class="n">norm_layer</span><span class="o">=</span><span class="n">my_Layernorm</span><span class="p">(</span><span class="n">configs</span><span class="o">.</span><span class="n">d_model</span><span class="p">),</span>
</span><span id="__span-49-39"><a id="__codelineno-49-39" name="__codelineno-49-39"></a><a href="#__codelineno-49-39"><span class="linenos" data-linenos="39 "></span></a>    <span class="n">projection</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">configs</span><span class="o">.</span><span class="n">d_model</span><span class="p">,</span> <span class="n">configs</span><span class="o">.</span><span class="n">c_out</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-49-40"><a id="__codelineno-49-40" name="__codelineno-49-40"></a><a href="#__codelineno-49-40"><span class="linenos" data-linenos="40 "></span></a><span class="p">)</span>
</span></code></pre></div>
<p>è¯´çè¯´çå°±è¿äº</p>
<h4 id="_12">è®ºæ<a class="headerlink" href="#_12" title="Permanent link">Â¶</a></h4>
<p>ç»§ç»­æç§è®ºæãå¬å¼ãä»£ç ãå¾çé»è¾è¿è¡è®²è§£</p>
<p>çè®ºææã</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321163503744.png"><img alt="image-20250321163503744" src="../images/image-20250321163503744.png"/></a></p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321163514281.png"><img alt="image-20250321163514281" src="../images/image-20250321163514281.png"/></a></p>
<p>ä¸å¥ä¸å¥çå§ï¼</p>
<p>ð¢   </p>
<blockquote>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321164634097.png"><img alt="image-20250321164634097" src="../images/image-20250321164634097.png"/></a></p>
<p>è§£ç å¨</p>
<p>è§£ç å¨åå«ä¸¤ä¸ªé¨åï¼è¡¨ç¤ºè¶å¿æåçç´¯ç§¯ç»æ å å­£èæåå å çèªç¸å³æºå¶</p>
<p>æ¯ä¸ªçDecoderLayer åå«äºåé¨èªç¸å³æºå¶(èªæ³¨æåæºå¶)åç¼ç å¨åè§£ç å¨ç¸å³æºå¶(äº¤åæ³¨æåæºå¶)ï¼ç®çæ¯ä¸ºäº  â  ç»åé¢æµ å¹¶ä¸ â¡ ååå©ç¨åå²çå­£èä¿¡æ¯</p>
</blockquote>
<p>ð¢ </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321164717926.png"><img alt="image-20250321164717926" src="../images/image-20250321164717926.png"/></a> </p>
<blockquote>
<p>æ³¨æï¼æ¨¡åæåæ½å¨çè¶å¿ä¿¡æ¯ï¼å¨è§£ç å¨ä¸­ï¼éè¿ä¸­é´çéèåéã</p>
<p>ï¼æ³¨æï¼å¨è§£ç å¨ä¸­ï¼æ¨¡å éè¿ä¸­é´çéèåé æåæ½å¨çè¶å¿ä¿¡æ¯ï¼</p>
<p>è¿ç§æºå¶ ä½¿å¾Autoformer éæ­¥ ä¼å è¶å¿é¢æµ å¹¶ä¸ æ¶é¤ å¹²æ°ä¿¡æ¯</p>
<p>ä»¥ä¾¿å¨èªç¸å³æºå¶ä¸­ åç° åºäºå¨æçä¾èµå³ç³»ã</p>
<blockquote>
<p>æï¼ï¼å°±æ¯è¯´ éèçä¸­é´åéé¢æµè¶å¿ä¿¡æ¯ï¼å¨èªç¸å³æºå¶ä¸­ é¢æµå­£èä¿¡æ¯ï¼</p>
</blockquote>
<p>åè®¾ è§£ç å¨ æ M å±ï¼ç»åæ¥èªç¼ç å¨çæ½å¨åé <span class="arithmatex">\(\mathcal{X}_{en}^N\)</span> ï¼æï¼åºè¯¥æ¯ç¼ç å¨çæåä¸å±è¾åºï¼ï¼ç¬¬ l å±è§£ç å¨çæ¹ç¨å¯ä»¥è¡¨ç¤ºä¸º $ \mathcal{X}<em de="de">{de}^{l} = Decoder(\mathcal{X}</em><sup>{l-1},\mathcal{X}_{en}</sup>N)$ ï¼æï¼ç¬¬ <span class="arithmatex">\(l\)</span> å±è§£ç å¨çè¾å¥ï¼æ¥æ¶æ¥èª==ä¸ä¸å±è§£ç å¨çè¾åº==  å <mark>æåä¸å±ç¼ç å¨çè¾åº</mark> ä½ä¸ºè¾å¥ï¼</p>
</blockquote>
<p>ð¢ åä¸ª DecoderLayer çè¿ç¨ï¼å¯ä»¥æ¦æ¬å¦ä¸ï¼</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321165833556.png"><img alt="image-20250321165833556" src="../images/image-20250321165833556.png"/></a> </p>
<p>ç¬¦å·è§£é</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321171255673.png"><img alt="image-20250321171255673" src="../images/image-20250321171255673.png"/></a> </p>
<ul>
<li><span class="arithmatex">\(\mathcal{X}_{de}^l = \mathcal{S}_{de}^{l,3},l \in \{1,...,M\}\)</span> è¡¨ç¤ºç¬¬ <span class="arithmatex">\(l\)</span> å±è§£ç å±çè¾åºï¼M æ¯ DecoderLayer çå±æ°</li>
</ul>
<blockquote>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input disabled="" type="checkbox"><span class="task-list-indicator"></span></input></label> 3 æ¯å¥ï¼</li>
</ul>
</blockquote>
<ul>
<li><span class="arithmatex">\(\mathcal{X}_{de}^0\)</span> æ¯å¯¹åå§è§£ç å¨è¾å¥ <span class="arithmatex">\(\mathcal{X}_{des}\)</span>  çåµå¥ ï¼ <span class="arithmatex">\(\mathcal{X}_{des}\)</span> â åµå¥å± â  <span class="arithmatex">\(\mathcal{X}_{de}^0\)</span>ï¼ </li>
</ul>
<blockquote>
<p>(outputs)ï¼å°±æ¯åå§æ°æ®è¡¨ç¤ºãTransformer ç»æå³ä¾§è§£ç å¨çè¾å¥ï¼çæäºï¼ä¸ºäºæèªå·±å¿ï¼ç¨çè¿ä¹å¤è§£éT.Tï¼ï¼</p>
</blockquote>
<ul>
<li><span class="arithmatex">\(\mathcal{T}_{de}^0 = \mathcal{X}_{det}\)</span> ç¨äºç´¯ç§¯==ï¼æä»¥å°±æ¯è¶å¿åéæ¯ç´¯å æ¥çï¼==    </li>
</ul>
<blockquote>
<p>çæåï¼é½å¥ç¬¦å·åãçæäºãç¿»æãæ¯ç«ç¬¦å·æ¯ç»ä¸çã</p>
<p>æ¾å°äºï¼</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321171042677.png"><img alt="image-20250321171042677" src="../images/image-20250321171042677.png"/></a> </p>
<ul>
<li>de è§£ç å¨ ãs å­£èåéãt è¶å¿åé</li>
<li><span class="arithmatex">\(\mathcal{X}\)</span> åå§æ°æ®ï¼æªç»åµå¥</li>
<li>ä¸æ  0 è¡¨ç¤ºåå§å¼</li>
<li>s æåï¼å­£èæåï¼çåå§åæ¯ 0 å¡«åçãt æåï¼è¶å¿æåï¼çåå§åæ¯ åå¼å¡«åç</li>
<li><span class="arithmatex">\(\mathcal{T}\)</span> è¡¨ç¤ºè¶å¿åéï¼ï¼Trendï¼</li>
<li><span class="arithmatex">\(\mathcal{S}\)</span> è¡¨ç¤º å­£èåéï¼ï¼Seasonï¼</li>
</ul>
<blockquote>
<p>ä¸éï¼å½åè¿æºè®²ç©¶çãæ¥èªæçè¶é«è¯ä»·ï¼å®³ï¼ç ç©¶è¿ä¸ªçï¼åªæå ä¸ªç²¾ç¥ç¾ä¸½çï¼å¹²æ´»äºã</p>
</blockquote>
</blockquote>
<ul>
<li><span class="arithmatex">\(\mathcal{S}_{de}^{l,i}\)</span> ã<span class="arithmatex">\(\mathcal{T}_{de}^{l,i}\)</span> $   i  \in {1,2,3}$ åå«è¡¨ç¤º ç¬¬<span class="arithmatex">\(l\)</span> å±çDecoderLayer ä¸­ï¼ç¬¬ <span class="arithmatex">\(i\)</span> æ¬¡åºååè§£å¿«ä¹åå¾å°çå­£èæååè¶å¿æåã(<span class="arithmatex">\(l\)</span> è¡¨ç¤º <span class="arithmatex">\(l\)</span> å±ï¼ç¼ç å¨è§£ç å¨ä¸­åç)</li>
<li><span class="arithmatex">\(\mathcal{W}_{l,i} , i\in \{1,2,3\}\)</span>  è¡¨ç¤º å¯¹ ç¬¬ <span class="arithmatex">\(i\)</span> ä¸ªæåçè¶å¿åé <span class="arithmatex">\(\mathcal{T}_{de}^{l,i}\)</span> ç çº¿æ§æå½±ãï¼W æ¯ä»ä¹çç¼©åï¼ï¼</li>
</ul>
<p>ð¢</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321172443831.png"><img alt="image-20250321172443831" src="../images/image-20250321172443831.png"/></a> </p>
<p>æç»çé¢æµç»æ æ¯å¯¹ä¸¤ä¸ªåè§£æåçå åï¼å¬å¼è¡¨ç¤ºä¸º <span class="arithmatex">\(\mathcal{W}_\mathcal{S} * \mathcal{X}_{de}^M + \mathcal{T}_{de}^M\)</span> </p>
<ul>
<li>è¿éç <span class="arithmatex">\(\mathcal{W}\)</span> é½è¡¨ç¤ºçº¿æ§æå½±ã</li>
<li><span class="arithmatex">\(\mathcal{W}_\mathcal{S}\)</span> å° æåä¸å± è§£ç å¨çè¾åº æå½±å°ç®æ ç»´åº¦</li>
</ul>
<blockquote>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321173400693.png"><img alt="image-20250321173400693" src="../images/image-20250321173400693.png"/></a> </p>
</blockquote>
<p>æï¼è¿ä¸ªå¬å¼  <span class="arithmatex">\(\mathcal{X}_{de}^{l} = \mathcal{S}_{de}^{l,3}\)</span> ä¹å°±æ¯è¡¨ç¤ºäº è§£ç å¨ä¸­æ°æ®ççæµå¨ä¹æ¯å­£èæåã</p>
<h4 id="_13">ä»£ç <a class="headerlink" href="#_13" title="Permanent link">Â¶</a></h4>
<p><strong>å¥½äºï¼è®ºæçå®äºï¼ç°å¨çä»£ç ã</strong></p>
<ul>
<li>ä» Autoformer forward åºå</li>
</ul>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321173752060.png"><img alt="image-20250321173752060" src="../images/image-20250321173752060.png"/></a></p>
<ul>
<li>è¿å¥ Decoder forward</li>
</ul>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321173851471.png"><img alt="image-20250321173851471" src="../images/image-20250321173851471.png"/></a> </p>
<ul>
<li>Decoder çåå§å</li>
</ul>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321173954060.png"><img alt="image-20250321173954060" src="../images/image-20250321173954060.png"/></a></p>
<p>å¶ä¸­ <code>d_layers = 1</code> ï¼å¨å±æç´¢ï¼</p>
<p>åæ¬äºä¸å± DecoderLayerãèªæ³¨æåæºå¶ãäº¤åæ³¨æåæºå¶ï¼æåçæå½±å±æ¯ä¸ºäºæåµå¥ç»´åº¦ è¿åä¸º åå§ç»´åº¦ã</p>
<h4 id="decoderlayer-forward">DecoderLayer  forward<a class="headerlink" href="#decoderlayer-forward" title="Permanent link">Â¶</a></h4>
<ul>
<li>æ­¥è¿ï¼æç¶è¿å¥äº DecoderLayer ç forward</li>
</ul>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321174221181.png"><img alt="image-20250321174221181" src="../images/image-20250321174221181.png"/></a> </p>
<ul>
<li>éæ­¥æ­¥è¿æ§è¡ï¼æç¶è¿å¥äº AutoCorrelationLayer ç forward</li>
</ul>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321174253332.png"><img alt="image-20250321174253332" src="../images/image-20250321174253332.png"/></a> </p>
<p>æ¥ä¸æ¥å°±æ¯ qkv çè®¡ç®ï¼è¿è¡å³é®ï¼ä¼æ­¥è¿å°å·ä½ç AutoCorrelationçè®¡ç®ãçç»´åº¦ï¼å¯ä»¥çå°è¿éè¿ç¨ç<span id="è¿åçè§£å¤å¤´æ³¨æåæºå¶"><a href="#è·³å°çè§£å¤å¤´æ³¨æåæºå¶">å¤å¤´æ³¨æåæºå¶</a></span>ã  </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321174359890.png"><img alt="image-20250321174359890" src="../images/image-20250321174359890.png"/></a> </p>
<ul>
<li>æ­¥è¿ï¼æç¶ è·³å°äº AutoCorrelation-forward</li>
</ul>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321175357208.png"><img alt="image-20250321175357208" src="../images/image-20250321175357208.png"/></a> </p>
<p><strong>å¶å®ï¼è·³è¿æ¥æ²¡ç¨ï¼å ä¸ºææ¶ä¸çèªç¸å³æºå¶çè®¡ç®ï¼è¿æ¯æ¬æçåæ°ãéæ­¥è·³åºï¼ç DecoderLayer çå¤çã</strong></p>
<p>ä¸¤ä¸ªæ³¨æåè®¡ç®ï¼ä¸ä¸ªè¶å¿åè§£ï¼ä¸ä¸ªè¿åç»´åº¦ççº¿æ§å±ã</p>
<p><strong>DecoderLayerä»£ç æ§è¡çæµç¨å¾</strong> </p>
<div class="language-markdown highlight"><span class="filename">Markdown</span><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1"></a><a href="#__codelineno-50-1"><span class="linenos" data-linenos=" 1 "></span></a>âââââââââââââââââââââââââââ
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2"></a><a href="#__codelineno-50-2"><span class="linenos" data-linenos=" 2 "></span></a>â è¾å¥åºå x [B,L,d_model] â
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3"></a><a href="#__codelineno-50-3"><span class="linenos" data-linenos=" 3 "></span></a>ââââââââââââââââ¬âââââââââââ
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4"></a><a href="#__codelineno-50-4"><span class="linenos" data-linenos=" 4 "></span></a>               â
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5"></a><a href="#__codelineno-50-5"><span class="linenos" data-linenos=" 5 "></span></a>âââââââââââââââââââââââââââ
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6"></a><a href="#__codelineno-50-6"><span class="linenos" data-linenos=" 6 "></span></a>â     èªæ³¨æå + æ®å·®è¿æ¥    â    x = x + dropout(self_attention(x,x,x))
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7"></a><a href="#__codelineno-50-7"><span class="linenos" data-linenos=" 7 "></span></a>ââââââââââââââââ¬âââââââââââ
</span><span id="__span-50-8"><a id="__codelineno-50-8" name="__codelineno-50-8"></a><a href="#__codelineno-50-8"><span class="linenos" data-linenos=" 8 "></span></a>               â
</span><span id="__span-50-9"><a id="__codelineno-50-9" name="__codelineno-50-9"></a><a href="#__codelineno-50-9"><span class="linenos" data-linenos=" 9 "></span></a>âââââââââââââââââââââââââââ
</span><span id="__span-50-10"><a id="__codelineno-50-10" name="__codelineno-50-10"></a><a href="#__codelineno-50-10"><span class="linenos" data-linenos="10 "></span></a>â       åºååè§£ 1         â    x, trend1 = decomp1(x)
</span><span id="__span-50-11"><a id="__codelineno-50-11" name="__codelineno-50-11"></a><a href="#__codelineno-50-11"><span class="linenos" data-linenos="11 "></span></a>ââââââââ¬âââââââââââââââââââ
</span><span id="__span-50-12"><a id="__codelineno-50-12" name="__codelineno-50-12"></a><a href="#__codelineno-50-12"><span class="linenos" data-linenos="12 "></span></a>       â                  â
</span><span id="__span-50-13"><a id="__codelineno-50-13" name="__codelineno-50-13"></a><a href="#__codelineno-50-13"><span class="linenos" data-linenos="13 "></span></a>       â                   trend1 [B,L,d_model] â ä¿å­
</span><span id="__span-50-14"><a id="__codelineno-50-14" name="__codelineno-50-14"></a><a href="#__codelineno-50-14"><span class="linenos" data-linenos="14 "></span></a>       â
</span><span id="__span-50-15"><a id="__codelineno-50-15" name="__codelineno-50-15"></a><a href="#__codelineno-50-15"><span class="linenos" data-linenos="15 "></span></a>âââââââââââââââââââââââââââ
</span><span id="__span-50-16"><a id="__codelineno-50-16" name="__codelineno-50-16"></a><a href="#__codelineno-50-16"><span class="linenos" data-linenos="16 "></span></a>â äº¤åæ³¨æå(ç¼ç å¨è¾åº)     â    x = x + dropout(cross_attention(x,cross,cross))
</span><span id="__span-50-17"><a id="__codelineno-50-17" name="__codelineno-50-17"></a><a href="#__codelineno-50-17"><span class="linenos" data-linenos="17 "></span></a>ââââââââââââââââ¬âââââââââââ
</span><span id="__span-50-18"><a id="__codelineno-50-18" name="__codelineno-50-18"></a><a href="#__codelineno-50-18"><span class="linenos" data-linenos="18 "></span></a>               â
</span><span id="__span-50-19"><a id="__codelineno-50-19" name="__codelineno-50-19"></a><a href="#__codelineno-50-19"><span class="linenos" data-linenos="19 "></span></a>âââââââââââââââââââââââââââ
</span><span id="__span-50-20"><a id="__codelineno-50-20" name="__codelineno-50-20"></a><a href="#__codelineno-50-20"><span class="linenos" data-linenos="20 "></span></a>â       åºååè§£ 2         â    x, trend2 = decomp2(x)
</span><span id="__span-50-21"><a id="__codelineno-50-21" name="__codelineno-50-21"></a><a href="#__codelineno-50-21"><span class="linenos" data-linenos="21 "></span></a>ââââââââ¬âââââââââââââââââââ
</span><span id="__span-50-22"><a id="__codelineno-50-22" name="__codelineno-50-22"></a><a href="#__codelineno-50-22"><span class="linenos" data-linenos="22 "></span></a>       â                  â
</span><span id="__span-50-23"><a id="__codelineno-50-23" name="__codelineno-50-23"></a><a href="#__codelineno-50-23"><span class="linenos" data-linenos="23 "></span></a>       â                   trend2 [B,L,d_model] â ä¿å­
</span><span id="__span-50-24"><a id="__codelineno-50-24" name="__codelineno-50-24"></a><a href="#__codelineno-50-24"><span class="linenos" data-linenos="24 "></span></a>       â
</span><span id="__span-50-25"><a id="__codelineno-50-25" name="__codelineno-50-25"></a><a href="#__codelineno-50-25"><span class="linenos" data-linenos="25 "></span></a>âââââââââââââââââââââââââââ
</span><span id="__span-50-26"><a id="__codelineno-50-26" name="__codelineno-50-26"></a><a href="#__codelineno-50-26"><span class="linenos" data-linenos="26 "></span></a>â        åé¦ç½ç»          â
</span><span id="__span-50-27"><a id="__codelineno-50-27" name="__codelineno-50-27"></a><a href="#__codelineno-50-27"><span class="linenos" data-linenos="27 "></span></a>â  y=x (å¤å¶æä½)          â
</span><span id="__span-50-28"><a id="__codelineno-50-28" name="__codelineno-50-28"></a><a href="#__codelineno-50-28"><span class="linenos" data-linenos="28 "></span></a>â  å·ç§¯1 + æ¿æ´» + Dropout  â    y = dropout(activation(conv1(y.transpose)))
</span><span id="__span-50-29"><a id="__codelineno-50-29" name="__codelineno-50-29"></a><a href="#__codelineno-50-29"><span class="linenos" data-linenos="29 "></span></a>â  å·ç§¯2 + Dropout        â    y = dropout(conv2(y).transpose)
</span><span id="__span-50-30"><a id="__codelineno-50-30" name="__codelineno-50-30"></a><a href="#__codelineno-50-30"><span class="linenos" data-linenos="30 "></span></a>ââââââââââââââââ¬âââââââââââ
</span><span id="__span-50-31"><a id="__codelineno-50-31" name="__codelineno-50-31"></a><a href="#__codelineno-50-31"><span class="linenos" data-linenos="31 "></span></a>               â
</span><span id="__span-50-32"><a id="__codelineno-50-32" name="__codelineno-50-32"></a><a href="#__codelineno-50-32"><span class="linenos" data-linenos="32 "></span></a>âââââââââââââââââââââââââââ
</span><span id="__span-50-33"><a id="__codelineno-50-33" name="__codelineno-50-33"></a><a href="#__codelineno-50-33"><span class="linenos" data-linenos="33 "></span></a>â æ®å·®è¿æ¥ (x + y)         â
</span><span id="__span-50-34"><a id="__codelineno-50-34" name="__codelineno-50-34"></a><a href="#__codelineno-50-34"><span class="linenos" data-linenos="34 "></span></a>ââââââââââââââââ¬âââââââââââ
</span><span id="__span-50-35"><a id="__codelineno-50-35" name="__codelineno-50-35"></a><a href="#__codelineno-50-35"><span class="linenos" data-linenos="35 "></span></a>               â
</span><span id="__span-50-36"><a id="__codelineno-50-36" name="__codelineno-50-36"></a><a href="#__codelineno-50-36"><span class="linenos" data-linenos="36 "></span></a>âââââââââââââââââââââââââââ
</span><span id="__span-50-37"><a id="__codelineno-50-37" name="__codelineno-50-37"></a><a href="#__codelineno-50-37"><span class="linenos" data-linenos="37 "></span></a>â       åºååè§£ 3         â    x, trend3 = decomp3(x + y)
</span><span id="__span-50-38"><a id="__codelineno-50-38" name="__codelineno-50-38"></a><a href="#__codelineno-50-38"><span class="linenos" data-linenos="38 "></span></a>ââââââââ¬âââââââââââââââââââ
</span><span id="__span-50-39"><a id="__codelineno-50-39" name="__codelineno-50-39"></a><a href="#__codelineno-50-39"><span class="linenos" data-linenos="39 "></span></a>       â                  â
</span><span id="__span-50-40"><a id="__codelineno-50-40" name="__codelineno-50-40"></a><a href="#__codelineno-50-40"><span class="linenos" data-linenos="40 "></span></a>       â                   trend3 [B,L,d_model] â ä¿å­
</span><span id="__span-50-41"><a id="__codelineno-50-41" name="__codelineno-50-41"></a><a href="#__codelineno-50-41"><span class="linenos" data-linenos="41 "></span></a>       â
</span><span id="__span-50-42"><a id="__codelineno-50-42" name="__codelineno-50-42"></a><a href="#__codelineno-50-42"><span class="linenos" data-linenos="42 "></span></a>       â
</span><span id="__span-50-43"><a id="__codelineno-50-43" name="__codelineno-50-43"></a><a href="#__codelineno-50-43"><span class="linenos" data-linenos="43 "></span></a>       â    âââââââââââââââââââââââââââââââââââââ
</span><span id="__span-50-44"><a id="__codelineno-50-44" name="__codelineno-50-44"></a><a href="#__codelineno-50-44"><span class="linenos" data-linenos="44 "></span></a>       â    â   åå¹¶è¶å¿: trend1 + trend2 + trend3 â
</span><span id="__span-50-45"><a id="__codelineno-50-45" name="__codelineno-50-45"></a><a href="#__codelineno-50-45"><span class="linenos" data-linenos="45 "></span></a>       â    âââââââââââââââââ¬ââââââââââââââââââââ
</span><span id="__span-50-46"><a id="__codelineno-50-46" name="__codelineno-50-46"></a><a href="#__codelineno-50-46"><span class="linenos" data-linenos="46 "></span></a>       â                    â
</span><span id="__span-50-47"><a id="__codelineno-50-47" name="__codelineno-50-47"></a><a href="#__codelineno-50-47"><span class="linenos" data-linenos="47 "></span></a>       â    âââââââââââââââââââââââââââââââââââââ
</span><span id="__span-50-48"><a id="__codelineno-50-48" name="__codelineno-50-48"></a><a href="#__codelineno-50-48"><span class="linenos" data-linenos="48 "></span></a>       â    â   è¶å¿æå½± (ç»´åº¦è°æ´)               â    residual_trend = projection(residual_trend)
</span><span id="__span-50-49"><a id="__codelineno-50-49" name="__codelineno-50-49"></a><a href="#__codelineno-50-49"><span class="linenos" data-linenos="49 "></span></a>       â    âââââââââââââââââ¬ââââââââââââââââââââ
</span><span id="__span-50-50"><a id="__codelineno-50-50" name="__codelineno-50-50"></a><a href="#__codelineno-50-50"><span class="linenos" data-linenos="50 "></span></a>       â                    â
</span><span id="__span-50-51"><a id="__codelineno-50-51" name="__codelineno-50-51"></a><a href="#__codelineno-50-51"><span class="linenos" data-linenos="51 "></span></a>       â                    â
</span><span id="__span-50-52"><a id="__codelineno-50-52" name="__codelineno-50-52"></a><a href="#__codelineno-50-52"><span class="linenos" data-linenos="52 "></span></a>ââââââââ´âââââââââ  ââââââââââ´ââââââââââ
</span><span id="__span-50-53"><a id="__codelineno-50-53" name="__codelineno-50-53"></a><a href="#__codelineno-50-53"><span class="linenos" data-linenos="53 "></span></a>â å­£èæ§è¾åº x   â  â è¶å¿è¾åº         â
</span><span id="__span-50-54"><a id="__codelineno-50-54" name="__codelineno-50-54"></a><a href="#__codelineno-50-54"><span class="linenos" data-linenos="54 "></span></a>â [B,L,d_model] â  â [B,L,c_out]      â
</span><span id="__span-50-55"><a id="__codelineno-50-55" name="__codelineno-50-55"></a><a href="#__codelineno-50-55"><span class="linenos" data-linenos="55 "></span></a>âââââââââââââââââ  ââââââââââââââââââââ
</span></code></pre></div>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></input></label> ä¸ºä»ä¹åªå¯¹è¶å¿æåè¿è¡æå½±ï¼ï¼ç­ï¼é½æå½±äºï¼åªæ¯ä½ç½®ä¸åï¼</li>
</ul>
<blockquote>
<p>éè¿æå½±å±å°è¶å¿ç»´åº¦ä»d_modelè°æ´ä¸ºc_out(è¾åºç¹å¾ç»´åº¦)</p>
<p>é¦åï¼éè¦æç¡®ï¼è¶å¿æååå­£èæåæåé½éè¦ ä» <code>d_model</code> è¿åä¸º <code>feature dim</code> ä¹å°±æ¯åå§çæ°æ®ç»´åº¦ï¼ä½æ¯è¿éè¶å¿æååå­£èæåè¿åçä½ç½®ä¸åï¼æ¹å¼ä¸åã</p>
<p><strong>ç¬¬ä¸ä¸ªè¿åä½ç½®</strong></p>
<p>â  é¦åæç¡® Decoder è°ç¨ DecoderLayer è¿è¡åä¸ªè§£ç å¨çå¤ç</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1"></a><a href="#__codelineno-51-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># è¿åå­£èæ§æå(ä¸è¿è¡æå½±)åæå½±åçè¶å¿æå</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2"></a><a href="#__codelineno-51-2"><span class="linenos" data-linenos="2 "></span></a><span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">residual_trend</span>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3"></a><a href="#__codelineno-51-3"><span class="linenos" data-linenos="3 "></span></a><span class="c1"># x: [B, L, d_model], residual_trend: [B, L, c_out]</span>
</span></code></pre></div>
<p>åä¸ª DecoderLayer è¿åçå­£èæååè¶å¿æåçç»´åº¦å°±æ¯ä¸ä¸æ ·ç</p>
<p>â¡ å­£èæåå¨ Decoder ä¸­è¿åç»´åº¦ï¼éè¿ if å¤æ­</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1"></a><a href="#__codelineno-52-1"><span class="linenos" data-linenos="1 "></span></a>        <span class="c1"># å¦æå­å¨æå½±å±ï¼åå¯¹è¾åºè¿è¡æå½±å¤ç</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2"></a><a href="#__codelineno-52-2"><span class="linenos" data-linenos="2 "></span></a>        <span class="c1"># x[B, L, d_model] -&gt; Linear -&gt; x[B, L, c_out]</span>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3"></a><a href="#__codelineno-52-3"><span class="linenos" data-linenos="3 "></span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4"></a><a href="#__codelineno-52-4"><span class="linenos" data-linenos="4 "></span></a>            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></code></pre></div>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></input></label> é£å·ä½ä»ä¹æ¶åè§¦åå¢ï¼æ¯æ¬¡ DecoderLayer æ§è¡å®ï¼è¿æ¯ææ DecoderLayer æç»æ§è¡å®ï¼ åç­ï¼åèï¼çç±ï¼</li>
</ul>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1"></a><a href="#__codelineno-53-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">cross</span><span class="p">,</span> <span class="n">x_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cross_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trend</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2"></a><a href="#__codelineno-53-2"><span class="linenos" data-linenos=" 2 "></span></a>    <span class="c1"># éåæ¯ä¸ªè§£ç å¨å±ï¼å¤çè¾å¥åºåxåäº¤ååºåcross</span>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3"></a><a href="#__codelineno-53-3"><span class="linenos" data-linenos=" 3 "></span></a>    <span class="c1"># x[B, L, d_model] -&gt; DecoderLayer.forward -&gt; x[B, L, d_model], residual_trend[B, L, c_out]</span>
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4"></a><a href="#__codelineno-53-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5"></a><a href="#__codelineno-53-5"><span class="linenos" data-linenos=" 5 "></span></a>        <span class="c1"># è°ç¨è§£ç å¨å±çååä¼ æ­æ¹æ³ï¼æ´æ°xåæ®å·®è¶å¿</span>
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6"></a><a href="#__codelineno-53-6"><span class="linenos" data-linenos=" 6 "></span></a>        <span class="c1"># x[B, L, d_model], cross[B, L, d_model] -&gt; DecoderLayer.forward -&gt; x[B, L, d_model], residual_trend[B, L, c_out]</span>
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7"></a><a href="#__codelineno-53-7"><span class="linenos" data-linenos=" 7 "></span></a>        <span class="n">x</span><span class="p">,</span> <span class="n">residual_trend</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cross</span><span class="p">,</span> <span class="n">x_mask</span><span class="o">=</span><span class="n">x_mask</span><span class="p">,</span> <span class="n">cross_mask</span><span class="o">=</span><span class="n">cross_mask</span><span class="p">)</span>
</span><span id="__span-53-8"><a id="__codelineno-53-8" name="__codelineno-53-8"></a><a href="#__codelineno-53-8"><span class="linenos" data-linenos=" 8 "></span></a>        <span class="c1"># æ´æ°è¶å¿ä¿¡æ¯ï¼å°æ®å·®è¶å¿æ·»å å°å½åè¶å¿</span>
</span><span id="__span-53-9"><a id="__codelineno-53-9" name="__codelineno-53-9"></a><a href="#__codelineno-53-9"><span class="linenos" data-linenos=" 9 "></span></a>        <span class="c1"># trend[B, L, c_out] + residual_trend[B, L, c_out] -&gt; trend[B, L, c_out]</span>
</span><span id="__span-53-10"><a id="__codelineno-53-10" name="__codelineno-53-10"></a><a href="#__codelineno-53-10"><span class="linenos" data-linenos="10 "></span></a>        <span class="n">trend</span> <span class="o">=</span> <span class="n">trend</span> <span class="o">+</span> <span class="n">residual_trend</span>
</span><span id="__span-53-11"><a id="__codelineno-53-11" name="__codelineno-53-11"></a><a href="#__codelineno-53-11"><span class="linenos" data-linenos="11 "></span></a>
</span><span id="__span-53-12"><a id="__codelineno-53-12" name="__codelineno-53-12"></a><a href="#__codelineno-53-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="c1"># å¦æå­å¨å½ä¸åå±ï¼åå¯¹è¾åºè¿è¡å½ä¸åå¤ç</span>
</span><span id="__span-53-13"><a id="__codelineno-53-13" name="__codelineno-53-13"></a><a href="#__codelineno-53-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="c1"># x[B, L, d_model] -&gt; LayerNorm -&gt; x[B, L, d_model]</span>
</span><span id="__span-53-14"><a id="__codelineno-53-14" name="__codelineno-53-14"></a><a href="#__codelineno-53-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-53-15"><a id="__codelineno-53-15" name="__codelineno-53-15"></a><a href="#__codelineno-53-15"><span class="linenos" data-linenos="15 "></span></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-53-16"><a id="__codelineno-53-16" name="__codelineno-53-16"></a><a href="#__codelineno-53-16"><span class="linenos" data-linenos="16 "></span></a>
</span><span id="__span-53-17"><a id="__codelineno-53-17" name="__codelineno-53-17"></a><a href="#__codelineno-53-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="c1"># å¦æå­å¨æå½±å±ï¼åå¯¹è¾åºè¿è¡æå½±å¤ç</span>
</span><span id="__span-53-18"><a id="__codelineno-53-18" name="__codelineno-53-18"></a><a href="#__codelineno-53-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="c1"># x[B, L, d_model] -&gt; Linear -&gt; x[B, L, c_out]</span>
</span><span id="__span-53-19"><a id="__codelineno-53-19" name="__codelineno-53-19"></a><a href="#__codelineno-53-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-53-20"><a id="__codelineno-53-20" name="__codelineno-53-20"></a><a href="#__codelineno-53-20"><span class="linenos" data-linenos="20 "></span></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></code></pre></div>
<p>for å¾ªç¯æ¯ä¸ºå¾ªç¯ DecoderLayerï¼DecoderLayer æ§è¡å®äºï¼å°±æ¯æåçå¤çäºã</p>
</blockquote>
<h4 id="_14">æ°æ®æµå¨å¾<a class="headerlink" href="#_14" title="Permanent link">Â¶</a></h4>
<blockquote>
<p>â¢ è¶å¿æå å¨æ¯æ¬¡ DecoderLayer  forward çæåå°±ä¼è¿è¡è¿åç»´åº¦</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250322100529812.png"><img alt="image-20250322100529812" src="../images/image-20250322100529812.png"/></a></p>
<p><strong>ç»å¾ç´è§çè§£ Decoder å DecoderLayer ä¸­å³äºå­£èæååè¶å¿æåççè§£</strong></p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1"></a><a href="#__codelineno-54-1"><span class="linenos" data-linenos="  1 "></span></a><span class="err">âââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2"></a><a href="#__codelineno-54-2"><span class="linenos" data-linenos="  2 "></span></a><span class="err">â</span>                         <span class="n">Decoder</span><span class="o">.</span><span class="n">forward</span>                              <span class="err">â</span>
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3"></a><a href="#__codelineno-54-3"><span class="linenos" data-linenos="  3 "></span></a><span class="err">ââââââââââââââââââââââââââââââââââ¬âââââââââââââââââââââââââââââââââââââ</span>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4"></a><a href="#__codelineno-54-4"><span class="linenos" data-linenos="  4 "></span></a>                                 <span class="err">â</span>
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5"></a><a href="#__codelineno-54-5"><span class="linenos" data-linenos="  5 "></span></a><span class="err">ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ</span>
</span><span id="__span-54-6"><a id="__codelineno-54-6" name="__codelineno-54-6"></a><a href="#__codelineno-54-6"><span class="linenos" data-linenos="  6 "></span></a><span class="err">â</span>  <span class="n">è¾å¥</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">d_model</span><span class="p">],</span> <span class="n">cross</span><span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">d_model</span><span class="p">],</span> <span class="n">trend</span><span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">c_out</span><span class="p">],</span> <span class="n">masks</span>            <span class="err">â</span>
</span><span id="__span-54-7"><a id="__codelineno-54-7" name="__codelineno-54-7"></a><a href="#__codelineno-54-7"><span class="linenos" data-linenos="  7 "></span></a><span class="err">ââââââââââââââââââââââââââââââââââ¬ââââââââââââââââââââââââââââââââââââââââââââââ</span>
</span><span id="__span-54-8"><a id="__codelineno-54-8" name="__codelineno-54-8"></a><a href="#__codelineno-54-8"><span class="linenos" data-linenos="  8 "></span></a>                                 <span class="err">â</span>
</span><span id="__span-54-9"><a id="__codelineno-54-9" name="__codelineno-54-9"></a><a href="#__codelineno-54-9"><span class="linenos" data-linenos="  9 "></span></a>
</span><span id="__span-54-10"><a id="__codelineno-54-10" name="__codelineno-54-10"></a><a href="#__codelineno-54-10"><span class="linenos" data-linenos=" 10 "></span></a><span class="err">ââââââââââââââââââââââââââââââââââââââ</span> <span class="n">DecoderLayer</span> <span class="mi">1</span> <span class="err">ââââââââââââââââââââââââââââââââââââââ</span>
</span><span id="__span-54-11"><a id="__codelineno-54-11" name="__codelineno-54-11"></a><a href="#__codelineno-54-11"><span class="linenos" data-linenos=" 11 "></span></a><span class="err">â</span>  <span class="err">âââââââââââââââââââââââââââ</span>                                                              <span class="err">â</span>
</span><span id="__span-54-12"><a id="__codelineno-54-12" name="__codelineno-54-12"></a><a href="#__codelineno-54-12"><span class="linenos" data-linenos=" 12 "></span></a><span class="err">â</span>  <span class="err">â</span> <span class="n">è¾å¥åºå</span> <span class="n">x</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">d_model</span><span class="p">]</span> <span class="err">â</span>                                                              <span class="err">â</span>
</span><span id="__span-54-13"><a id="__codelineno-54-13" name="__codelineno-54-13"></a><a href="#__codelineno-54-13"><span class="linenos" data-linenos=" 13 "></span></a><span class="err">â</span>  <span class="err">ââââââââââââââââ¬âââââââââââ</span>                                                              <span class="err">â</span>
</span><span id="__span-54-14"><a id="__codelineno-54-14" name="__codelineno-54-14"></a><a href="#__codelineno-54-14"><span class="linenos" data-linenos=" 14 "></span></a><span class="err">â</span>                 <span class="err">â</span>                                                                         <span class="err">â</span>
</span><span id="__span-54-15"><a id="__codelineno-54-15" name="__codelineno-54-15"></a><a href="#__codelineno-54-15"><span class="linenos" data-linenos=" 15 "></span></a><span class="err">â</span>  <span class="err">âââââââââââââââââââââââââââ</span>                                                              <span class="err">â</span>
</span><span id="__span-54-16"><a id="__codelineno-54-16" name="__codelineno-54-16"></a><a href="#__codelineno-54-16"><span class="linenos" data-linenos=" 16 "></span></a><span class="err">â</span>  <span class="err">â</span>   <span class="n">èªæ³¨æå</span> <span class="o">+</span> <span class="n">æ®å·®è¿æ¥</span>     <span class="err">â</span>    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">dropout</span><span class="p">(</span><span class="n">self_attention</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">))</span>                    <span class="err">â</span>
</span><span id="__span-54-17"><a id="__codelineno-54-17" name="__codelineno-54-17"></a><a href="#__codelineno-54-17"><span class="linenos" data-linenos=" 17 "></span></a><span class="err">â</span>  <span class="err">ââââââââââââââââ¬âââââââââââ</span>                                                              <span class="err">â</span>
</span><span id="__span-54-18"><a id="__codelineno-54-18" name="__codelineno-54-18"></a><a href="#__codelineno-54-18"><span class="linenos" data-linenos=" 18 "></span></a><span class="err">â</span>                 <span class="err">â</span>                                                                         <span class="err">â</span>
</span><span id="__span-54-19"><a id="__codelineno-54-19" name="__codelineno-54-19"></a><a href="#__codelineno-54-19"><span class="linenos" data-linenos=" 19 "></span></a><span class="err">â</span>  <span class="err">âââââââââââââââââââââââââââ</span>                                                              <span class="err">â</span>
</span><span id="__span-54-20"><a id="__codelineno-54-20" name="__codelineno-54-20"></a><a href="#__codelineno-54-20"><span class="linenos" data-linenos=" 20 "></span></a><span class="err">â</span>  <span class="err">â</span>       <span class="n">åºååè§£</span> <span class="mi">1</span>         <span class="err">â</span>    <span class="n">x</span><span class="p">,</span> <span class="n">trend1</span> <span class="o">=</span> <span class="n">decomp1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>                                    <span class="err">â</span>
</span><span id="__span-54-21"><a id="__codelineno-54-21" name="__codelineno-54-21"></a><a href="#__codelineno-54-21"><span class="linenos" data-linenos=" 21 "></span></a><span class="err">â</span>  <span class="err">ââââââââ¬âââââââââââââââââââ</span>                                                              <span class="err">â</span>
</span><span id="__span-54-22"><a id="__codelineno-54-22" name="__codelineno-54-22"></a><a href="#__codelineno-54-22"><span class="linenos" data-linenos=" 22 "></span></a><span class="err">â</span>         <span class="err">â</span>                  <span class="err">â</span>                                                              <span class="err">â</span>
</span><span id="__span-54-23"><a id="__codelineno-54-23" name="__codelineno-54-23"></a><a href="#__codelineno-54-23"><span class="linenos" data-linenos=" 23 "></span></a><span class="err">â</span>         <span class="err">â</span>                   <span class="n">trend1</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">d_model</span><span class="p">]</span> <span class="err">â</span> <span class="n">ä¿å­</span>                                    <span class="err">â</span>
</span><span id="__span-54-24"><a id="__codelineno-54-24" name="__codelineno-54-24"></a><a href="#__codelineno-54-24"><span class="linenos" data-linenos=" 24 "></span></a><span class="err">â</span>         <span class="err">â</span>                                                                                 <span class="err">â</span>
</span><span id="__span-54-25"><a id="__codelineno-54-25" name="__codelineno-54-25"></a><a href="#__codelineno-54-25"><span class="linenos" data-linenos=" 25 "></span></a><span class="err">â</span>  <span class="err">âââââââââââââââââââââââââââ</span>                                                              <span class="err">â</span>
</span><span id="__span-54-26"><a id="__codelineno-54-26" name="__codelineno-54-26"></a><a href="#__codelineno-54-26"><span class="linenos" data-linenos=" 26 "></span></a><span class="err">â</span>  <span class="err">â</span> <span class="n">äº¤åæ³¨æå</span><span class="p">(</span><span class="n">ç¼ç å¨è¾åº</span><span class="p">)</span>     <span class="err">â</span>    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">dropout</span><span class="p">(</span><span class="n">cross_attention</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">cross</span><span class="p">,</span><span class="n">cross</span><span class="p">))</span>          <span class="err">â</span>
</span><span id="__span-54-27"><a id="__codelineno-54-27" name="__codelineno-54-27"></a><a href="#__codelineno-54-27"><span class="linenos" data-linenos=" 27 "></span></a><span class="err">â</span>  <span class="err">ââââââââââââââââ¬âââââââââââ</span>                                                              <span class="err">â</span>
</span><span id="__span-54-28"><a id="__codelineno-54-28" name="__codelineno-54-28"></a><a href="#__codelineno-54-28"><span class="linenos" data-linenos=" 28 "></span></a><span class="err">â</span>                 <span class="err">â</span>                                                                         <span class="err">â</span>
</span><span id="__span-54-29"><a id="__codelineno-54-29" name="__codelineno-54-29"></a><a href="#__codelineno-54-29"><span class="linenos" data-linenos=" 29 "></span></a><span class="err">â</span>  <span class="err">âââââââââââââââââââââââââââ</span>                                                              <span class="err">â</span>
</span><span id="__span-54-30"><a id="__codelineno-54-30" name="__codelineno-54-30"></a><a href="#__codelineno-54-30"><span class="linenos" data-linenos=" 30 "></span></a><span class="err">â</span>  <span class="err">â</span>       <span class="n">åºååè§£</span> <span class="mi">2</span>         <span class="err">â</span>    <span class="n">x</span><span class="p">,</span> <span class="n">trend2</span> <span class="o">=</span> <span class="n">decomp2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>                                    <span class="err">â</span>
</span><span id="__span-54-31"><a id="__codelineno-54-31" name="__codelineno-54-31"></a><a href="#__codelineno-54-31"><span class="linenos" data-linenos=" 31 "></span></a><span class="err">â</span>  <span class="err">ââââââââ¬âââââââââââââââââââ</span>                                                              <span class="err">â</span>
</span><span id="__span-54-32"><a id="__codelineno-54-32" name="__codelineno-54-32"></a><a href="#__codelineno-54-32"><span class="linenos" data-linenos=" 32 "></span></a><span class="err">â</span>         <span class="err">â</span>                  <span class="err">â</span>                                                              <span class="err">â</span>
</span><span id="__span-54-33"><a id="__codelineno-54-33" name="__codelineno-54-33"></a><a href="#__codelineno-54-33"><span class="linenos" data-linenos=" 33 "></span></a><span class="err">â</span>         <span class="err">â</span>                   <span class="n">trend2</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">d_model</span><span class="p">]</span> <span class="err">â</span> <span class="n">ä¿å­</span>                                    <span class="err">â</span>
</span><span id="__span-54-34"><a id="__codelineno-54-34" name="__codelineno-54-34"></a><a href="#__codelineno-54-34"><span class="linenos" data-linenos=" 34 "></span></a><span class="err">â</span>         <span class="err">â</span>                                                                                 <span class="err">â</span>
</span><span id="__span-54-35"><a id="__codelineno-54-35" name="__codelineno-54-35"></a><a href="#__codelineno-54-35"><span class="linenos" data-linenos=" 35 "></span></a><span class="err">â</span>  <span class="err">âââââââââââââââââââââââââââ</span>                                                              <span class="err">â</span>
</span><span id="__span-54-36"><a id="__codelineno-54-36" name="__codelineno-54-36"></a><a href="#__codelineno-54-36"><span class="linenos" data-linenos=" 36 "></span></a><span class="err">â</span>  <span class="err">â</span>        <span class="n">åé¦ç½ç»</span>          <span class="err">â</span>                                                              <span class="err">â</span>
</span><span id="__span-54-37"><a id="__codelineno-54-37" name="__codelineno-54-37"></a><a href="#__codelineno-54-37"><span class="linenos" data-linenos=" 37 "></span></a><span class="err">â</span>  <span class="err">â</span>  <span class="n">y</span><span class="o">=</span><span class="n">x</span> <span class="p">(</span><span class="n">å¤å¶æä½</span><span class="p">)</span>          <span class="err">â</span>                                                              <span class="err">â</span>
</span><span id="__span-54-38"><a id="__codelineno-54-38" name="__codelineno-54-38"></a><a href="#__codelineno-54-38"><span class="linenos" data-linenos=" 38 "></span></a><span class="err">â</span>  <span class="err">â</span>  <span class="n">å·ç§¯1</span> <span class="o">+</span> <span class="n">æ¿æ´»</span> <span class="o">+</span> <span class="n">Dropout</span>  <span class="err">â</span>    <span class="n">y</span> <span class="o">=</span> <span class="n">dropout</span><span class="p">(</span><span class="n">activation</span><span class="p">(</span><span class="n">conv1</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">transpose</span><span class="p">)))</span>              <span class="err">â</span>
</span><span id="__span-54-39"><a id="__codelineno-54-39" name="__codelineno-54-39"></a><a href="#__codelineno-54-39"><span class="linenos" data-linenos=" 39 "></span></a><span class="err">â</span>  <span class="err">â</span>  <span class="n">å·ç§¯2</span> <span class="o">+</span> <span class="n">Dropout</span>        <span class="err">â</span>    <span class="n">y</span> <span class="o">=</span> <span class="n">dropout</span><span class="p">(</span><span class="n">conv2</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">)</span>                          <span class="err">â</span>
</span><span id="__span-54-40"><a id="__codelineno-54-40" name="__codelineno-54-40"></a><a href="#__codelineno-54-40"><span class="linenos" data-linenos=" 40 "></span></a><span class="err">â</span>  <span class="err">ââââââââââââââââ¬âââââââââââ</span>                                                              <span class="err">â</span>
</span><span id="__span-54-41"><a id="__codelineno-54-41" name="__codelineno-54-41"></a><a href="#__codelineno-54-41"><span class="linenos" data-linenos=" 41 "></span></a><span class="err">â</span>                 <span class="err">â</span>                                                                         <span class="err">â</span>
</span><span id="__span-54-42"><a id="__codelineno-54-42" name="__codelineno-54-42"></a><a href="#__codelineno-54-42"><span class="linenos" data-linenos=" 42 "></span></a><span class="err">â</span>  <span class="err">âââââââââââââââââââââââââââ</span>                                                              <span class="err">â</span>
</span><span id="__span-54-43"><a id="__codelineno-54-43" name="__codelineno-54-43"></a><a href="#__codelineno-54-43"><span class="linenos" data-linenos=" 43 "></span></a><span class="err">â</span>  <span class="err">â</span> <span class="n">æ®å·®è¿æ¥</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>         <span class="err">â</span>                                                              <span class="err">â</span>
</span><span id="__span-54-44"><a id="__codelineno-54-44" name="__codelineno-54-44"></a><a href="#__codelineno-54-44"><span class="linenos" data-linenos=" 44 "></span></a><span class="err">â</span>  <span class="err">ââââââââââââââââ¬âââââââââââ</span>                                                              <span class="err">â</span>
</span><span id="__span-54-45"><a id="__codelineno-54-45" name="__codelineno-54-45"></a><a href="#__codelineno-54-45"><span class="linenos" data-linenos=" 45 "></span></a><span class="err">â</span>                 <span class="err">â</span>                                                                         <span class="err">â</span>
</span><span id="__span-54-46"><a id="__codelineno-54-46" name="__codelineno-54-46"></a><a href="#__codelineno-54-46"><span class="linenos" data-linenos=" 46 "></span></a><span class="err">â</span>  <span class="err">âââââââââââââââââââââââââââ</span>                                                              <span class="err">â</span>
</span><span id="__span-54-47"><a id="__codelineno-54-47" name="__codelineno-54-47"></a><a href="#__codelineno-54-47"><span class="linenos" data-linenos=" 47 "></span></a><span class="err">â</span>  <span class="err">â</span>       <span class="n">åºååè§£</span> <span class="mi">3</span>         <span class="err">â</span>    <span class="n">x</span><span class="p">,</span> <span class="n">trend3</span> <span class="o">=</span> <span class="n">decomp3</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>                                <span class="err">â</span>
</span><span id="__span-54-48"><a id="__codelineno-54-48" name="__codelineno-54-48"></a><a href="#__codelineno-54-48"><span class="linenos" data-linenos=" 48 "></span></a><span class="err">â</span>  <span class="err">ââââââââ¬âââââââââââââââââââ</span>                                                              <span class="err">â</span>
</span><span id="__span-54-49"><a id="__codelineno-54-49" name="__codelineno-54-49"></a><a href="#__codelineno-54-49"><span class="linenos" data-linenos=" 49 "></span></a><span class="err">â</span>         <span class="err">â</span>                  <span class="err">â</span>                                                              <span class="err">â</span>
</span><span id="__span-54-50"><a id="__codelineno-54-50" name="__codelineno-54-50"></a><a href="#__codelineno-54-50"><span class="linenos" data-linenos=" 50 "></span></a><span class="err">â</span>         <span class="err">â</span>                   <span class="n">trend3</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">d_model</span><span class="p">]</span> <span class="err">â</span> <span class="n">ä¿å­</span>                                    <span class="err">â</span>
</span><span id="__span-54-51"><a id="__codelineno-54-51" name="__codelineno-54-51"></a><a href="#__codelineno-54-51"><span class="linenos" data-linenos=" 51 "></span></a><span class="err">â</span>         <span class="err">â</span>                                                                                 <span class="err">â</span>
</span><span id="__span-54-52"><a id="__codelineno-54-52" name="__codelineno-54-52"></a><a href="#__codelineno-54-52"><span class="linenos" data-linenos=" 52 "></span></a><span class="err">â</span>         <span class="err">â</span>    <span class="err">âââââââââââââââââââââââââââââââââââââââ</span>                                      <span class="err">â</span>
</span><span id="__span-54-53"><a id="__codelineno-54-53" name="__codelineno-54-53"></a><a href="#__codelineno-54-53"><span class="linenos" data-linenos=" 53 "></span></a><span class="err">â</span>         <span class="err">â</span>    <span class="err">â</span> <span class="n">ç´¯å è¶å¿</span><span class="p">:</span> <span class="n">trend1</span> <span class="o">+</span> <span class="n">trend2</span> <span class="o">+</span> <span class="n">trend3</span>   <span class="err">â</span>     <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">d_model</span><span class="p">]</span>                    <span class="err">â</span>
</span><span id="__span-54-54"><a id="__codelineno-54-54" name="__codelineno-54-54"></a><a href="#__codelineno-54-54"><span class="linenos" data-linenos=" 54 "></span></a><span class="err">â</span>         <span class="err">â</span>    <span class="err">âââââââââââââââââ¬ââââââââââââââââââââââ</span>                                      <span class="err">â</span>
</span><span id="__span-54-55"><a id="__codelineno-54-55" name="__codelineno-54-55"></a><a href="#__codelineno-54-55"><span class="linenos" data-linenos=" 55 "></span></a><span class="err">â</span>         <span class="err">â</span>                    <span class="err">â</span>                                                            <span class="err">â</span>
</span><span id="__span-54-56"><a id="__codelineno-54-56" name="__codelineno-54-56"></a><a href="#__codelineno-54-56"><span class="linenos" data-linenos=" 56 "></span></a><span class="err">â</span>         <span class="err">â</span>    <span class="err">âââââââââââââââââââââââââââââââââââââââ</span>                                      <span class="err">â</span>
</span><span id="__span-54-57"><a id="__codelineno-54-57" name="__codelineno-54-57"></a><a href="#__codelineno-54-57"><span class="linenos" data-linenos=" 57 "></span></a><span class="err">â</span>         <span class="err">â</span>    <span class="err">â</span> <span class="n">è¶å¿æå½±</span><span class="p">:</span> <span class="n">å·ç§¯</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>    <span class="err">â</span>     <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">d_model</span><span class="p">]</span> <span class="err">â</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">c_out</span><span class="p">]</span>      <span class="err">â</span>
</span><span id="__span-54-58"><a id="__codelineno-54-58" name="__codelineno-54-58"></a><a href="#__codelineno-54-58"><span class="linenos" data-linenos=" 58 "></span></a><span class="err">â</span>         <span class="err">â</span>    <span class="err">âââââââââââââââââ¬ââââââââââââââââââââââ</span>                                      <span class="err">â</span>
</span><span id="__span-54-59"><a id="__codelineno-54-59" name="__codelineno-54-59"></a><a href="#__codelineno-54-59"><span class="linenos" data-linenos=" 59 "></span></a><span class="err">â</span>         <span class="err">â</span>                    <span class="err">â</span>                                                            <span class="err">â</span>
</span><span id="__span-54-60"><a id="__codelineno-54-60" name="__codelineno-54-60"></a><a href="#__codelineno-54-60"><span class="linenos" data-linenos=" 60 "></span></a><span class="err">â</span>  <span class="err">ââââââââ´âââââââââ</span>    <span class="err">ââââââââ´ââââââââââââ</span>                                                <span class="err">â</span>
</span><span id="__span-54-61"><a id="__codelineno-54-61" name="__codelineno-54-61"></a><a href="#__codelineno-54-61"><span class="linenos" data-linenos=" 61 "></span></a><span class="err">â</span>  <span class="err">â</span> <span class="n">å­£èæ§è¾åº</span> <span class="n">x</span>   <span class="err">â</span>    <span class="err">â</span> <span class="n">è¶å¿è¾åº</span> <span class="n">residual_trend</span> <span class="err">â</span>                                         <span class="err">â</span>
</span><span id="__span-54-62"><a id="__codelineno-54-62" name="__codelineno-54-62"></a><a href="#__codelineno-54-62"><span class="linenos" data-linenos=" 62 "></span></a><span class="err">â</span>  <span class="err">â</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">d_model</span><span class="p">]</span> <span class="err">â</span>    <span class="err">â</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">c_out</span><span class="p">]</span>       <span class="err">â</span>                                                <span class="err">â</span>
</span><span id="__span-54-63"><a id="__codelineno-54-63" name="__codelineno-54-63"></a><a href="#__codelineno-54-63"><span class="linenos" data-linenos=" 63 "></span></a><span class="err">â</span>  <span class="err">âââââââââ¬ââââââââ</span>    <span class="err">ââââââââââââ¬âââââââââ</span>                                                <span class="err">â</span>
</span><span id="__span-54-64"><a id="__codelineno-54-64" name="__codelineno-54-64"></a><a href="#__codelineno-54-64"><span class="linenos" data-linenos=" 64 "></span></a><span class="err">ââââââââââââ¼ââââââââââââââââââââââ¬ââ´âââââââââââââââââââââââââââââââââââââââââââââââââââââââââ</span>
</span><span id="__span-54-65"><a id="__codelineno-54-65" name="__codelineno-54-65"></a><a href="#__codelineno-54-65"><span class="linenos" data-linenos=" 65 "></span></a>           <span class="err">â</span>                     <span class="err">â</span>
</span><span id="__span-54-66"><a id="__codelineno-54-66" name="__codelineno-54-66"></a><a href="#__codelineno-54-66"><span class="linenos" data-linenos=" 66 "></span></a>           <span class="err">â</span>             <span class="err">ââââââââââââââââââââââ</span>
</span><span id="__span-54-67"><a id="__codelineno-54-67" name="__codelineno-54-67"></a><a href="#__codelineno-54-67"><span class="linenos" data-linenos=" 67 "></span></a>           <span class="err">â</span>             <span class="err">â</span> <span class="n">Decoderä¸­ç´¯ç§¯è¶å¿</span>   <span class="err">â</span>     <span class="n">trend</span> <span class="o">+=</span> <span class="n">residual_trend</span>
</span><span id="__span-54-68"><a id="__codelineno-54-68" name="__codelineno-54-68"></a><a href="#__codelineno-54-68"><span class="linenos" data-linenos=" 68 "></span></a>           <span class="err">â</span>             <span class="err">â</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">c_out</span><span class="p">]</span>        <span class="err">â</span>     <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">c_out</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">c_out</span><span class="p">]</span>
</span><span id="__span-54-69"><a id="__codelineno-54-69" name="__codelineno-54-69"></a><a href="#__codelineno-54-69"><span class="linenos" data-linenos=" 69 "></span></a>           <span class="err">â</span>             <span class="err">âââââââââââ¬âââââââââââ</span>
</span><span id="__span-54-70"><a id="__codelineno-54-70" name="__codelineno-54-70"></a><a href="#__codelineno-54-70"><span class="linenos" data-linenos=" 70 "></span></a>           <span class="err">â</span>                       <span class="err">â</span>
</span><span id="__span-54-71"><a id="__codelineno-54-71" name="__codelineno-54-71"></a><a href="#__codelineno-54-71"><span class="linenos" data-linenos=" 71 "></span></a><span class="err">ââââââââââââââââââââââ</span>    <span class="err">ââââââââââââââââââââââ</span>
</span><span id="__span-54-72"><a id="__codelineno-54-72" name="__codelineno-54-72"></a><a href="#__codelineno-54-72"><span class="linenos" data-linenos=" 72 "></span></a><span class="err">â</span>  <span class="n">xä¼ å¥ä¸ä¸å±</span>        <span class="err">â</span>    <span class="err">â</span>  <span class="n">trendä¼ å¥ä¸ä¸å±</span>    <span class="err">â</span>
</span><span id="__span-54-73"><a id="__codelineno-54-73" name="__codelineno-54-73"></a><a href="#__codelineno-54-73"><span class="linenos" data-linenos=" 73 "></span></a><span class="err">â</span>  <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">d_model</span><span class="p">]</span>     <span class="err">â</span>    <span class="err">â</span>  <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">c_out</span><span class="p">]</span>       <span class="err">â</span>
</span><span id="__span-54-74"><a id="__codelineno-54-74" name="__codelineno-54-74"></a><a href="#__codelineno-54-74"><span class="linenos" data-linenos=" 74 "></span></a><span class="err">ââââââââââ¬ââââââââââââ</span>    <span class="err">ââââââââââââ¬ââââââââââ</span>
</span><span id="__span-54-75"><a id="__codelineno-54-75" name="__codelineno-54-75"></a><a href="#__codelineno-54-75"><span class="linenos" data-linenos=" 75 "></span></a>         <span class="err">â</span>                           <span class="err">â</span>
</span><span id="__span-54-76"><a id="__codelineno-54-76" name="__codelineno-54-76"></a><a href="#__codelineno-54-76"><span class="linenos" data-linenos=" 76 "></span></a><span class="err">ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ</span>
</span><span id="__span-54-77"><a id="__codelineno-54-77" name="__codelineno-54-77"></a><a href="#__codelineno-54-77"><span class="linenos" data-linenos=" 77 "></span></a><span class="err">â</span>                         <span class="n">DecoderLayer</span> <span class="mi">2</span>                             <span class="err">â</span>
</span><span id="__span-54-78"><a id="__codelineno-54-78" name="__codelineno-54-78"></a><a href="#__codelineno-54-78"><span class="linenos" data-linenos=" 78 "></span></a><span class="err">â</span>                          <span class="p">(</span><span class="n">éå¤æµç¨</span><span class="p">)</span>                                 <span class="err">â</span>
</span><span id="__span-54-79"><a id="__codelineno-54-79" name="__codelineno-54-79"></a><a href="#__codelineno-54-79"><span class="linenos" data-linenos=" 79 "></span></a><span class="err">ââââââââââ¬ââââââââââââââââââââââââââââââââââââ¬âââââââââââââââââââââââââ</span>
</span><span id="__span-54-80"><a id="__codelineno-54-80" name="__codelineno-54-80"></a><a href="#__codelineno-54-80"><span class="linenos" data-linenos=" 80 "></span></a>         <span class="err">â</span>                                   <span class="err">â</span>
</span><span id="__span-54-81"><a id="__codelineno-54-81" name="__codelineno-54-81"></a><a href="#__codelineno-54-81"><span class="linenos" data-linenos=" 81 "></span></a>         <span class="o">.</span>                                   <span class="o">.</span>
</span><span id="__span-54-82"><a id="__codelineno-54-82" name="__codelineno-54-82"></a><a href="#__codelineno-54-82"><span class="linenos" data-linenos=" 82 "></span></a>         <span class="o">.</span>                                   <span class="o">.</span>
</span><span id="__span-54-83"><a id="__codelineno-54-83" name="__codelineno-54-83"></a><a href="#__codelineno-54-83"><span class="linenos" data-linenos=" 83 "></span></a>         <span class="err">â</span>                                   <span class="err">â</span>
</span><span id="__span-54-84"><a id="__codelineno-54-84" name="__codelineno-54-84"></a><a href="#__codelineno-54-84"><span class="linenos" data-linenos=" 84 "></span></a><span class="err">ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ</span>
</span><span id="__span-54-85"><a id="__codelineno-54-85" name="__codelineno-54-85"></a><a href="#__codelineno-54-85"><span class="linenos" data-linenos=" 85 "></span></a><span class="err">â</span>                         <span class="n">DecoderLayer</span> <span class="n">N</span>                             <span class="err">â</span>
</span><span id="__span-54-86"><a id="__codelineno-54-86" name="__codelineno-54-86"></a><a href="#__codelineno-54-86"><span class="linenos" data-linenos=" 86 "></span></a><span class="err">â</span>                          <span class="p">(</span><span class="n">éå¤æµç¨</span><span class="p">)</span>                                 <span class="err">â</span>
</span><span id="__span-54-87"><a id="__codelineno-54-87" name="__codelineno-54-87"></a><a href="#__codelineno-54-87"><span class="linenos" data-linenos=" 87 "></span></a><span class="err">ââââââââââ¬ââââââââââââââââââââââââââââââââââââ¬âââââââââââââââââââââââââ</span>
</span><span id="__span-54-88"><a id="__codelineno-54-88" name="__codelineno-54-88"></a><a href="#__codelineno-54-88"><span class="linenos" data-linenos=" 88 "></span></a>         <span class="err">â</span>                                   <span class="err">â</span>
</span><span id="__span-54-89"><a id="__codelineno-54-89" name="__codelineno-54-89"></a><a href="#__codelineno-54-89"><span class="linenos" data-linenos=" 89 "></span></a><span class="err">ââââââââââââââââââââââ</span>             <span class="err">ââââââââââââââââââââââ</span>
</span><span id="__span-54-90"><a id="__codelineno-54-90" name="__codelineno-54-90"></a><a href="#__codelineno-54-90"><span class="linenos" data-linenos=" 90 "></span></a><span class="err">â</span>  <span class="n">æç»å­£èæ§</span> <span class="n">x</span>       <span class="err">â</span>             <span class="err">â</span>  <span class="n">ç´¯ç§¯è¶å¿</span> <span class="n">trend</span>     <span class="err">â</span>
</span><span id="__span-54-91"><a id="__codelineno-54-91" name="__codelineno-54-91"></a><a href="#__codelineno-54-91"><span class="linenos" data-linenos=" 91 "></span></a><span class="err">â</span>  <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">d_model</span><span class="p">]</span>     <span class="err">â</span>             <span class="err">â</span>  <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">c_out</span><span class="p">]</span>       <span class="err">â</span>
</span><span id="__span-54-92"><a id="__codelineno-54-92" name="__codelineno-54-92"></a><a href="#__codelineno-54-92"><span class="linenos" data-linenos=" 92 "></span></a><span class="err">ââââââââââ¬ââââââââââââ</span>             <span class="err">ââââââââââââ¬ââââââââââ</span>
</span><span id="__span-54-93"><a id="__codelineno-54-93" name="__codelineno-54-93"></a><a href="#__codelineno-54-93"><span class="linenos" data-linenos=" 93 "></span></a>         <span class="err">â</span>                                    <span class="err">â</span>
</span><span id="__span-54-94"><a id="__codelineno-54-94" name="__codelineno-54-94"></a><a href="#__codelineno-54-94"><span class="linenos" data-linenos=" 94 "></span></a><span class="err">ââââââââââââââââââââââ</span>                        <span class="err">â</span>
</span><span id="__span-54-95"><a id="__codelineno-54-95" name="__codelineno-54-95"></a><a href="#__codelineno-54-95"><span class="linenos" data-linenos=" 95 "></span></a><span class="err">â</span> <span class="n">å½ä¸å</span><span class="p">(</span><span class="n">å¦æå­å¨</span><span class="p">)</span>    <span class="err">â</span>                        <span class="err">â</span>
</span><span id="__span-54-96"><a id="__codelineno-54-96" name="__codelineno-54-96"></a><a href="#__codelineno-54-96"><span class="linenos" data-linenos=" 96 "></span></a><span class="err">â</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">d_model</span><span class="p">]</span>      <span class="err">â</span>                        <span class="err">â</span>
</span><span id="__span-54-97"><a id="__codelineno-54-97" name="__codelineno-54-97"></a><a href="#__codelineno-54-97"><span class="linenos" data-linenos=" 97 "></span></a><span class="err">ââââââââââ¬ââââââââââââ</span>                        <span class="err">â</span>
</span><span id="__span-54-98"><a id="__codelineno-54-98" name="__codelineno-54-98"></a><a href="#__codelineno-54-98"><span class="linenos" data-linenos=" 98 "></span></a>         <span class="err">â</span>                                    <span class="err">â</span>
</span><span id="__span-54-99"><a id="__codelineno-54-99" name="__codelineno-54-99"></a><a href="#__codelineno-54-99"><span class="linenos" data-linenos=" 99 "></span></a><span class="err">ââââââââââââââââââââââ</span>                        <span class="err">â</span>
</span><span id="__span-54-100"><a id="__codelineno-54-100" name="__codelineno-54-100"></a><a href="#__codelineno-54-100"><span class="linenos" data-linenos="100 "></span></a><span class="err">â</span> <span class="n">æå½±</span><span class="p">(</span><span class="n">å¦æå­å¨</span><span class="p">)</span>      <span class="err">â</span>     <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">d_model</span><span class="p">]</span> <span class="err">â</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">c_out</span><span class="p">]</span>
</span><span id="__span-54-101"><a id="__codelineno-54-101" name="__codelineno-54-101"></a><a href="#__codelineno-54-101"><span class="linenos" data-linenos="101 "></span></a><span class="err">â</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">c_out</span><span class="p">]</span>        <span class="err">â</span>                        <span class="err">â</span>
</span><span id="__span-54-102"><a id="__codelineno-54-102" name="__codelineno-54-102"></a><a href="#__codelineno-54-102"><span class="linenos" data-linenos="102 "></span></a><span class="err">ââââââââââ¬ââââââââââââ</span>                        <span class="err">â</span>
</span><span id="__span-54-103"><a id="__codelineno-54-103" name="__codelineno-54-103"></a><a href="#__codelineno-54-103"><span class="linenos" data-linenos="103 "></span></a>         <span class="err">â</span>                                    <span class="err">â</span>
</span><span id="__span-54-104"><a id="__codelineno-54-104" name="__codelineno-54-104"></a><a href="#__codelineno-54-104"><span class="linenos" data-linenos="104 "></span></a><span class="err">ââââââââââââââââââââââ</span>             <span class="err">ââââââââââââââââââââââ</span>
</span><span id="__span-54-105"><a id="__codelineno-54-105" name="__codelineno-54-105"></a><a href="#__codelineno-54-105"><span class="linenos" data-linenos="105 "></span></a><span class="err">â</span>  <span class="n">Decoderå­£èæ§è¾åº</span>  <span class="err">â</span>             <span class="err">â</span>  <span class="n">Decoderè¶å¿è¾åº</span>   <span class="err">â</span>
</span><span id="__span-54-106"><a id="__codelineno-54-106" name="__codelineno-54-106"></a><a href="#__codelineno-54-106"><span class="linenos" data-linenos="106 "></span></a><span class="err">â</span>  <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">c_out</span><span class="p">]</span>       <span class="err">â</span>             <span class="err">â</span>  <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">c_out</span><span class="p">]</span>       <span class="err">â</span>
</span><span id="__span-54-107"><a id="__codelineno-54-107" name="__codelineno-54-107"></a><a href="#__codelineno-54-107"><span class="linenos" data-linenos="107 "></span></a><span class="err">ââââââââââââââââââââââ</span>             <span class="err">ââââââââââââââââââââââ</span>
</span></code></pre></div>
<p><strong>ç¬¬äºä¸ª è¿åæä½</strong></p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1"></a><a href="#__codelineno-55-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># è§£ç å¨å±åçè¶å¿æå½±ï¼ä½¿ç¨å·ç§¯ï¼</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2"></a><a href="#__codelineno-55-2"><span class="linenos" data-linenos="2 "></span></a><span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv1d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="n">d_model</span><span class="p">,</span> <span class="n">out_channels</span><span class="o">=</span><span class="n">c_out</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> 
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3"></a><a href="#__codelineno-55-3"><span class="linenos" data-linenos="3 "></span></a>                           <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">padding_mode</span><span class="o">=</span><span class="s1">'circular'</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4"></a><a href="#__codelineno-55-4"><span class="linenos" data-linenos="4 "></span></a>
</span><span id="__span-55-5"><a id="__codelineno-55-5" name="__codelineno-55-5"></a><a href="#__codelineno-55-5"><span class="linenos" data-linenos="5 "></span></a><span class="c1"># Decoderç±»ä¸­çå­£èæ§æå½±ï¼éå¸¸æ¯çº¿æ§å±ï¼</span>
</span><span id="__span-55-6"><a id="__codelineno-55-6" name="__codelineno-55-6"></a><a href="#__codelineno-55-6"><span class="linenos" data-linenos="6 "></span></a><span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">d_model</span><span class="p">,</span> <span class="n">c_out</span><span class="p">)</span> <span class="k">if</span> <span class="n">projection</span> <span class="k">else</span> <span class="kc">None</span>
</span></code></pre></div>
<p>è¶å¿ä½¿ç¨å·ç§¯æå½±æä»¥ä¸ä¼å¿ï¼ï¼è¶å¿çåå§åæ¬æ¥ä½¿ç¨çæ¯å¹³åæ± åï¼è¿éç 1D å·ç§¯å°±ç¸å½äºå¨è¿æ¥ï¼åªæ¯ä¸åçæ°æ®ç»ç»æ¹å¼ï¼</p>
<ul>
<li>å¯ä»¥æè·å±é¨æ¶é´ä¾èµå³ç³»ï¼kernel_size=3ï¼</li>
<li>ä½¿ç¨å¾ªç¯å¡«åï¼circular paddingï¼éåå¤çæ¶é´åºåçå¨ææ§</li>
<li>å¯ä»¥å¹³æ»å¤çè¶å¿ååï¼åå°åªå£°</li>
</ul>
</blockquote>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></input></label> åä¸ª DecoderLayer è¿åçæ¯ çº¯å­£èæ§æå x[B,L,d_model] å è½¬æ¢åçè¶å¿æå residual_trend[B,L,c_out]</li>
</ul>
<blockquote>
<p>ð¢ <strong>å½¢ç¶ååçè§£ï¼</strong></p>
<p><strong>ðµ å­£èæ§æå:</strong></p>
<p>â¶ï¸ <strong>DecoderLayeråé¨:</strong></p>
<ul>
<li>å§ç»ä¿æå½¢ç¶ [B,L,d_model]</li>
<li>ç»è¿å¤ä¸ªå­æ¨¡åå¤ç(èªæ³¨æåãäº¤åæ³¨æåãåé¦ç½ç»)ï¼ä½ç»´åº¦ä¸å</li>
<li>è¾åºå°Decoderæ¶ä»ä¸º [B,L,d_model]</li>
</ul>
<p><strong>â¶ï¸ Decoderæç»å¤ç:</strong> </p>
<ul>
<li>éè¿ææDecoderLayeråä»ä¸º [B,L,d_model]</li>
<li>ç»è¿å¯éçå½ä¸åå±ï¼ç»´åº¦ä¸å</li>
<li>ç»è¿å¯éçæå½±å±åï¼åä¸º [B,L,c_out]</li>
</ul>
<p>ðµ <strong>è¶å¿æå:</strong></p>
<p>â¶ï¸ <strong>DecoderLayeråé¨è¶å¿æå:</strong></p>
<p>ä¸ä¸ªè¶å¿åé(trend1/2/3)é½æ¯ [B,L,d_model]</p>
<p>ä¸ä¸ªè¶å¿ç´¯å åä»ä¸º [B,L,d_model]</p>
<p>ç»è¿æå½±å±åï¼åä¸º [B,L,c_out]</p>
<p>â¶ï¸ <strong>Decoderä¸­çè¶å¿ç´¯ç§¯:</strong></p>
<p>Decoderè¾å¥çåå§è¶å¿trendä¸º [B,L,c_out]</p>
<p>æ¯ä¸ªDecoderLayerè¾åºçresidual_trendä¸º [B,L,c_out]</p>
<p>ç´¯ç§¯åçè¶å¿ç»´åº¦ä¿æ [B,L,c_out]</p>
<p><strong>ðåå±é´çæ°æ®ä¼ é</strong> </p>
<p>ð«§ <strong>å­£èæ§æåä¼ é:</strong></p>
<p>å­£èæ§æåxå¨åDecoderLayerä¹é´ä¼ é</p>
<p>æ¯ä¸ªDecoderLayerå¤çåçå­£èæ§æåä½ä¸ºä¸ä¸å±çè¾å¥</p>
<p>æåä¸å±çå­£èæ§æåè¾åºåç»è¿å½ä¸ååæå½±</p>
<p>ð«§ <strong>è¶å¿æåä¼ é:</strong> </p>
<p>DecoderLayeråé¨æåçä¸ä¸ªè¶å¿æåå¨å±åç´¯å åæå½±</p>
<p>æ¯ä¸ªDecoderLayeræä¾ä¸ä¸ªè¶å¿è´¡ç®residual_trend</p>
<p><mark>Decoderç»´æ¤ä¸ä¸ªç´¯ç§¯è¶å¿trendï¼åç´ç´¯ç§¯åå±çè´¡ç®</mark></p>
<p>æç»ç´¯ç§¯åçè¶å¿ä¸éè¦é¢å¤å¤çï¼ç´æ¥ä½ä¸ºè¾åº</p>
<p>ð <strong>DecoderLayerçè¾å¥è¾åº:</strong></p>
<p><strong>è¾å¥:</strong> å­£èæ§æå<code>x[B,L,d_model]</code>åç¼ç å¨è¾åº<code>cross[B,L,d_model]</code></p>
<p><strong>è¾åº:</strong> å¤çåçå­£èæ§æå<code>x[B,L,d_model]</code>åè¶å¿è´¡ç®<code>residual_trend[B,L,c_out]</code></p>
</blockquote>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></input></label> <a href="#ç¼ç å¨çè¾åºä½ä¸º K å Vï¼è§£ç å¨çè¾å¥ä½ä¸º Q"><span id="è¿åç¼ç å¨çè¾åºä½ä¸º K å Vï¼è§£ç å¨çè¾å¥ä½ä¸º Q">ç¼ç å¨çè¾åºä½ä¸º K å Vï¼è§£ç å¨çè¾å¥ä½ä¸º Q</span></a></li>
</ul>
<p>ç®æ åºåçææ¥è¯¢ï¼å¯¹ç§æºåºå</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></input></label> å¯¹æ¯ç¼ç å¨çè®¾è®¡</li>
</ul>
<blockquote>
<p>ä¸ç¼ç å¨çå³é®åºå«</p>
<ul>
<li>è¶å¿å¤çæ¹å¼: </li>
</ul>
<p>ç¼ç å¨: ä¸¢å¼è¶å¿æåï¼åªä¿çå­£èæ§</p>
<p>è§£ç å¨: ä¿å­å¹¶ç´¯ç§¯è¶å¿æåï¼æç»ä¸å­£èæ§åå¼è¾åº</p>
<ul>
<li>åè§£æ¬¡æ°:</li>
</ul>
<p>ç¼ç å¨: ä¸¤æ¬¡åè§£(æ³¨æååååé¦ç½ç»å)</p>
<p>è§£ç å¨: ä¸æ¬¡åè§£(èªæ³¨æååãäº¤åæ³¨æååååé¦ç½ç»å)</p>
<ul>
<li>è¶å¿ç´¯ç§¯:</li>
</ul>
<p>ç¼ç å¨: æ è¶å¿ç´¯ç§¯</p>
<p>è§£ç å¨: ä¸ä¸ªé¶æ®µçè¶å¿ç¸å ï¼å½¢æå®æ´è¶å¿è¡¨ç¤º</p>
<ul>
<li>è¾åºç»´åº¦:</li>
</ul>
<p>ç¼ç å¨: è¾åºä¿æd_modelç»´åº¦</p>
<p>è§£ç å¨: å¯¹è¶å¿æåè¿è¡æå½±ï¼è°æ´ä¸ºc_outç»´åº¦
è¿ç§è®¾è®¡ä½ç°äºAutoformerå¯¹æ¶é´åºååè§£çç²¾å¿å¤çï¼éè¿å¨è§£ç å¨ä¸­ç´¯ç§¯è¶å¿ä¿¡æ¯ï¼ç»åç¼ç å¨æåçå­£èæ§ç¹å¾ï¼æç»è½å¤å®ç°é«è´¨éçæ¶é´åºåé¢æµã</p>
</blockquote>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></input></label> é®ï¼ä¸ºä»ä¹è¦è¿æ ·è®¾è®¡ï¼</li>
</ul>
<blockquote>
<p>é®é¢æè¿°ï¼</p>
<p>è¶å¿æåï¼å¨æ¯ä¸ªè§£ç å¨å±åé¨å°±è¿è¡æå½±ï¼å¹¶ä¸åå±çæå½±ç»æè¢«ç´¯ç§¯</p>
<p>å­£èæ§æåï¼ä¿æåå§ç»´åº¦éè¿ææè§£ç å¨å±ï¼åªå¨æåè¿è¡ä¸æ¬¡ç»ä¸æå½±</p>
</blockquote>
<p>æççè§£ï¼å­£èæ¯ä¸ä¸ªé«é¢æåï¼ä¿æé«ç»´è¡¨ç¤ºè½å¤æ´å¥½çè¡¨ç¤ºç¹å¾ãè¶å¿æåæ¯ä¸ä¸ªä½é¢æåï¼ä¸ç®¡æ¯å·ç§¯æèæ¯ DecoderLayer æåç conv é½å¯ä»¥è¾¾å°å¹³æ»åªå£°çä½ç¨ï¼ä½¿å¾ç½ç»è½å¤æ´å å³æ³¨é¿æç¨³å®çè¶å¿</p>
<blockquote>
<p><strong>å¯¹å¦~å¾å° gpt çè¯å®ãokayï¼goãå®çè¡¥åï¼</strong> </p>
<p>Autoformerçè®¾è®¡çå¿µç¡®å®å´ç»çå¯¹æ¶é´åºåæ°æ®ä¸­ä¸åé¢çæåçå·®å¼åå¤ç</p>
<p><strong>ðµ å­£èæ§æåï¼é«é¢ï¼çå¤çç­ç¥</strong></p>
<p><strong>ä¿æé«ç»´è¡¨ç¤º</strong></p>
<ul>
<li>å­£èæ§æåå¨DecoderLayerä¸­å§ç»ä¿æd_modelç»´åº¦ï¼éå¸¸è¾é«ï¼</li>
<li>åªå¨Decoderçæåé¶æ®µææå½±å°c_outç»´åº¦</li>
<li>è¿ç§è®¾è®¡åè®¸æ¨¡åä½¿ç¨ä¸°å¯çç¹å¾ç©ºé´æ¥è¡¨è¾¾å¤æçå¨ææ§æ¨¡å¼</li>
</ul>
<p><strong>æ³¨æåæºå¶çä¼å¿</strong></p>
<ul>
<li>èªæ³¨æååäº¤åæ³¨æåç¹å«éåæè·ä¸åæ¶é´ç¹ä¹é´çå¨ææ§å³ç³»</li>
<li>å­£èæ§æåç»è¿å¤æ¬¡æ³¨æåå¤çï¼å¯ä»¥è¯å«å¤æçéå¤æ¨¡å¼</li>
</ul>
<p><strong>å¤å±æ¸è¿å¼å¤ç</strong> </p>
<ul>
<li>æ¯å±DecoderLayeré½å¯¹å­£èæ§è¿è¡è¿ä¸æ­¥ç²¾ç¼</li>
<li>éè¿å±å±ä¼ éï¼åè®¸æ¨¡åå­¦ä¹ å°å±æ¬¡åçå­£èæ¨¡å¼ï¼å¦æ¥åæ¨¡å¼ãå¨åæ¨¡å¼ãæåæ¨¡å¼ï¼</li>
</ul>
<p>ðµ <strong>è¶å¿æåï¼ä½é¢ï¼çå¤çç­ç¥</strong></p>
<p><strong>æ©æéç»´åå¹³æ»å¤ç</strong></p>
<ul>
<li>è¶å¿æåå¨æ¯ä¸ªDecoderLayeråå°±éè¿å·ç§¯ï¼kernel_size=3ï¼è¿è¡æå½±
  å·ç§¯çæ¬è´¨æ¯ä¸ç§å¹³æ»æä½ï¼è½å¤è¿æ»¤æé«é¢åªå£°</li>
<li>å¾ªç¯å¡«åï¼padding_mode='circular'ï¼éåå¤çå¨ææ§æ¶é´åºå
  ç´¯ç§¯æºå¶çæä¹</li>
</ul>
<p><strong>ä¸åå±æè·çè¶å¿éè¿ç®åç´¯å çæ¹å¼ç»å</strong></p>
<ul>
<li>è¶å¿ä½¿ç¨è¾ä½çç»´åº¦ï¼c_outï¼å°±è¶³ä»¥è¡¨è¾¾</li>
<li>è¶å¿æ¬è´¨ä¸æ¯ä½é¢ãå¹³æ»çæåï¼ç¹å¾å¤æåº¦ä½äºå­£èæ§</li>
</ul>
</blockquote>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></input></label> <a href="#è·³å°ä¸ºä»ä¹å­£èæååè¶å¿æå">ä¸ºä»ä¹å­£èæååè¶å¿æå</a><a id="è¿åä¸ºä»ä¹å­£èæååè¶å¿æå"></a>ï¼ä¸ä¸ªç¨nn.Linearä¸ä¸ªç¨ nn.conv1Dï¼</li>
</ul>
<p>è¡¥åï¼è¶å¿æåå·ç§¯æ¶ç¨å°ç<a href="#å¾ªç¯å¡«å"><span id="è¿åå¾ªç¯å¡«å">å¾ªç¯å¡«å</span></a></p>
<p>èªå·±çè¯ï¼kernel size=3ï¼å¹³æ»è¶å¿ï¼èèå±é¨ä¸ä¸æï¼è¿æ»¤åªå£°ï¼ï¼ä¼æä¸æ­¥å½¢ç¶ååï¼ä½å ä¸ºå·ç§¯æ ¸åæ°å±äº«ï¼å¯ä»¥è¯å«ç¸åçå¨æååï¼</p>
<p>å­£èæåä½¿ç¨ nn.Linearï¼ä¿çé«é¢æååå¿«éååçé¨åã</p>
<ul>
<li>å­£èæ§æåï¼é«é¢ãå¤æååï¼ï¼ä½¿ç¨çº¿æ§æå½±ä¿çç²¾ç»ç»æ</li>
<li>è¶å¿æåï¼ä½é¢ãå¹³æ»ååï¼ï¼ä½¿ç¨å·ç§¯æå½±å¼å¥å¹³æ»ææåå±é¨ä¸ä¸æ</li>
</ul>
<p><strong>æåçä¸ç¹å³äºæ¥æ¼è¡¥ç¼º</strong></p>
<p>Decoder å¯¹åºè®ºæä¸­çè¿éï¼</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250322153705300.png"><img alt="image-20250322153705300" src="../images/image-20250322153705300.png"/></a></p>
<p>å¬å¼ä¸­ï¼</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250322153735389.png"><img alt="image-20250322153735389" src="../images/image-20250322153735389.png"/></a> </p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></input></label> è¿éç <span class="arithmatex">\(\mathcal{W}_{l,}\)</span> æ¯ä»ä¹ææï¼</li>
</ul>
<p>é¦åéè¦æç¡®ï¼åä¸ªçå½¢ç¶</p>
<p><span class="arithmatex">\(\mathcal{T}_{de}^{l}ã\mathcal{T}_{de}^{l-1} \in \mathbb{R}^{B \times L \times c_{out}}\)</span></p>
<p><span class="arithmatex">\(\mathcal{T}_{de}^{l,1} ã\mathcal{T}_{de}^{l,2}ã\mathcal{T}_{de}^{l,3}\in \mathbb{R}^{B \times L \times d_{model}}\)</span></p>
<p><strong>â</strong> <span class="arithmatex">\(\mathcal{W}_{l,1}ã\mathcal{W}_{l,2}ã\mathcal{W}_{l,3}\)</span> åå«æ¯è°æ´ç»´åº¦æç¨å°çåæ¢ç©éµ</p>
<h2 id="autoformer-forward_1">æ±æ» Autoformer forward<a class="headerlink" href="#autoformer-forward_1" title="Permanent link">Â¶</a></h2>
<p>1</p>
<pre class="mermaid"><code>classDiagram
    class Model {
        +int seq_len
        +int label_len
        +int pred_len
        +bool output_attention
        +series_decomp decomp
        +DataEmbedding_wo_pos enc_embedding
        +DataEmbedding_wo_pos dec_embedding
        +Encoder encoder
        +Decoder decoder
        +forward(x_enc, x_mark_enc, x_dec, x_mark_dec, enc_self_mask, dec_self_mask, dec_enc_mask)
    }

    class series_decomp {
        +moving_avg moving_avg
        +forward(x) res, moving_mean
    }

    class moving_avg {
        +int kernel_size
        +AvgPool1d avg
        +forward(x)
    }

    class DataEmbedding_wo_pos {
        +TokenEmbedding value_embedding
        +PositionalEmbedding position_embedding
        +TemporalEmbedding or TimeFeatureEmbedding temporal_embedding  
        +Dropout dropout
        +forward(x, x_mark)
    }

    class TokenEmbedding {
        +Conv1d tokenConv
        +forward(x)
    }

    class TemporalEmbedding {
        +Embedding minute_embed
        +Embedding hour_embed
        +Embedding weekday_embed
        +Embedding day_embed
        +Embedding month_embed
        +forward(x)
    }

    class TimeFeatureEmbedding {
        +Linear embed
        +forward(x)
    }

    class Encoder {
        +List~EncoderLayer~ layers
        +my_Layernorm norm_layer
        +forward(x, attn_mask)
    }

    class EncoderLayer {
        +AutoCorrelationLayer attention
        +Conv1d conv1
        +Conv1d conv2
        +series_decomp decomp1
        +series_decomp decomp2
        +Dropout dropout
        +activation
        +forward(x, attn_mask)
    }

    class AutoCorrelationLayer {
        +AutoCorrelation attention
        +Linear query_projection
        +Linear key_projection
        +Linear value_projection
        +Linear out_projection
        +forward(queries, keys, values, attn_mask)
    }

    class AutoCorrelation {
        +bool mask_flag
        +int factor
        +float scale
        +Dropout dropout
        +bool output_attention
        +time_delay_agg_training(values, corr)
        +time_delay_agg_inference(values, corr)
        +forward(queries, keys, values, attn_mask)
    }

    class Decoder {
        +List~DecoderLayer~ layers
        +my_Layernorm norm_layer
        +Linear projection
        +forward(x, enc_out, x_mask, cross_mask, trend)
    }

    class DecoderLayer {
        +AutoCorrelationLayer self_attention
        +AutoCorrelationLayer cross_attention
        +Conv1d conv1
        +Conv1d conv2
        +series_decomp decomp1
        +series_decomp decomp2
        +series_decomp decomp3
        +Dropout dropout
        +activation
        +forward(x, enc_out, x_mask, cross_mask, trend)
    }

    %% æ ¸å¿ç»ä»¶å³ç³»
    Model --&gt; series_decomp
    Model --&gt; DataEmbedding_wo_pos
    Model --&gt; Encoder
    Model --&gt; Decoder

    %% åµå¥å±å³ç³» - ä¿®æ­£ä¸ºæ¡ä»¶å³ç³»
    DataEmbedding_wo_pos --&gt; TokenEmbedding
    DataEmbedding_wo_pos ..&gt; TemporalEmbedding : å½embed_type!='timeF'
    DataEmbedding_wo_pos ..&gt; TimeFeatureEmbedding : å½embed_type='timeF'

    %% ç¼ç å¨ç»ä»¶å³ç³»
    Encoder --&gt; EncoderLayer
    EncoderLayer --&gt; AutoCorrelationLayer
    EncoderLayer --&gt; Conv1d
    EncoderLayer --&gt; series_decomp
    AutoCorrelationLayer --&gt; AutoCorrelation

    %% è§£ç å¨ç»ä»¶å³ç³»
    Decoder --&gt; DecoderLayer
    DecoderLayer --&gt; AutoCorrelationLayer
    DecoderLayer --&gt; Conv1d
    DecoderLayer --&gt; series_decomp

    %% åºååè§£å³ç³»
    series_decomp --&gt; moving_avg
    moving_avg --&gt; AvgPool1d
</code></pre>
<p>2 </p>
<pre class="mermaid"><code>classDiagram
    class Model {
        +int seq_len
        +int label_len
        +int pred_len
        +bool output_attention
        +series_decomp decomp
        +DataEmbedding_wo_pos enc_embedding
        +DataEmbedding_wo_pos dec_embedding
        +Encoder encoder
        +Decoder decoder
        +forward(x_enc, x_mark_enc, x_dec, x_mark_dec, enc_self_mask, dec_self_mask, dec_enc_mask)
    }

    class series_decomp {
        +moving_avg moving_avg
        +forward(x) res, moving_mean
    }

    class moving_avg {
        +int kernel_size
        +AvgPool1d avg
        +forward(x)
    }

    class DataEmbedding_wo_pos {
        +TokenEmbedding value_embedding
        +TemporalEmbedding|TimeFeatureEmbedding temporal_embedding
        +Dropout dropout
        +forward(x, x_mark)
        +__init__(c_in, d_model, embed_type, freq, dropout)
    }

    class TokenEmbedding {
        +Conv1d tokenConv
        +forward(x)
    }

    class TemporalEmbedding {
        +Embedding minute_embed
        +Embedding hour_embed
        +Embedding weekday_embed
        +Embedding day_embed
        +Embedding month_embed
        +forward(x)
    }

    class TimeFeatureEmbedding {
        +Linear embed
        +forward(x)
    }

    class Encoder {
        +List~EncoderLayer~ layers
        +my_Layernorm norm_layer
        +forward(x, attn_mask)
    }

    class EncoderLayer {
        +AutoCorrelationLayer attention
        +Conv1d conv1
        +Conv1d conv2
        +series_decomp decomp1
        +series_decomp decomp2
        +Dropout dropout
        +activation
        +forward(x, attn_mask)
    }

    class AutoCorrelationLayer {
        +AutoCorrelation attention
        +Linear query_projection
        +Linear key_projection
        +Linear value_projection
        +Linear out_projection
        +forward(queries, keys, values, attn_mask)
    }

    class AutoCorrelation {
        +bool mask_flag
        +int factor
        +float scale
        +Dropout dropout
        +bool output_attention
        +time_delay_agg_training(values, corr)
        +time_delay_agg_inference(values, corr)
        +forward(queries, keys, values, attn_mask)
    }

    class Decoder {
        +List~DecoderLayer~ layers
        +my_Layernorm norm_layer
        +Linear projection
        +forward(x, enc_out, x_mask, cross_mask, trend)
    }

    class DecoderLayer {
        +AutoCorrelationLayer self_attention
        +AutoCorrelationLayer cross_attention
        +Conv1d conv1
        +Conv1d conv2
        +series_decomp decomp1
        +series_decomp decomp2
        +series_decomp decomp3
        +Dropout dropout
        +activation
        +forward(x, enc_out, x_mask, cross_mask, trend)
    }

    %% Modelä¸­çç»ä»¶å®ä¾åå³ç³»
    Model *-- "1" series_decomp : åå»ºdecomp
    Model *-- "1" DataEmbedding_wo_pos : åå»ºenc_embedding
    Model *-- "1" DataEmbedding_wo_pos : åå»ºdec_embedding
    Model *-- "1" Encoder : åå»ºencoder
    Model *-- "1" Decoder : åå»ºdecoder

    %% DataEmbedding_wo_posåé¨ç»ä»¶
    DataEmbedding_wo_pos *-- "1" TokenEmbedding : åå»ºvalue_embedding
    DataEmbedding_wo_pos *-- "1" TemporalEmbedding : åå»ºtemporal_embedding(å½embed_type!='timeF')
    DataEmbedding_wo_pos *-- "1" TimeFeatureEmbedding : åå»ºtemporal_embedding(å½embed_type='timeF')

    %% å¶ä»ç»ä»¶å³ç³»
    series_decomp *-- "1" moving_avg
    Encoder *-- "e_layers" EncoderLayer
    EncoderLayer *-- "1" AutoCorrelationLayer
    EncoderLayer *-- "2" series_decomp : decomp1,decomp2
    AutoCorrelationLayer *-- "1" AutoCorrelation
    Decoder *-- "d_layers" DecoderLayer
    DecoderLayer *-- "2" AutoCorrelationLayer : selfåcrossæ³¨æå
    DecoderLayer *-- "3" series_decomp : decomp1,2,3
</code></pre>
<h2 id="_15"><span id="éå½">éå½</span><a class="headerlink" href="#_15" title="Permanent link">Â¶</a></h2>
<p>åå§ Transformer æ¶æ</p>
<p><a href="#åå§ Transformer æ¶æ">è¿å æ­£æä½ç½®ï¼åå§ Transformer æ¶æ</a> </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320213456149.png"><img alt="image-20250320213456149" src="../images/image-20250320213456149.png"/></a></p>
<ul>
<li><code>d_model</code> æ¯åµå¥ç»´åº¦ï¼ä¹å°±æ¯ Embedding dimï¼D æ¯åä¸ªæ¶é´æ­¥è§å¯çç¹å¾æ°ã</li>
<li>å¾å° Embeddingdim çæä½ï¼NLP ä¸­ä¸è¬å« word embeddingï¼è¿éå« tokenEmbeddingä¹è¿æºåççï¼åä¸ªæ¶é´æ­¥å°±æ¯åä¸ª tokenã</li>
</ul>
<h3 id="conv2">çé®ä¸ <a href="#ä¸ºä»ä¹Conv2ä¹åæ²¡æè¿è¡æ¿æ´»å½æ°çåºç¨">ä¸ºä»ä¹Conv2ä¹åæ²¡æè¿è¡æ¿æ´»å½æ°çåºç¨</a><a class="headerlink" href="#conv2" title="Permanent link">Â¶</a></h3>
<p>ï¼1ï¼éµå¾ªåå§Transformerçè®¾è®¡æ¨¡å¼ï¼å¨åå§Transformerè®¾è®¡ä¸­ï¼FFNçç»æä¸ºï¼<code>FFN(x) = max(0, xWâ + bâ)Wâ + bâ</code>ï¼è¿ç¸å½äºä¸¤ä¸ªçº¿æ§åæ¢ï¼ä¸­é´æä¸ä¸ªReLUæ¿æ´»å½æ°ãç¬¬ä¸ä¸ªçº¿æ§åæ¢ååºç¨æ¿æ´»å½æ°ï¼èç¬¬äºä¸ªçº¿æ§åæ¢åä¸åºç¨æ¿æ´»å½æ°ãAutoformerä½¿ç¨1Då·ç§¯æ¿ä»£çº¿æ§åæ¢ï¼ä½ä¿æäºç¸åçæ¿æ´»å½æ°æ¨¡å¼ã</p>
<p>ï¼2ï¼ä¿æè¾åºççº¿æ§ç¹æ§ï¼æåä¸å±ä¸ä½¿ç¨æ¿æ´»å½æ°å¯ä»¥ä¿æè¾åºççº¿æ§ç¹æ§ï¼è¿å¯¹äºæ¶é´åºåé¢æµå°¤å¶éè¦ãå¦æå¨ç¬¬äºä¸ªå·ç§¯å±ååºç¨æ¿æ´»å½æ°ï¼</p>
<ul>
<li>å¯¹äºReLUï¼ä¼å¯¼è´è´å¼è¢«æªæ­ä¸ºé¶ï¼éå¶æ¨¡åè¡¨è¾¾è´åè¶å¿çè½å</li>
<li>å¯¹äºå¶ä»æ¿æ´»å½æ°ï¼ä¼å¼å¥éçº¿æ§åæ¢ï¼å¯è½éå¶æ¨¡åå¯¹çº¿æ§è¶å¿çå»ºæ¨¡è½å</li>
<li>å¨æ¶é´åºåå»ºæ¨¡ä¸­ï¼ä¿æä¸å®ççº¿æ§ç¹æ§å¾éè¦ï¼å ä¸ºè®¸å¤æ¶é´åºååå«å¼ºçº¿æ§è¶å¿ãæåä¸å±ä¸ä½¿ç¨æ¿æ´»å½æ°ï¼å¯ä»¥ä½¿æ¨¡åæ´å¥½å°ææè¿äºçº¿æ§è¶å¿ã</li>
</ul>
<p>ï¼3ï¼æ»ä¹ï¼<strong>ç¬¬ä¸ä¸ªå·ç§¯å±åæ¿æ´»å½æ°**è´è´£ææéçº¿æ§ç¹å¾ï¼**ç¬¬äºä¸ªå·ç§¯å±æ²¡ææ¿æ´»å½æ°</strong>ï¼ä¿æäºä¸å®ççº¿æ§æ å°è½åï¼è¿ç§è®¾è®¡å¨éçº¿æ§è¡¨è¾¾è½ååä¿æçº¿æ§ç¹æ§ä¹é´åå¾äºå¹³è¡¡</p>
<h3 id="2-conv1d-nnlinear">çé® 2 ä¸ºä»ä¹æ¯ conv1dï¼èä¸æ¯ nn.Linear<a class="headerlink" href="#2-conv1d-nnlinear" title="Permanent link">Â¶</a></h3>
<ul>
<li>é¦åï¼å¿é¡»æç¡®çæ¯ï¼ä½¿ç¨nn.Linear <strong>ä¸æ¯</strong> ä¸ºæ¯ä¸ªæ¶é´æ­¥åå»ºåç¬çå¨è¿æ¥å±ï¼èæ¯å¯¹æææ¶é´æ­¥åºç¨ç¸åçæéï¼æéå±äº«ï¼ã</li>
</ul>
<p><mark>ä¾å­ï¼</mark> </p>
<p><u>æ¹å¼1ï¼åºç¨äºæ´ä¸ªåºåï¼æ¹éå¤çæææ¶é´æ­¥ï¼</u> </p>
<p>åè®¾è¾å¥xå½¢ç¶ä¸º[B, L, D]</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1"></a><a href="#__codelineno-56-1"><span class="linenos" data-linenos="1 "></span></a>linear_layer = nn.Linear(D, D_out)
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2"></a><a href="#__codelineno-56-2"><span class="linenos" data-linenos="2 "></span></a>output = linear_layer(x)  # è¾åºå½¢ç¶ä¸º[B, L, D_out]
</span></code></pre></div>
<p><strong>åä¸ä¸ªçº¿æ§å±ä¼åºç¨å°æææ¶é´æ­¥ï¼æéæ¯å±äº«çãè¿ä¸kernel_size=1çConv1Déå¸¸ç¸ä¼¼</strong> </p>
<ul>
<li>kernel_size=1çConv1Då¨åè½ä¸ç±»ä¼¼äºç¬ç«åºç¨äºæ¯ä¸ªæ¶é´æ­¥çå¨è¿æ¥å±ï¼ä½å®æä¸ä¸ªå³é®åºå«ï¼æéå±äº«ãä½¿ç¨å·ç§¯æå³çåä¸ç»æéåºç¨äºæææ¶é´æ­¥</li>
</ul>
<p><u>æ¹å¼2ï¼å¾ªç¯åºç¨äºæ¯ä¸ªæ¶é´æ­¥</u> </p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1"></a><a href="#__codelineno-57-1"><span class="linenos" data-linenos="1 "></span></a># åè®¾è¾å¥xå½¢ç¶ä¸º[B, L, D]
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2"></a><a href="#__codelineno-57-2"><span class="linenos" data-linenos="2 "></span></a>linear_layer = nn.Linear(D, D_out)
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3"></a><a href="#__codelineno-57-3"><span class="linenos" data-linenos="3 "></span></a>outputs = []
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4"></a><a href="#__codelineno-57-4"><span class="linenos" data-linenos="4 "></span></a>for i in range(L):
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5"></a><a href="#__codelineno-57-5"><span class="linenos" data-linenos="5 "></span></a>    output_step = linear_layer(x[:, i, :])  # è¾åºå½¢ç¶ä¸º[B, D_out]
</span><span id="__span-57-6"><a id="__codelineno-57-6" name="__codelineno-57-6"></a><a href="#__codelineno-57-6"><span class="linenos" data-linenos="6 "></span></a>    outputs.append(output_step)
</span><span id="__span-57-7"><a id="__codelineno-57-7" name="__codelineno-57-7"></a><a href="#__codelineno-57-7"><span class="linenos" data-linenos="7 "></span></a>output = torch.stack(outputs, dim=1)  # è¾åºå½¢ç¶ä¸º[B, L, D_out]
</span></code></pre></div>
<p>è¿ç§æ¹å¼ä¹æ¯ä½¿ç¨åä¸ä¸ªçº¿æ§å±ï¼æéä»ç¶æ¯å±äº«çã</p>
<p>å¶å®è¿ä¸ªçé®çåç­å¶å®ä¹æ¯å¤§å¯ä¸å¿çãççå°±è¡äºï¼æ³ççæç½ä¸å¤§å¯è½ã</p>
<p><strong>å¨Autoformerä¸­ä½¿ç¨kernel_size=1çConv1Dæ¶ï¼å®å¨åè½ä¸ä¸æ¹å¼1ä¸­çnn.Linearéå¸¸ç¸ä¼¼ï¼ä¸»è¦åºå«å¨äºï¼</strong> </p>
<ol>
<li><strong>ç»´åº¦é¡ºåº</strong>ï¼
   - Conv1Dææè¾å¥å½¢ç¶ä¸º<code>[B, C, L]</code>ï¼æ¹æ¬¡å¤§å°ãééæ°ãåºåé¿åº¦ï¼
   - Linearææè¾å¥å½¢ç¶ä¸º<code>[B, L, D]</code>ï¼æ¹æ¬¡å¤§å°ãåºåé¿åº¦ãç¹å¾ç»´åº¦ï¼</li>
<li><strong>å®ç°æç</strong>ï¼
   - Conv1Då¨GPUä¸å¯¹äºåºåæ°æ®ææ´ä¼åçå®ç°
   - ä½¿ç¨Conv1Då¯ä»¥é¿åreshapeæä½æå¾ªç¯å¤çæ¶é´æ­¥</li>
<li><strong>æ¡æ¶è®¾è®¡</strong>ï¼
   - ä½¿ç¨Conv1Dä¸Autoformerçæ´ä½æ¶æè®¾è®¡æ´ä¸è´
   - Conv1Dæä¾äºæ©å±å°æ´å¤§kernel_sizeçå¯è½æ§</li>
</ol>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320225707561.png"><img alt="image-20250320225707561" src="../images/image-20250320225707561.png"/></a> </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320225721285.png"><img alt="image-20250320225721285" src="../images/image-20250320225721285.png"/></a></p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320225730620.png"><img alt="image-20250320225730620" src="../images/image-20250320225730620.png"/></a> </p>
<h3 id="_16">åºååè§£çç°å®æä¹<a class="headerlink" href="#_16" title="Permanent link">Â¶</a></h3>
<p><strong>Autoformerä¸­åºååè§£çç¹æ®æ§ä¸æä¹</strong> </p>
<p>Autoformerä¸­çåºååè§£ï¼series_decompï¼æ¯è¯¥æ¨¡åæå·åæ°æ§çç¹ç¹ä¹ä¸ï¼å®æ·±å»ä½ç°äºæ¶é´åºåæ°æ®å¤ççç¹æ®éæ±ãè®©æè¯¦ç»è§£æè¿ä¸è®¾è®¡çæä¹ï¼</p>
<p>ð¢ <strong><u>æ¶é´åºåçåºæ¬ç»æé¨å</u></strong> </p>
<p>é¦åï¼æ¶é´åºåæ°æ®éå¸¸å¯ä»¥åè§£ä¸ºä¸ä¸ªåºæ¬ç»æé¨åï¼
- <strong>è¶å¿ï¼Trendï¼</strong>ï¼é¿æçååæ¹åï¼å¦ç»æµå¢é¿çæ»ä½è¶å¿
- <strong>å­£èæ§ï¼Seasonalityï¼</strong>ï¼å¨ææ§çååæ¨¡å¼ï¼å¦æ¯å¹´çå­£èæ§éå®åå
- <strong>æ®å·®ï¼Residualï¼</strong>ï¼éæºæ³¢å¨æåªå£°</p>
<p>ä¼ ç»æ¶é´åºååææ¹æ³ï¼å¦ARIMAãææ°å¹³æ»æ³ï¼éå¸¸ä¼ååè§£æ¶é´åºåï¼ååå«å»ºæ¨¡ã</p>
<p><strong><u>ð¢ Autoformerçåºååè§£æºå¶</u></strong></p>
<p>Autoformeréè¿<code>series_decomp</code>å°è¾å¥åºååè§£ä¸ºå­£èæ§åè¶å¿ä¸¤ä¸ªé¨åï¼</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1"></a><a href="#__codelineno-58-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">res</span><span class="p">,</span> <span class="n">moving_mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decomp1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></code></pre></div>
<p>è¿éï¼
- <code>res</code> æ¯å­£èæ§é¨åï¼ç­æå¨ææ§ååï¼
- <code>moving_mean</code> æ¯è¶å¿é¨åï¼é¿ææ¹åæ§ååï¼</p>
<p>å³é®ç¹æ¯ï¼<strong>Autoformerå¨å¤ä¸ªä½ç½®ä½¿ç¨åºååè§£ï¼å¹¶æéæ©å°ä¸¢å¼è¶å¿é¨å</strong>ãä¾å¦ï¼</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1"></a><a href="#__codelineno-59-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># å°æ®å·®è¿æ¥ç»æåè§£ï¼ä»ä¿çå­£èæ§é¨å</span>
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2"></a><a href="#__codelineno-59-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">res</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decomp2</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>
</span></code></pre></div>
<p><u>ð¢  <strong>è¿ç§è®¾è®¡çæ·±å±æä¹</strong></u> </p>
<p>ï¼1ï¼åç¦»ä¸åæ¶é´å°ºåº¦çæ¨¡å¼</p>
<p>è¶å¿åå­£èæ§ä»£è¡¨ä¸åæ¶é´å°ºåº¦çååæ¨¡å¼ï¼
- è¶å¿åæ é¿æååï¼ä½é¢ä¿¡å·ï¼
- å­£èæ§åæ ç­æå¨æååï¼é«é¢ä¿¡å·ï¼</p>
<p>éè¿åç¦»è¿ä¸¤ç§æ¨¡å¼ï¼Autoformerå¯ä»¥ï¼
- è®©èªæ³¨æåæºå¶ä¸æ³¨äºæè·å­£èæ§æ¨¡å¼ï¼è¿æ´éåå¶æé¿æè·çå±é¨ä¾èµå³ç³»
- åç¬å¤çè¶å¿é¨åï¼é¿åæ··åä¸åé¢ççä¿¡å·å¯¼è´çå»ºæ¨¡å°é¾</p>
<p><strong>ï¼2ï¼æ¸è¿å¼åè§£æ¶æ</strong> </p>
<p>Autoformeréç¨"æ¸è¿å¼åè§£"ï¼Progressive Decompositionï¼æ¶æï¼
- æ¯ä¸å±é½è¿è¡åºååè§£ï¼éæ­¥æåå­£èæ§ç¹å¾
- éè¿ä¸¢å¼ä¸­é´å±çè¶å¿ä¿¡æ¯ï¼å¼ºå¶æ¨¡åå³æ³¨å­£èæ§æ¨¡å¼
- å¨è§£ç å¨ä¸­ï¼åå«ç´¯ç§¯åå±çè¶å¿ä¿¡æ¯ï¼å½¢ææç»è¶å¿é¢æµ</p>
<p>è¿ç§æ¶æè§£å³äºä¼ ç»Transformerå¨é¿åºåé¢æµä¸­çç¶é¢ï¼
- ä¼ ç»Transformerå¨é¿æé¢æµä¸­å¾å¾å­å¨"é¿æé¢æµåå·®ç§¯ç´¯"é®é¢
- åç¦»è¶å¿åå­£èæ§å¯ä»¥åè½»è¿ç§åå·®ç§¯ç´¯</p>
<p><strong>ï¼3ï¼å¢å¼ºå­£èæ§åå¨ææ§æ¨¡å¼çå­¦ä¹ </strong> </p>
<p>æ¶é´åºåä¸­çå­£èæ§æ¨¡å¼ï¼å¦æ¯æ¥ãæ¯å¨ãæ¯æææ¯å¹´çå¨ææ§ï¼æ¯é¢æµçéè¦ä¾æ®ãéè¿ä¿çå­£èæ§é¨åï¼
- æ¨¡åå¯ä»¥æ´å¥½å°ææè¿äºéå¤åºç°çæ¨¡å¼
- å¢å¼ºäºå¯¹å¨ææ§è¡ä¸ºçè¯å«è½å
- éä½äºè¶å¿ååå¯¹å­£èæ§æ¨¡å¼è¯å«çå¹²æ°</p>
<p>ð¢ <u><strong>å·¥ç¨å®ç°çå·§å¦ä¹å¤</strong></u> </p>
<p>ä»ä»£ç å®ç°çï¼Autoformerçåºååè§£éç¨ç®åèææçç§»å¨å¹³åæ¹æ³ï¼
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1"></a><a href="#__codelineno-60-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># è®¡ç®ç§»å¨å¹³åï¼æååºåè¶å¿åé</span>
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2"></a><a href="#__codelineno-60-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">moving_mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moving_avg</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3"></a><a href="#__codelineno-60-3"><span class="linenos" data-linenos="3 "></span></a><span class="c1"># éè¿åå§åºååå»è¶å¿åéï¼å¾å°æ®å·®(å­£èæ§åé)</span>
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4"></a><a href="#__codelineno-60-4"><span class="linenos" data-linenos="4 "></span></a><span class="n">res</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">moving_mean</span>
</span></code></pre></div></p>
<p>è¿ä¸ç®åæä½å¨è®¡ç®æçä¸ææä¹é´åå¾äºå¾å¥½çå¹³è¡¡ï¼
- è®¡ç®å¼éä½ï¼éåå¤çé¿åºå
- æææ¾èï¼è½ææåç¦»ä¸åé¢ççä¿¡å·</p>
<p><u><strong>ð¢ ä¸ä¼ ç»Transformerçå³é®åºå«</strong></u> </p>
<p>å¨ä¼ ç»Transformerä¸­ï¼æ®å·®è¿æ¥ç´æ¥å°åå§è¾å¥åå¤çåçè¾åºç¸å ï¼
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1"></a><a href="#__codelineno-61-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="n">new_x</span><span class="p">)</span>  <span class="c1"># ä¼ ç»Transformer</span>
</span></code></pre></div></p>
<p>èAutoformerå¨ç¸å åè¿è¿è¡äºåºååè§£ï¼
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1"></a><a href="#__codelineno-62-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="n">new_x</span><span class="p">)</span>
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2"></a><a href="#__codelineno-62-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">x</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decomp1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># Autoformerçç¹æ®å¤ç</span>
</span></code></pre></div></p>
<p>ä»¥åå¨åé¦ç½ç»åï¼
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1"></a><a href="#__codelineno-63-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">res</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decomp2</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>  <span class="c1"># ä¼ ç»Transformeråªæ x = x + y</span>
</span></code></pre></div></p>
<p>è¿ä¸åæ°è®¾è®¡ä»æ ¹æ¬ä¸æ¹åäºä¿¡æ¯å¨ç½ç»ä¸­çæµå¨æ¹å¼ï¼ä½¿æ¨¡åæ´éåæ¶é´åºåé¢æµä»»å¡ã</p>
<p><strong>ð¢ å®éåºç¨æä¹</strong> </p>
<p>å¨å®éåºç¨ä¸­ï¼è¿ç§åºååè§£æºå¶å¸¦æ¥çå¥½å¤åæ¬ï¼</p>
<ol>
<li><strong>æé«é¿æé¢æµåç¡®æ§</strong>ï¼éè¿åç¦»è¶å¿åå­£èæ§ï¼åå°é¿æé¢æµä¸­çè¯¯å·®ç§¯ç´¯</li>
<li><strong>å¢å¼ºå¯è§£éæ§</strong>ï¼åè§£åçè¶å¿åå­£èæ§ç»ä»¶æ´å®¹æçè§£åè§£é</li>
<li><strong>æ´å¥½çæ³åè½å</strong>ï¼å­¦ä¹ å°çå­£èæ§æ¨¡å¼å¯ä»¥æ´å¥½å°æ³åå°æ°çæ¶é´æ®µ</li>
<li><strong>åè½»æ°æ®é¢å¤çè´æ</strong>ï¼æ¨¡ååç½®çåè§£æºå¶åå°äºæ°æ®é¢å¤ççéæ±</li>
</ol>
<p><strong>ð¢ ç»è®º</strong> </p>
<p>Autoformerä¸­çåºååè§£ä¸ä»æ¯ä¸ä¸ªææ¯ç»èï¼èæ¯ä¸ä¸ªä½ç°æ¶é´åºåæ°æ®æ¬è´¨ç¹æ§çå³é®è®¾è®¡ãå®ä½¿Autoformerè½å¤ææåºååå¤çä¸åé¢ççä¿¡å·ï¼æé«é¿æé¢æµè½åï¼å¹¶å¢å¼ºæ¨¡åçå¯è§£éæ§ãè¿ä¸è®¾è®¡ååå±ç¤ºäºå¦ä½å°é¢åç¥è¯ï¼æ¶é´åºååæï¼ä¸æ·±åº¦å­¦ä¹ æ¶æï¼Transformerï¼ææºç»åï¼åé åºæ´éåç¹å®ä»»å¡çæ¨¡åæ¶æã</p>
<h3 id="_17"><a href="#è¿åçè§£å¤å¤´æ³¨æåæºå¶"><span id="è·³å°çè§£å¤å¤´æ³¨æåæºå¶">çè§£å¤å¤´æ³¨æåæºå¶</span></a><a class="headerlink" href="#_17" title="Permanent link">Â¶</a></h3>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321174539839.png"><img alt="image-20250321174539839" src="../images/image-20250321174539839.png"/></a> </p>
<h3 id="k-v-q"><a href="#è¿åç¼ç å¨çè¾åºä½ä¸º K å Vï¼è§£ç å¨çè¾å¥ä½ä¸º Q"><span id="ç¼ç å¨çè¾åºä½ä¸º K å Vï¼è§£ç å¨çè¾å¥ä½ä¸º Q">ç¼ç å¨çè¾åºä½ä¸º K å Vï¼è§£ç å¨çè¾å¥ä½ä¸º Q</span></a><a class="headerlink" href="#k-v-q" title="Permanent link">Â¶</a></h3>
<p>ð¢ æ³¨æåæºå¶æ¬è´¨ä¸æ¯ä¸ç§è½¯æ£ç´¢ç³»ç»ï¼</p>
<ul>
<li>Queryï¼æ¥è¯¢ï¼ï¼è¡¨è¾¾å½åè§£ç ä½ç½®éè¦çä¿¡æ¯ç±»å</li>
<li>Keyï¼é®ï¼ï¼è¡¨ç¤ºæºåºåä¸­åä½ç½®ä¿¡æ¯ç"ç´¢å¼"</li>
<li>Valueï¼å¼ï¼ï¼è¡¨ç¤ºæºåºåä¸­åä½ç½®çå®éåå®¹</li>
</ul>
<p>è§£ç å¨éè¿å¶éèç¶æå½¢ææ¥è¯¢ï¼Qï¼ï¼ç¶åæ ¹æ®ä¸ç¼ç å¨éèç¶æï¼Kï¼çç¸å³æ§ï¼æåç¸åºçç¼ç å¨ä¿¡æ¯ï¼Vï¼ã</p>
<p>ð¢ å¨åºåå°åºåå­¦ä¹ ä¸­ï¼äº¤åæ³¨æåå®ç°äºæ¡ä»¶çæï¼</p>
<p>ç¼ç å¨ï¼è´è´£çè§£è¾å¥åºåï¼å¦æºè¯­è¨ææ¬æåå²æ¶é´åºåï¼</p>
<p>è§£ç å¨ï¼è´è´£åºäºè¾å¥åºåçæè¾åºåºåï¼å¦ç®æ è¯­è¨ææ¬ææªæ¥æ¶é´åºåï¼</p>
<p>è§£ç å¨éè¦"ææ¡ä»¶å°"çæè¾åºï¼è¿ä¸ªæ¡ä»¶å°±æ¯ç¼ç å¨å¤ççè¾å¥åºåï¼äº¤åæ³¨æåæä¾äºè¿ç§æ¡ä»¶æºå¶ã</p>
<p>ð¢ å¨Autoformerè¿æ ·çæ¶é´åºåé¢æµæ¨¡åä¸­ï¼è¿ç§è®¾è®¡æå¶ç¹æ®æä¹ï¼</p>
<p>ç¼ç å¨ï¼å¤çåå²æ¶é´åºåï¼æåå³é®æ¨¡å¼åç¹å¾</p>
<p>è§£ç å¨ï¼åºäºè¿äºæ¨¡å¼çææªæ¥æ¶é´åºå</p>
<p>äº¤åæ³¨æåè®©è§£ç å¨è½å¤å¨çææ¯ä¸ªæªæ¥æ¶é´æ­¥æ¶ï¼éæ©æ§å°å³æ³¨åå²åºåä¸­çç¸å³æ¨¡å¼ï¼å°¤å¶æ¯é£äºä¸å½åé¢æµä½ç½®ç¸å³çå­£èæ§æå¨ææ§æ¨¡å¼ã</p>
<h3 id="_18"><a href="#è¿åå¾ªç¯å¡«å"><span id="å¾ªç¯å¡«å">å¾ªç¯å¡«å</span></a><a class="headerlink" href="#_18" title="Permanent link">Â¶</a></h3>
<p>éç¨ï¼ç¹å«éåå¤çå·æå¨ææ§ç¹å¾çæ¶é´åºåæ°æ®</p>
<p>æ¬æä½¿ç¨å¾ªç¯å¡«åçä½ç½®ï¼å¯¹è¶å¿æåè¿ååå§ç»´åº¦çæ¶åï¼</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1"></a><a href="#__codelineno-64-1"><span class="linenos" data-linenos="1 "></span></a><span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv1d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="n">d_model</span><span class="p">,</span> 
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2"></a><a href="#__codelineno-64-2"><span class="linenos" data-linenos="2 "></span></a>                            <span class="n">out_channels</span><span class="o">=</span><span class="n">c_out</span><span class="p">,</span> 
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3"></a><a href="#__codelineno-64-3"><span class="linenos" data-linenos="3 "></span></a>                            <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> 
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4"></a><a href="#__codelineno-64-4"><span class="linenos" data-linenos="4 "></span></a>                            <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5"></a><a href="#__codelineno-64-5"><span class="linenos" data-linenos="5 "></span></a>                            <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
</span><span id="__span-64-6"><a id="__codelineno-64-6" name="__codelineno-64-6"></a><a href="#__codelineno-64-6"><span class="linenos" data-linenos="6 "></span></a>                            <span class="n">padding_mode</span><span class="o">=</span><span class="s1">'circular'</span><span class="p">,</span> 
</span><span id="__span-64-7"><a id="__codelineno-64-7" name="__codelineno-64-7"></a><a href="#__codelineno-64-7"><span class="linenos" data-linenos="7 "></span></a>                            <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></code></pre></div>
<p>åºåå ç§å¡«åæ¹å¼</p>
<p>ãä¸»è¦è§å¯ï¼<mark>a,b,c,dçå·¦å³</mark> ã</p>
<p>ï¼1ï¼0 å¡«åï¼é¶å¡«åï¼é»è®¤ï¼'zeros'ï¼ï¼ç¨0å¼å¡«ååºåè¾¹ç</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1"></a><a href="#__codelineno-65-1"><span class="linenos" data-linenos="1 "></span></a>ååºå: [a, b, c, d]
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2"></a><a href="#__codelineno-65-2"><span class="linenos" data-linenos="2 "></span></a>å¡«åå: [0, 0, a, b, c, d, 0, 0]
</span></code></pre></div>
<p>ï¼2ï¼éå¤å¡«åï¼éå¤å¡«åï¼'replicate'ï¼ï¼å¤å¶è¾¹çå¼</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1"></a><a href="#__codelineno-66-1"><span class="linenos" data-linenos="1 "></span></a>ååºå: [a, b, c, d]
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2"></a><a href="#__codelineno-66-2"><span class="linenos" data-linenos="2 "></span></a>å¡«åå: [a, a, a, b, c, d, d, d]
</span></code></pre></div>
<p>(3)å¾ªç¯å¡«åï¼'circular'ï¼ï¼å°åºåè§ä¸ºå¾ªç¯ç»æ</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1"></a><a href="#__codelineno-67-1"><span class="linenos" data-linenos="1 "></span></a>ååºå: [a, b, c, d]
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2"></a><a href="#__codelineno-67-2"><span class="linenos" data-linenos="2 "></span></a>å¡«åå: [c, d, a, b, c, d, a, b]
</span></code></pre></div>
<p><mark>ä¸ºä»ä¹åºåå¡«åï¼ä½¿ç¨æ¶é´åºå</mark></p>
<p>å°æ¶é´åºåè§ä¸ºä¸ä¸ªå¾ªç¯ï¼åºåæ«å°¾è¿æ¥å°åºåå¼å¤´ï¼ä¿ææ¶é´æ°æ®çå¨ææ§ç¹æ§ï¼ä¸å¼å¥äººä¸ºçå¼ï¼åªä½¿ç¨å·²ææ°æ®</p>
<p><strong>æ¶é´åºåå¨ææ§çæè¿°ï¼</strong></p>
<ul>
<li>å¹´åº¦å¨æï¼æ¯å¹´åä¸æ¶é´ç¹çæ°æ®å¯è½æç¸ä¼¼æ¨¡å¼</li>
<li>æåº¦å¨æï¼æ¯æå¯è½æç¸ä¼¼çæ¨¡å¼ï¼å¦æåãæä¸­ãææ«ï¼</li>
<li>å¨åº¦å¨æï¼æ¯å¨çå·¥ä½æ¥åå¨æ«æ¨¡å¼å¾å¾ç±»ä¼¼</li>
<li>æ¥åå¨æï¼æ¯å¤©åçæ´»å¨æ¨¡å¼ï¼å¦æ©é«å³°ãåä¼æ¶é´ï¼</li>
</ul>
<p>ä¾å­ï¼</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1"></a><a href="#__codelineno-68-1"><span class="linenos" data-linenos="1 "></span></a>[å¨ä¸, å¨äº, å¨ä¸, å¨å, å¨äº, å¨å­, å¨æ¥]
</span></code></pre></div>
<p><strong>å¾ªç¯å¡«åä»¥åï¼</strong> </p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1"></a><a href="#__codelineno-69-1"><span class="linenos" data-linenos="1 "></span></a>è¾¹çå¤çåï¼[å¨å­, å¨æ¥, å¨ä¸, å¨äº, ..., å¨æ¥, å¨ä¸, å¨äº]
</span></code></pre></div>
<p>PyTorchä¸­çå¾ªç¯å¡«åå®ç°ä¼å°åºåè§ä¸ºç¯å½¢ç»æï¼</p>
<ul>
<li>å¯¹äºéè¦å¨å·¦ä¾§å¡«åçé¨åï¼ä»åºåå³ç«¯åå¼</li>
<li>å¯¹äºéè¦å¨å³ä¾§å¡«åçé¨åï¼ä»åºåå·¦ç«¯åå¼</li>
</ul>
<h3 id="_19"><a href="#è¿åä¸ºä»ä¹å­£èæååè¶å¿æå">ä¸ºä»ä¹å­£èæååè¶å¿æåä¸åçè¿åç»´åº¦æ¹æ³</a> <a id="è·³å°ä¸ºä»ä¹å­£èæååè¶å¿æå"></a><a class="headerlink" href="#_19" title="Permanent link">Â¶</a></h3>
<p><strong>é¦åï¼æç¡®ï¼å­£èæå ä½¿ç¨çº¿æ§å±æå½±</strong> </p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1"></a><a href="#__codelineno-70-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># Decoderç±»ä¸­çæå½±</span>
</span><span id="__span-70-2"><a id="__codelineno-70-2" name="__codelineno-70-2"></a><a href="#__codelineno-70-2"><span class="linenos" data-linenos="2 "></span></a><span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">=</span> <span class="n">projection</span>  <span class="c1"># éå¸¸æ¯nn.Linear(d_model, c_out)</span>
</span><span id="__span-70-3"><a id="__codelineno-70-3" name="__codelineno-70-3"></a><a href="#__codelineno-70-3"><span class="linenos" data-linenos="3 "></span></a>
</span><span id="__span-70-4"><a id="__codelineno-70-4" name="__codelineno-70-4"></a><a href="#__codelineno-70-4"><span class="linenos" data-linenos="4 "></span></a><span class="c1"># ä½¿ç¨æ¶</span>
</span><span id="__span-70-5"><a id="__codelineno-70-5" name="__codelineno-70-5"></a><a href="#__codelineno-70-5"><span class="linenos" data-linenos="5 "></span></a><span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-70-6"><a id="__codelineno-70-6" name="__codelineno-70-6"></a><a href="#__codelineno-70-6"><span class="linenos" data-linenos="6 "></span></a>    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># x: [B, L, d_model] -&gt; [B, L, c_out]</span>
</span></code></pre></div>
<p><strong>è¶å¿æåï¼ä½¿ç¨å·ç§¯å±ï¼Conv1dï¼è¿è¡æå½±</strong></p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1"></a><a href="#__codelineno-71-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># DecoderLayerç±»ä¸­çæå½±</span>
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2"></a><a href="#__codelineno-71-2"><span class="linenos" data-linenos="2 "></span></a><span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv1d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="n">d_model</span><span class="p">,</span> <span class="n">out_channels</span><span class="o">=</span><span class="n">c_out</span><span class="p">,</span> 
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3"></a><a href="#__codelineno-71-3"><span class="linenos" data-linenos="3 "></span></a>                           <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-71-4"><a id="__codelineno-71-4" name="__codelineno-71-4"></a><a href="#__codelineno-71-4"><span class="linenos" data-linenos="4 "></span></a>                           <span class="n">padding_mode</span><span class="o">=</span><span class="s1">'circular'</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-71-5"><a id="__codelineno-71-5" name="__codelineno-71-5"></a><a href="#__codelineno-71-5"><span class="linenos" data-linenos="5 "></span></a>
</span><span id="__span-71-6"><a id="__codelineno-71-6" name="__codelineno-71-6"></a><a href="#__codelineno-71-6"><span class="linenos" data-linenos="6 "></span></a><span class="c1"># ä½¿ç¨æ¶</span>
</span><span id="__span-71-7"><a id="__codelineno-71-7" name="__codelineno-71-7"></a><a href="#__codelineno-71-7"><span class="linenos" data-linenos="7 "></span></a><span class="n">residual_trend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">(</span><span class="n">residual_trend</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></code></pre></div>
<p>ðµ è§£éè¿ä¹è®¾è®¡ççç±ï¼</p>
<p>å­£èæåä½ä¸ºé«é¢æåï¼<mark>ä¸ä¼å¹³æ»æ¶é´åºåï¼ä¿çäºå­£èæ§çå°éåå</mark></p>
<p>è¶å¿æåä½ä¸ºä½é¢æåï¼è¶å¿æ¬è´¨ä¸æ¯==å¹³æ»==ç</p>
<ul>
<li>è®¾ç½® <strong>kernel size = 3</strong>ï¼èèäºå±é¨ä¸ä¸ææå©äºç»´æè¿ç§å¹³æ»æ§</li>
<li>å·ç§¯æä½ï¼ç¹å«æ¯kernel_size=3ï¼è½å¤å¹³æ»è¶å¿ï¼è¿æ»¤æä¸å¿è¦çé«é¢æ°å¨</li>
<li>ï¼åæ°å±äº«ï¼è·¨ä¸åæ¶é´ç¹çç¸åæ¨¡å¼å¯ä»¥è¢«ç¸åçå·ç§¯æ ¸è¯å«</li>
</ul>
<div class="document-dates-plugin-wrapper"><div class="document-dates-plugin"><span title="åå»ºæ¶é´: 2025-03-17"><span class="material-icons">add_circle</span>2025-03-17 14:44:43</span><span title="æåæ´æ°: 2025-03-22"><span class="material-icons">update</span>2025-03-22 15:47:58</span></div></div>
<div id="__comments"></div>
<!-- <h3>é¢è²ä¸»é¢è°æ´</h3>
    <div class="tx-switch">
    <button class="button1" data-md-color-primary="red" style="background-color:red">red</button>
    <button class="button1" data-md-color-primary="pink" style="background-color:pink;color:black">pink</button>
    <button class="button1" data-md-color-primary="purple" style="background-color:purple">purple</button>
    <button class="button1" data-md-color-primary="indigo" style="background-color:indigo">indigo</button>
    <button class="button1" data-md-color-primary="blue" style="background-color:blue">blue</button>
    <button class="button1" data-md-color-primary="cyan" style="background-color:cyan;color:black">cyan</button>
    <button class="button1" data-md-color-primary="teal" style="background-color:teal">teal</button>
    <button class="button1" data-md-color-primary="green" style="background-color:green">green</button>
    <button class="button1" data-md-color-primary="lime" style="background-color:lime;color:black">lime</button>
    <button class="button1" data-md-color-primary="orange" style="background-color:orange;color:black">orange</button>
    <button class="button1" data-md-color-primary="brown" style="background-color:brown;border-radius=3px">brown</button>
    <button class="button1" data-md-color-primary="grey" style="background-color:grey">grey</button>
    <button class="button1" data-md-color-primary="black" style="background-color:black">black</button>
    <button class="button1" data-md-color-primary="white" style="background-color:white;color:black">white</button>
    </div> -->
<!-- Giscus -->
<script async="" crossorigin="anonymous" data-category="Announcements" data-category-id="DIC_kwDONhXY184ClgKT" data-emit-metadata="0" data-input-position="bottom" data-lang="zh-CN" data-mapping="pathname" data-reactions-enabled="1" data-repo="Auzers/notes" data-repo-id="R_kgDONhXY1w" data-strict="0" data-theme="preferred_color_scheme" src="https://giscus.app/client.js">
</script>
<script>
    var buttons = document.querySelectorAll("button[data-md-color-primary]")
    buttons.forEach(function (button) {
        button.addEventListener("click", function () {
            var attr = this.getAttribute("data-md-color-primary")
            document.body.setAttribute("data-md-color-primary", attr)
            localStorage.setItem("data-md-color-primary", attr);
        })
    })
</script>
<!-- Synchronize Giscus theme with palette -->
<script>
    var giscus = document.querySelector("script[src*=giscus]")
</script>
<script>
    var giscus = document.querySelector("script[src*=giscus]")

    /* Set palette on initial load */
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
        var theme = palette.color.scheme === "slate" ? "dark" : "light"
        giscus.setAttribute("data-theme", theme)
    }

    /* Register event handlers after documented loaded */
    document.addEventListener("DOMContentLoaded", function () {
        var ref = document.querySelector("[data-md-component=palette]")
        ref.addEventListener("change", function () {
            var palette = __md_get("__palette")
            if (palette && typeof palette.color === "object") {
                var theme = palette.color.scheme === "slate" ? "dark" : "light"

                /* Instruct Giscus to change theme */
                var frame = document.querySelector(".giscus-frame")
                frame.contentWindow.postMessage(
                    { giscus: { setConfig: { theme } } },
                    "https://giscus.app"
                )
            }
        })
    })
</script>
</article>
</div>
<script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["content.action.edit", "content.action.view", "toc.follow", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.code.annotate", "content.code.select", "content.tooltips", "content.footnote.tooltips", "content.tabs.link", "header.autohide", "navigation.tabs", "navigation.tracking", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.indexes", "navigation.top", "navigation.path"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
<script src="../../assets/javascripts/katex.js"></script>
<script src="../../assets/javascripts/mathjax.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-chtml.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-chtml-full.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-svg-full.js"></script>
<script src="../../assets/javascripts/tablesort.js"></script>
<script src="../../assets/javascripts/toc.js"></script>
<script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script src="../../mkdocs/javascripts/katex.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/contrib/auto-render.min.js"></script>
<script src="../../assets/javascripts/web-time.js"></script>
<script src="https://cdn.jsdelivr.net/gh/Wcowin/Wcowin.github.io@main/docs/javascripts/extra.js"></script>
<script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
window.mermaidConfig = {default: {
    startOnLoad: false
}};</script><script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script><script>document.addEventListener('DOMContentLoaded', () => {
    let attempts = 0;
    const maxAttempts = 50;

    const waitForNav = setInterval(() => {
        attempts++;
        const nav = document.querySelector('.md-sidebar--secondary .md-nav__list');
        if (!nav) return;

        const navItems = Array.from(nav.querySelectorAll('.md-nav__item'));
        if (navItems.length === 0) {
            if (attempts >= maxAttempts) {
                clearInterval(waitForNav);
                console.error('ç®å½å è½½è¶æ¶');
            }
            return;
        }

        clearInterval(waitForNav);
        console.log('ç®å½é¡¹æ°é:', navItems.length);

        // è·åä¸»åå®¹åºå
        const mainContent = document.querySelector('.md-content__inner');
        if (!mainContent) return;

        // è·åæææ é¢
        const headings = Array.from(mainContent.querySelectorAll('h1, h2, h3, h4, h5, h6'));
        console.log('æ é¢æ°é:', headings.length);

        // æ¶éææåéçº¿ä½ç½®
        const walker = document.createTreeWalker(mainContent, NodeFilter.SHOW_TEXT, {
            acceptNode: (node) => {
                if (!node || !node.textContent) return NodeFilter.FILTER_REJECT;
                if (node.parentElement?.closest('pre, code, .md-nav, script, style')) {
                    return NodeFilter.FILTER_REJECT;
                }
                return NodeFilter.FILTER_ACCEPT;
            }
        }, false);

        const hrPositions = [];
        let node;
        while (node = walker.nextNode()) {
            const text = node.textContent.trim();
            const match = text.match(/^---(.+?)---$/);
            if (match) {
                hrPositions.push({
                    node,
                    content: match[1].trim()
                });
            }
        }

        // å¤çæ¯ä¸ªåéçº¿
        hrPositions.forEach((hrData, index) => {
            // åå»ºåéçº¿
            const hr = document.createElement('hr');
            hr.setAttribute('data-content', hrData.content);
            hr.classList.add('custom-hr');
            hr.id = `hr-${index + 1}`;
            hrData.node.parentNode.replaceChild(hr, hrData.node);

            // åå»ºç®å½é¡¹
            const li = document.createElement('li');
            li.classList.add('md-nav__item', 'hr-nav-item');
            const a = document.createElement('a');
            a.classList.add('md-nav__link');
            a.href = `#hr-${index + 1}`;
            a.textContent = `${hrData.content}`; // ä¿®æ¹è¿éï¼æ·»å ååçç ´æå·
            li.appendChild(a);



            // æ¾å°åéçº¿åçç¬¬ä¸ä¸ªæ é¢
            let nextHeadingIndex = -1;
            for (let i = 0; i < headings.length; i++) {
                const heading = headings[i];
                if (hr.compareDocumentPosition(heading) & Node.DOCUMENT_POSITION_FOLLOWING) {
                    nextHeadingIndex = i;
                    break;
                }
            }

            console.log('åéçº¿:', hrData.content, 'ä¸ä¸ä¸ªæ é¢ç´¢å¼:', nextHeadingIndex);

            if (nextHeadingIndex !== -1) {
                // æ¾å°å¯¹åºçç®å½é¡¹
                const nextHeading = headings[nextHeadingIndex];
                const nextNavItem = navItems.find(item => {
                    const link = item.querySelector('a');
                    const text = link?.textContent?.replace('Â¶', '').trim();
                    return text === nextHeading.textContent.replace('Â¶', '').trim();
                });

                if (nextNavItem) {
                    nav.insertBefore(li, nextNavItem);
                    console.log('æå¥å°æ é¢å:', nextHeading.textContent);
                    return;
                }
            }

            nav.appendChild(li);
            console.log('è¿½å å°æ«å°¾:', hrData.content);
        });
    }, 100);
});</script></body>
</html>