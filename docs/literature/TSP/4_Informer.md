# 2021ã€ Informer

- [ ] ä»£ç ç»“æ„å›¾

![image-20250317120535689](https://cdn.jsdelivr.net/gh/dearRongerr/PicGo@main/202504090905181.png)    

å‚çœ‹ï¼š[æ»‘åŠ¨çª—å£æœºåˆ¶æ¦‚è¿°](https://blog.csdn.net/m0_53881899/article/details/136281557)

## æ¨¡å‹æ¥å—è¾“å…¥



![image-20250304211029241](https://cdn.jsdelivr.net/gh/dearRongerr/PicGo@main/202504090905679.png)

- batch_sizeï¼šbatchä¸­æ ·æœ¬çš„æ•°é‡ï¼Œæ¨¡å‹è®­ç»ƒè¿‡ç¨‹æ¯æ¬¡ä»¥ä¸€ä¸ªbatchä¸ºè¾“å…¥å•ä½æ¥è¿›è¡Œè®­ç»ƒã€‚ 

- seq_lenï¼šEncoderæ¥æ”¶çš„è¾“å…¥åºåˆ—é•¿åº¦ï¼Œä¹Ÿæ˜¯æ»‘åŠ¨çª—å£ä¸­çš„çª—å£é•¿åº¦ã€‚
- label_lenï¼šDecoderå¼€å§‹é˜¶æ®µæ¥æ”¶çš„å·²çŸ¥åºåˆ—çš„é•¿åº¦ï¼ˆå³â€œæ ‡ç­¾â€ç”¨äºå¼•å¯¼è§£ç å™¨çš„é¢„æµ‹ï¼‰ã€‚

- pred_len:Decoderé¢„æµ‹æœªæ¥æ—¶é—´ç‚¹çš„é•¿åº¦ã€‚

 `Informer` åœ¨è®­ç»ƒæ—¶`Encoder`è¾“å…¥çš„æ˜¯`batch_size`ä¸ªå¤§å°çš„**è§„èŒƒæ ·æœ¬**ï¼Œå…¶ä¸­æ¯ä¸ªè§„èŒƒæ ·æœ¬éƒ½æ˜¯é€šè¿‡**æ»‘åŠ¨çª—å£æŠ€æœ¯**ä»åŸå§‹æ•°æ®é›†æ ·æœ¬ä¸­æå–å‡ºæ¥çš„ï¼Œ**æ¯ä¸ªè§„èŒƒæ ·æœ¬éƒ½åŒ…å«`seq_len`ä¸ªæ—¶é—´æ­¥é•¿çš„æ•°æ®ç‚¹**ï¼ˆå³æ¯ä¸ªè§„èŒƒæ ·æœ¬éƒ½åŒ…å«è®­ç»ƒé›†ä¸­`seq_len`è¡Œè¿ç»­æ•°æ®ï¼‰ã€‚



## æ»‘åŠ¨çª—å£

æ»‘åŠ¨çª—å£å®ç°åŸç†ï¼š 

ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ç»„æ—¶é—´åºåˆ—æ•°æ®ï¼Œè¿™äº›æ•°æ®è®°å½•äº†`1000h`çš„æ°”æ¸©ï¼ˆ`1000`è¡Œï¼‰ï¼Œè®¾å®š`seq_len=72`ï¼ˆçª—å£é•¿åº¦ï¼‰ï¼Œ`label_len=48`ï¼Œ`pred_len=24`ï¼Œ`batch_size=12`ã€‚

åˆå§‹ï¼šä»`ç¬¬1h`å¼€å§‹ï¼Œæ”¾ç½®ä¸€ä¸ª`72h`çš„æ»‘åŠ¨çª—å£ï¼Œçª—å£å†…æ ·æœ¬åŒ…å«`ç¬¬1hâ€”72h`æ°”æ¸©ï¼Œè¿™æ—¶`batch`ä¸­çš„ä¸€ä¸ªè§„èŒƒæ ·æœ¬å°±æ˜¯å½“å‰çª—å£å†…çš„`72h`æ ·æœ¬ï¼Œè¯¥è§„èŒƒæ ·æœ¬å¯¹åº”çš„==æ ‡ç­¾==ä¸º25hâ€”72hæ°”æ¸©ï¼Œè¯¥è§„èŒƒæ ·æœ¬å¯¹åº”çš„==é¢„æµ‹æ ·æœ¬==ä¸º`73hâ€”96h`æ°”æ¸©ã€‚


![image-20250304195519180](images/image-20250304195519180.png)

## å…³äº embedding

 EmbeddingåŸç†ï¼š 
Embeddingå¯¹ä½ç»´æ•°æ®è¿›è¡Œå‡ç»´æ—¶ï¼Œä¼šæŠŠä¸€äº›ç‰¹å¾ç»™æ”¾å¤§ï¼Œæˆ–è€…æŠŠç¬¼ç»Ÿçš„ç‰¹å¾ç»™åˆ†å¼€ã€‚

åŸç†å°±æ˜¯çŸ©é˜µä¹˜æ³•ï¼Œå…¶ä¸­è¢«ä¹˜æ•°æ˜¯æ—¶é—´åºåˆ—æ•°æ®ï¼Œä¹˜æ•°æ˜¯åµŒå…¥çŸ©é˜µEmbedding Matrixï¼ŒEmbedding Matrixåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æ ¹æ®åå‘ä¼ æ’­ç®—æ³•å’Œä¼˜åŒ–å™¨è¿›è¡Œæ›´æ–°ï¼Œä½¿å¾—æ—¶é—´åºåˆ—æ•°æ®åœ¨ä¹˜Embedding Matrixåèƒ½æ›´å¥½åœ°æ”¾å¤§å…¶æ•°æ®ä¸­çš„ç‰¹å¾ã€‚

å› æ­¤ï¼Œè¿™ä¸ªEmbeddingå±‚ä¸€ç›´åœ¨å­¦ä¹ ä¼˜åŒ–ï¼Œä½¿å¾—æ•´ä¸ªæ•°æ®å‡ç»´è¿‡ç¨‹æ…¢æ…¢å½¢æˆä¸€ä¸ªè‰¯å¥½çš„è§‚å¯Ÿç‚¹ï¼Œå³Embedding Matrixã€‚


## éšæœºé€‰æ‹© 25 ä¸ª Kã€ProbAttn

çš„è§£é‡Šæ˜¯ï¼Œç±»æ¯”äº†è§£ä¸€ä¸ªäººå¯ä»¥é€šè¿‡å®ƒçš„ä¸ºäººå¤„ä¸–å»äº†è§£ï¼Œä½†ä¹Ÿä¸å¯èƒ½å¤©å¤©è§‚å¯Ÿå®ƒæ€ä¹ˆåšäº‹ï¼Œé‚£å°±éšæ„è§‚å¯Ÿ 5 å¤©ä¹Ÿå¯ä»¥å¤§æ¦‚çš„äº†è§£åˆ°å®ƒè¿™ä¸ªäººï¼Œæˆ–è€…éšæ„çš„è§‚å¯Ÿå®ƒåšçš„ 5 ä»¶äº‹å°±å¯ä»¥äº†

ã€[å‚çœ‹](https://www.bilibili.com/video/BV1GNNde1ETs?spm_id_from=333.788.videopod.episodes&vd_source=ddd7d236ab3e9b123c4086c415f4939e&p=3)ã€‘

![image-20250304202833161](images/image-20250304202833161.png)

è§£é‡Šè¾“å‡ºç»“æœï¼šå½¢çŠ¶æ˜¯ `32*8*96*25`

`32`ï¼šbatch

`8`ï¼š`8` å¤´ï¼Œæ€ä¹ˆç†è§£ `8` å¤´ï¼Œé¦–å…ˆæŠŠç‰¹å¾æ‹†æˆ `8` ä»½ï¼Œç„¶ååˆ†åˆ«è®¡ç®—ï¼Œéšåå†æ‹¼æ¥

`96`ï¼š`96` ä¸ª query

`25`ï¼š`25` ä¸ª key

ä¹Ÿå°±æ˜¯è¿™é‡Œçš„æ³¨æ„åŠ›çŸ©é˜µæ˜¯ `96*25`

å›¾ç¤ºï¼š

![image-20250304204543009](images/image-20250304204543009.png)

ï¼ˆ1ï¼‰è¾“å…¥åºåˆ—é•¿åº¦ä¸º96ï¼Œé¦–å…ˆåœ¨Kä¸­è¿›è¡Œé‡‡æ ·ï¼Œéšæœºé€‰å–25ä¸ªkã€‚
ï¼ˆ2ï¼‰è®¡ç®—æ¯ä¸ªqä¸25ä¸ªkçš„å†…ç§¯ï¼Œç°åœ¨ä¸€ä¸ªqä¸€å…±æœ‰25ä¸ªå¾—åˆ†ã€‚
ï¼ˆ3ï¼‰æ¯ä¸ªqåœ¨25ä¸ªå¾—åˆ†ä¸­ï¼Œé€‰å–==æœ€é«˜åˆ†çš„ä¸å‡å€¼==ç®—å·®å¼‚ã€‚
ï¼ˆ4ï¼‰è¿™æ ·æˆ‘ä»¬è¾“å…¥çš„96ä¸ªqéƒ½æœ‰å¯¹åº”çš„å·®å¼‚å¾—åˆ†ï¼Œæˆ‘ä»¬å°†å·®å¼‚ä»å¤§åˆ°å°æ’åˆ—ï¼Œé€‰å‡ºå·®å¼‚å‰25å¤§çš„qã€‚
ï¼ˆ5ï¼‰å…¶ä»–æ·˜æ±°æ‰çš„qä½¿ç”¨Vå‘é‡çš„å¹³å‡æ¥ä»£æ›¿ã€‚

ä»¥ä¸Šè§£å†³äº†åŸæ–‡æåˆ°çš„é—®é¢˜ï¼š

![image-20250304204759271](images/image-20250304204759271.png)

### è¯´æ˜é€‰å‡º 25 ä¸ªæ›´æ–°ï¼Œå…¶ä½™å…¨ä¸ºå‡å€¼å‘é‡

![image-20250304205401531](images/image-20250304205401531.png)

è§£é‡Šå½¢çŠ¶ï¼š32 ä¸ª batchï¼Œ8 ä¸ªå¤´ï¼Œé€‰æ‹©å‡º 25 ä¸ª queryï¼Œè·Ÿ 96 ä¸ª key è®¡ç®—æ³¨æ„åŠ›

ä¾‹å­ï¼šé€‰åˆ°äº† 2 å· queryï¼Œè·Ÿ 1â€”â€”96 å· key è®¡ç®—æ³¨æ„åŠ›ï¼Œä¹Ÿå°±æ˜¯åªæ›´æ–° 2 å·ä»¥åŠé€‰åˆ°çš„ queryï¼Œé‚£ä¹ˆæ²¡é€‰åˆ°çš„æ€ä¹ˆåŠï¼Ÿ

å›ç­”ï¼šå‡å€¼å¡«å……

**å¡«å……å…¬å¼ï¼š** 

ä¸ºé€‰åˆ°çš„ query å¡«å……ï¼š

$\frac{1}{96}V_1+\frac{1}{96}V_2+......+\frac{1}{96}V_{96}$

**ç†ç”±ï¼š**

å› ä¸º $lazy \ query$ çš„æ³¨æ„åŠ›åˆ†å¸ƒå°±æ˜¯ç±»ä¼¼å‡åŒ€åˆ†å¸ƒçš„ï¼Œæ‰€ä»¥å¡«å……çš„æ—¶å€™ç”¨ $V$çš„å‡å€¼å¡«å……æ˜¯æœ‰é“ç†çš„

![image-20250304205546856](images/image-20250304205546856.png)

ä»¥ä¸Šè¯´æ˜äº† infomer ä¸­æ³¨æ„åŠ›æƒå€¼çš„è®¡ç®—

æœŸåˆŠï¼šAAAI21(best paper)

## Distilling

![image-20250305105025558](images/image-20250305105025558.png)

æˆ‘ä»¬å¤„ç†çš„å•å…ƒï¼šæ˜¯ 96 ä¸ªæ—¶é—´æ­¥ï¼›ä¸€ä¸ªè§„èŒƒåŒ–æ ·æœ¬96 ä¸ªæ•°æ®ç‚¹ï¼Œå…³äºè¿™ç‚¹[è¡¥å……è§](#è·³ 111)

åœ¨ç›¸é‚»çš„Attention Blockä¹‹é—´åŠ å…¥å·ç§¯æ± åŒ–æ“ä½œï¼Œæ¥å¯¹ç‰¹å¾è¿›è¡Œé™é‡‡æ ·ã€‚å¯¹==è¾“å…¥ç»´åº¦==è¿›è¡Œä¿®å‰ªï¼Œå †å nå±‚ï¼Œæ¯å±‚==è¾“å…¥åºåˆ—é•¿åº¦å‡åŠ==ï¼Œä»è€Œå°†ç©ºé—´å¤æ‚åº¦é™ä½åˆ°O(nlogn)

ä¹Ÿå°±æ˜¯è¾“å…¥åºåˆ—é•¿åº¦ï¼š 96 â†’ 48

> è¿™æ ·å¤„ç†ä¹‹åï¼Œä¸‹ä¸€æ¬¡self attentionè€ƒè™‘çš„åºåˆ—é•¿åº¦å°±ä¸æ˜¯96ï¼Œè€Œæ˜¯48
>
> æ€è€ƒä¸ºä»€ä¹ˆ åºåˆ—é•¿åº¦æ‰“æŠ˜æ‰£ä¹Ÿå¯ä»¥ï¼š
>
> encoderå°±æ˜¯æŠŠåŸå§‹åºåˆ—é•¿åº¦è¾“å…¥æ•°æ®ç‰¹å¾è¿›è¡Œæå–ï¼ŒåŸå§‹è¾“å…¥ç‰¹å¾æ˜¯96ä¸ªç‰¹å¾ã€48 ä¸ªç‰¹å¾ï¼Œ24 ä¸ªç‰¹å¾éƒ½æ˜¯å¯ä»¥çš„ï¼Œåªè¦èƒ½è¿›è¡Œç‰¹å¾æå–å°±å¯ä»¥
>
> encoder è¾“å‡ºçš„ä¸œè¥¿è¦è¿›è¡Œé¢„æµ‹ï¼Œè¾“å‡ºçš„é¢„æµ‹çš„è·ŸåŸå§‹è¾“å…¥åºåˆ—é•¿åº¦1~96æ²¡å…³ç³»ï¼Œåªéœ€è¦å‘Šè¯‰ decoderå‰é¢ç‰¹å¾æ˜¯å•¥å°±å¥½äº†
>
> åºåˆ—é•¿åº¦å‡åŠçš„
>
> ğŸ”´ é‚£ è¾“å…¥åºåˆ—é•¿åº¦å‡åŠï¼Œä¹Ÿå°±æ˜¯ query å‡åŠäº†ï¼Œé‚£ key å‘¢ï¼Ÿè¿˜æ˜¯ 25 ä¸ªå—ï¼Ÿ
>
> åœ¨æºç ä¸­æœ‰å‚æ•°æ§åˆ¶ï¼Œé€šè¿‡ maxpool å¯¹è¾“å…¥åºåˆ—å‡åŠçš„æ—¶å€™ï¼Œåºåˆ—é•¿åº¦ä» 96 åˆ° 48ï¼Œkey ç”± 25â†’20ï¼Œåˆç»è¿‡ä¸€å±‚ maxpoolï¼Œè¾“å…¥åºåˆ—ä» 48â†’24ï¼Œkey ç”± 20â†’10
>
> é€šè¿‡ä¸€ç»„å‚æ•°è®¾ç½®ï¼Œé€å±‚é€’å‡

å›¾ç¤ºï¼šï¼ˆä¸­é—´çš„æ¿å­ æ˜¯ **æ³¨æ„åŠ›çš„å¤´æ•°** ï¼‰

![image-20250305132822125](images/image-20250305132822125.png)

æ•ˆæœï¼š

![image-20250305133120142](images/image-20250305133120142.png)

maxpoolä¼šæŠŠç‰¹å¾é²œæ˜çš„é€‰å‡ºæ¥ï¼Œé€å±‚ç­›é€‰

==ä¼ ç»Ÿdecoderï¼š==

![image-20250305133347368](images/image-20250305133347368.png)

**decoder çš„è¾“å…¥ï¼š** 

![image-20250305133620089](images/image-20250305133620089.png)

encoder ä¸­çš„åšï¼šself attention

decoder ä¸­åš 2 ç§ **attention**ï¼š

â‘   ä¸ encoder çš„è¾“å‡ºçš„åš attentionï¼Œè¡¨ç¤º encoder ä¸­çš„ç‰¹å¾èƒ½æä¾›ç”¨äºæŒ‡å¯¼decoder çš„è¾“å…¥

â‘¡ decoder è¾“å…¥çš„è‡ªæ³¨æ„åŠ›ï¼Œè¿™ä¸€éƒ¨åˆ†éœ€è¦æ³¨æ„çš„æ˜¯ mask æ“ä½œï¼Œå½“å‰ä½ç½®åœ¨åšè‡ªæ³¨æ„åŠ›æ—¶ï¼Œä¸èƒ½çœ‹åˆ°æœªæ¥çš„ä¿¡æ¯

![image-20250305134615512](images/image-20250305134615512.png)



### <span id="è·³ 111">æ¨¡å‹è¾“å…¥è¾“å‡ºè§’åº¦ç†è§£Informerè®­ç»ƒå’Œé¢„æµ‹è¿‡ç¨‹</span>

æ•°æ®é›†ï¼šBDG2

(å°æ—¶ç»´åº¦çš„æ•°æ®) æ•°æ®è§„æ ¼:17420 * 320

Batch_size:32

 1ï¸âƒ£ **Encoder Embeddingè¾“å…¥** 

> $X_{enc} = 32 Ã— 96 Ã— 320  $
>
> 32ä¸ºbatchå¤§å°ï¼Œä¸€ä¸ªbatchæœ‰32ä¸ªæ ·æœ¬ï¼Œä¸€ä¸ªæ ·æœ¬ä»£è¡¨96ä¸ªæ—¶é—´ç‚¹çš„æ•°æ®ã€‚
> 320ä¸ºæ¯ä¸ªæ•°æ®çš„ç»´åº¦ï¼Œè¡¨ç¤ºæ¯ä¸ªæ—¶é—´ç‚¹æ•°æ®ï¼ˆæ¯è¡Œï¼‰æœ‰320åˆ—ã€‚
>
> $X_{mark} = 32 Ã— 96 Ã— 4 $ 
>
> 32 Ã— 96åŒä¸Šï¼Œè¡¨ç¤ºæ¯ä¸ªæ—¶é—´ç‚¹çš„æ•°æ®éƒ½è¦æœ‰ä¸€ä¸ªä½ç½®ç¼–ç ï¼ŒXmarkä¸Xencæ¯è¡Œä¸€ä¸€å¯¹åº”ã€‚
>
> 4ä¸ºæ—¶é—´æˆ³ï¼Œä¾‹å¦‚æˆ‘ä»¬ç”¨å°æ—¶ç»´åº¦çš„æ•°æ®ï¼Œé‚£ä¹ˆ4åˆ†åˆ«ä»£è¡¨å¹´ã€æœˆã€æ—¥ã€å°æ—¶ï¼Œ

2ï¸âƒ£ **Decoder Embeddingè¾“å…¥ï¼š**

> $X_{dec} = 32 Ã— 72 Ã— 320$ 
>
> $X_{mark} = 32 Ã— 72 Ã— 4$ 
>
> - 72=48+24ï¼Œå…¶ä¸­48ä¸ºEncoder96çš„å48ä¸ªæ—¶é—´ç‚¹æ•°æ®ï¼Œç”¨è¿™äº›çœŸå®å€¼æ¥å¸¦ä¸€å¸¦é¢„æµ‹å€¼ï¼Œ24ä¸ºå¾…é¢„æµ‹å€¼ã€‚
> - 48ä¸ºç»¿è‰²éƒ¨åˆ†ï¼Œ24ä¸ºç™½è‰²éƒ¨åˆ†å¡«å……0ï¼ˆmaskæœºåˆ¶ï¼‰

3ï¸âƒ£ **Embeddingè¾“å…¥è¾“å‡ºï¼š**

> å°†ç»´åº¦ä¸º$320$çš„ä¸€ä¸ªæ—¶é—´ç‚¹çš„æ•°æ®æŠ•å½±æˆç»´åº¦ä¸º512çš„æ•°æ®ã€‚
>
>  **è¾“å…¥ï¼š**
>
> 32 Ã— 96/72 Ã— 320
>
> 32 Ã— 96/72 Ã— 4
>
> **è¾“å‡ºï¼š**
>
> 32 Ã— 96/72 Ã— 512

4ï¸âƒ£ **ProbSparse Self-attentionè¾“å…¥è¾“å‡º**

> **è¾“å…¥ï¼š**
>
> 32 Ã— 8 Ã— 96 Ã— 64 (8 Ã— 64 = 512ï¼Œè¿™ä¹Ÿæ˜¯å¤šå¤´çš„åŸç†ï¼Œå³8ä¸ªå¤´)
>
> **Activeè¾“å‡ºï¼š**
>
> 32 Ã— 8 Ã— 25 Ã— 64 ï¼ˆåªå–25ä¸ªæ´»è·ƒqï¼‰
>
> **Active+Lazyè¾“å‡ºï¼š**
>
> 32 Ã— 8 Ã— 96 Ã— 64 ï¼ˆé™¤äº†25ä¸ªæ´»è·ƒqï¼Œå…¶ä½™qç”¨Vå‘é‡çš„å¹³å‡æ¥ä»£æ›¿ï¼‰
>
> **å¤šå¤´æ³¨æ„åŠ›åˆå¹¶ï¼š**
>
> 32 Ã— 96 Ã— 512
>
> **Encoderè¾“å…¥è¾“å‡ºï¼š**
>
> <u>å¤šä¸ªEncoderå’Œè’¸é¦å±‚çš„ç»„åˆ</u>
>
> è¾“å…¥ï¼š
>
> 32 Ã— 96 Ã— 512ï¼ˆæ¥è‡ªä¸Šé¢embedding é•¿åº¦ä¸º96çš„éƒ¨åˆ†ï¼‰
>
>  è¾“å‡ºï¼š
>
> 32 Ã— 51 Ã— 512ï¼ˆè¿™é‡Œçš„51åº”è¯¥æ˜¯conv1då·ç§¯å–æ•´å¯¼è‡´çš„ï¼Œå› ä¸ºæºç è¦è‡ªè¡Œè°ƒæ•´ï¼Œæ‰€ä»¥æ˜¯è¿™æ ·çš„ï¼‰

5ï¸âƒ£ **Decoderè¾“å…¥è¾“å‡º**

> **è¾“å…¥ï¼š**
>
> 32 Ã— 51 Ã— 512 & 32 Ã— 72 Ã— 512
>
> ï¼ˆ32 Ã— 51 Ã— 512æ˜¯Encoderè¾“å‡ºï¼Œ32 Ã— 72 Ã— 512æ˜¯Decoder Embeddingåçš„è¾“å…¥ï¼‰
>
> **è¾“å‡ºï¼š**
>
> 32 Ã— 72 Ã— 512





## ä½ç½®ç¼–ç 

![image-20250305134714859](images/image-20250305134714859.png)

## å®éªŒéƒ¨åˆ†

[æ—¶åºé¢„æµ‹è®ºæ–‡ç²¾è¯»ï¼šé•¿åºåˆ—é¢„æµ‹æ¨¡å‹informerä¸Š](https://www.bilibili.com/video/BV127CYYQELB?spm_id_from=333.788.videopod.sections&vd_source=ddd7d236ab3e9b123c4086c415f4939e)

æœ¬æ–‡æ‰€ç”¨æ•°æ®é›†ï¼šETT h1ï¼ŒETT h2ï¼ŒETT m1ã€weather

å®éªŒéƒ¨åˆ†ï¼š

- å•å˜é‡ é•¿åºåˆ—æ—¶é—´åºåˆ—é¢„æµ‹
- å¤šå˜é‡ ~ ï¼ˆq çš„ç¨€ç–æ€§å‡è®¾åœ¨å¾ˆå¤šæ•°æ®é›†ä¸Šæˆç«‹ï¼‰

[https://arxiv.org/pdf/2012.07436](https://arxiv.org/pdf/2012.07436)

![image-20250317121532608](images/image-20250317121532608.png)
