<!DOCTYPE html><html class="no-js" lang="en"><head>
<meta charset="utf-8">
<meta content="width=device-width,initial-scale=1" name="viewport">
<link href="https://dearrongerr.github.io/Rongerr.github.io/Reproduction/6_AutoFormer/" rel="canonical">
<link href="../5_SegRNN_v4/" rel="prev">
<link href="../6_AutoFormer_v1/" rel="next">
<link href="../../assets/images/logo2.png" rel="icon">
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.20" name="generator">
<title>Autoformer - æº¶err</title>
<link href="../../assets/stylesheets/main.e53b48f4.min.css" rel="stylesheet">
<link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet">
<style>:root{--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20576%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.0.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M288%2064a32%2032%200%201%200%200%2064%2032%2032%200%201%200%200-64m-96%2032c0-53%2043-96%2096-96s96%2043%2096%2096c0%2041.8-26.7%2077.4-64%2090.5v257.9c62.9-14.3%20110.2-69.7%20111.9-136.5L415.8%20322c-10%208.7-25.1%207.7-33.9-2.3s-7.7-25.1%202.3-33.9l64-56c9-7.9%2022.6-7.9%2031.6%200l64%2056c10%208.7%2011%2023.9%202.3%2033.9s-23.9%2011-33.9%202.3L496%20307.9C493.9%20421%20401.6%20512%20288%20512S82.1%20421%2080%20307.9l-16.2%2014.2c-10%208.7-25.1%207.7-33.9-2.3s-7.7-25.1%202.3-33.9l64-56c9-7.9%2022.6-7.9%2031.6%200l64%2056c10%208.7%2011%2023.9%202.3%2033.9s-23.9%2011-33.9%202.3L144.1%20308c1.8%2066.8%2049.1%20122.2%20111.9%20136.5V186.6c-37.3-13.2-64-48.7-64-90.5z%22/%3E%3C/svg%3E');--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.0.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22m368.5%2018.3-50.1%2050.1%20125.3%20125.3%2050.1-50.1c21.9-21.9%2021.9-57.3%200-79.2l-46.1-46.1c-21.9-21.9-57.3-21.9-79.2%200m-89.2%2078.9-.5.1-144.1%2043.2c-19.9%206-35.7%2021.2-42.3%2041L3.8%20445.8c-2.9%208.7-1.9%2018.2%202.5%2026l155.4-155.4c-1.1-4-1.6-8.1-1.6-12.4%200-26.5%2021.5-48%2048-48s48%2021.5%2048%2048-21.5%2048-48%2048c-4.3%200-8.5-.6-12.4-1.6L40.3%20505.7c7.8%204.4%2017.2%205.4%2026%202.5l264.3-88.6c19.7-6.6%2035-22.4%2041-42.3l43.2-144.1.1-.5L279.4%2097.2z%22/%3E%3C/svg%3E');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.0.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M40%2048c-13.3%200-24%2010.7-24%2024v48c0%2013.3%2010.7%2024%2024%2024h48c13.3%200%2024-10.7%2024-24V72c0-13.3-10.7-24-24-24zm152%2016c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032h288c17.7%200%2032-14.3%2032-32s-14.3-32-32-32zm0%20160c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032h288c17.7%200%2032-14.3%2032-32s-14.3-32-32-32zm0%20160c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032h288c17.7%200%2032-14.3%2032-32s-14.3-32-32-32zM16%20232v48c0%2013.3%2010.7%2024%2024%2024h48c13.3%200%2024-10.7%2024-24v-48c0-13.3-10.7-24-24-24H40c-13.3%200-24%2010.7-24%2024m24%20136c-13.3%200-24%2010.7-24%2024v48c0%2013.3%2010.7%2024%2024%2024h48c13.3%200%2024-10.7%2024-24v-48c0-13.3-10.7-24-24-24z%22/%3E%3C/svg%3E');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20384%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.0.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M292.9%20384c7.3-22.3%2021.9-42.5%2038.4-59.9C364%20289.7%20384%20243.2%20384%20192%20384%2086%20298%200%20192%200S0%2086%200%20192c0%2051.2%2020%2097.7%2052.7%20132.1%2016.5%2017.4%2031.2%2037.6%2038.4%2059.9h201.7zm-4.9%2048H96v16c0%2044.2%2035.8%2080%2080%2080h32c44.2%200%2080-35.8%2080-80zM184%20112c-39.8%200-72%2032.2-72%2072%200%2013.3-10.7%2024-24%2024s-24-10.7-24-24c0-66.3%2053.7-120%20120-120%2013.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024%22/%3E%3C/svg%3E');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.0.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M434.8%2070.1c14.3%2010.4%2017.5%2030.4%207.1%2044.7l-256%20352c-5.5%207.6-14%2012.3-23.4%2013.1s-18.5-2.7-25.1-9.3l-128-128c-12.5-12.5-12.5-32.8%200-45.3s32.8-12.5%2045.3%200l101.5%20101.5%20234-321.7c10.4-14.3%2030.4-17.5%2044.7-7.1z%22/%3E%3C/svg%3E');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.0.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M256%20512a256%20256%200%201%200%200-512%20256%20256%200%201%200%200%20512m0-336c-17.7%200-32%2014.3-32%2032%200%2013.3-10.7%2024-24%2024s-24-10.7-24-24c0-44.2%2035.8-80%2080-80s80%2035.8%2080%2080c0%2047.2-36%2067.2-56%2074.5v3.8c0%2013.3-10.7%2024-24%2024s-24-10.7-24-24v-8.1c0-20.5%2014.8-35.2%2030.1-40.2%206.4-2.1%2013.2-5.5%2018.2-10.3%204.3-4.2%207.7-10%207.7-19.6%200-17.7-14.3-32-32-32zm-32%20192a32%2032%200%201%201%2064%200%2032%2032%200%201%201-64%200%22/%3E%3C/svg%3E');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.0.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M256%200c14.7%200%2028.2%208.1%2035.2%2021l216%20400c6.7%2012.4%206.4%2027.4-.8%2039.5S486.1%20480%20472%20480H40c-14.1%200-27.1-7.4-34.4-19.5s-7.5-27.1-.8-39.5l216-400c7-12.9%2020.5-21%2035.2-21m0%20168c-13.3%200-24%2010.7-24%2024v112c0%2013.3%2010.7%2024%2024%2024s24-10.7%2024-24V192c0-13.3-10.7-24-24-24m26.7%20216a26.7%2026.7%200%201%200-53.3%200%2026.7%2026.7%200%201%200%2053.3%200%22/%3E%3C/svg%3E');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M12%203c4.97%200%209%203.58%209%208s-6%2010-9%2010-9-5.58-9-10%204.03-8%209-8m-1.69%207.93C9.29%209.29%207.47%208.58%206.25%209.34s-1.38%202.71-.36%204.35c1.03%201.64%202.85%202.35%204.07%201.59%201.22-.78%201.37-2.71.35-4.35m3.38%200c-1.02%201.64-.87%203.57.35%204.35%201.22.76%203.04.05%204.07-1.59%201.02-1.64.86-3.59-.36-4.35s-3.04-.05-4.06%201.59M12%2017.75c-2%200-2.5-.75-2.5-.75%200%20.03.5%202%202.5%202s2.5-2%202.5-2-.5.75-2.5.75%22/%3E%3C/svg%3E');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.0.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M296%2040c0-22.1-17.9-40-40-40s-40%2017.9-40%2040c0%2044.1-53.3%2066.1-84.5%2035-15.6-15.6-40.9-15.6-56.6%200s-15.6%2040.9%200%2056.6c31.2%2031.2%209.1%2084.5-35%2084.5-22.1%200-40%2017.9-40%2040s17.9%2040%2040%2040c44.1%200%2066.1%2053.3%2035%2084.5-15.6%2015.6-15.6%2040.9%200%2056.6s40.9%2015.6%2056.6%200c31.2-31.2%2084.5-9.1%2084.5%2035%200%2022.1%2017.9%2040%2040%2040s40-17.9%2040-40c0-44.1%2053.3-66.1%2084.5-35%2015.6%2015.6%2040.9%2015.6%2056.6%200s15.6-40.9%200-56.6c-31.2-31.2-9.1-84.5%2035-84.5%2022.1%200%2040-17.9%2040-40s-17.9-40-40-40c-44.1%200-66.1-53.3-35-84.5%2015.6-15.6%2015.6-40.9%200-56.6s-40.9-15.6-56.6%200c-31.2%2031.1-84.5%209.1-84.5-35M160%20224a32%2032%200%201%201%2064%200%2032%2032%200%201%201-64%200m160%2032a32%2032%200%201%201%200%2064%2032%2032%200%201%201%200-64%22/%3E%3C/svg%3E');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20640%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.0.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M352%200c0-17.7-14.3-32-32-32s-32%2014.3-32%2032v64h-96c-53%200-96%2043-96%2096v224c0%2053%2043%2096%2096%2096h256c53%200%2096-43%2096-96V160c0-53-43-96-96-96h-96zM160%20368c0-13.3%2010.7-24%2024-24h32c13.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024h-32c-13.3%200-24-10.7-24-24m120%200c0-13.3%2010.7-24%2024-24h32c13.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024h-32c-13.3%200-24-10.7-24-24m120%200c0-13.3%2010.7-24%2024-24h32c13.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024h-32c-13.3%200-24-10.7-24-24M224%20176a48%2048%200%201%201%200%2096%2048%2048%200%201%201%200-96m144%2048a48%2048%200%201%201%2096%200%2048%2048%200%201%201-96%200m-304%200c0-17.7-14.3-32-32-32S0%20206.3%200%20224v96c0%2017.7%2014.3%2032%2032%2032s32-14.3%2032-32zm544-32c-17.7%200-32%2014.3-32%2032v96c0%2017.7%2014.3%2032%2032%2032s32-14.3%2032-32v-96c0-17.7-14.3-32-32-32%22/%3E%3C/svg%3E');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.0.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M288%200H128c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032v151.5L7.5%20426.3C2.6%20435%200%20444.7%200%20454.7%200%20486.4%2025.6%20512%2057.3%20512h333.4c31.6%200%2057.3-25.6%2057.3-57.3%200-10-2.6-19.8-7.5-28.4L320%20215.5V64c17.7%200%2032-14.3%2032-32S337.7%200%20320%200zm-96%20215.5V64h64v151.5c0%2011.1%202.9%2022.1%208.4%2031.8L306%20320H142l41.6-72.7c5.5-9.7%208.4-20.6%208.4-31.8%22/%3E%3C/svg%3E');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20576%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.0.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M419.5%2096c-16.6%200-32.7%204.5-46.8%2012.7-15.8-16-34.2-29.4-54.5-39.5%2028.2-24%2064.1-37.2%20101.3-37.2C505.9%2032%20576%20102%20576%20188.5c0%2041.5-16.5%2081.3-45.8%20110.6l-71.1%2071.1C429.8%20399.5%20390%20416%20348.5%20416%20262.1%20416%20192%20346%20192%20259.5c0-1.5%200-3%20.1-4.5.5-17.7%2015.2-31.6%2032.9-31.1s31.6%2015.2%2031.1%2032.9v2.6c0%2051.1%2041.4%2092.5%2092.5%2092.5%2024.5%200%2048-9.7%2065.4-27.1l71.1-71.1c17.3-17.3%2027.1-40.9%2027.1-65.4%200-51.1-41.4-92.5-92.5-92.5zm-144.3%2077.3c-1.9-.8-3.8-1.9-5.5-3.1-12.6-6.5-27-10.2-42.1-10.2-24.5%200-48%209.7-65.4%2027.1l-71.1%2071.1C73.8%20275.5%2064%20299.1%2064%20323.6c0%2051.1%2041.4%2092.5%2092.5%2092.5%2016.5%200%2032.6-4.4%2046.7-12.6%2015.8%2016%2034.2%2029.4%2054.6%2039.5-28.2%2023.9-64%2037.2-101.3%2037.2C70.1%20480.2%200%20410.2%200%20323.7c0-41.5%2016.5-81.3%2045.8-110.6l71.1-71.1c29.3-29.3%2069.1-45.8%20110.6-45.8%2086.6%200%20156.5%2070.6%20156.5%20156.9v3.9c-.4%2017.7-15.1%2031.6-32.8%2031.2s-31.6-15.1-31.2-32.8v-2.3c0-33.7-18-63.3-44.8-79.6z%22/%3E%3C/svg%3E');}</style>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect">
<link href="https://fonts.googleapis.com/css?family=LXGW+WenKai+Screen+GB+Screen:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet">
<style>:root{--md-text-font:"LXGW WenKai Screen GB Screen";--md-code-font:"JetBrains Mono"}</style>
<link href="../../css/timeline.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css" rel="stylesheet">
<link href="../../mkdocs/css/no-footer.css" rel="stylesheet">
<link href="../../mkdocs/css/unordered-list-symbols.css" rel="stylesheet">
<link href="../../assets/stylesheets/cards.css" rel="stylesheet">
<link href="../../assets/stylesheets/flink.css" rel="stylesheet">
<link href="../../assets/stylesheets/rounded_corner.css" rel="stylesheet">
<link href="https://gcore.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.1.0/style.css" rel="stylesheet">
<link href="https://gcore.jsdelivr.net/npm/lxgw-wenkai-webfont@1.1.0/style.css" rel="stylesheet">
<link href="https://cdn.tonycrane.cc/jbmono/jetbrainsmono.css" rel="stylesheet">
<link href="https://cdn.tonycrane.cc/lxgw/lxgwscreen.css" rel="stylesheet">
<link href="../../assets/stylesheets/custom.css" rel="stylesheet">
<link href="../../assets/stylesheets/tasklist.css" rel="stylesheet">
<link href="../../assets/stylesheets/fold_toc.css" rel="stylesheet">
<link href="../../assets/stylesheets/changelog_extra.css" rel="stylesheet">
<link href="../../assets/document_dates/fonts/material-icons.css" rel="stylesheet">
<link href="../../assets/document_dates/tippy/light.css" rel="stylesheet">
<link href="../../assets/document_dates/tippy/material.css" rel="stylesheet">
<link href="../../assets/document_dates/tippy/shift-away.css" rel="stylesheet">
<link href="../../assets/document_dates/tippy/scale.css" rel="stylesheet">
<link href="../../assets/document_dates/tippy/backdrop.css" rel="stylesheet">
<link href="../../assets/document_dates/tippy/tippy.css" rel="stylesheet">
<link href="../../assets/document_dates/core/core.css" rel="stylesheet">
<link href="../../assets/document_dates/user.config.css" rel="stylesheet">
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style><style>/* è‡ªå®šä¹‰åˆ†éš”çº¿æ ·å¼ */
hr.custom-hr {
    position: relative;
    text-align: center;
    border: 0;
    height: 1px;
    background: none;
    /* ä½¿ç”¨ä¸»é¢˜çš„è¾¹æ¡†é¢œè‰² */
    border-top: 2px solid var(--md-default-fg-color--lighter, currentColor);
    margin: 100px 0 !important;
}

hr.custom-hr:before {
    content: attr(data-content);
    position: absolute;
    /* ä½¿ç”¨ä¸»é¢˜çš„èƒŒæ™¯è‰²ï¼Œfallback åˆ°é¡µé¢èƒŒæ™¯è‰² */
    background: var(--md-default-bg-color, var(--md-primary-bg-color, inherit));
    /* ä½¿ç”¨ä¸»é¢˜çš„æ–‡æœ¬é¢œè‰² */
    color: var(--md-default-fg-color, currentColor);
    padding: 0 0.5em;
    line-height: 1;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 2em;
    font-weight: bold;
}

/* ç›®å½•ä¸­åˆ†éš”çº¿æ¡ç›®çš„æ ·å¼ */
.md-nav__item.hr-nav-item {
    text-align: center;
    margin: 1.16em 0;
    /* å¢åŠ ä¸Šä¸‹é—´è· */
}

.md-nav__item.hr-nav-item .md-nav__link {
    justify-content: center;
    font-weight: bold;
    font-size: 1.1em;
    color: var(--md-typeset-color) !important;
}

/* æ‚¬åœæ•ˆæœ */
.md-nav__item.hr-nav-item .md-nav__link:hover {
    color: var(--md-accent-fg-color) !important;
}

/* ä¿®æ”¹åˆ†éš”çº¿çš„æ ·å¼ */
.md-content__inner hr.custom-hr {
    border: none !important;
    height: 2px !important;
    background-color: var(--md-typeset-color) !important;
    margin: 8em 0 !important;
    /* å¢åŠ åˆ†éš”çº¿çš„ä¸Šä¸‹é—´è· */
}

/* ç¡®ä¿åˆ†éš”çº¿æ–‡å­—å¯è§ */
.md-content__inner hr.custom-hr[data-content]::before {
    color: var(--md-typeset-color) !important;
}</style></head>
<body data-md-color-accent="light-green" data-md-color-primary="green" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox">
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox">
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#autoformer">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="æº¶err" class="md-header__button md-logo" data-md-component="logo" href="../.." title="æº¶err">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 8C8 10 5.9 16.17 3.82 21.34l1.89.66.95-2.3c.48.17.98.3 1.34.3C19 20 22 3 22 3c-1 2-8 2.25-13 3.25S2 11.5 2 13.5s1.75 3.75 1.75 3.75C7 8 17 8 17 8"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            æº¶err
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Autoformer
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="light-green" data-md-color-media="" data-md-color-primary="green" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio">
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="indigo" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio">
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text">
<label class="md-search__icon md-icon" for="__search">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewBox="0 0 256 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l137.3-137.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
</a>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/dearRongerr/Rongerr.github.io" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</div>
<div class="md-source__repository">
    Rongerr.github.io
  </div>
</a>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../..">
        
  
  
    
  
  ğŸƒ Welcome

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../sticks/5_preReproduction/">
          
  
  
    
  
  ä¾¿ç­¾

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../bagu/">
          
  
  
    
  
  é¢è¯•

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../Error/github/">
          
  
  
    
  
  æ‰ä¸ªè™«

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../learning/">
          
  
  
    
  
  æ·±åº¦å­¦ä¹ 

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../literature/">
          
  
  
    
  
  æ–‡çŒ®

        </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../">
          
  
  
    
  
  è®ºæ–‡å¤ç°

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../CodeRepo/">
          
  
  
    
  
  python

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../Statistics/">
          
  
  
    
  
  ç»Ÿè®¡å­¦

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../logs/">
          
  
  
    
  
  æ”¶çº³ç®±

        </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="æº¶err" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="æº¶err">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 8C8 10 5.9 16.17 3.82 21.34l1.89.66.95-2.3c.48.17.98.3 1.34.3C19 20 22 3 22 3c-1 2-8 2.25-13 3.25S2 11.5 2 13.5s1.75 3.75 1.75 3.75C7 8 17 8 17 8"></path></svg>
</a>
    æº¶err
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/dearRongerr/Rongerr.github.io" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</div>
<div class="md-source__repository">
    Rongerr.github.io
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    ğŸƒ Welcome
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2" type="checkbox">
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    ä¾¿ç­¾
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            ä¾¿ç­¾
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2_1" type="checkbox">
<label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
<span class="md-ellipsis">
    é€æ­¥ç³»åˆ—
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_1">
<span class="md-nav__icon md-icon"></span>
            é€æ­¥ç³»åˆ—
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../sticks/5_preReproduction/">
<span class="md-ellipsis">
    (é€æ­¥ç³»åˆ—)å¤ç°ä¹‹å‰
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sticks/6_0_docker/">
<span class="md-ellipsis">
    (é€æ­¥ç³»åˆ—)docker
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sticks/1_github_v3/">
<span class="md-ellipsis">
    (é€æ­¥ç³»åˆ—) git
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sticks/mkdocs_learn/">
<span class="md-ellipsis">
    MkDocs
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sticks/markdwon_learn/">
<span class="md-ellipsis">
    markdown
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sticks/latex/">
<span class="md-ellipsis">
    LaTex
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sticks/MacOS/">
<span class="md-ellipsis">
    MacOS
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sticks/shell/">
<span class="md-ellipsis">
    Shell
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sticks/linux/">
<span class="md-ellipsis">
    linux
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sticks/screen/">
<span class="md-ellipsis">
    screen
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sticks/docker/">
<span class="md-ellipsis">
    Docker
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sticks/writting/">
<span class="md-ellipsis">
    å†™ä½œ
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sticks/3_vscode/">
<span class="md-ellipsis">
    VSCode
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sticks/4_mkdocs/">
<span class="md-ellipsis">
    mkdocs å¸¸ç”¨å‘½ä»¤
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2_13" type="checkbox">
<label class="md-nav__link" for="__nav_2_13" id="__nav_2_13_label" tabindex="0">
<span class="md-ellipsis">
    Git
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_13_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_13">
<span class="md-nav__icon md-icon"></span>
            Git
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../sticks/GitHub/">
<span class="md-ellipsis">
    Gitå­¦ä¹ 
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sticks/1_github_v0/">
<span class="md-ellipsis">
    git init
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sticks/1_github_v1/">
<span class="md-ellipsis">
    Git(cloneä»¥å)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sticks/1_github_v2/">
<span class="md-ellipsis">
    gitåˆ†æ”¯ä¸åŠŸèƒ½æµ‹è¯•
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3" type="checkbox">
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../bagu/">
<span class="md-ellipsis">
    é¢è¯•
    
  </span>
</a>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            é¢è¯•
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3_2" type="checkbox">
<label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
<span class="md-ellipsis">
    é¢˜ç›®
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_2">
<span class="md-nav__icon md-icon"></span>
            é¢˜ç›®
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../bagu/questions/1_questions/">
<span class="md-ellipsis">
    é¢è¯•é—®é¢˜
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3_3" type="checkbox">
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../bagu/leetcode/">
<span class="md-ellipsis">
    åŠ›æ‰£
    
  </span>
</a>
<label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_3_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_3">
<span class="md-nav__icon md-icon"></span>
            åŠ›æ‰£
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../bagu/leetcode/1/">
<span class="md-ellipsis">
    1 ä¸¤æ•°ä¹‹å’Œ
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../bagu/leetcode/2/">
<span class="md-ellipsis">
    2 ä¸¤æ•°ç›¸åŠ 
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3_4" type="checkbox">
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../bagu/deeplearning/">
<span class="md-ellipsis">
    æ·±åº¦å­¦ä¹ 
    
  </span>
</a>
<label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_3_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_4">
<span class="md-nav__icon md-icon"></span>
            æ·±åº¦å­¦ä¹ 
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../bagu/deeplearning/transformer/">
<span class="md-ellipsis">
    æ‰‹æ’•Transformerä»£ç 
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../bagu/deeplearning/pytorch_shape_function/">
<span class="md-ellipsis">
    pytorchçš„ç»´åº¦å˜æ¢å‡½æ•°
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../bagu/deeplearning/1/">
<span class="md-ellipsis">
    visionTransformerä»£ç 
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3_5" type="checkbox">
<label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
<span class="md-ellipsis">
    æœºå™¨å­¦ä¹ 
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_5">
<span class="md-nav__icon md-icon"></span>
            æœºå™¨å­¦ä¹ 
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../bagu/machinelearning/kmeans/">
<span class="md-ellipsis">
    æ‰‹æ’•kmeans
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../bagu/machinelearning/2/">
<span class="md-ellipsis">
    æ‰‹æ’•åå‘ä¼ æ’­
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4" type="checkbox">
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    æ‰ä¸ªè™«
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            æ‰ä¸ªè™«
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../Error/github/">
<span class="md-ellipsis">
    github
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Error/latex/">
<span class="md-ellipsis">
    Latex
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Error/python/">
<span class="md-ellipsis">
    python
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Error/macos/">
<span class="md-ellipsis">
    macOS
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Error/docker/">
<span class="md-ellipsis">
    docker
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Error/Typora_1/">
<span class="md-ellipsis">
    PicGo+Typora+Githubå›¾åºŠè®¾ç½®
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox">
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../learning/">
<span class="md-ellipsis">
    æ·±åº¦å­¦ä¹ 
    
  </span>
</a>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            æ·±åº¦å­¦ä¹ 
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/17_1_SENet/">
<span class="md-ellipsis">
    SENet
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/17_ManBa/">
<span class="md-ellipsis">
    Mamba
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/16_KAN/">
<span class="md-ellipsis">
    KAN
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/15_CausualConv/">
<span class="md-ellipsis">
    å› æœå·ç§¯
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/3_ViT/">
<span class="md-ellipsis">
    ViT
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/1_clip/">
<span class="md-ellipsis">
    CLIP
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/2_MOCO/">
<span class="md-ellipsis">
    MOCO
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/2_python/">
<span class="md-ellipsis">
    ä¸‹åˆ’çº¿æ–¹æ³• &amp; è™šæ‹Ÿç¯å¢ƒ
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/2/">
<span class="md-ellipsis">
    å›¾è§£LayerNorm &amp; BatchNorm
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/1/">
<span class="md-ellipsis">
    5ç§å½’ä¸€åŒ–æ–¹æ³•
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/vit/">
<span class="md-ellipsis">
    vision Transformerçš„åŸç†ä¸éš¾ç‚¹æºç å®ç°
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/pe/">
<span class="md-ellipsis">
    4ç§ä½ç½®ç¼–ç 
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/convs/">
<span class="md-ellipsis">
    å·ç§¯
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/3/">
<span class="md-ellipsis">
    ææ² ç›®æ ‡æ£€æµ‹éƒ¨åˆ†
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/4_GAN/">
<span class="md-ellipsis">
    GAN
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/5_Bert/">
<span class="md-ellipsis">
    BERTä»é›¶è¯¦ç»†è§£è¯»
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/6_Diffusion/">
<span class="md-ellipsis">
    DDPM
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/6_Diffusion1/">
<span class="md-ellipsis">
    VDM
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/8_WeightNorm/">
<span class="md-ellipsis">
    WeightNorm
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/9_cGAN/">
<span class="md-ellipsis">
    GAN å˜ä½“
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/12_KLdivergence/">
<span class="md-ellipsis">
    KL divergence
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/13_RNN/">
<span class="md-ellipsis">
    RNN
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/14_LSTM/">
<span class="md-ellipsis">
    LSTM
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../learning/0_pdfNotes/">
<span class="md-ellipsis">
    ğŸ“’
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_6" type="checkbox">
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../literature/">
<span class="md-ellipsis">
    æ–‡çŒ®
    
  </span>
</a>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            æ–‡çŒ®
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_6_2" type="checkbox">
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../literature/TSP/">
<span class="md-ellipsis">
    æ—¶é—´åºåˆ—é¢„æµ‹
    
  </span>
</a>
<label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_6_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_2">
<span class="md-nav__icon md-icon"></span>
            æ—¶é—´åºåˆ—é¢„æµ‹
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/TSP/0_note/">
<span class="md-ellipsis">
    æ—¶åºé¢„æµ‹åŸºç¡€
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/TSP/1_SegRNN/">
<span class="md-ellipsis">
    2023ã€SegRNN
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/TSP/2_DLinear/">
<span class="md-ellipsis">
    2022ã€LTSF-Linear
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/TSP/3_TimesNet/">
<span class="md-ellipsis">
    2023ã€TimesNet
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/TSP/4_Informer/">
<span class="md-ellipsis">
    2021ã€ Informer
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/TSP/5_Autoformer/">
<span class="md-ellipsis">
    2021ã€Autoformer
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/TSP/6_UnetTSF/">
<span class="md-ellipsis">
    2024ã€UnetTSF
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/TSP/7_SCINet/">
<span class="md-ellipsis">
    2022ã€SCINet
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/TSP/8_PatchTST/">
<span class="md-ellipsis">
    2023ã€PatchTST
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/TSP/9_Pyraformer/">
<span class="md-ellipsis">
    2022ã€Pyraformer
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/TSP/10_TimesMixer/">
<span class="md-ellipsis">
    2024ã€TimeMixer
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/TSP/11_Fedformer/">
<span class="md-ellipsis">
    2022ã€FEDformer
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/TSP/12_WITRAN/">
<span class="md-ellipsis">
    2023ã€WITRAN
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/TSP/13_TFB/">
<span class="md-ellipsis">
    TFB
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/TSP/14_TSLib/">
<span class="md-ellipsis">
    TSLib
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_6_3" type="checkbox">
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../literature/ObejectCounting/">
<span class="md-ellipsis">
    ç›®æ ‡è®¡æ•°
    
  </span>
</a>
<label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_6_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_3">
<span class="md-nav__icon md-icon"></span>
            ç›®æ ‡è®¡æ•°
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/ObejectCounting/rank1%20CountGD/">
<span class="md-ellipsis">
    rank1 CountGD
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/ObejectCounting/rank2%20GeCo/">
<span class="md-ellipsis">
    rank2 GeCo
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/ObejectCounting/rank3%20DAVE/">
<span class="md-ellipsis">
    rank3 DAVE
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/ObejectCounting/rank4%20CACViT/">
<span class="md-ellipsis">
    rank4 CACViT
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/ObejectCounting/rank5%20SSD/">
<span class="md-ellipsis">
    rank5 SSD
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/ObejectCounting/rank6%20LOCA/">
<span class="md-ellipsis">
    rank6 LOCA
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/ObejectCounting/rank7%20SemAug_CountTR/">
<span class="md-ellipsis">
    rank7 SemAug CountTR
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/ObejectCounting/rank8%20CounTR/">
<span class="md-ellipsis">
    rank8 CounTR
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/ObejectCounting/rank9%20SemAug_SAFECount/">
<span class="md-ellipsis">
    rank9 SemAug SAFECount
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/ObejectCounting/rank10%20SPDCN/">
<span class="md-ellipsis">
    rank10 SPDCN
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/ObejectCounting/rank11%20GCA_SUN/">
<span class="md-ellipsis">
    rank11 GCA SUN
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/ObejectCounting/rank12%20SAFECount/">
<span class="md-ellipsis">
    rank12 SAFECount
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_6_4" type="checkbox">
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../literature/ObjectDetection/">
<span class="md-ellipsis">
    ç›®æ ‡æ£€æµ‹
    
  </span>
</a>
<label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_6_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_4">
<span class="md-nav__icon md-icon"></span>
            ç›®æ ‡æ£€æµ‹
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/ObjectDetection/2/">
<span class="md-ellipsis">
    ç›®æ ‡æ£€æµ‹åŸºç¡€çŸ¥è¯†
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/ObjectDetection/1/">
<span class="md-ellipsis">
    DETRè®ºæ–‡ç³»åˆ—
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../literature/ObjectDetection/3/">
<span class="md-ellipsis">
    ï¼ˆDETRï¼‰End-to-End Object Detection with Transformer
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_7" type="checkbox">
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../">
<span class="md-ellipsis">
    è®ºæ–‡å¤ç°
    
  </span>
</a>
<label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_7_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
            è®ºæ–‡å¤ç°
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../7_summary/">
<span class="md-ellipsis">
    æ±‡æ€»å¤ç°è°ƒç”¨å›¾
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../DAVE/">
<span class="md-ellipsis">
    DAVEå¤ç°
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../5_SegRNN_index/">
<span class="md-ellipsis">
    SegRNN
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../5_SegRNN_v1/">
<span class="md-ellipsis">
    å¤ç°SegRNN
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../5_SegRNN_v2/">
<span class="md-ellipsis">
    ï¼ˆè¡¥å……ï¼‰å¤ç° SegRNN
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../5_SegRNN_v3/">
<span class="md-ellipsis">
    (æ‰‹å†™ç¬”è®°)SegRNN
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../5_SegRNN_v4/">
<span class="md-ellipsis">
    SegRNNå®éªŒè¿‡ç¨‹
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox">
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Autoformer
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Autoformer
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#github">
<span class="md-ellipsis">
      github æºç ä¸»é¡µ
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_1">
<span class="md-ellipsis">
      å‡†å¤‡
    </span>
</a>
<nav aria-label="å‡†å¤‡" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#git-clone">
<span class="md-ellipsis">
      git clone
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#readme">
<span class="md-ellipsis">
      readme
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_2">
<span class="md-ellipsis">
      è°ƒè¯•é…ç½®
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#python">
<span class="md-ellipsis">
      æ–°å»º python è™šæ‹Ÿç¯å¢ƒ
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#requirements">
<span class="md-ellipsis">
      requirements
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_3">
<span class="md-ellipsis">
      å¼€å§‹è°ƒè¯•
    </span>
</a>
<nav aria-label="å¼€å§‹è°ƒè¯•" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#encoder-embedding">
<span class="md-ellipsis">
      encoder embedding
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_4">
<span class="md-ellipsis">
      æ¨¡å‹å®šä¹‰
    </span>
</a>
<nav aria-label="æ¨¡å‹å®šä¹‰" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_5">
<span class="md-ellipsis">
      ç¼–ç å™¨ è§£ç å™¨éƒ¨åˆ†
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_6">
<span class="md-ellipsis">
      è®­ç»ƒè¿‡ç¨‹ï¼Œå½¢çŠ¶å˜æ¢
    </span>
</a>
<nav aria-label="è®­ç»ƒè¿‡ç¨‹ï¼Œå½¢çŠ¶å˜æ¢" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#autoformer-forward">
<span class="md-ellipsis">
      Autoformer forward
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_7">
<span class="md-ellipsis">
      åºåˆ—åˆ†è§£
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#model-inputs">
<span class="md-ellipsis">
      model inputs
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#encoder">
<span class="md-ellipsis">
      Encoder
    </span>
</a>
<nav aria-label="Encoder" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_8">
<span class="md-ellipsis">
      è®ºæ–‡
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#encoder-embedding_1">
<span class="md-ellipsis">
      Encoder Embedding
    </span>
</a>
<nav aria-label="Encoder Embedding" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_9">
<span class="md-ellipsis">
      ç±»å›¾
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#encoder-forward">
<span class="md-ellipsis">
      Encoder forward
    </span>
</a>
<nav aria-label="Encoder forward" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_10">
<span class="md-ellipsis">
      ç±»å›¾
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#encoderlayer">
<span class="md-ellipsis">
      EncoderLayer
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#decoder">
<span class="md-ellipsis">
      Decoder
    </span>
</a>
<nav aria-label="Decoder" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_11">
<span class="md-ellipsis">
      ç±»å›¾
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_12">
<span class="md-ellipsis">
      è®ºæ–‡
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_13">
<span class="md-ellipsis">
      ä»£ç 
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#decoderlayer-forward">
<span class="md-ellipsis">
      DecoderLayer forward
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_14">
<span class="md-ellipsis">
      æ•°æ®æµåŠ¨å›¾
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#autoformer-forward_1">
<span class="md-ellipsis">
      æ±‡æ€» Autoformer forward
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_15">
<span class="md-ellipsis">
      é™„å½•
    </span>
</a>
<nav aria-label="é™„å½•" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#conv2">
<span class="md-ellipsis">
      ç–‘é—®ä¸€ ä¸ºä»€ä¹ˆConv2ä¹‹åæ²¡æœ‰è¿›è¡Œæ¿€æ´»å‡½æ•°çš„åº”ç”¨
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-conv1d-nnlinear">
<span class="md-ellipsis">
      ç–‘é—® 2 ä¸ºä»€ä¹ˆæ˜¯ conv1dï¼Œè€Œä¸æ˜¯ nn.Linear
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_16">
<span class="md-ellipsis">
      åºåˆ—åˆ†è§£çš„ç°å®æ„ä¹‰
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_17">
<span class="md-ellipsis">
      ç†è§£å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#k-v-q">
<span class="md-ellipsis">
      ç¼–ç å™¨çš„è¾“å‡ºä½œä¸º K å’Œ Vï¼Œè§£ç å™¨çš„è¾“å…¥ä½œä¸º Q
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_18">
<span class="md-ellipsis">
      å¾ªç¯å¡«å……
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_19">
<span class="md-ellipsis">
      ä¸ºä»€ä¹ˆå­£èŠ‚æˆåˆ†å’Œè¶‹åŠ¿æˆåˆ†ä¸åŒçš„è¿˜åŸç»´åº¦æ–¹æ³•
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../6_AutoFormer_v1/">
<span class="md-ellipsis">
    (ç»­) Autoformer
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../6_AutoFormer_v2_eg/">
<span class="md-ellipsis">
    AutoFormer å¯è§†åŒ–ç»“æœ
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../8_ThuML/">
<span class="md-ellipsis">
    thumlå¤ç°
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../9_WITRAN/">
<span class="md-ellipsis">
    WITRANä»£ç å¤ç°
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../10_UNetTSF/">
<span class="md-ellipsis">
    UNetTSF
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_8" type="checkbox">
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../CodeRepo/">
<span class="md-ellipsis">
    python
    
  </span>
</a>
<label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_8_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_8">
<span class="md-nav__icon md-icon"></span>
            python
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../CodeRepo/4_PreTrained/">
<span class="md-ellipsis">
    é¢„è®­ç»ƒæƒé‡
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../CodeRepo/3_args/">
<span class="md-ellipsis">
    ç±»çš„åˆå§‹åŒ–ä¼ å…¥å‘½ä»¤è¡Œå‚æ•°
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../CodeRepo/2_SHHtensorboard/">
<span class="md-ellipsis">
    è¿œç¨‹æœåŠ¡å™¨&amp;tensorboard
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../CodeRepo/2_0_tensorboad/">
<span class="md-ellipsis">
    tensorboardå¯è§†åŒ–
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../CodeRepo/4_PreTrained/">
<span class="md-ellipsis">
    é¢„è®­ç»ƒæƒé‡
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../CodeRepo/1_model/">
<span class="md-ellipsis">
    æŸ¥çœ‹ pytorch ç½‘ç»œç»“æ„
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../CodeRepo/4_self_/">
<span class="md-ellipsis">
    è‡ªæ€»ï¼šæ‰’æ¨¡å—
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../1/">
<span class="md-ellipsis">
    ä¸€äº›æ¨¡å—
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../2/">
<span class="md-ellipsis">
    ç‰¹å¾èåˆæ–¹å¼
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../3/">
<span class="md-ellipsis">
    ä¸€äº›æ„Ÿæ‚Ÿ
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../CodeRepo/1_MultiHeadAttention/">
<span class="md-ellipsis">
    å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶å½¢çŠ¶å˜åŒ–
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../CodeRepo/2_transformer/">
<span class="md-ellipsis">
    ä»ç°å®ç”Ÿæ´»çš„è§’åº¦çœ‹ Transformer
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../CodeRepo/3_fourier/">
<span class="md-ellipsis">
    DFTä¾‹é¢˜
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../CodeRepo/1_0_Autoformer/">
<span class="md-ellipsis">
    Autoformer
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_9" type="checkbox">
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../Statistics/">
<span class="md-ellipsis">
    ç»Ÿè®¡å­¦
    
  </span>
</a>
<label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_9_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_9">
<span class="md-nav__icon md-icon"></span>
            ç»Ÿè®¡å­¦
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../Statistics/1_FFT/">
<span class="md-ellipsis">
    Fourierçº§æ•°
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Statistics/2_FFT/">
<span class="md-ellipsis">
    FourieråŸºç¡€çŸ¥è¯†
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Statistics/1_0_fourier/">
<span class="md-ellipsis">
    å¤å¹³é¢æ—‹è½¬&amp;DFT
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Statistics/1_1_fourier/">
<span class="md-ellipsis">
    ç›´è§‚ç†è§£å‚…é‡Œå¶å˜æ¢
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Statistics/1_2_signal/">
<span class="md-ellipsis">
    ä¿¡å·çš„åˆæˆä¸åˆ†è§£
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Statistics/1_4_signal/">
<span class="md-ellipsis">
    FSã€FTã€DTFSã€DTFT
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Statistics/1_3_complexExp/">
<span class="md-ellipsis">
    å¤æŒ‡æ•°çš„æ€§è´¨
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_10" type="checkbox">
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../logs/">
<span class="md-ellipsis">
    æ”¶çº³ç®±
    
  </span>
</a>
<label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_10_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_10">
<span class="md-nav__icon md-icon"></span>
            æ”¶çº³ç®±
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../logs/1_date/">
<span class="md-ellipsis">
    ä¸€äº›æ—¥æœŸ
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../logs/2_updatelog/">
<span class="md-ellipsis">
    æ›´æ–°æ—¥å¿—
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../logs/4_flink/">
<span class="md-ellipsis">
    æ›´å¤šé“¾æ¥
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../logs/6_waline/">
<span class="md-ellipsis">
    ç•…æ‰€æ¬²è¨€
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../logs/7_backup/">
<span class="md-ellipsis">
    Backup
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_10_7" type="checkbox">
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../logs/1_0_diary/">
<span class="md-ellipsis">
    daily
    
  </span>
</a>
<label class="md-nav__link" for="__nav_10_7" id="__nav_10_7_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_10_7_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_10_7">
<span class="md-nav__icon md-icon"></span>
            daily
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../logs/1_0_diary/2025/0_Question/">
<span class="md-ellipsis">
    é—®é¢˜æ¸…å•
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../logs/1_0_diary/2025/03/">
<span class="md-ellipsis">
    3 æœˆ
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../logs/1_0_diary/2025/04/">
<span class="md-ellipsis">
    4æœˆ
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../logs/diary/">
<span class="md-ellipsis">
    æ›´æ—©ä»¥å‰
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#github">
<span class="md-ellipsis">
      github æºç ä¸»é¡µ
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_1">
<span class="md-ellipsis">
      å‡†å¤‡
    </span>
</a>
<nav aria-label="å‡†å¤‡" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#git-clone">
<span class="md-ellipsis">
      git clone
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#readme">
<span class="md-ellipsis">
      readme
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_2">
<span class="md-ellipsis">
      è°ƒè¯•é…ç½®
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#python">
<span class="md-ellipsis">
      æ–°å»º python è™šæ‹Ÿç¯å¢ƒ
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#requirements">
<span class="md-ellipsis">
      requirements
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_3">
<span class="md-ellipsis">
      å¼€å§‹è°ƒè¯•
    </span>
</a>
<nav aria-label="å¼€å§‹è°ƒè¯•" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#encoder-embedding">
<span class="md-ellipsis">
      encoder embedding
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_4">
<span class="md-ellipsis">
      æ¨¡å‹å®šä¹‰
    </span>
</a>
<nav aria-label="æ¨¡å‹å®šä¹‰" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_5">
<span class="md-ellipsis">
      ç¼–ç å™¨ è§£ç å™¨éƒ¨åˆ†
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_6">
<span class="md-ellipsis">
      è®­ç»ƒè¿‡ç¨‹ï¼Œå½¢çŠ¶å˜æ¢
    </span>
</a>
<nav aria-label="è®­ç»ƒè¿‡ç¨‹ï¼Œå½¢çŠ¶å˜æ¢" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#autoformer-forward">
<span class="md-ellipsis">
      Autoformer forward
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_7">
<span class="md-ellipsis">
      åºåˆ—åˆ†è§£
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#model-inputs">
<span class="md-ellipsis">
      model inputs
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#encoder">
<span class="md-ellipsis">
      Encoder
    </span>
</a>
<nav aria-label="Encoder" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_8">
<span class="md-ellipsis">
      è®ºæ–‡
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#encoder-embedding_1">
<span class="md-ellipsis">
      Encoder Embedding
    </span>
</a>
<nav aria-label="Encoder Embedding" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_9">
<span class="md-ellipsis">
      ç±»å›¾
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#encoder-forward">
<span class="md-ellipsis">
      Encoder forward
    </span>
</a>
<nav aria-label="Encoder forward" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_10">
<span class="md-ellipsis">
      ç±»å›¾
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#encoderlayer">
<span class="md-ellipsis">
      EncoderLayer
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#decoder">
<span class="md-ellipsis">
      Decoder
    </span>
</a>
<nav aria-label="Decoder" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_11">
<span class="md-ellipsis">
      ç±»å›¾
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_12">
<span class="md-ellipsis">
      è®ºæ–‡
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_13">
<span class="md-ellipsis">
      ä»£ç 
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#decoderlayer-forward">
<span class="md-ellipsis">
      DecoderLayer forward
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_14">
<span class="md-ellipsis">
      æ•°æ®æµåŠ¨å›¾
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#autoformer-forward_1">
<span class="md-ellipsis">
      æ±‡æ€» Autoformer forward
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_15">
<span class="md-ellipsis">
      é™„å½•
    </span>
</a>
<nav aria-label="é™„å½•" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#conv2">
<span class="md-ellipsis">
      ç–‘é—®ä¸€ ä¸ºä»€ä¹ˆConv2ä¹‹åæ²¡æœ‰è¿›è¡Œæ¿€æ´»å‡½æ•°çš„åº”ç”¨
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-conv1d-nnlinear">
<span class="md-ellipsis">
      ç–‘é—® 2 ä¸ºä»€ä¹ˆæ˜¯ conv1dï¼Œè€Œä¸æ˜¯ nn.Linear
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_16">
<span class="md-ellipsis">
      åºåˆ—åˆ†è§£çš„ç°å®æ„ä¹‰
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_17">
<span class="md-ellipsis">
      ç†è§£å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#k-v-q">
<span class="md-ellipsis">
      ç¼–ç å™¨çš„è¾“å‡ºä½œä¸º K å’Œ Vï¼Œè§£ç å™¨çš„è¾“å…¥ä½œä¸º Q
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_18">
<span class="md-ellipsis">
      å¾ªç¯å¡«å……
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_19">
<span class="md-ellipsis">
      ä¸ºä»€ä¹ˆå­£èŠ‚æˆåˆ†å’Œè¶‹åŠ¿æˆåˆ†ä¸åŒçš„è¿˜åŸç»´åº¦æ–¹æ³•
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/dearRongerr/Rongerr.github.io/edit/main/docs/Reproduction/6_AutoFormer.md" rel="edit" title="Edit this page">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"></path></svg>
</a>
<a class="md-content__button md-icon" href="https://github.com/dearRongerr/Rongerr.github.io/raw/main/docs/Reproduction/6_AutoFormer.md" title="View source of this page">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"></path></svg>
</a>
<h1 id="autoformer">Autoformer<a class="headerlink" href="#autoformer" title="Permanent link">Â¶</a></h1>
<div class="document-dates-plugin-wrapper document-dates-top"><div class="document-dates-plugin" locale="zh"><span data-tippy-content="" data-tippy-raw="2025-03-19"><span class="material-icons" data-icon="doc_created"></span><time datetime="2025-03-19T20:59:29+08:00">2025-03-19 20:59:29</time></span><span data-tippy-content="" data-tippy-raw="2025-09-28"><span class="material-icons" data-icon="doc_modified"></span><time datetime="2025-09-28T13:26:37.776378+00:00">2025-09-28 13:26:37</time></span><span class="material-icons" data-icon="doc_author"></span><div class="avatar-group"><div class="avatar-wrapper" data-name="dearr" data-tippy-content="" data-tippy-raw="<a href=&quot;mailto:1939472345@qq.com&quot;>dearr</a>"><span class="avatar-text"></span><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="https://avatars.githubusercontent.com/dearRongerr"><img class="avatar" src="https://avatars.githubusercontent.com/dearRongerr"></a></div></div></div></div>
<div style="margin-top: -30px; font-size: 0.75em; opacity: 0.7;">
<p><span class="twemoji"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10h-2a8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8zm6.78 1a.7.7 0 0 0-.48.2l-1.22 1.21 2.5 2.5L20.8 5.7c.26-.26.26-.7 0-.95L19.25 3.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L9 12.5V15h2.5l7.37-7.38z"></path></svg></span> çº¦ 17665 ä¸ªå­— <span class="twemoji"><svg viewBox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M360.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6m64.6 136.1c-12.5 12.5-12.5 32.8 0 45.3l73.4 73.4-73.4 73.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l96-96c12.5-12.5 12.5-32.8 0-45.3l-96-96c-12.5-12.5-32.8-12.5-45.3 0zm-274.7 0c-12.5-12.5-32.8-12.5-45.3 0l-96 96c-12.5 12.5-12.5 32.8 0 45.3l96 96c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l73.3-73.4c12.5-12.5 12.5-32.8 0-45.3z"></path></svg></span> 583 è¡Œä»£ç  <span class="twemoji"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21 17H7V3h14m0-2H7a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2M3 5H1v16a2 2 0 0 0 2 2h16v-2H3m12.96-10.71-2.75 3.54-1.96-2.36L8.5 15h11z"></path></svg></span> 100 å¼ å›¾ç‰‡ <span class="twemoji"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 20c4.42 0 8-3.58 8-8s-3.58-8-8-8-8 3.58-8 8 3.58 8 8 8m0-18c5.5 0 10 4.5 10 10s-4.5 10-10 10C6.47 22 2 17.5 2 12S6.5 2 12 2m.5 11H11V7h1.5v4.26l3.7-2.13.75 1.3z"></path></svg></span> é¢„è®¡é˜…è¯»æ—¶é—´ 96 åˆ†é’Ÿ</p>
</div>
<h2 id="github">github æºç ä¸»é¡µ<a class="headerlink" href="#github" title="Permanent link">Â¶</a></h2>
<p>Autoformer (NeurIPS 2021) è‡ªåŠ¨æˆå‹æœº (NeurIPS 2021)</p>
<p>Autoformer: Decomposition Transformers with Auto-Correlation for Long-Term Series Forecasting
Autoformerï¼šç”¨äºé•¿æœŸåºåˆ—é¢„æµ‹çš„å…·æœ‰è‡ªç›¸å…³çš„åˆ†è§£å˜å‹å™¨</p>
<p>Time series forecasting is a critical demand for real applications. Enlighted by the classic time series analysis and stochastic process theory, we propose the Autoformer as a general series forecasting model [<a href="https://arxiv.org/abs/2106.13008">paper</a>]. <strong>Autoformer goes beyond the Transformer family and achieves the series-wise connection for the first time.</strong>
æ—¶é—´åºåˆ—é¢„æµ‹æ˜¯å®é™…åº”ç”¨çš„å…³é”®éœ€æ±‚ã€‚å—ç»å…¸æ—¶é—´åºåˆ—åˆ†æå’Œéšæœºè¿‡ç¨‹ç†è®ºçš„å¯å‘ï¼Œæˆ‘ä»¬æå‡ºäº† Autoformer ä½œä¸ºé€šç”¨åºåˆ—é¢„æµ‹æ¨¡å‹ [<a href="https://arxiv.org/abs/2106.13008">è®ºæ–‡</a>]ã€‚Autoformer**è¶…è¶Šäº† Transformer å®¶æ—ï¼Œé¦–æ¬¡å®ç°äº†åºåˆ—è¿æ¥ã€‚**</p>
<p>In long-term forecasting, Autoformer achieves SOTA, with a <strong>38% relative improvement</strong> on six benchmarks, covering five practical applications: <strong>energy, traffic, economics, weather and disease</strong>.
åœ¨é•¿æœŸé¢„æµ‹ä¸­ï¼ŒAutoformer å®ç°äº† SOTAï¼Œåœ¨å…­ä¸ªåŸºå‡†ä¸Š**ç›¸å¯¹æå‡äº† 38%** ï¼Œæ¶µç›–äº†**èƒ½æºã€äº¤é€šã€ç»æµã€å¤©æ°”å’Œç–¾ç—…**äº”ä¸ªå®é™…åº”ç”¨ã€‚</p>
<p><strong>News</strong> (2023.08) Autoformer has been included in <a href="https://huggingface.co/models?search=autoformer">Hugging Face</a>. See <a href="https://huggingface.co/blog/autoformer">blog</a>.
ğŸš©<strong>æ–°é—»</strong>(2023.08) Autoformer å·²åŒ…å«åœ¨<a href="https://huggingface.co/models?search=autoformer">Hugging Face</a>ä¸­ã€‚æŸ¥çœ‹<a href="https://huggingface.co/blog/autoformer">åšå®¢</a>ã€‚</p>
<p>ğŸš©<strong>News</strong> (2023.06) The extension version of Autoformer (<a href="https://www.nature.com/articles/s42256-023-00667-9">Interpretable weather forecasting for worldwide stations with a unified deep model</a>) has been published in Nature Machine Intelligence as the <a href="https://www.nature.com/natmachintell/volumes/5/issues/6">Cover Article</a>.
ğŸš©<strong>æ–°é—»</strong>(2023.06) Autoformer çš„æ‰©å±•ç‰ˆæœ¬ (<a href="https://www.nature.com/articles/s42256-023-00667-9">ä½¿ç”¨ç»Ÿä¸€æ·±åº¦æ¨¡å‹ä¸ºå…¨çƒç«™ç‚¹æä¾›å¯è§£é‡Šçš„å¤©æ°”é¢„æŠ¥</a>) åœ¨ã€Šè‡ªç„¶æœºå™¨æ™ºèƒ½ã€‹æ‚å¿—ä¸Šä½œä¸º<a href="https://www.nature.com/natmachintell/volumes/5/issues/6">å°é¢æ–‡ç« </a>å‘è¡¨ã€‚</p>
<p>ğŸš©<strong>News</strong> (2023.02) Autoformer has been included in our [<a href="https://github.com/thuml/Time-Series-Library">Time-Series-Library]</a>, which covers long- and short-term forecasting, imputation, anomaly detection, and classification.
ğŸš©<strong>æ–°é—»</strong>(2023.02) Autoformer å·²åŒ…å«åœ¨æˆ‘ä»¬çš„[<a href="https://github.com/thuml/Time-Series-Library">æ—¶é—´åºåˆ—åº“]</a>ä¸­ï¼Œå®ƒæ¶µç›–é•¿æœŸå’ŒçŸ­æœŸé¢„æµ‹ã€å½’çº³ã€å¼‚å¸¸æ£€æµ‹å’Œåˆ†ç±»ã€‚</p>
<p>ğŸš©<strong>News</strong> (2022.02-2022.03) Autoformer has been deployed in <a href="https://en.wikipedia.org/wiki/2022_Winter_Olympics">2022 Winter Olympics</a> to provide weather forecasting for competition venues, including wind speed and temperature.
ğŸš©<strong>æ–°é—»</strong>ï¼ˆ2022.02-2022.03ï¼‰Autoformer å·²éƒ¨ç½²åœ¨<a href="https://en.wikipedia.org/wiki/2022_Winter_Olympics">2022 å¹´å†¬å¥¥ä¼šï¼Œ</a>ä¸ºæ¯”èµ›åœºé¦†æä¾›å¤©æ°”é¢„æŠ¥ï¼ŒåŒ…æ‹¬é£é€Ÿã€æ¸©åº¦ç­‰ã€‚</p>
<h2 id="_1">å‡†å¤‡<a class="headerlink" href="#_1" title="Permanent link">Â¶</a></h2>
<h3 id="git-clone">git clone<a class="headerlink" href="#git-clone" title="Permanent link">Â¶</a></h3>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250317144505215.png"><img alt="image-20250317144505215" src="../images/image-20250317144505215.png"></a> </p>
<p>å…‹éš†è¿œç¨‹ä»“åº“çš„æ–¹æ³•ï¼š</p>
<p>ï¼ˆ1ï¼‰HTTPSï¼Œåœ¨æŠŠæœ¬åœ°ä»“åº“çš„ä»£ç  push åˆ°è¿œç¨‹ä»“åº“çš„æ—¶å€™ï¼Œéœ€è¦éªŒè¯ç”¨æˆ·åå’Œå¯†ç </p>
<p>ï¼ˆ2ï¼‰SSHï¼Œgit å¼€å¤´çš„æ˜¯ SSH åè®®ï¼Œè¿™ç§æ–¹å¼åœ¨æ¨é€çš„æ—¶å€™ï¼Œä¸éœ€è¦éªŒè¯ç”¨æˆ·åå’Œå¯†ç ï¼Œä½†æ˜¯éœ€è¦åœ¨ github ä¸Šæ·»åŠ SSHå…¬é’¥çš„é…ç½®ï¼ˆæ¨èï¼‰</p>
<p>ï¼ˆ3ï¼‰zip download</p>
<p>æˆ‘è¿™é‡Œä½¿ç”¨äº† SSH é…ç½®ï¼š</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250317144903028.png"><img alt="image-20250317144903028" src="../images/image-20250317144903028.png"></a> </p>
<p>æœåŠ¡å™¨ç›´æ¥ git clone æ˜¯å¾ˆæ…¢ã€‚æ‰€ä»¥æœ¬åœ° git cloneï¼Œç„¶åå†ä¸Šä¼ æœåŠ¡å™¨ã€‚</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250317145242243.png"><img alt="image-20250317145242243" src="../images/image-20250317145242243.png"></a> </p>
<p>æœ¬åœ°ä¸‹è½½å¥½ä»¥åï¼Œä½¿ç”¨ FileZillaä¸Šä¼ åˆ°è¿œç¨‹æœåŠ¡å™¨</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250317145427044.png"><img alt="image-20250317145427044" src="../images/image-20250317145427044.png"></a> </p>
<p>downåˆ°æœ¬åœ°ä»¥åï¼Œåˆ é™¤ .gitæ–‡ä»¶ï¼Œå–æ¶ˆè¿æ¥ç€è¿œç¨‹ä»“åº“</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250317145705700.png"><img alt="image-20250317145705700" src="../images/image-20250317145705700.png"></a> </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250317145752968.png"><img alt="image-20250317145752968" src="../images/image-20250317145752968.png"></a> </p>
<h3 id="readme">readme<a class="headerlink" href="#readme" title="Permanent link">Â¶</a></h3>
<p>ä¸‹è½½æ•°æ®é›†</p>
<p>è®¾ç½®æ•°æ®é›†è·¯å¾„</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250317150739551.png"><img alt="image-20250317150739551" src="../images/image-20250317150739551.png"></a> </p>
<h3 id="_2">è°ƒè¯•é…ç½®<a class="headerlink" href="#_2" title="Permanent link">Â¶</a></h3>
<p>æ–°å»ºé…ç½®æ–‡ä»¶</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250317150852423.png"><img alt="image-20250317150852423" src="../images/image-20250317150852423.png"></a> </p>
<p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250317151048416.png"><img alt="image-20250317151048416" src="../images/image-20250317151048416.png"></a> </p>
<p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a><a href="#__codelineno-0-1"><span class="linenos" data-linenos="1 "></span></a>        {
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a><a href="#__codelineno-0-2"><span class="linenos" data-linenos="2 "></span></a>            "name": "Autoformer",
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3"></a><a href="#__codelineno-0-3"><span class="linenos" data-linenos="3 "></span></a>            "type": "python",
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4"></a><a href="#__codelineno-0-4"><span class="linenos" data-linenos="4 "></span></a>            "request": "attach",
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5"></a><a href="#__codelineno-0-5"><span class="linenos" data-linenos="5 "></span></a>            "connect": {
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><a href="#__codelineno-0-6"><span class="linenos" data-linenos="6 "></span></a>                "host": "localhost",
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><a href="#__codelineno-0-7"><span class="linenos" data-linenos="7 "></span></a>                "port": 5997
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a><a href="#__codelineno-0-8"><span class="linenos" data-linenos="8 "></span></a>            }
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a><a href="#__codelineno-0-9"><span class="linenos" data-linenos="9 "></span></a>        },
</span></code></pre></div>
<p>ä¿®æ”¹ sh æ–‡ä»¶</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a><a href="#__codelineno-1-1"><span class="linenos" data-linenos="1 "></span></a>python -m debugpy --listen 5997 --wait-for-client run.py \
</span></code></pre></div>
<h3 id="python">æ–°å»º python è™šæ‹Ÿç¯å¢ƒ<a class="headerlink" href="#python" title="Permanent link">Â¶</a></h3>
<p>æœ¬å®éªŒæ‰€éœ€è¦çš„å®éªŒç¯å¢ƒ</p>
<blockquote>
<p>Install Python 3.6, PyTorch 1.9.0.</p>
</blockquote>
<p>å‚è€ƒå‘½ä»¤</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1"></a><a href="#__codelineno-2-1"><span class="linenos" data-linenos="1 "></span></a>conda create -n dave python==3.8
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2"></a><a href="#__codelineno-2-2"><span class="linenos" data-linenos="2 "></span></a>conda activate dave
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3"></a><a href="#__codelineno-2-3"><span class="linenos" data-linenos="3 "></span></a>conda install pytorch==2.1.2 torchvision==0.16.2 torchaudio==2.1.2 pytorch-cuda=11.8 -c pytorch -c nvidia
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4"></a><a href="#__codelineno-2-4"><span class="linenos" data-linenos="4 "></span></a>conda install numpy
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5"></a><a href="#__codelineno-2-5"><span class="linenos" data-linenos="5 "></span></a>conda install scikit-image
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6"></a><a href="#__codelineno-2-6"><span class="linenos" data-linenos="6 "></span></a>conda install scikit-learn
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7"></a><a href="#__codelineno-2-7"><span class="linenos" data-linenos="7 "></span></a>conda install tqdm
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8"></a><a href="#__codelineno-2-8"><span class="linenos" data-linenos="8 "></span></a>conda install pycocotools
</span></code></pre></div>
<p>æ¿€æ´»ã€é€€å‡ºï¼š</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1"></a><a href="#__codelineno-3-1"><span class="linenos" data-linenos="1 "></span></a># To activate this environment, use               
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2"></a><a href="#__codelineno-3-2"><span class="linenos" data-linenos="2 "></span></a>#     $ conda activate Autoformer
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3"></a><a href="#__codelineno-3-3"><span class="linenos" data-linenos="3 "></span></a>#
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4"></a><a href="#__codelineno-3-4"><span class="linenos" data-linenos="4 "></span></a># To deactivate an active environment, use
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5"></a><a href="#__codelineno-3-5"><span class="linenos" data-linenos="5 "></span></a>#
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6"></a><a href="#__codelineno-3-6"><span class="linenos" data-linenos="6 "></span></a>#     $ conda deactivate
</span></code></pre></div>
<p>ç”¨ requirements.txt å®‰è£…éœ€è¦çš„åº“</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1"></a><a href="#__codelineno-4-1"><span class="linenos" data-linenos="1 "></span></a>conda create -n SegRNN python=3.8
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2"></a><a href="#__codelineno-4-2"><span class="linenos" data-linenos="2 "></span></a>conda activate SegRNN
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3"></a><a href="#__codelineno-4-3"><span class="linenos" data-linenos="3 "></span></a>pip install -r requirements.txt
</span></code></pre></div>
<p>å¯åŠ¨ sh æ–‡ä»¶ï¼š</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1"></a><a href="#__codelineno-5-1"><span class="linenos" data-linenos="1 "></span></a>sh run_main.sh
</span></code></pre></div>
<p><strong>é€‚ç”¨äºæœ¬å®éªŒçš„æ‰€æœ‰å‘½ä»¤ :</strong></p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1"></a><a href="#__codelineno-6-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">conda</span> <span class="n">create</span> <span class="o">-</span><span class="n">n</span> <span class="n">Autoformer</span> <span class="n">python</span><span class="o">=</span><span class="mf">3.6</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2"></a><a href="#__codelineno-6-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">conda</span> <span class="n">activate</span> <span class="n">Autoformer</span>
</span></code></pre></div>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1"></a><a href="#__codelineno-7-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">conda</span> <span class="n">env</span> <span class="nb">list</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2"></a><a href="#__codelineno-7-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">conda</span> <span class="n">actiavte</span> <span class="n">ç¯å¢ƒå</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3"></a><a href="#__codelineno-7-3"><span class="linenos" data-linenos="3 "></span></a><span class="n">conda</span> <span class="n">deactivate</span>
</span></code></pre></div>
<p><a href="https://pytorch.org/">pytorch å®˜ç½‘</a>æŸ¥çœ‹æ‰€éœ€å‘½ä»¤</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250317154037815.png"><img alt="image-20250317154037815" src="../images/image-20250317154037815.png"></a> </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250317153952283.png"><img alt="image-20250317153952283" src="../images/image-20250317153952283.png"></a></p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1"></a><a href="#__codelineno-8-1"><span class="linenos" data-linenos="1 "></span></a>conda install pytorch==1.9.0 torchvision==0.10.0 torchaudio==0.9.0 cudatoolkit=10.2 -c pytorch
</span></code></pre></div>
<h3 id="requirements">requirements<a class="headerlink" href="#requirements" title="Permanent link">Â¶</a></h3>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1"></a><a href="#__codelineno-9-1"><span class="linenos" data-linenos="1 "></span></a>pip install -r requirements.txt
</span></code></pre></div>
<p>æˆ–è€…ï¼š</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1"></a><a href="#__codelineno-10-1"><span class="linenos" data-linenos="1 "></span></a>conda create -n Autoformer python=3.6
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2"></a><a href="#__codelineno-10-2"><span class="linenos" data-linenos="2 "></span></a>conda activate Autoformer
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3"></a><a href="#__codelineno-10-3"><span class="linenos" data-linenos="3 "></span></a>conda install pytorch==1.9.0 torchvision==0.10.0 torchaudio==0.9.0 cudatoolkit=10.2 -c pytorch
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4"></a><a href="#__codelineno-10-4"><span class="linenos" data-linenos="4 "></span></a>conda install pandas
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5"></a><a href="#__codelineno-10-5"><span class="linenos" data-linenos="5 "></span></a>conda install scikit-learn
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6"></a><a href="#__codelineno-10-6"><span class="linenos" data-linenos="6 "></span></a>conda install debugpy
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7"></a><a href="#__codelineno-10-7"><span class="linenos" data-linenos="7 "></span></a>conda install matplotlib
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8"></a><a href="#__codelineno-10-8"><span class="linenos" data-linenos="8 "></span></a>conda install reformer_pytorch
</span></code></pre></div>
<p>é…ç½®å¥½ä»¥åï¼ŒæˆåŠŸè¿›å…¥è°ƒè¯•ï¼š</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250317155629524.png"><img alt="image-20250317155629524" src="../images/image-20250317155629524.png"></a> </p>
<h2 id="_3">å¼€å§‹è°ƒè¯•<a class="headerlink" href="#_3" title="Permanent link">Â¶</a></h2>
<p>ä»£ç ç›¸ä¼¼åº¦æé«˜ã€‚</p>
<p><strong>Autoformer initï¼š36ï¼ˆ18ï¼‰-ã€‹24</strong></p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250317160059801.png"><img alt="image-20250317160059801" src="../images/image-20250317160059801.png"></a></p>
<p>setting:</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1"></a><a href="#__codelineno-11-1"><span class="linenos" data-linenos="1 "></span></a>ili_36_24_Autoformer_custom_ftM_sl36_ll18_pl24_dm512_nh8_el2_dl1_df2048_fc3_ebtimeF_dtTrue_Exp_0
</span></code></pre></div>
<p>model_id  36 é¢„æµ‹ 24 æ­¥é•¿ï¼ˆlabel=18ï¼‰ã€AutoFormer æ¨¡å‹ï¼Œè‡ªå®šä¹‰æ•°æ®é›†ï¼Œé¢„æµ‹å¤šå˜é‡ï¼Œè¾“å…¥åºåˆ— 36ï¼Œæ ‡ç­¾åºåˆ— 18ï¼Œé¢„æµ‹åºåˆ— 24ï¼ŒåµŒå…¥ç»´åº¦ 512ï¼Œæ³¨æ„åŠ›å¤´æ•° 8ï¼Œ2å±‚ç¼–ç å±‚ï¼Œ1 å±‚è§£ç å±‚ï¼Œ</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1"></a><a href="#__codelineno-12-1"><span class="linenos" data-linenos="1 "></span></a>df2048_fc3_ebtimeF_dtTrue_Exp_0
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2"></a><a href="#__codelineno-12-2"><span class="linenos" data-linenos="2 "></span></a>                args.d_ff,
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3"></a><a href="#__codelineno-12-3"><span class="linenos" data-linenos="3 "></span></a>                args.factor,
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4"></a><a href="#__codelineno-12-4"><span class="linenos" data-linenos="4 "></span></a>                args.embed,
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5"></a><a href="#__codelineno-12-5"><span class="linenos" data-linenos="5 "></span></a>                args.distil,
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6"></a><a href="#__codelineno-12-6"><span class="linenos" data-linenos="6 "></span></a>                args.des, ii)
</span></code></pre></div>
<p><strong>Autoformer model</strong></p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1"></a><a href="#__codelineno-13-1"><span class="linenos" data-linenos="  1 "></span></a><span class="n">Model</span><span class="p">(</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2"></a><a href="#__codelineno-13-2"><span class="linenos" data-linenos="  2 "></span></a>  <span class="p">(</span><span class="n">decomp</span><span class="p">):</span> <span class="n">series_decomp</span><span class="p">(</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3"></a><a href="#__codelineno-13-3"><span class="linenos" data-linenos="  3 "></span></a>    <span class="p">(</span><span class="n">moving_avg</span><span class="p">):</span> <span class="n">moving_avg</span><span class="p">(</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4"></a><a href="#__codelineno-13-4"><span class="linenos" data-linenos="  4 "></span></a>      <span class="p">(</span><span class="n">avg</span><span class="p">):</span> <span class="n">AvgPool1d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5"></a><a href="#__codelineno-13-5"><span class="linenos" data-linenos="  5 "></span></a>    <span class="p">)</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6"></a><a href="#__codelineno-13-6"><span class="linenos" data-linenos="  6 "></span></a>  <span class="p">)</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7"></a><a href="#__codelineno-13-7"><span class="linenos" data-linenos="  7 "></span></a>  <span class="p">(</span><span class="n">enc_embedding</span><span class="p">):</span> <span class="n">DataEmbedding_wo_pos</span><span class="p">(</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8"></a><a href="#__codelineno-13-8"><span class="linenos" data-linenos="  8 "></span></a>    <span class="p">(</span><span class="n">value_embedding</span><span class="p">):</span> <span class="n">TokenEmbedding</span><span class="p">(</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9"></a><a href="#__codelineno-13-9"><span class="linenos" data-linenos="  9 "></span></a>      <span class="p">(</span><span class="n">tokenConv</span><span class="p">):</span> <span class="n">Conv1d</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">padding_mode</span><span class="o">=</span><span class="n">circular</span><span class="p">)</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10"></a><a href="#__codelineno-13-10"><span class="linenos" data-linenos=" 10 "></span></a>    <span class="p">)</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11"></a><a href="#__codelineno-13-11"><span class="linenos" data-linenos=" 11 "></span></a>    <span class="p">(</span><span class="n">position_embedding</span><span class="p">):</span> <span class="n">PositionalEmbedding</span><span class="p">()</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12"></a><a href="#__codelineno-13-12"><span class="linenos" data-linenos=" 12 "></span></a>    <span class="p">(</span><span class="n">temporal_embedding</span><span class="p">):</span> <span class="n">TimeFeatureEmbedding</span><span class="p">(</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13"></a><a href="#__codelineno-13-13"><span class="linenos" data-linenos=" 13 "></span></a>      <span class="p">(</span><span class="n">embed</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14"></a><a href="#__codelineno-13-14"><span class="linenos" data-linenos=" 14 "></span></a>    <span class="p">)</span>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15"></a><a href="#__codelineno-13-15"><span class="linenos" data-linenos=" 15 "></span></a>    <span class="p">(</span><span class="n">dropout</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16"></a><a href="#__codelineno-13-16"><span class="linenos" data-linenos=" 16 "></span></a>  <span class="p">)</span>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17"></a><a href="#__codelineno-13-17"><span class="linenos" data-linenos=" 17 "></span></a>  <span class="p">(</span><span class="n">dec_embedding</span><span class="p">):</span> <span class="n">DataEmbedding_wo_pos</span><span class="p">(</span>
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18"></a><a href="#__codelineno-13-18"><span class="linenos" data-linenos=" 18 "></span></a>    <span class="p">(</span><span class="n">value_embedding</span><span class="p">):</span> <span class="n">TokenEmbedding</span><span class="p">(</span>
</span><span id="__span-13-19"><a id="__codelineno-13-19" name="__codelineno-13-19"></a><a href="#__codelineno-13-19"><span class="linenos" data-linenos=" 19 "></span></a>      <span class="p">(</span><span class="n">tokenConv</span><span class="p">):</span> <span class="n">Conv1d</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">padding_mode</span><span class="o">=</span><span class="n">circular</span><span class="p">)</span>
</span><span id="__span-13-20"><a id="__codelineno-13-20" name="__codelineno-13-20"></a><a href="#__codelineno-13-20"><span class="linenos" data-linenos=" 20 "></span></a>    <span class="p">)</span>
</span><span id="__span-13-21"><a id="__codelineno-13-21" name="__codelineno-13-21"></a><a href="#__codelineno-13-21"><span class="linenos" data-linenos=" 21 "></span></a>    <span class="p">(</span><span class="n">position_embedding</span><span class="p">):</span> <span class="n">PositionalEmbedding</span><span class="p">()</span>
</span><span id="__span-13-22"><a id="__codelineno-13-22" name="__codelineno-13-22"></a><a href="#__codelineno-13-22"><span class="linenos" data-linenos=" 22 "></span></a>    <span class="p">(</span><span class="n">temporal_embedding</span><span class="p">):</span> <span class="n">TimeFeatureEmbedding</span><span class="p">(</span>
</span><span id="__span-13-23"><a id="__codelineno-13-23" name="__codelineno-13-23"></a><a href="#__codelineno-13-23"><span class="linenos" data-linenos=" 23 "></span></a>      <span class="p">(</span><span class="n">embed</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-24"><a id="__codelineno-13-24" name="__codelineno-13-24"></a><a href="#__codelineno-13-24"><span class="linenos" data-linenos=" 24 "></span></a>    <span class="p">)</span>
</span><span id="__span-13-25"><a id="__codelineno-13-25" name="__codelineno-13-25"></a><a href="#__codelineno-13-25"><span class="linenos" data-linenos=" 25 "></span></a>    <span class="p">(</span><span class="n">dropout</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-26"><a id="__codelineno-13-26" name="__codelineno-13-26"></a><a href="#__codelineno-13-26"><span class="linenos" data-linenos=" 26 "></span></a>  <span class="p">)</span>
</span><span id="__span-13-27"><a id="__codelineno-13-27" name="__codelineno-13-27"></a><a href="#__codelineno-13-27"><span class="linenos" data-linenos=" 27 "></span></a>  <span class="p">(</span><span class="n">encoder</span><span class="p">):</span> <span class="n">Encoder</span><span class="p">(</span>
</span><span id="__span-13-28"><a id="__codelineno-13-28" name="__codelineno-13-28"></a><a href="#__codelineno-13-28"><span class="linenos" data-linenos=" 28 "></span></a>    <span class="p">(</span><span class="n">attn_layers</span><span class="p">):</span> <span class="n">ModuleList</span><span class="p">(</span>
</span><span id="__span-13-29"><a id="__codelineno-13-29" name="__codelineno-13-29"></a><a href="#__codelineno-13-29"><span class="linenos" data-linenos=" 29 "></span></a>      <span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">EncoderLayer</span><span class="p">(</span>
</span><span id="__span-13-30"><a id="__codelineno-13-30" name="__codelineno-13-30"></a><a href="#__codelineno-13-30"><span class="linenos" data-linenos=" 30 "></span></a>        <span class="p">(</span><span class="n">attention</span><span class="p">):</span> <span class="n">AutoCorrelationLayer</span><span class="p">(</span>
</span><span id="__span-13-31"><a id="__codelineno-13-31" name="__codelineno-13-31"></a><a href="#__codelineno-13-31"><span class="linenos" data-linenos=" 31 "></span></a>          <span class="p">(</span><span class="n">inner_correlation</span><span class="p">):</span> <span class="n">AutoCorrelation</span><span class="p">(</span>
</span><span id="__span-13-32"><a id="__codelineno-13-32" name="__codelineno-13-32"></a><a href="#__codelineno-13-32"><span class="linenos" data-linenos=" 32 "></span></a>            <span class="p">(</span><span class="n">dropout</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-33"><a id="__codelineno-13-33" name="__codelineno-13-33"></a><a href="#__codelineno-13-33"><span class="linenos" data-linenos=" 33 "></span></a>          <span class="p">)</span>
</span><span id="__span-13-34"><a id="__codelineno-13-34" name="__codelineno-13-34"></a><a href="#__codelineno-13-34"><span class="linenos" data-linenos=" 34 "></span></a>          <span class="p">(</span><span class="n">query_projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-35"><a id="__codelineno-13-35" name="__codelineno-13-35"></a><a href="#__codelineno-13-35"><span class="linenos" data-linenos=" 35 "></span></a>          <span class="p">(</span><span class="n">key_projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-36"><a id="__codelineno-13-36" name="__codelineno-13-36"></a><a href="#__codelineno-13-36"><span class="linenos" data-linenos=" 36 "></span></a>          <span class="p">(</span><span class="n">value_projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-37"><a id="__codelineno-13-37" name="__codelineno-13-37"></a><a href="#__codelineno-13-37"><span class="linenos" data-linenos=" 37 "></span></a>          <span class="p">(</span><span class="n">out_projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-38"><a id="__codelineno-13-38" name="__codelineno-13-38"></a><a href="#__codelineno-13-38"><span class="linenos" data-linenos=" 38 "></span></a>        <span class="p">)</span>
</span><span id="__span-13-39"><a id="__codelineno-13-39" name="__codelineno-13-39"></a><a href="#__codelineno-13-39"><span class="linenos" data-linenos=" 39 "></span></a>        <span class="p">(</span><span class="n">conv1</span><span class="p">):</span> <span class="n">Conv1d</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">2048</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-40"><a id="__codelineno-13-40" name="__codelineno-13-40"></a><a href="#__codelineno-13-40"><span class="linenos" data-linenos=" 40 "></span></a>        <span class="p">(</span><span class="n">conv2</span><span class="p">):</span> <span class="n">Conv1d</span><span class="p">(</span><span class="mi">2048</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-41"><a id="__codelineno-13-41" name="__codelineno-13-41"></a><a href="#__codelineno-13-41"><span class="linenos" data-linenos=" 41 "></span></a>        <span class="p">(</span><span class="n">decomp1</span><span class="p">):</span> <span class="n">series_decomp</span><span class="p">(</span>
</span><span id="__span-13-42"><a id="__codelineno-13-42" name="__codelineno-13-42"></a><a href="#__codelineno-13-42"><span class="linenos" data-linenos=" 42 "></span></a>          <span class="p">(</span><span class="n">moving_avg</span><span class="p">):</span> <span class="n">moving_avg</span><span class="p">(</span>
</span><span id="__span-13-43"><a id="__codelineno-13-43" name="__codelineno-13-43"></a><a href="#__codelineno-13-43"><span class="linenos" data-linenos=" 43 "></span></a>            <span class="p">(</span><span class="n">avg</span><span class="p">):</span> <span class="n">AvgPool1d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
</span><span id="__span-13-44"><a id="__codelineno-13-44" name="__codelineno-13-44"></a><a href="#__codelineno-13-44"><span class="linenos" data-linenos=" 44 "></span></a>          <span class="p">)</span>
</span><span id="__span-13-45"><a id="__codelineno-13-45" name="__codelineno-13-45"></a><a href="#__codelineno-13-45"><span class="linenos" data-linenos=" 45 "></span></a>        <span class="p">)</span>
</span><span id="__span-13-46"><a id="__codelineno-13-46" name="__codelineno-13-46"></a><a href="#__codelineno-13-46"><span class="linenos" data-linenos=" 46 "></span></a>        <span class="p">(</span><span class="n">decomp2</span><span class="p">):</span> <span class="n">series_decomp</span><span class="p">(</span>
</span><span id="__span-13-47"><a id="__codelineno-13-47" name="__codelineno-13-47"></a><a href="#__codelineno-13-47"><span class="linenos" data-linenos=" 47 "></span></a>          <span class="p">(</span><span class="n">moving_avg</span><span class="p">):</span> <span class="n">moving_avg</span><span class="p">(</span>
</span><span id="__span-13-48"><a id="__codelineno-13-48" name="__codelineno-13-48"></a><a href="#__codelineno-13-48"><span class="linenos" data-linenos=" 48 "></span></a>            <span class="p">(</span><span class="n">avg</span><span class="p">):</span> <span class="n">AvgPool1d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
</span><span id="__span-13-49"><a id="__codelineno-13-49" name="__codelineno-13-49"></a><a href="#__codelineno-13-49"><span class="linenos" data-linenos=" 49 "></span></a>          <span class="p">)</span>
</span><span id="__span-13-50"><a id="__codelineno-13-50" name="__codelineno-13-50"></a><a href="#__codelineno-13-50"><span class="linenos" data-linenos=" 50 "></span></a>        <span class="p">)</span>
</span><span id="__span-13-51"><a id="__codelineno-13-51" name="__codelineno-13-51"></a><a href="#__codelineno-13-51"><span class="linenos" data-linenos=" 51 "></span></a>        <span class="p">(</span><span class="n">dropout</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-52"><a id="__codelineno-13-52" name="__codelineno-13-52"></a><a href="#__codelineno-13-52"><span class="linenos" data-linenos=" 52 "></span></a>      <span class="p">)</span>
</span><span id="__span-13-53"><a id="__codelineno-13-53" name="__codelineno-13-53"></a><a href="#__codelineno-13-53"><span class="linenos" data-linenos=" 53 "></span></a>      <span class="p">(</span><span class="mi">1</span><span class="p">):</span> <span class="n">EncoderLayer</span><span class="p">(</span>
</span><span id="__span-13-54"><a id="__codelineno-13-54" name="__codelineno-13-54"></a><a href="#__codelineno-13-54"><span class="linenos" data-linenos=" 54 "></span></a>        <span class="p">(</span><span class="n">attention</span><span class="p">):</span> <span class="n">AutoCorrelationLayer</span><span class="p">(</span>
</span><span id="__span-13-55"><a id="__codelineno-13-55" name="__codelineno-13-55"></a><a href="#__codelineno-13-55"><span class="linenos" data-linenos=" 55 "></span></a>          <span class="p">(</span><span class="n">inner_correlation</span><span class="p">):</span> <span class="n">AutoCorrelation</span><span class="p">(</span>
</span><span id="__span-13-56"><a id="__codelineno-13-56" name="__codelineno-13-56"></a><a href="#__codelineno-13-56"><span class="linenos" data-linenos=" 56 "></span></a>            <span class="p">(</span><span class="n">dropout</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-57"><a id="__codelineno-13-57" name="__codelineno-13-57"></a><a href="#__codelineno-13-57"><span class="linenos" data-linenos=" 57 "></span></a>          <span class="p">)</span>
</span><span id="__span-13-58"><a id="__codelineno-13-58" name="__codelineno-13-58"></a><a href="#__codelineno-13-58"><span class="linenos" data-linenos=" 58 "></span></a>          <span class="p">(</span><span class="n">query_projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-59"><a id="__codelineno-13-59" name="__codelineno-13-59"></a><a href="#__codelineno-13-59"><span class="linenos" data-linenos=" 59 "></span></a>          <span class="p">(</span><span class="n">key_projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-60"><a id="__codelineno-13-60" name="__codelineno-13-60"></a><a href="#__codelineno-13-60"><span class="linenos" data-linenos=" 60 "></span></a>          <span class="p">(</span><span class="n">value_projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-61"><a id="__codelineno-13-61" name="__codelineno-13-61"></a><a href="#__codelineno-13-61"><span class="linenos" data-linenos=" 61 "></span></a>          <span class="p">(</span><span class="n">out_projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-62"><a id="__codelineno-13-62" name="__codelineno-13-62"></a><a href="#__codelineno-13-62"><span class="linenos" data-linenos=" 62 "></span></a>        <span class="p">)</span>
</span><span id="__span-13-63"><a id="__codelineno-13-63" name="__codelineno-13-63"></a><a href="#__codelineno-13-63"><span class="linenos" data-linenos=" 63 "></span></a>        <span class="p">(</span><span class="n">conv1</span><span class="p">):</span> <span class="n">Conv1d</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">2048</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-64"><a id="__codelineno-13-64" name="__codelineno-13-64"></a><a href="#__codelineno-13-64"><span class="linenos" data-linenos=" 64 "></span></a>        <span class="p">(</span><span class="n">conv2</span><span class="p">):</span> <span class="n">Conv1d</span><span class="p">(</span><span class="mi">2048</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-65"><a id="__codelineno-13-65" name="__codelineno-13-65"></a><a href="#__codelineno-13-65"><span class="linenos" data-linenos=" 65 "></span></a>        <span class="p">(</span><span class="n">decomp1</span><span class="p">):</span> <span class="n">series_decomp</span><span class="p">(</span>
</span><span id="__span-13-66"><a id="__codelineno-13-66" name="__codelineno-13-66"></a><a href="#__codelineno-13-66"><span class="linenos" data-linenos=" 66 "></span></a>          <span class="p">(</span><span class="n">moving_avg</span><span class="p">):</span> <span class="n">moving_avg</span><span class="p">(</span>
</span><span id="__span-13-67"><a id="__codelineno-13-67" name="__codelineno-13-67"></a><a href="#__codelineno-13-67"><span class="linenos" data-linenos=" 67 "></span></a>            <span class="p">(</span><span class="n">avg</span><span class="p">):</span> <span class="n">AvgPool1d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
</span><span id="__span-13-68"><a id="__codelineno-13-68" name="__codelineno-13-68"></a><a href="#__codelineno-13-68"><span class="linenos" data-linenos=" 68 "></span></a>          <span class="p">)</span>
</span><span id="__span-13-69"><a id="__codelineno-13-69" name="__codelineno-13-69"></a><a href="#__codelineno-13-69"><span class="linenos" data-linenos=" 69 "></span></a>        <span class="p">)</span>
</span><span id="__span-13-70"><a id="__codelineno-13-70" name="__codelineno-13-70"></a><a href="#__codelineno-13-70"><span class="linenos" data-linenos=" 70 "></span></a>        <span class="p">(</span><span class="n">decomp2</span><span class="p">):</span> <span class="n">series_decomp</span><span class="p">(</span>
</span><span id="__span-13-71"><a id="__codelineno-13-71" name="__codelineno-13-71"></a><a href="#__codelineno-13-71"><span class="linenos" data-linenos=" 71 "></span></a>          <span class="p">(</span><span class="n">moving_avg</span><span class="p">):</span> <span class="n">moving_avg</span><span class="p">(</span>
</span><span id="__span-13-72"><a id="__codelineno-13-72" name="__codelineno-13-72"></a><a href="#__codelineno-13-72"><span class="linenos" data-linenos=" 72 "></span></a>            <span class="p">(</span><span class="n">avg</span><span class="p">):</span> <span class="n">AvgPool1d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
</span><span id="__span-13-73"><a id="__codelineno-13-73" name="__codelineno-13-73"></a><a href="#__codelineno-13-73"><span class="linenos" data-linenos=" 73 "></span></a>          <span class="p">)</span>
</span><span id="__span-13-74"><a id="__codelineno-13-74" name="__codelineno-13-74"></a><a href="#__codelineno-13-74"><span class="linenos" data-linenos=" 74 "></span></a>        <span class="p">)</span>
</span><span id="__span-13-75"><a id="__codelineno-13-75" name="__codelineno-13-75"></a><a href="#__codelineno-13-75"><span class="linenos" data-linenos=" 75 "></span></a>        <span class="p">(</span><span class="n">dropout</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-76"><a id="__codelineno-13-76" name="__codelineno-13-76"></a><a href="#__codelineno-13-76"><span class="linenos" data-linenos=" 76 "></span></a>      <span class="p">)</span>
</span><span id="__span-13-77"><a id="__codelineno-13-77" name="__codelineno-13-77"></a><a href="#__codelineno-13-77"><span class="linenos" data-linenos=" 77 "></span></a>    <span class="p">)</span>
</span><span id="__span-13-78"><a id="__codelineno-13-78" name="__codelineno-13-78"></a><a href="#__codelineno-13-78"><span class="linenos" data-linenos=" 78 "></span></a>    <span class="p">(</span><span class="n">norm</span><span class="p">):</span> <span class="n">my_Layernorm</span><span class="p">(</span>
</span><span id="__span-13-79"><a id="__codelineno-13-79" name="__codelineno-13-79"></a><a href="#__codelineno-13-79"><span class="linenos" data-linenos=" 79 "></span></a>      <span class="p">(</span><span class="n">layernorm</span><span class="p">):</span> <span class="n">LayerNorm</span><span class="p">((</span><span class="mi">512</span><span class="p">,),</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">elementwise_affine</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-80"><a id="__codelineno-13-80" name="__codelineno-13-80"></a><a href="#__codelineno-13-80"><span class="linenos" data-linenos=" 80 "></span></a>    <span class="p">)</span>
</span><span id="__span-13-81"><a id="__codelineno-13-81" name="__codelineno-13-81"></a><a href="#__codelineno-13-81"><span class="linenos" data-linenos=" 81 "></span></a>  <span class="p">)</span>
</span><span id="__span-13-82"><a id="__codelineno-13-82" name="__codelineno-13-82"></a><a href="#__codelineno-13-82"><span class="linenos" data-linenos=" 82 "></span></a>  <span class="p">(</span><span class="n">decoder</span><span class="p">):</span> <span class="n">Decoder</span><span class="p">(</span>
</span><span id="__span-13-83"><a id="__codelineno-13-83" name="__codelineno-13-83"></a><a href="#__codelineno-13-83"><span class="linenos" data-linenos=" 83 "></span></a>    <span class="p">(</span><span class="n">layers</span><span class="p">):</span> <span class="n">ModuleList</span><span class="p">(</span>
</span><span id="__span-13-84"><a id="__codelineno-13-84" name="__codelineno-13-84"></a><a href="#__codelineno-13-84"><span class="linenos" data-linenos=" 84 "></span></a>      <span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">DecoderLayer</span><span class="p">(</span>
</span><span id="__span-13-85"><a id="__codelineno-13-85" name="__codelineno-13-85"></a><a href="#__codelineno-13-85"><span class="linenos" data-linenos=" 85 "></span></a>        <span class="p">(</span><span class="n">self_attention</span><span class="p">):</span> <span class="n">AutoCorrelationLayer</span><span class="p">(</span>
</span><span id="__span-13-86"><a id="__codelineno-13-86" name="__codelineno-13-86"></a><a href="#__codelineno-13-86"><span class="linenos" data-linenos=" 86 "></span></a>          <span class="p">(</span><span class="n">inner_correlation</span><span class="p">):</span> <span class="n">AutoCorrelation</span><span class="p">(</span>
</span><span id="__span-13-87"><a id="__codelineno-13-87" name="__codelineno-13-87"></a><a href="#__codelineno-13-87"><span class="linenos" data-linenos=" 87 "></span></a>            <span class="p">(</span><span class="n">dropout</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-88"><a id="__codelineno-13-88" name="__codelineno-13-88"></a><a href="#__codelineno-13-88"><span class="linenos" data-linenos=" 88 "></span></a>          <span class="p">)</span>
</span><span id="__span-13-89"><a id="__codelineno-13-89" name="__codelineno-13-89"></a><a href="#__codelineno-13-89"><span class="linenos" data-linenos=" 89 "></span></a>          <span class="p">(</span><span class="n">query_projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-90"><a id="__codelineno-13-90" name="__codelineno-13-90"></a><a href="#__codelineno-13-90"><span class="linenos" data-linenos=" 90 "></span></a>          <span class="p">(</span><span class="n">key_projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-91"><a id="__codelineno-13-91" name="__codelineno-13-91"></a><a href="#__codelineno-13-91"><span class="linenos" data-linenos=" 91 "></span></a>          <span class="p">(</span><span class="n">value_projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-92"><a id="__codelineno-13-92" name="__codelineno-13-92"></a><a href="#__codelineno-13-92"><span class="linenos" data-linenos=" 92 "></span></a>          <span class="p">(</span><span class="n">out_projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-93"><a id="__codelineno-13-93" name="__codelineno-13-93"></a><a href="#__codelineno-13-93"><span class="linenos" data-linenos=" 93 "></span></a>        <span class="p">)</span>
</span><span id="__span-13-94"><a id="__codelineno-13-94" name="__codelineno-13-94"></a><a href="#__codelineno-13-94"><span class="linenos" data-linenos=" 94 "></span></a>        <span class="p">(</span><span class="n">cross_attention</span><span class="p">):</span> <span class="n">AutoCorrelationLayer</span><span class="p">(</span>
</span><span id="__span-13-95"><a id="__codelineno-13-95" name="__codelineno-13-95"></a><a href="#__codelineno-13-95"><span class="linenos" data-linenos=" 95 "></span></a>          <span class="p">(</span><span class="n">inner_correlation</span><span class="p">):</span> <span class="n">AutoCorrelation</span><span class="p">(</span>
</span><span id="__span-13-96"><a id="__codelineno-13-96" name="__codelineno-13-96"></a><a href="#__codelineno-13-96"><span class="linenos" data-linenos=" 96 "></span></a>            <span class="p">(</span><span class="n">dropout</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-97"><a id="__codelineno-13-97" name="__codelineno-13-97"></a><a href="#__codelineno-13-97"><span class="linenos" data-linenos=" 97 "></span></a>          <span class="p">)</span>
</span><span id="__span-13-98"><a id="__codelineno-13-98" name="__codelineno-13-98"></a><a href="#__codelineno-13-98"><span class="linenos" data-linenos=" 98 "></span></a>          <span class="p">(</span><span class="n">query_projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-99"><a id="__codelineno-13-99" name="__codelineno-13-99"></a><a href="#__codelineno-13-99"><span class="linenos" data-linenos=" 99 "></span></a>          <span class="p">(</span><span class="n">key_projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-100"><a id="__codelineno-13-100" name="__codelineno-13-100"></a><a href="#__codelineno-13-100"><span class="linenos" data-linenos="100 "></span></a>          <span class="p">(</span><span class="n">value_projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-101"><a id="__codelineno-13-101" name="__codelineno-13-101"></a><a href="#__codelineno-13-101"><span class="linenos" data-linenos="101 "></span></a>          <span class="p">(</span><span class="n">out_projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-102"><a id="__codelineno-13-102" name="__codelineno-13-102"></a><a href="#__codelineno-13-102"><span class="linenos" data-linenos="102 "></span></a>        <span class="p">)</span>
</span><span id="__span-13-103"><a id="__codelineno-13-103" name="__codelineno-13-103"></a><a href="#__codelineno-13-103"><span class="linenos" data-linenos="103 "></span></a>        <span class="p">(</span><span class="n">conv1</span><span class="p">):</span> <span class="n">Conv1d</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">2048</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-104"><a id="__codelineno-13-104" name="__codelineno-13-104"></a><a href="#__codelineno-13-104"><span class="linenos" data-linenos="104 "></span></a>        <span class="p">(</span><span class="n">conv2</span><span class="p">):</span> <span class="n">Conv1d</span><span class="p">(</span><span class="mi">2048</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-105"><a id="__codelineno-13-105" name="__codelineno-13-105"></a><a href="#__codelineno-13-105"><span class="linenos" data-linenos="105 "></span></a>        <span class="p">(</span><span class="n">decomp1</span><span class="p">):</span> <span class="n">series_decomp</span><span class="p">(</span>
</span><span id="__span-13-106"><a id="__codelineno-13-106" name="__codelineno-13-106"></a><a href="#__codelineno-13-106"><span class="linenos" data-linenos="106 "></span></a>          <span class="p">(</span><span class="n">moving_avg</span><span class="p">):</span> <span class="n">moving_avg</span><span class="p">(</span>
</span><span id="__span-13-107"><a id="__codelineno-13-107" name="__codelineno-13-107"></a><a href="#__codelineno-13-107"><span class="linenos" data-linenos="107 "></span></a>            <span class="p">(</span><span class="n">avg</span><span class="p">):</span> <span class="n">AvgPool1d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
</span><span id="__span-13-108"><a id="__codelineno-13-108" name="__codelineno-13-108"></a><a href="#__codelineno-13-108"><span class="linenos" data-linenos="108 "></span></a>          <span class="p">)</span>
</span><span id="__span-13-109"><a id="__codelineno-13-109" name="__codelineno-13-109"></a><a href="#__codelineno-13-109"><span class="linenos" data-linenos="109 "></span></a>        <span class="p">)</span>
</span><span id="__span-13-110"><a id="__codelineno-13-110" name="__codelineno-13-110"></a><a href="#__codelineno-13-110"><span class="linenos" data-linenos="110 "></span></a>        <span class="p">(</span><span class="n">decomp2</span><span class="p">):</span> <span class="n">series_decomp</span><span class="p">(</span>
</span><span id="__span-13-111"><a id="__codelineno-13-111" name="__codelineno-13-111"></a><a href="#__codelineno-13-111"><span class="linenos" data-linenos="111 "></span></a>          <span class="p">(</span><span class="n">moving_avg</span><span class="p">):</span> <span class="n">moving_avg</span><span class="p">(</span>
</span><span id="__span-13-112"><a id="__codelineno-13-112" name="__codelineno-13-112"></a><a href="#__codelineno-13-112"><span class="linenos" data-linenos="112 "></span></a>            <span class="p">(</span><span class="n">avg</span><span class="p">):</span> <span class="n">AvgPool1d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
</span><span id="__span-13-113"><a id="__codelineno-13-113" name="__codelineno-13-113"></a><a href="#__codelineno-13-113"><span class="linenos" data-linenos="113 "></span></a>          <span class="p">)</span>
</span><span id="__span-13-114"><a id="__codelineno-13-114" name="__codelineno-13-114"></a><a href="#__codelineno-13-114"><span class="linenos" data-linenos="114 "></span></a>        <span class="p">)</span>
</span><span id="__span-13-115"><a id="__codelineno-13-115" name="__codelineno-13-115"></a><a href="#__codelineno-13-115"><span class="linenos" data-linenos="115 "></span></a>        <span class="p">(</span><span class="n">decomp3</span><span class="p">):</span> <span class="n">series_decomp</span><span class="p">(</span>
</span><span id="__span-13-116"><a id="__codelineno-13-116" name="__codelineno-13-116"></a><a href="#__codelineno-13-116"><span class="linenos" data-linenos="116 "></span></a>          <span class="p">(</span><span class="n">moving_avg</span><span class="p">):</span> <span class="n">moving_avg</span><span class="p">(</span>
</span><span id="__span-13-117"><a id="__codelineno-13-117" name="__codelineno-13-117"></a><a href="#__codelineno-13-117"><span class="linenos" data-linenos="117 "></span></a>            <span class="p">(</span><span class="n">avg</span><span class="p">):</span> <span class="n">AvgPool1d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
</span><span id="__span-13-118"><a id="__codelineno-13-118" name="__codelineno-13-118"></a><a href="#__codelineno-13-118"><span class="linenos" data-linenos="118 "></span></a>          <span class="p">)</span>
</span><span id="__span-13-119"><a id="__codelineno-13-119" name="__codelineno-13-119"></a><a href="#__codelineno-13-119"><span class="linenos" data-linenos="119 "></span></a>        <span class="p">)</span>
</span><span id="__span-13-120"><a id="__codelineno-13-120" name="__codelineno-13-120"></a><a href="#__codelineno-13-120"><span class="linenos" data-linenos="120 "></span></a>        <span class="p">(</span><span class="n">dropout</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-13-121"><a id="__codelineno-13-121" name="__codelineno-13-121"></a><a href="#__codelineno-13-121"><span class="linenos" data-linenos="121 "></span></a>        <span class="p">(</span><span class="n">projection</span><span class="p">):</span> <span class="n">Conv1d</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">padding_mode</span><span class="o">=</span><span class="n">circular</span><span class="p">)</span>
</span><span id="__span-13-122"><a id="__codelineno-13-122" name="__codelineno-13-122"></a><a href="#__codelineno-13-122"><span class="linenos" data-linenos="122 "></span></a>      <span class="p">)</span>
</span><span id="__span-13-123"><a id="__codelineno-13-123" name="__codelineno-13-123"></a><a href="#__codelineno-13-123"><span class="linenos" data-linenos="123 "></span></a>    <span class="p">)</span>
</span><span id="__span-13-124"><a id="__codelineno-13-124" name="__codelineno-13-124"></a><a href="#__codelineno-13-124"><span class="linenos" data-linenos="124 "></span></a>    <span class="p">(</span><span class="n">norm</span><span class="p">):</span> <span class="n">my_Layernorm</span><span class="p">(</span>
</span><span id="__span-13-125"><a id="__codelineno-13-125" name="__codelineno-13-125"></a><a href="#__codelineno-13-125"><span class="linenos" data-linenos="125 "></span></a>      <span class="p">(</span><span class="n">layernorm</span><span class="p">):</span> <span class="n">LayerNorm</span><span class="p">((</span><span class="mi">512</span><span class="p">,),</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">elementwise_affine</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-126"><a id="__codelineno-13-126" name="__codelineno-13-126"></a><a href="#__codelineno-13-126"><span class="linenos" data-linenos="126 "></span></a>    <span class="p">)</span>
</span><span id="__span-13-127"><a id="__codelineno-13-127" name="__codelineno-13-127"></a><a href="#__codelineno-13-127"><span class="linenos" data-linenos="127 "></span></a>    <span class="p">(</span><span class="n">projection</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-128"><a id="__codelineno-13-128" name="__codelineno-13-128"></a><a href="#__codelineno-13-128"><span class="linenos" data-linenos="128 "></span></a>  <span class="p">)</span>
</span><span id="__span-13-129"><a id="__codelineno-13-129" name="__codelineno-13-129"></a><a href="#__codelineno-13-129"><span class="linenos" data-linenos="129 "></span></a><span class="p">)</span>
</span></code></pre></div>
<p>æ•°æ®é›†çš„åŠ è½½æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚</p>
<h3 id="encoder-embedding">encoder embedding<a class="headerlink" href="#encoder-embedding" title="Permanent link">Â¶</a></h3>
<p>ç›®çš„ï¼šç»“åˆæ—¶é—´ç‰¹å¾ï¼Œå°† æ•°æ®ç‰¹å¾åµŒå…¥åˆ°æŒ‡å®šç»´åº¦</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1"></a><a href="#__codelineno-14-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">enc_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">enc_embedding</span><span class="p">(</span><span class="n">x_enc</span><span class="p">,</span> <span class="n">x_mark_enc</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1"></a><a href="#__codelineno-15-1"><span class="linenos" data-linenos="1 "></span></a><span class="bp">self</span><span class="o">.</span><span class="n">enc_embedding</span> <span class="o">=</span> <span class="n">DataEmbedding_wo_pos</span><span class="p">(</span><span class="n">configs</span><span class="o">.</span><span class="n">enc_in</span><span class="p">,</span> <span class="n">configs</span><span class="o">.</span><span class="n">d_model</span><span class="p">,</span> <span class="n">configs</span><span class="o">.</span><span class="n">embed</span><span class="p">,</span> <span class="n">configs</span><span class="o">.</span><span class="n">freq</span><span class="p">,</span><span class="n">configs</span><span class="o">.</span><span class="n">dropout</span><span class="p">)</span>
</span></code></pre></div>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250317204752276.png"><img alt="image-20250317204752276" src="../images/image-20250317204752276.png"></a></p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250317205258626.png"><img alt="image-20250317205258626" src="../images/image-20250317205258626.png"></a></p>
<p><strong>æµç¨‹å›¾</strong></p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1"></a><a href="#__codelineno-16-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="n">è¾“å…¥</span><span class="p">:</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2"></a><a href="#__codelineno-16-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="n">x_enc</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">D</span><span class="p">]</span>        <span class="n">x_mark_enc</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">time_features</span><span class="p">]</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3"></a><a href="#__codelineno-16-3"><span class="linenos" data-linenos=" 3 "></span></a>    <span class="o">|</span>                        <span class="o">|</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4"></a><a href="#__codelineno-16-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="n">v</span>                        <span class="n">v</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5"></a><a href="#__codelineno-16-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="o">+-----------------------------------------------+</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6"></a><a href="#__codelineno-16-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="o">|</span>           <span class="n">Model</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span><span class="n">è°ƒç”¨</span>                  <span class="o">|</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7"></a><a href="#__codelineno-16-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="o">|</span>      <span class="bp">self</span><span class="o">.</span><span class="n">enc_embedding</span><span class="p">(</span><span class="n">x_enc</span><span class="p">,</span> <span class="n">x_mark_enc</span><span class="p">)</span>    <span class="o">|</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8"></a><a href="#__codelineno-16-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="o">+-----------------------------------------------+</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9"></a><a href="#__codelineno-16-9"><span class="linenos" data-linenos=" 9 "></span></a>            <span class="o">|</span>                <span class="o">|</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10"></a><a href="#__codelineno-16-10"><span class="linenos" data-linenos="10 "></span></a>            <span class="n">v</span>                <span class="n">v</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11"></a><a href="#__codelineno-16-11"><span class="linenos" data-linenos="11 "></span></a><span class="o">+------------------------+</span>  <span class="o">+---------------------------+</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12"></a><a href="#__codelineno-16-12"><span class="linenos" data-linenos="12 "></span></a><span class="o">|</span> <span class="n">TokenEmbedding</span> <span class="p">(</span><span class="n">å€¼åµŒå…¥</span><span class="p">)</span> <span class="o">|</span>  <span class="o">|</span> <span class="n">TemporalEmbedding</span> <span class="p">(</span><span class="n">æ—¶é—´åµŒå…¥</span><span class="p">)</span><span class="o">|</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13"></a><a href="#__codelineno-16-13"><span class="linenos" data-linenos="13 "></span></a><span class="o">+------------------------+</span>  <span class="o">+---------------------------+</span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14"></a><a href="#__codelineno-16-14"><span class="linenos" data-linenos="14 "></span></a><span class="o">|</span> <span class="n">è¾“å…¥</span><span class="p">:</span> <span class="n">x</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">D</span><span class="p">]</span>      <span class="o">|</span>  <span class="o">|</span> <span class="n">è¾“å…¥</span><span class="p">:</span> <span class="n">x_mark</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">time_f</span><span class="p">]</span><span class="o">|</span>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15"></a><a href="#__codelineno-16-15"><span class="linenos" data-linenos="15 "></span></a><span class="o">|</span>                        <span class="o">|</span>  <span class="o">|</span>                           <span class="o">|</span>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16"></a><a href="#__codelineno-16-16"><span class="linenos" data-linenos="16 "></span></a><span class="o">|</span> <span class="n">æ“ä½œ</span><span class="p">:</span>                  <span class="o">|</span>  <span class="o">|</span> <span class="n">æ“ä½œ</span><span class="p">:</span>                     <span class="o">|</span>
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17"></a><a href="#__codelineno-16-17"><span class="linenos" data-linenos="17 "></span></a><span class="o">|</span> <span class="mf">1.</span><span class="n">è½¬ç½®</span><span class="p">:</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">L</span><span class="p">]</span>      <span class="o">|</span>  <span class="o">|</span> <span class="mf">1.</span><span class="n">è½¬æ¢ä¸ºlongç±»å‹</span>          <span class="o">|</span>
</span><span id="__span-16-18"><a id="__codelineno-16-18" name="__codelineno-16-18"></a><a href="#__codelineno-16-18"><span class="linenos" data-linenos="18 "></span></a><span class="o">|</span> <span class="mf">2.1</span><span class="n">Då·ç§¯</span><span class="p">:</span> <span class="n">D</span> <span class="o">-&gt;</span> <span class="n">d_model</span> <span class="o">|</span>  <span class="o">|</span> <span class="mf">2.</span><span class="n">æå–æ—¶é—´ç‰¹å¾</span><span class="p">:</span>           <span class="o">|</span>
</span><span id="__span-16-19"><a id="__codelineno-16-19" name="__codelineno-16-19"></a><a href="#__codelineno-16-19"><span class="linenos" data-linenos="19 "></span></a><span class="o">|</span> <span class="mf">3.</span><span class="n">è½¬ç½®å›</span><span class="p">:</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">d_model</span><span class="p">]</span><span class="o">|</span>  <span class="o">|</span>   <span class="o">-</span> <span class="n">month_x</span> <span class="p">(</span><span class="n">x</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">])</span>   <span class="o">|</span>
</span><span id="__span-16-20"><a id="__codelineno-16-20" name="__codelineno-16-20"></a><a href="#__codelineno-16-20"><span class="linenos" data-linenos="20 "></span></a><span class="o">|</span>                        <span class="o">|</span>  <span class="o">|</span>   <span class="o">-</span> <span class="n">day_x</span> <span class="p">(</span><span class="n">x</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">])</span>      <span class="o">|</span>
</span><span id="__span-16-21"><a id="__codelineno-16-21" name="__codelineno-16-21"></a><a href="#__codelineno-16-21"><span class="linenos" data-linenos="21 "></span></a><span class="o">|</span> <span class="n">è¾“å‡º</span><span class="p">:</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">d_model</span><span class="p">]</span>  <span class="o">|</span>  <span class="o">|</span>   <span class="o">-</span> <span class="n">weekday_x</span> <span class="p">(</span><span class="n">x</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">])</span>  <span class="o">|</span>
</span><span id="__span-16-22"><a id="__codelineno-16-22" name="__codelineno-16-22"></a><a href="#__codelineno-16-22"><span class="linenos" data-linenos="22 "></span></a><span class="o">|</span>                        <span class="o">|</span>  <span class="o">|</span>   <span class="o">-</span> <span class="n">hour_x</span> <span class="p">(</span><span class="n">x</span><span class="p">[:,:,</span><span class="mi">3</span><span class="p">])</span>     <span class="o">|</span>
</span><span id="__span-16-23"><a id="__codelineno-16-23" name="__codelineno-16-23"></a><a href="#__codelineno-16-23"><span class="linenos" data-linenos="23 "></span></a><span class="o">+------------------------+</span>  <span class="o">|</span>   <span class="o">-</span> <span class="n">minute_x</span> <span class="p">(</span><span class="n">å¯é€‰</span><span class="p">)</span>       <span class="o">|</span>
</span><span id="__span-16-24"><a id="__codelineno-16-24" name="__codelineno-16-24"></a><a href="#__codelineno-16-24"><span class="linenos" data-linenos="24 "></span></a>            <span class="o">|</span>               <span class="o">|</span>                           <span class="o">|</span>
</span><span id="__span-16-25"><a id="__codelineno-16-25" name="__codelineno-16-25"></a><a href="#__codelineno-16-25"><span class="linenos" data-linenos="25 "></span></a>            <span class="o">|</span>               <span class="o">|</span> <span class="mf">3.</span><span class="n">æŸ¥è¡¨è·å–å„æ—¶é—´ç‰¹å¾çš„åµŒå…¥</span>  <span class="o">|</span>
</span><span id="__span-16-26"><a id="__codelineno-16-26" name="__codelineno-16-26"></a><a href="#__codelineno-16-26"><span class="linenos" data-linenos="26 "></span></a>            <span class="o">|</span>               <span class="o">|</span> <span class="mf">4.</span><span class="n">å°†æ‰€æœ‰æ—¶é—´åµŒå…¥ç›¸åŠ </span>       <span class="o">|</span>
</span><span id="__span-16-27"><a id="__codelineno-16-27" name="__codelineno-16-27"></a><a href="#__codelineno-16-27"><span class="linenos" data-linenos="27 "></span></a>            <span class="o">|</span>               <span class="o">|</span>                           <span class="o">|</span>
</span><span id="__span-16-28"><a id="__codelineno-16-28" name="__codelineno-16-28"></a><a href="#__codelineno-16-28"><span class="linenos" data-linenos="28 "></span></a>            <span class="o">|</span>               <span class="o">|</span> <span class="n">è¾“å‡º</span><span class="p">:</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">d_model</span><span class="p">]</span>     <span class="o">|</span>
</span><span id="__span-16-29"><a id="__codelineno-16-29" name="__codelineno-16-29"></a><a href="#__codelineno-16-29"><span class="linenos" data-linenos="29 "></span></a>            <span class="o">|</span>               <span class="o">+---------------------------+</span>
</span><span id="__span-16-30"><a id="__codelineno-16-30" name="__codelineno-16-30"></a><a href="#__codelineno-16-30"><span class="linenos" data-linenos="30 "></span></a>            <span class="o">|</span>                        <span class="o">|</span>
</span><span id="__span-16-31"><a id="__codelineno-16-31" name="__codelineno-16-31"></a><a href="#__codelineno-16-31"><span class="linenos" data-linenos="31 "></span></a>            <span class="o">+------------+------------+</span>
</span><span id="__span-16-32"><a id="__codelineno-16-32" name="__codelineno-16-32"></a><a href="#__codelineno-16-32"><span class="linenos" data-linenos="32 "></span></a>                         <span class="n">v</span>
</span><span id="__span-16-33"><a id="__codelineno-16-33" name="__codelineno-16-33"></a><a href="#__codelineno-16-33"><span class="linenos" data-linenos="33 "></span></a>            <span class="o">+---------------------------+</span>
</span><span id="__span-16-34"><a id="__codelineno-16-34" name="__codelineno-16-34"></a><a href="#__codelineno-16-34"><span class="linenos" data-linenos="34 "></span></a>            <span class="o">|</span> <span class="n">ç›¸åŠ å¹¶åº”ç”¨Dropout</span>         <span class="o">|</span>
</span><span id="__span-16-35"><a id="__codelineno-16-35" name="__codelineno-16-35"></a><a href="#__codelineno-16-35"><span class="linenos" data-linenos="35 "></span></a>            <span class="o">|</span> <span class="n">value_emb</span> <span class="o">+</span> <span class="n">temporal_emb</span> <span class="o">|</span>
</span><span id="__span-16-36"><a id="__codelineno-16-36" name="__codelineno-16-36"></a><a href="#__codelineno-16-36"><span class="linenos" data-linenos="36 "></span></a>            <span class="o">+---------------------------+</span>
</span><span id="__span-16-37"><a id="__codelineno-16-37" name="__codelineno-16-37"></a><a href="#__codelineno-16-37"><span class="linenos" data-linenos="37 "></span></a>                         <span class="o">|</span>
</span><span id="__span-16-38"><a id="__codelineno-16-38" name="__codelineno-16-38"></a><a href="#__codelineno-16-38"><span class="linenos" data-linenos="38 "></span></a>                         <span class="n">v</span>
</span><span id="__span-16-39"><a id="__codelineno-16-39" name="__codelineno-16-39"></a><a href="#__codelineno-16-39"><span class="linenos" data-linenos="39 "></span></a>                  <span class="n">è¾“å‡º</span><span class="p">:</span> <span class="n">enc_out</span>
</span><span id="__span-16-40"><a id="__codelineno-16-40" name="__codelineno-16-40"></a><a href="#__codelineno-16-40"><span class="linenos" data-linenos="40 "></span></a>                 <span class="p">[</span><span class="n">B</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">d_model</span><span class="p">]</span>
</span></code></pre></div>
<ol>
<li><strong>å€¼åµŒå…¥ (TokenEmbedding)</strong>:
   - é€šè¿‡å·ç§¯æ“ä½œå°†åŸå§‹ç‰¹å¾ [B, L, D] æ˜ å°„åˆ°æ›´é«˜ç»´åº¦è¡¨ç¤º [B, L, d_model]
   - ä½¿ç”¨å¾ªç¯å¡«å……çš„1Då·ç§¯æ•è·å±€éƒ¨ç‰¹å¾æ¨¡å¼</li>
<li><strong>æ—¶é—´åµŒå…¥ (TemporalEmbedding)</strong>:
   - å°†æ—¶é—´æ ‡è®° [B, L, time_features] è½¬æ¢ä¸º [B, L, d_model] çš„åµŒå…¥å‘é‡
   - åˆ†åˆ«ä¸ºæœˆã€æ—¥ã€æ˜ŸæœŸã€å°æ—¶ç­‰æ—¶é—´ç‰¹å¾æŸ¥è¡¨è·å–åµŒå…¥ï¼Œç„¶åç›¸åŠ 
   - æ—¶é—´åµŒå…¥å¸®åŠ©æ¨¡å‹è¯†åˆ«æ—¶é—´æ¨¡å¼(å­£èŠ‚æ€§ã€æ¯æ—¥/æ¯å‘¨å‘¨æœŸç­‰)</li>
<li><strong>ç»„åˆåµŒå…¥</strong>:
   - å°†å€¼åµŒå…¥å’Œæ—¶é—´åµŒå…¥ç›¸åŠ ï¼Œå½¢æˆæœ€ç»ˆç¼–ç å™¨è¾“å…¥ [B, L, d_model]
   - æ³¨æ„æ­¤ç‰ˆæœ¬ä¸åŒ…å«ä½ç½®åµŒå…¥(DataEmbedding_wo_pos)</li>
</ol>
<p>è¿™ç§å¤šé‡åµŒå…¥æ–¹å¼ä½¿æ¨¡å‹èƒ½åŒæ—¶åˆ©ç”¨æ—¶é—´åºåˆ—çš„å€¼ä¿¡æ¯å’Œæ—¶é—´ç‰¹å¾ä¿¡æ¯ï¼Œä¸ºåç»­çš„æ³¨æ„åŠ›æœºåˆ¶å’Œæ—¶é—´åºåˆ—å»ºæ¨¡æä¾›ä¸°å¯Œçš„ä¸Šä¸‹æ–‡ã€‚</p>
<h2 id="_4">æ¨¡å‹å®šä¹‰<a class="headerlink" href="#_4" title="Permanent link">Â¶</a></h2>
<h3 id="_5">ç¼–ç å™¨ è§£ç å™¨éƒ¨åˆ†<a class="headerlink" href="#_5" title="Permanent link">Â¶</a></h3>
<pre class="mermaid"><code>classDiagram
    class Model {
        +DataEmbedding_wo_pos enc_embedding
        +DataEmbedding_wo_pos dec_embedding
        +Encoder encoder
        +Decoder decoder
        +series_decomp decomp
        +forward(x_enc, x_mark_enc, x_dec, x_mark_dec, enc_self_mask, dec_self_mask, dec_enc_mask)
    }

    class Encoder {
        +List~EncoderLayer~ layers
        +my_Layernorm norm_layer
        +forward(x, attn_mask)
    }

    class EncoderLayer {
        +AutoCorrelationLayer attention
        +Conv1d conv1
        +Conv1d conv2
        +series_decomp decomp1
        +series_decomp decomp2
        +Dropout dropout
        +activation
        +forward(x, attn_mask)
    }

    class AutoCorrelationLayer {
        +AutoCorrelation attention
        +Linear query_projection
        +Linear key_projection
        +Linear value_projection
        +Linear out_projection
        +forward(queries, keys, values, attn_mask)
    }

    class AutoCorrelation {
        +bool mask_flag
        +int factor
        +float scale
        +Dropout dropout
        +bool output_attention
        +time_delay_agg_training(values, corr)
        +time_delay_agg_inference(values, corr)
        +forward(queries, keys, values, attn_mask)
    }

    class Decoder {
        +List~DecoderLayer~ layers
        +my_Layernorm norm_layer
        +Linear projection
        +forward(x, enc_out, x_mask, cross_mask, trend)
    }

    class DecoderLayer {
        +AutoCorrelationLayer self_attention
        +AutoCorrelationLayer cross_attention
        +Conv1d conv1
        +Conv1d conv2
        +series_decomp decomp1
        +series_decomp decomp2
        +Dropout dropout
        +activation
        +forward(x, enc_out, x_mask, cross_mask, trend)
    }

    Model --&gt; Encoder
    Model --&gt; Decoder
    Encoder --&gt; EncoderLayer
    EncoderLayer --&gt; AutoCorrelationLayer
    EncoderLayer --&gt; Conv1d
    EncoderLayer --&gt; series_decomp
    AutoCorrelationLayer --&gt; AutoCorrelation
    Decoder --&gt; DecoderLayer
    DecoderLayer --&gt; AutoCorrelationLayer
    DecoderLayer --&gt; Conv1d
    DecoderLayer --&gt; series_decomp
</code></pre>
<h2 id="_6">è®­ç»ƒè¿‡ç¨‹ï¼Œå½¢çŠ¶å˜æ¢<a class="headerlink" href="#_6" title="Permanent link">Â¶</a></h2>
<p>ï¼ˆ1ï¼‰</p>
<p>ä»£ç ï¼š</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250319202142537.png"><img alt="image-20250319202142537" src="../images/image-20250319202142537.png"></a> </p>
<p>é€å­—è®²è§£ï¼š</p>
<p>model è®­ç»ƒä» exp_main.pyçš„ train å‡½æ•°å¼€å§‹ï¼Œepoch è¡¨ç¤ºæ•´ä¸ªè®­ç»ƒé›†è¿­ä»£å‡ æ¬¡ï¼Œfor batchxã€batchyã€batch x markã€batch y mark ä¸€ä¸ªæ‰¹æ¬¡ä¸€ä¸ªæ‰¹æ¬¡çš„è®­ç»ƒï¼Œç¬¬ä¸€ä¸ª for è®­ç»ƒçš„ epoch æ˜¯æˆ‘ä»¬è‡ªå·±å¯ä»¥è®¾ç½®çš„ï¼Œç¬¬äºŒä¸ª for è®­ç»ƒçš„ iteration è¿­ä»£æ¬¡æ•°æ˜¯ <code>æ•°æ®é›†é•¿åº¦ â— batch size</code></p>
<p>æ¥ä¸‹æ¥ï¼Œè°ƒç”¨ <code>self._predict</code> æ–¹æ³•è¿›è¡Œé¢„æµ‹ï¼Œè¿™é‡Œ predict å‡½æ•°éœ€è¦çš„å‚æ•° batchxã€batchyã€batch x markã€batch y mark å½¢çŠ¶åˆ†åˆ«æ˜¯ <code>batch_x = [32,36,7], batch_y = [32,42(18+24),7],batch_x_mark=[32,36,4],batch_y_mark = [32,42,4]</code></p>
<p>32 è¡¨ç¤º ä¸€ä¸ª batch æ ·æœ¬çš„ä¸ªæ•°ï¼›</p>
<p>36 è¡¨ç¤ºæ¯ä¸ªæ ·æœ¬çš„æ—¶é—´æ­¥ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯å›æº¯çª—å£çš„å¤§å°ï¼Œæˆ–è€…å«è¾“å…¥åºåˆ—çš„é•¿åº¦</p>
<p>7 è¡¨ç¤º illness æ•°æ®é›†çš„ç‰¹å¾æ•°</p>
<p>batchy çš„ 42 è¡¨ç¤º 18 çš„ label lengthï¼Œæ˜¯å–çš„ åŸå§‹è¾“å…¥åºåˆ—çš„ äºŒåˆ†ä¹‹ä¸€ï¼Œè¿™ä¸ªåœ¨è®ºæ–‡ä¸­æœ‰è¯´</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250319202958076.png"><img alt="image-20250319202958076" src="../images/image-20250319202958076.png"></a> </p>
<p>ç¼–ç å™¨çš„è¾“å…¥ æ˜¯ <code>I times d</code> <span class="arithmatex">\(I\)</span> è¡¨ç¤º è¾“å…¥åºåˆ—é•¿åº¦ï¼Œåœ¨è¿™é‡Œä¾‹å­å°±æ˜¯ 36ï¼Œ<span class="arithmatex">\(d\)</span> æ˜¯ç‰¹å¾æ•°ï¼Œè¿™é‡Œçš„ç‰¹å¾æ•°ï¼Œéƒ½å»æ‰äº†æ—¶é—´æˆ³ï¼Œä¹Ÿå°±æ˜¯ 7</p>
<p>è§£ç å™¨çš„è¾“å…¥æ˜¯ <code>äºŒåˆ†ä¹‹ I + O</code>ï¼Œ<code>äºŒåˆ†ä¹‹ I</code>è¡¨ç¤º è¾“å…¥åºåˆ—é•¿åº¦çš„ä¸€åŠï¼Œ<code>O</code> è¡¨ç¤ºé¢„æµ‹æ­¥é•¿ï¼Œä¹Ÿå°±æ˜¯è¾“å‡ºåºåˆ—çš„é•¿åº¦</p>
<p>batch x markï¼Œbatch y mark å°±æ˜¯å¤„ç†çš„æ—¶é—´æˆ³ç‰¹å¾äº†ï¼ŒåŒ…å«ä¸€å¤©çš„ç¬¬å‡ ä¸ªå°æ—¶ï¼Œä¸€ä¸ªæœˆçš„ç¬¬å‡ å¤©ï¼Œä¸€å‘¨çš„ç¬¬å‡ å¤©ï¼Œä¸€ä¸ªæœˆçš„ç¬¬å‡ å¤©ï¼Œå°±æ˜¯æˆ‘ä»¬ä¹‹å‰è®²è¿‡çš„ SegRNNï¼Œè¿™é‡Œå¤„ç†è¿˜æ¶‰åŠäº† å½’ä¸€åŒ– å’Œä¸­å¿ƒåŒ–ï¼Œä¸å†é‡å¤å•¦ã€‚</p>
<hr>
<p><strong>å¥½äº†ï¼Œæ¥ä¸‹æ¥è¿›å…¥ é¢„æµ‹éƒ¨åˆ†ï¼Œ<mark>æ­¥è¿›</mark>ï¼Œä¹Ÿå°±æ˜¯ predict å‡½æ•°</strong> </p>
<p>é¦–å…ˆï¼Œæ„é€ å®Œæ•´çš„è§£ç å™¨è¾“å…¥ï¼Œå…·ä½“çš„æ“ä½œæ˜¯ï¼Œåˆ‡ç‰‡ batch y ä¸­çš„é¢„æµ‹æ­¥é•¿ï¼Œå¡«å…… 0ï¼Œå¹¶ä¸ ä¹‹å‰çš„ label length è¿›è¡Œæ‹¼æ¥ã€‚ä¹Ÿå°±æ˜¯è¿™ä¸¤è¡Œä»£ç </p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1"></a><a href="#__codelineno-17-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># decoder input </span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2"></a><a href="#__codelineno-17-2"><span class="linenos" data-linenos="2 "></span></a><span class="c1"># åˆ›å»ºè§£ç å™¨è¾“å…¥çš„é›¶å¼ é‡éƒ¨åˆ†ï¼Œç”¨äºé¢„æµ‹æœªæ¥æ—¶é—´æ­¥</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3"></a><a href="#__codelineno-17-3"><span class="linenos" data-linenos="3 "></span></a><span class="c1"># batch_y[B, label_len+pred_len, D] -&gt; åˆ‡ç‰‡ -&gt; [B, pred_len, D] -&gt; åˆ›å»ºç›¸åŒå½¢çŠ¶å…¨é›¶å¼ é‡ -&gt; dec_inp[B, pred_len, D]</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4"></a><a href="#__codelineno-17-4"><span class="linenos" data-linenos="4 "></span></a><span class="n">dec_inp</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">batch_y</span><span class="p">[:,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">pred_len</span><span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5"></a><a href="#__codelineno-17-5"><span class="linenos" data-linenos="5 "></span></a>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6"></a><a href="#__codelineno-17-6"><span class="linenos" data-linenos="6 "></span></a><span class="c1"># å°†å†å²æ•°æ®(æ ‡ç­¾åºåˆ—)ä¸é›¶å¼ é‡è¿æ¥ï¼Œå½¢æˆå®Œæ•´çš„è§£ç å™¨è¾“å…¥ï¼Œå¹¶ç§»åŠ¨åˆ°æŒ‡å®šè®¾å¤‡</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7"></a><a href="#__codelineno-17-7"><span class="linenos" data-linenos="7 "></span></a><span class="c1"># [B, label_len, D] + [B, pred_len, D] -&gt; torch.catæ²¿ç»´åº¦1æ‹¼æ¥ -&gt; [B, label_len+pred_len, D] -&gt; to(device) -&gt; åœ¨GPUä¸Šçš„dec_inp</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8"></a><a href="#__codelineno-17-8"><span class="linenos" data-linenos="8 "></span></a><span class="n">dec_inp</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">batch_y</span><span class="p">[:,</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">label_len</span><span class="p">,</span> <span class="p">:],</span> <span class="n">dec_inp</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span></code></pre></div>
<p>æ„é€ çš„å®Œæ•´è§£ç å™¨çš„è¾“å…¥ï¼Œå½¢çŠ¶è¿˜æ˜¯ 32,42,7ã€‚</p>
<p>ï¼ˆè¿™é‡Œçš„ä»£ç å¹¶ä¸æ˜¯é‚£ä¹ˆé‡è¦ï¼Œæ‰€ä»¥å°±ä¸ç²˜è´´äº†ï¼Œå åœ°æ–¹ï¼‰æ¥ä¸‹æ¥æ˜¯ä¸€ä¸ªå†…éƒ¨æ–¹æ³• run modelï¼Œç±»ä¼¼ forwardï¼Œä½†å› ä¸ºä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„æ¨¡å‹ï¼Œæ‰€ä»¥å°±å« run modeläº†ï¼Œç±»å†…è°ƒç”¨äº†è¿™ä¸ªå‡½æ•°ï¼Œæ‰ä¼šæ‰§è¡Œï¼Œè¿™é‡Œæ²¡æœ‰è°ƒç”¨ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥ï¼Œåˆ¤æ–­æ˜¯å¦é‡‡ç”¨äº†è‡ªåŠ¨ç²¾åº¦è®­ç»ƒï¼Œæˆ‘ä¹Ÿä¸æ˜ç™½ï¼Œå¤§æ¦‚æ˜¯æ¨¡å‹åŠ é€ŸæŠŠï¼Œæ€»ä¹‹æ˜¯ falseï¼Œæ‰§è¡Œ elseã€‚</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1"></a><a href="#__codelineno-18-1"><span class="linenos" data-linenos="1 "></span></a><span class="k">else</span><span class="p">:</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2"></a><a href="#__codelineno-18-2"><span class="linenos" data-linenos="2 "></span></a>    <span class="c1"># ä½¿ç”¨æ™®é€šç²¾åº¦æ‰§è¡Œæ¨¡å‹è®¡ç®—</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3"></a><a href="#__codelineno-18-3"><span class="linenos" data-linenos="3 "></span></a>    <span class="c1"># _run_model() -&gt; outputs[B, label_len+pred_len, D]</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4"></a><a href="#__codelineno-18-4"><span class="linenos" data-linenos="4 "></span></a>    <span class="n">outputs</span> <span class="o">=</span> <span class="n">_run_model</span><span class="p">()</span>
</span></code></pre></div>
<p>è°ƒç”¨çš„å†…éƒ¨æ–¹æ³• <code>_run_model()</code>ï¼Œæ­¥è¿›ï¼Œè¿›å…¥åˆ° run model å†…éƒ¨ã€‚</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250319211512141.png"><img alt="image-20250319211512141" src="../images/image-20250319211512141.png"></a></p>
<p>é¦–å…ˆï¼Œè¿™é‡Œçš„ self.model æ˜¯ <code>Exp_Basic</code>ä¸­çš„ <code>build_model</code> å®šä¹‰æ¥çš„ï¼Œè€Œä¸”<code>exp_main</code> ï¼Œ <code>Basic</code> çš„å­ç±» é‡å†™äº† çˆ¶ç±»çš„æ–¹æ³•ï¼Œå¹¶é€šè¿‡å­—å…¸ï¼Œé”®æ˜¯å­—ç¬¦ä¸²ï¼Œå€¼çš„ç±»ï¼Œç´¢å¼•è¿›è¡Œç±»çš„åˆå§‹åŒ–ï¼Œè¿™ä¸ªä¹Ÿæ˜¯ SegRNN ä¸­ä»‹ç»è¿‡çš„ã€‚æ€»ä¹‹ï¼Œè¿™é‡Œçš„ <code>self.model</code> æ˜¯ <code>Autoformer</code> </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250319211736243.png"><img alt="image-20250319211736243" src="../images/image-20250319211736243.png"></a></p>
<p><strong>ç‚¹å‡»æ­¥è¿›ï¼Œè¿›å…¥ Autoformer çš„ forward ä¸­ã€‚ä¸€ä¸ª batch ä¸­æ ·æœ¬çš„å¤„ç†</strong> </p>
<hr>
<h3 id="autoformer-forward">Autoformer  forward<a class="headerlink" href="#autoformer-forward" title="Permanent link">Â¶</a></h3>
<p>é¦–å…ˆï¼Œè¿™é‡ŒAutoformer  forward æ¥æ”¶çš„å‚æ•°ï¼š</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1"></a><a href="#__codelineno-19-1"><span class="linenos" data-linenos="1 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_enc</span><span class="p">,</span> <span class="n">x_mark_enc</span><span class="p">,</span> <span class="n">x_dec</span><span class="p">,</span> <span class="n">x_mark_dec</span><span class="p">,</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2"></a><a href="#__codelineno-19-2"><span class="linenos" data-linenos="2 "></span></a>            <span class="n">enc_self_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3"></a><a href="#__codelineno-19-3"><span class="linenos" data-linenos="3 "></span></a>            <span class="n">dec_self_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4"></a><a href="#__codelineno-19-4"><span class="linenos" data-linenos="4 "></span></a>            <span class="n">dec_enc_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></code></pre></div>
<p>å¿…é¡»ä¼ å…¥çš„å‚æ•° æ˜¯  <code>x_enc, x_mark_enc, x_dec, x_mark_dec</code> æˆ‘ä»¬è¿™é‡Œå°±æ˜¯ <code>batch xï¼Œbatch yï¼Œbatch x markï¼Œbatch y mark</code>ï¼Œä¸”å½¢çŠ¶åˆ†åˆ«æ˜¯ <code>[32,36,7]ã€[32,42,7]ã€[32,36,4]ã€[32,42,4]</code></p>
<p>å¯é€‰å‚æ•°æ˜¯ Transformer ä¸­çš„ 3 ä¸ª maskï¼Œé»˜è®¤æ˜¯ Noneã€‚è§£é‡Šä¸€ä¸‹ Transformer ä¸­çš„ä¸‰ä¸ª mask åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼š</p>
<blockquote>
<p>ä¸‰ä¸ªmaskæœºåˆ¶ï¼Œåˆ†åˆ«æŒ‡çš„æ˜¯</p>
<ul>
<li>ç¬¬ä¸€ä¸ª ç¼–ç ç«¯è¾“â¼Š ç”±äºpaddingå­—ç¬¦çš„maskï¼Œä¸ºäº†â¼€ä¸ªbatchsizeä¸­ï¼Œæ‰€æœ‰é•¿åº¦ä¸ç›¸åŒçš„æ ·æœ¬ï¼Œèƒ½æ„æˆâ¼€ä¸ªçŸ©é˜µï¼Œæ‰€ä»¥æœ‰padå­—ç¬¦ï¼Œä½†æ˜¯åœ¨åâ¾¯è¿›â¾inputencoderçš„â¾ƒæ³¨æ„â¼’è®¡ç®—æ—¶ï¼Œpadå­—ç¬¦ä¸èƒ½å½±å“è®¡ç®—ç»“æœï¼Œæ‰€ä»¥éœ€è¦maskï¼›</li>
<li>ç¬¬â¼†ä¸ªmaskæ˜¯è§£ç ç«¯çš„maskï¼Œè¿™ä¸ªmaskæ˜¯æ¶‰åŠåˆ°å› æœçš„maskï¼Œå› ä¸ºTransformeræ˜¯â¼€ä¸ªâ¾ƒå›å½’æ¨¡å‹ï¼Œåœ¨è¿›â¾è¿ç®—æ—¶ï¼Œä¸ºäº†å¹¶â¾è®¡ç®—ï¼Œæˆ‘ä»¬æ˜¯æŠŠinputså’Œoutputsâ¼€èµ·å–‚ç»™æ¨¡å‹çš„ï¼Œinputsç›´æ¥ç»™æ¨¡å‹æ²¡äº‹ï¼Œä½†æ˜¯outputsåœ¨å¾—åˆ°æœ€åçš„è¾“å‡ºæ—¶ï¼Œä¸èƒ½å€ŸåŠ©æœªæ¥ä¿¡æ¯ï¼Œåªèƒ½æ˜¯å½“å‰æ—¶åˆ»åŠå…¶ä¹‹å‰æ—¶åˆ»çš„è¾“å‡ºï¼Œæ‰€ä»¥éœ€è¦â¼€ä¸ªmaskæœºåˆ¶ï¼Œè¿™ä¸ªmaskæ˜¯â¼€ä¸ªä¸Šä¸‰è§’çŸ©é˜µï¼Œä¿è¯åœ¨é¢„æµ‹å½“å‰è¾“å‡ºæ—¶ï¼Œä¸ä¼šå€ŸåŠ©æœªæ¥ä¿¡æ¯ã€‚</li>
<li>ç¬¬ä¸‰ä¸ªmaskï¼Œæ˜¯ç¼–ç å™¨å’Œè§£ç å™¨çš„äº¤äº’æ³¨æ„â¼’ï¼Œç¼–ç å™¨çš„è¾“å‡ºä½œä¸ºkeyå’Œvalueï¼Œè§£ç å™¨çš„è¾“å‡ºä½œä¸ºqueryï¼Œå› ä¸ºâ½¬æ ‡åºåˆ— æ¯ä¸ªæ ·æœ¬çš„é•¿åº¦æ˜¯ä¸â¼€æ ·çš„ï¼ŒåŒæ—¶åŸåºåˆ—çš„æ ·æœ¬é•¿åº¦ä¹Ÿæ˜¯ä¸â¼€æ ·çš„ï¼Œâ½½ä¸”â¼€å¯¹ä¹‹é—´ é•¿åº¦ä¹Ÿæ˜¯ä¸â¼€æ ·çš„ï¼Œæ‰€ä»¥éœ€è¦â¼€ä¸ªmask å°†åŸåºåˆ—ä¸­æŸä¸ªå•è¯æŸä¸ªä½ç½® è·Ÿ â½¬æ ‡åºåˆ—ä¸­ æŸä¸ªä½ç½® å¦‚æœå®ƒä»¬ä¹‹é—´ æœ‰â¼€ä¸ªpadçš„è¯ è¯´æ˜æ˜¯â½†æ•ˆå­—ç¬¦ï¼Œå¾—åˆ°è¿™æ ·çš„æ©ç çŸ©é˜µã€‚</li>
</ul>
<p>ç¼–ç å™¨ä»¥åŠ ç¼–ç å™¨å’Œè§£ç å™¨çš„ mask æ˜¯ä¸ºäº†ä¿è¯é•¿åº¦çš„å¯¹é½ï¼Œè§£ç å™¨çš„ mask æ˜¯ä¸ºäº†åœ¨é¢„æµ‹æ—¶ é¿å…çœ‹åˆ°æœªæ¥çš„ä¿¡æ¯</p>
</blockquote>
<p>å›åˆ° Autoformer è¿™é‡Œï¼Œçœ‹è¿™ä¸ªæ¨¡å‹æ˜¯æ€ä¹ˆå¤„ç†ï¼Œè¾“å…¥æ•°æ®å’Œè¾“å‡ºæ•°æ®ï¼Œä»¥åŠæ¨¡å‹çš„åˆ›æ–°æ˜¯æ€ä¹ˆå®ç°çš„ã€‚</p>
<p>é¦–å…ˆï¼Œçœ‹åˆ°ä¸‹é¢è¿™å‡ è¡Œä»£ç ã€‚</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250319214129515.png"><img alt="image-20250319214129515" src="../images/image-20250319214129515.png"></a></p>
<p>è¿™å‡ è¡Œä»£ç çš„ç›®çš„æ˜¯ä¸ºäº†è§£ç å™¨çš„è¾“å…¥çš„åˆå§‹åŒ–ï¼Œç¼–ç å™¨é˜¶æ®µæ˜¯ç”¨ä¸åˆ°ã€‚</p>
<hr>
<h3 id="_7">åºåˆ—åˆ†è§£<a class="headerlink" href="#_7" title="Permanent link">Â¶</a></h3>
<p><strong>çœ‹è®ºæ–‡ è¾“å…¥åºåˆ—çš„è¶‹åŠ¿åºåˆ—å’Œå­£èŠ‚è¶‹åŠ¿æ˜¯æ€ä¹ˆæå–çš„ã€‚</strong> </p>
<p>æœ¬æ–‡å°†æ—¶é—´åºåˆ—åˆ†è§£ä¸º è¶‹åŠ¿åºåˆ—å’Œå­£èŠ‚å‘é‡</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250319214344038.png"><img alt="image-20250319214344038" src="../images/image-20250319214344038.png"></a></p>
<p>è¶‹åŠ¿å‘é‡åæ˜ äº†æ•°æ®çš„é•¿æœŸå˜åŒ–è¶‹åŠ¿å’Œå­£èŠ‚è¶‹åŠ¿ã€‚å¹¶ä¸”è®ºæ–‡ä¸­æåˆ° å¯¹äºæœªæ¥åºåˆ—è¿›è¡Œåˆ†è§£æ˜¯ä¸ç°å®çš„ï¼Œå› ä¸ºæœªæ¥çš„æ‰€æœ‰åºåˆ—éƒ½æ˜¯ä¸çŸ¥é“çš„ã€‚å› æ­¤ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒåŸæ–‡æå‡ºäº† åºåˆ—åˆ†è§£æ¨¡å—ï¼Œæ€æƒ³æ˜¯ ä»é¢„æµ‹çš„ä¸­é—´éšè—å˜é‡ä¸­ é€æ­¥æå– é•¿æœŸç¨³å®šçš„è¶‹åŠ¿ ã€‚</p>
<p>å…·ä½“çš„åšæ³•ï¼Œä½¿ç”¨ç§»åŠ¨å¹³å‡æ¥å¹³æ»‘å‘¨æœŸæ€§æ³¢åŠ¨æ¥çªå‡ºé•¿æœŸè¶‹åŠ¿ã€‚</p>
<p>æ–‡ä¸­ä¹Ÿç»™å‡ºäº†å…¬å¼ï¼š</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250319220946468.png"><img alt="image-20250319220946468" src="../images/image-20250319220946468.png"></a></p>
<p>å…¬å¼çš„è§£é‡Šï¼šå¯¹äºé•¿åº¦ ä¸º L çš„è¾“å…¥åºåˆ— X ï¼Œå½¢çŠ¶æ˜¯ LÃ—dï¼Œä½¿ç”¨å¹³å‡æ± åŒ–è¿›è¡Œç§»åŠ¨å¹³å‡ï¼Œå¹¶ä¸”ä½¿ç”¨å¡«å……æ“ä½œä¿æŒåºåˆ—é•¿åº¦ä¸å˜ã€‚åé¢ç”¨ä¸€ä¸ª SeriesDecomp(X)æ¥è¡¨ç¤º ä¸Šé¢çš„è¿‡ç¨‹ï¼Œç®€åŒ–ä¸€ä¸‹è®°å·ã€‚</p>
<p><strong>è®ºæ–‡ä¸­çš„æ¨¡å‹ç»“æ„å›¾ä¹Ÿæœ‰ç”»å‡ºè¿™éƒ¨åˆ†</strong></p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250319221443646.png"><img alt="image-20250319221443646" src="../images/image-20250319221443646.png"></a></p>
<p>é¦–å…ˆ ç®­å¤´æŒ‡çš„åœ°æ–¹æ—¶ ç›´è§‚åœ°æ˜¾ç¤ºäº† è¾“å…¥åºåˆ— è¶‹åŠ¿åºåˆ— å’Œ å­£èŠ‚åºåˆ—æ˜¯æ€ä¹ˆæ¥çš„ã€‚è¾“å…¥åºåˆ— çš„ è¶‹åŠ¿åºåˆ— æ˜¯å¯¹ è¾“å…¥åºåˆ— å»å‡å€¼ï¼›å­£èŠ‚ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯å‘¨æœŸæ³¢åŠ¨ä¿¡æ¯æ˜¯ è¾“å…¥åºåˆ— - å‡å€¼ ï¼Œè¿™ä¸ªå‘¨æœŸæ³¢åŠ¨ä¿¡æ¯ æ˜¯å›´ç»• 0 è¿›è¡Œæ³¢åŠ¨çš„ã€‚åŸºäºå¯¹è¾“å…¥åºåˆ—çš„åˆ†è§£çš„è®¤è¯†ï¼Œå¯¹äºè§£ç å™¨ è¶‹åŠ¿åºåˆ— å’Œ å­£èŠ‚åºåˆ—çš„ åˆå§‹åŒ–ä¹Ÿæ˜¯å¾ˆæœ‰é“ç†çš„ã€‚</p>
<p>å›¾ç‰‡çš„ä¸‹åŠéƒ¨åˆ†ï¼Œæ˜¯è§£ç å™¨çš„è¾“å…¥ï¼Œæ˜¾ç¤ºäº† é¢„æµ‹åºåˆ— è¶‹åŠ¿åºåˆ—å’Œå­£èŠ‚åºåˆ—çš„åˆå§‹åŒ–ï¼Œå…¶ä¸­è¶‹åŠ¿åºåˆ—ä½¿ç”¨è¾“å…¥åºåˆ—çš„å‡å€¼è¿›è¡Œåˆå§‹åŒ–ï¼Œå­£èŠ‚æ³¢åŠ¨ä¿¡æ¯ç”¨ 0 æ¥åˆå§‹åŒ–</p>
<hr>
<p><strong>æ¥ä¸‹æ¥ï¼Œçœ‹ä»£ç ä¸­ï¼Œå¯¹é¢„æµ‹åºåˆ— çš„ è¶‹åŠ¿åºåˆ— å’Œ å­£èŠ‚åºåˆ—çš„æå–ã€‚</strong></p>
<p>é¦–å…ˆ æœ‰ å†å²æ•°æ® x_enc [B, L, D]çš„ï¼Œé¢„æµ‹å’Œæ ‡ç­¾æ•°æ® x_dec [B, L+P, D]ï¼Œæ¥ç€è¿›è¡Œæ—¶é—´åºåˆ—åˆ†è§£ å°†å†å²åºåˆ—åˆ†è§£ä¸ºå­£èŠ‚æ€§å’Œè¶‹åŠ¿ä¸¤ä¸ªæˆåˆ†</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1"></a><a href="#__codelineno-20-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">seasonal_init</span><span class="p">,</span> <span class="n">trend_init</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decomp</span><span class="p">(</span><span class="n">x_enc</span><span class="p">)</span>
</span></code></pre></div>
<p>å¾—åˆ° è¶‹åŠ¿åˆå§‹å€¼ï¼šå†å²åºåˆ—å‡å€¼ï¼Œå­£èŠ‚æ€§åˆå§‹å€¼ï¼šå…¨é›¶å¼ é‡</p>
<p>åŸºäº è¾“å…¥åºåˆ—çš„ åºåˆ—åˆ†è§£ç»“æœï¼Œæ„é€  è§£ç å™¨çš„è¾“å…¥ï¼Œå…·ä½“æ¥è¯´ï¼š</p>
<ul>
<li>
<p>è¾“å‡ºåºåˆ— è¶‹åŠ¿è¾“å…¥= å†å²è¶‹åŠ¿æœ«å°¾ + è¶‹åŠ¿åˆå§‹å€¼</p>
</li>
<li>
<p>è¾“å‡ºåºåˆ— å­£èŠ‚æ€§è¾“å…¥ = å†å²å­£èŠ‚æ€§æœ«å°¾ + å­£èŠ‚æ€§åˆå§‹å€¼(é›¶)</p>
</li>
</ul>
<p>ä¹Ÿå°±æ˜¯æºç ä¸­çš„è¿™å‡ è¡Œï¼š</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1"></a><a href="#__codelineno-21-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">mean</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x_enc</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pred_len</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2"></a><a href="#__codelineno-21-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">zeros</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">x_dec</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pred_len</span><span class="p">,</span> <span class="n">x_dec</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="n">device</span><span class="o">=</span><span class="n">x_enc</span><span class="o">.</span><span class="n">device</span><span class="p">)</span> 
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3"></a><a href="#__codelineno-21-3"><span class="linenos" data-linenos="3 "></span></a><span class="n">trend_init</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">trend_init</span><span class="p">[:,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">label_len</span><span class="p">:,</span> <span class="p">:],</span> <span class="n">mean</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4"></a><a href="#__codelineno-21-4"><span class="linenos" data-linenos="4 "></span></a><span class="n">seasonal_init</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">seasonal_init</span><span class="p">[:,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">label_len</span><span class="p">:,</span> <span class="p">:],</span> <span class="n">zeros</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></code></pre></div>
<p>è¿™ä¸ªæ¨¡å‹çš„ç»“æ„ç®€å•æ¥è¯´æ˜¯ åˆ©ç”¨ **ç¼–ç å™¨**å¤„ç†å†å²æ•°æ®ï¼Œ**è§£ç å™¨**åˆ©ç”¨ç¼–ç å™¨è¾“å‡ºå’Œç»„è£…çš„åˆå§‹è¾“å…¥ç”Ÿæˆé¢„æµ‹ï¼Œå°±æ˜¯ä¸€ä¸ªå¾ˆæ ‡å‡†çš„ Transformer å¤„ç†æ•°æ®çš„æ¶æ„ã€‚æˆ‘ä»¬å¾—åˆ°çš„æœ€ç»ˆè¾“å‡ºæ˜¯ è¶‹åŠ¿å’Œå­£èŠ‚æ€§é¢„æµ‹ç›¸åŠ ï¼Œå› ä¸ºæœ‰ label lengthï¼Œæ‰€ä»¥å¯¹äºè¾“å‡º æ˜¯ æå–æœ«å°¾ pred_len é•¿åº¦ä½œä¸ºæœ€ç»ˆé¢„æµ‹ç»“æœ</p>
<p>Autoformer çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ å°†æ—¶é—´åºåˆ—åˆ†è§£ä¸ºä¸åŒé¢‘ç‡æˆåˆ†å¹¶åˆ†åˆ«å»ºæ¨¡ï¼Œå†ç»„åˆç”Ÿæˆæœ€ç»ˆé¢„æµ‹ã€‚</p>
<p><strong>å…ˆæœ‰ä¸ªå¤§ä½“çš„å°è±¡ï¼Œåé¢çœ‹åˆ°ä»£ç  è¯¦ç»†çš„è®²è§£ã€‚</strong></p>
<hr>
<p>åœ¨è¿›è¡Œåé¢çš„Encoder å’Œ Decoderä¹‹å‰ï¼Œ<strong>å…ˆçœ‹ è¶‹åŠ¿é¡¹ å’Œ å­£èŠ‚é¡¹ çš„å…·ä½“å®ç°æ–¹æ³•ã€‚</strong> æœ‰ç‚¹å¤æ‚ï¼Œä½†æ˜¯ä¸€æ­¥æ­¥æ¥ã€‚</p>
<p>â–¶ï¸ é¦–å…ˆæ˜¯è°ƒç”¨ çš„   self.decomp</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1"></a><a href="#__codelineno-22-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">seasonal_init</span><span class="p">,</span> <span class="n">trend_init</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decomp</span><span class="p">(</span><span class="n">x_enc</span><span class="p">)</span>
</span></code></pre></div>
<p>â–¶ï¸ è€Œ self.decomp åˆæ˜¯ åˆå§‹åŒ– series_decomp ç±»</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1"></a><a href="#__codelineno-23-1"><span class="linenos" data-linenos="1 "></span></a><span class="bp">self</span><span class="o">.</span><span class="n">decomp</span> <span class="o">=</span> <span class="n">series_decomp</span><span class="p">(</span><span class="n">kernel_size</span><span class="p">)</span>
</span></code></pre></div>
<p>â–¶ï¸ çœ‹åˆ° series_decomp ç±»çš„å®šä¹‰</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1"></a><a href="#__codelineno-24-1"><span class="linenos" data-linenos="1 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">series_decomp</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span></code></pre></div>
<p>ğŸŸ¢ ç±»çš„å®šä¹‰</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1"></a><a href="#__codelineno-25-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">series_decomp</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2"></a><a href="#__codelineno-25-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3"></a><a href="#__codelineno-25-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="sd">    Series decomposition block</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4"></a><a href="#__codelineno-25-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="sd">    """</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5"></a><a href="#__codelineno-25-5"><span class="linenos" data-linenos=" 5 "></span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kernel_size</span><span class="p">):</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6"></a><a href="#__codelineno-25-6"><span class="linenos" data-linenos=" 6 "></span></a>        <span class="nb">super</span><span class="p">(</span><span class="n">series_decomp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7"></a><a href="#__codelineno-25-7"><span class="linenos" data-linenos=" 7 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">moving_avg</span> <span class="o">=</span> <span class="n">moving_avg</span><span class="p">(</span><span class="n">kernel_size</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8"></a><a href="#__codelineno-25-8"><span class="linenos" data-linenos=" 8 "></span></a>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9"></a><a href="#__codelineno-25-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10"></a><a href="#__codelineno-25-10"><span class="linenos" data-linenos="10 "></span></a>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11"></a><a href="#__codelineno-25-11"><span class="linenos" data-linenos="11 "></span></a>        <span class="c1"># è®¡ç®—ç§»åŠ¨å¹³å‡ï¼Œæå–åºåˆ—è¶‹åŠ¿åˆ†é‡</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12"></a><a href="#__codelineno-25-12"><span class="linenos" data-linenos="12 "></span></a>        <span class="c1"># x å½¢çŠ¶[B, L, D] -&gt; moving_meanå½¢çŠ¶[B, L, D]</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13"></a><a href="#__codelineno-25-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="c1">#  moving_avgå†…éƒ¨ä¼šè¿›è¡Œå¡«å……ï¼Œä¿è¯è¾“å‡ºå½¢çŠ¶ä¸è¾“å…¥ç›¸åŒ</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14"></a><a href="#__codelineno-25-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="n">moving_mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moving_avg</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15"></a><a href="#__codelineno-25-15"><span class="linenos" data-linenos="15 "></span></a>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16"></a><a href="#__codelineno-25-16"><span class="linenos" data-linenos="16 "></span></a>        <span class="c1"># é€šè¿‡åŸå§‹åºåˆ—å‡å»è¶‹åŠ¿åˆ†é‡ï¼Œå¾—åˆ°æ®‹å·®(å­£èŠ‚æ€§åˆ†é‡)ï¼Œé€å…ƒç´ å‡æ³•æ“ä½œ</span>
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17"></a><a href="#__codelineno-25-17"><span class="linenos" data-linenos="17 "></span></a>        <span class="c1"># xå½¢çŠ¶[B, L, D] - moving_meanå½¢çŠ¶[B, L, D] -&gt; reså½¢çŠ¶[B, L, D]</span>
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18"></a><a href="#__codelineno-25-18"><span class="linenos" data-linenos="18 "></span></a>        <span class="n">res</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">moving_mean</span>
</span><span id="__span-25-19"><a id="__codelineno-25-19" name="__codelineno-25-19"></a><a href="#__codelineno-25-19"><span class="linenos" data-linenos="19 "></span></a>
</span><span id="__span-25-20"><a id="__codelineno-25-20" name="__codelineno-25-20"></a><a href="#__codelineno-25-20"><span class="linenos" data-linenos="20 "></span></a>        <span class="c1"># è¿”å›å­£èŠ‚æ€§åˆ†é‡å’Œè¶‹åŠ¿åˆ†é‡ï¼Œå‡ä¿æŒåŸå§‹å½¢çŠ¶[B, L, D]</span>
</span><span id="__span-25-21"><a id="__codelineno-25-21" name="__codelineno-25-21"></a><a href="#__codelineno-25-21"><span class="linenos" data-linenos="21 "></span></a>        <span class="c1"># ç¬¬ä¸€ä¸ªè¿”å›å€¼resæ˜¯å­£èŠ‚æ€§åˆ†é‡ï¼Œç¬¬äºŒä¸ªè¿”å›å€¼moving_meanæ˜¯è¶‹åŠ¿åˆ†é‡</span>
</span><span id="__span-25-22"><a id="__codelineno-25-22" name="__codelineno-25-22"></a><a href="#__codelineno-25-22"><span class="linenos" data-linenos="22 "></span></a>        <span class="k">return</span> <span class="n">res</span><span class="p">,</span> <span class="n">moving_mean</span>
</span></code></pre></div>
<p>â–¶ï¸ ç±»å†… è°ƒç”¨ <code>moving_avg</code> </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250317202431440.png"><img alt="image-20250317202431440" src="../images/image-20250317202431440.png"></a></p>
<p>â–¶ï¸ çœ‹åˆ° <code>moving_avg</code> ç±»çš„å®šä¹‰</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1"></a><a href="#__codelineno-26-1"><span class="linenos" data-linenos="1 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">moving_avg</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span></code></pre></div>
<p>ğŸŸ¢ <code>moving_avg</code> å®šä¹‰</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1"></a><a href="#__codelineno-27-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">moving_avg</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2"></a><a href="#__codelineno-27-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3"></a><a href="#__codelineno-27-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="sd">    Moving average block to highlight the trend of time series</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4"></a><a href="#__codelineno-27-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="sd">    """</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5"></a><a href="#__codelineno-27-5"><span class="linenos" data-linenos=" 5 "></span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kernel_size</span><span class="p">,</span> <span class="n">stride</span><span class="p">):</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6"></a><a href="#__codelineno-27-6"><span class="linenos" data-linenos=" 6 "></span></a>        <span class="nb">super</span><span class="p">(</span><span class="n">moving_avg</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7"></a><a href="#__codelineno-27-7"><span class="linenos" data-linenos=" 7 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span> <span class="o">=</span> <span class="n">kernel_size</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8"></a><a href="#__codelineno-27-8"><span class="linenos" data-linenos=" 8 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">avg</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">AvgPool1d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="n">kernel_size</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="n">stride</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9"></a><a href="#__codelineno-27-9"><span class="linenos" data-linenos=" 9 "></span></a>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10"></a><a href="#__codelineno-27-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11"></a><a href="#__codelineno-27-11"><span class="linenos" data-linenos="11 "></span></a>        <span class="c1"># padding on the both ends of time series</span>
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12"></a><a href="#__codelineno-27-12"><span class="linenos" data-linenos="12 "></span></a>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13"></a><a href="#__codelineno-27-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="c1"># æå–ç¬¬ä¸€ä¸ªæ—¶é—´æ­¥å¹¶é‡å¤ï¼Œç”¨äºå‰ç«¯å¡«å……</span>
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14"></a><a href="#__codelineno-27-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="c1">#  [B, L, D] -&gt; [B, 1, D] -&gt; [B, (kernel_size-1)//2, D]</span>
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15"></a><a href="#__codelineno-27-15"><span class="linenos" data-linenos="15 "></span></a>        <span class="n">front</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> 
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16"></a><a href="#__codelineno-27-16"><span class="linenos" data-linenos="16 "></span></a>
</span><span id="__span-27-17"><a id="__codelineno-27-17" name="__codelineno-27-17"></a><a href="#__codelineno-27-17"><span class="linenos" data-linenos="17 "></span></a>        <span class="c1"># æå–æœ€åä¸€ä¸ªæ—¶é—´æ­¥å¹¶é‡å¤ï¼Œç”¨äºåç«¯å¡«å……</span>
</span><span id="__span-27-18"><a id="__codelineno-27-18" name="__codelineno-27-18"></a><a href="#__codelineno-27-18"><span class="linenos" data-linenos="18 "></span></a>        <span class="c1"># [B, L, D] -&gt; [B, 1, D] -&gt; [B, (kernel_size-1)//2, D]</span>
</span><span id="__span-27-19"><a id="__codelineno-27-19" name="__codelineno-27-19"></a><a href="#__codelineno-27-19"><span class="linenos" data-linenos="19 "></span></a>        <span class="n">end</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-27-20"><a id="__codelineno-27-20" name="__codelineno-27-20"></a><a href="#__codelineno-27-20"><span class="linenos" data-linenos="20 "></span></a>
</span><span id="__span-27-21"><a id="__codelineno-27-21" name="__codelineno-27-21"></a><a href="#__codelineno-27-21"><span class="linenos" data-linenos="21 "></span></a>        <span class="c1"># è¿æ¥å¡«å……éƒ¨åˆ†ä¸åŸåºåˆ—</span>
</span><span id="__span-27-22"><a id="__codelineno-27-22" name="__codelineno-27-22"></a><a href="#__codelineno-27-22"><span class="linenos" data-linenos="22 "></span></a>        <span class="c1"># [B, (k-1)//2, D] + [B, L, D] + [B, (k-1)//2, D] -&gt; [B, L+(k-1), D]</span>
</span><span id="__span-27-23"><a id="__codelineno-27-23" name="__codelineno-27-23"></a><a href="#__codelineno-27-23"><span class="linenos" data-linenos="23 "></span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">front</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">end</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-27-24"><a id="__codelineno-27-24" name="__codelineno-27-24"></a><a href="#__codelineno-27-24"><span class="linenos" data-linenos="24 "></span></a>
</span><span id="__span-27-25"><a id="__codelineno-27-25" name="__codelineno-27-25"></a><a href="#__codelineno-27-25"><span class="linenos" data-linenos="25 "></span></a>        <span class="c1"># è½¬ç½®å¹¶åº”ç”¨ä¸€ç»´å¹³å‡æ± åŒ–</span>
</span><span id="__span-27-26"><a id="__codelineno-27-26" name="__codelineno-27-26"></a><a href="#__codelineno-27-26"><span class="linenos" data-linenos="26 "></span></a>        <span class="c1"># [B, L+(k-1), D] -&gt; [B, D, L+(k-1)] -&gt; [B, D, L]</span>
</span><span id="__span-27-27"><a id="__codelineno-27-27" name="__codelineno-27-27"></a><a href="#__codelineno-27-27"><span class="linenos" data-linenos="27 "></span></a>        <span class="c1"># æ± åŒ–çª—å£å¤§å°ä¸ºkernel_sizeï¼Œæ­¥é•¿ä¸º1ï¼Œè¾“å‡ºé•¿åº¦ä¸º(L+(k-1)-k+1)=L ï¼ˆlength + 2P - K + 1ï¼‰</span>
</span><span id="__span-27-28"><a id="__codelineno-27-28" name="__codelineno-27-28"></a><a href="#__codelineno-27-28"><span class="linenos" data-linenos="28 "></span></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="__span-27-29"><a id="__codelineno-27-29" name="__codelineno-27-29"></a><a href="#__codelineno-27-29"><span class="linenos" data-linenos="29 "></span></a>
</span><span id="__span-27-30"><a id="__codelineno-27-30" name="__codelineno-27-30"></a><a href="#__codelineno-27-30"><span class="linenos" data-linenos="30 "></span></a>        <span class="c1"># è½¬ç½®å›åŸå§‹ç»´åº¦é¡ºåº [B, D, L] -&gt; [B, L, D]</span>
</span><span id="__span-27-31"><a id="__codelineno-27-31" name="__codelineno-27-31"></a><a href="#__codelineno-27-31"><span class="linenos" data-linenos="31 "></span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-27-32"><a id="__codelineno-27-32" name="__codelineno-27-32"></a><a href="#__codelineno-27-32"><span class="linenos" data-linenos="32 "></span></a>        <span class="k">return</span> <span class="n">x</span>
</span></code></pre></div>
<p>æ€»ç»“ï¼šå°±æ˜¯ 3 æ¬¡è°ƒç”¨ï¼š</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1"></a><a href="#__codelineno-28-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="n">seasonal_init</span><span class="p">,</span> <span class="n">trend_init</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decomp</span><span class="p">(</span><span class="n">x_enc</span><span class="p">)</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2"></a><a href="#__codelineno-28-2"><span class="linenos" data-linenos=" 2 "></span></a>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3"></a><a href="#__codelineno-28-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="bp">self</span><span class="o">.</span><span class="n">decomp</span> <span class="o">=</span> <span class="n">series_decomp</span><span class="p">(</span><span class="n">kernel_size</span><span class="p">)</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4"></a><a href="#__codelineno-28-4"><span class="linenos" data-linenos=" 4 "></span></a>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5"></a><a href="#__codelineno-28-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">series_decomp</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6"></a><a href="#__codelineno-28-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kernel_size</span><span class="p">):</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7"></a><a href="#__codelineno-28-7"><span class="linenos" data-linenos=" 7 "></span></a>        <span class="nb">super</span><span class="p">(</span><span class="n">series_decomp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8"></a><a href="#__codelineno-28-8"><span class="linenos" data-linenos=" 8 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">moving_avg</span> <span class="o">=</span> <span class="n">moving_avg</span><span class="p">(</span><span class="n">kernel_size</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9"></a><a href="#__codelineno-28-9"><span class="linenos" data-linenos=" 9 "></span></a>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10"></a><a href="#__codelineno-28-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11"></a><a href="#__codelineno-28-11"><span class="linenos" data-linenos="11 "></span></a>        <span class="n">moving_mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moving_avg</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12"></a><a href="#__codelineno-28-12"><span class="linenos" data-linenos="12 "></span></a>
</span><span id="__span-28-13"><a id="__codelineno-28-13" name="__codelineno-28-13"></a><a href="#__codelineno-28-13"><span class="linenos" data-linenos="13 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">moving_avg</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-28-14"><a id="__codelineno-28-14" name="__codelineno-28-14"></a><a href="#__codelineno-28-14"><span class="linenos" data-linenos="14 "></span></a>     <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="__span-28-15"><a id="__codelineno-28-15" name="__codelineno-28-15"></a><a href="#__codelineno-28-15"><span class="linenos" data-linenos="15 "></span></a>        <span class="n">front</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> 
</span><span id="__span-28-16"><a id="__codelineno-28-16" name="__codelineno-28-16"></a><a href="#__codelineno-28-16"><span class="linenos" data-linenos="16 "></span></a>        <span class="n">end</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-28-17"><a id="__codelineno-28-17" name="__codelineno-28-17"></a><a href="#__codelineno-28-17"><span class="linenos" data-linenos="17 "></span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">front</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">end</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-28-18"><a id="__codelineno-28-18" name="__codelineno-28-18"></a><a href="#__codelineno-28-18"><span class="linenos" data-linenos="18 "></span></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="__span-28-19"><a id="__codelineno-28-19" name="__codelineno-28-19"></a><a href="#__codelineno-28-19"><span class="linenos" data-linenos="19 "></span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-28-20"><a id="__codelineno-28-20" name="__codelineno-28-20"></a><a href="#__codelineno-28-20"><span class="linenos" data-linenos="20 "></span></a>        <span class="k">return</span> <span class="n">x</span>    
</span></code></pre></div>
<p>ç”¨ä¸€å¼ å›¾è¡¨ç¤º Autoformer åºåˆ—åˆ†è§£çš„çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªåˆ†è§£è¿‡ç¨‹å°†åŸå§‹åºåˆ— x_enc åˆ†è§£ä¸ºä¸¤ä¸ªç›¸åŒå½¢çŠ¶ [B,L,D] çš„å¼ é‡ï¼šè¶‹åŠ¿æˆåˆ†å’Œå­£èŠ‚æ€§æˆåˆ†ï¼š</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1"></a><a href="#__codelineno-29-1"><span class="linenos" data-linenos=" 1 "></span></a>                    è¾“å…¥: x_enc [B, L, D]
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2"></a><a href="#__codelineno-29-2"><span class="linenos" data-linenos=" 2 "></span></a>                          |
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3"></a><a href="#__codelineno-29-3"><span class="linenos" data-linenos=" 3 "></span></a>                          v
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4"></a><a href="#__codelineno-29-4"><span class="linenos" data-linenos=" 4 "></span></a>            +---------------------------+
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5"></a><a href="#__codelineno-29-5"><span class="linenos" data-linenos=" 5 "></span></a>            | Model.forward()           |
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6"></a><a href="#__codelineno-29-6"><span class="linenos" data-linenos=" 6 "></span></a>            | è°ƒç”¨: self.decomp(x_enc)  |
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7"></a><a href="#__codelineno-29-7"><span class="linenos" data-linenos=" 7 "></span></a>            +---------------------------+
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8"></a><a href="#__codelineno-29-8"><span class="linenos" data-linenos=" 8 "></span></a>                          |
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9"></a><a href="#__codelineno-29-9"><span class="linenos" data-linenos=" 9 "></span></a>                          v
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10"></a><a href="#__codelineno-29-10"><span class="linenos" data-linenos="10 "></span></a>            +---------------------------+
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11"></a><a href="#__codelineno-29-11"><span class="linenos" data-linenos="11 "></span></a>            | series_decomp(kernel_size)|
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12"></a><a href="#__codelineno-29-12"><span class="linenos" data-linenos="12 "></span></a>            | self.decompå®ä¾‹           |
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13"></a><a href="#__codelineno-29-13"><span class="linenos" data-linenos="13 "></span></a>            +---------------------------+
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14"></a><a href="#__codelineno-29-14"><span class="linenos" data-linenos="14 "></span></a>                          |
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15"></a><a href="#__codelineno-29-15"><span class="linenos" data-linenos="15 "></span></a>                          v
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16"></a><a href="#__codelineno-29-16"><span class="linenos" data-linenos="16 "></span></a>            +---------------------------+
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17"></a><a href="#__codelineno-29-17"><span class="linenos" data-linenos="17 "></span></a>            | series_decomp.forward(x)  |
</span><span id="__span-29-18"><a id="__codelineno-29-18" name="__codelineno-29-18"></a><a href="#__codelineno-29-18"><span class="linenos" data-linenos="18 "></span></a>            | 1. è°ƒç”¨ç§»åŠ¨å¹³å‡è®¡ç®—è¶‹åŠ¿   |
</span><span id="__span-29-19"><a id="__codelineno-29-19" name="__codelineno-29-19"></a><a href="#__codelineno-29-19"><span class="linenos" data-linenos="19 "></span></a>            | 2. åŸåºåˆ—å‡å»è¶‹åŠ¿å¾—åˆ°å­£èŠ‚æ€§|
</span><span id="__span-29-20"><a id="__codelineno-29-20" name="__codelineno-29-20"></a><a href="#__codelineno-29-20"><span class="linenos" data-linenos="20 "></span></a>            +---------------------------+
</span><span id="__span-29-21"><a id="__codelineno-29-21" name="__codelineno-29-21"></a><a href="#__codelineno-29-21"><span class="linenos" data-linenos="21 "></span></a>                          |
</span><span id="__span-29-22"><a id="__codelineno-29-22" name="__codelineno-29-22"></a><a href="#__codelineno-29-22"><span class="linenos" data-linenos="22 "></span></a>                  +-------+-------+
</span><span id="__span-29-23"><a id="__codelineno-29-23" name="__codelineno-29-23"></a><a href="#__codelineno-29-23"><span class="linenos" data-linenos="23 "></span></a>                  |               |
</span><span id="__span-29-24"><a id="__codelineno-29-24" name="__codelineno-29-24"></a><a href="#__codelineno-29-24"><span class="linenos" data-linenos="24 "></span></a>                  v               v
</span><span id="__span-29-25"><a id="__codelineno-29-25" name="__codelineno-29-25"></a><a href="#__codelineno-29-25"><span class="linenos" data-linenos="25 "></span></a>    +---------------------------+  +---------------------------+
</span><span id="__span-29-26"><a id="__codelineno-29-26" name="__codelineno-29-26"></a><a href="#__codelineno-29-26"><span class="linenos" data-linenos="26 "></span></a>    | moving_avg.forward(x)     |  | å­£èŠ‚æ€§è®¡ç®—                |
</span><span id="__span-29-27"><a id="__codelineno-29-27" name="__codelineno-29-27"></a><a href="#__codelineno-29-27"><span class="linenos" data-linenos="27 "></span></a>    | æ­¥éª¤:                     |  | res = x - moving_mean     |
</span><span id="__span-29-28"><a id="__codelineno-29-28" name="__codelineno-29-28"></a><a href="#__codelineno-29-28"><span class="linenos" data-linenos="28 "></span></a>    | 1.å‰åå¡«å……åºåˆ—           |  |                           |
</span><span id="__span-29-29"><a id="__codelineno-29-29" name="__codelineno-29-29"></a><a href="#__codelineno-29-29"><span class="linenos" data-linenos="29 "></span></a>    | 2.åº”ç”¨å¹³å‡æ± åŒ–           |  |                           |
</span><span id="__span-29-30"><a id="__codelineno-29-30" name="__codelineno-29-30"></a><a href="#__codelineno-29-30"><span class="linenos" data-linenos="30 "></span></a>    | 3.è¿”å›è¶‹åŠ¿åˆ†é‡           |  |                           |
</span><span id="__span-29-31"><a id="__codelineno-29-31" name="__codelineno-29-31"></a><a href="#__codelineno-29-31"><span class="linenos" data-linenos="31 "></span></a>    +---------------------------+  +---------------------------+
</span><span id="__span-29-32"><a id="__codelineno-29-32" name="__codelineno-29-32"></a><a href="#__codelineno-29-32"><span class="linenos" data-linenos="32 "></span></a>                  |               |
</span><span id="__span-29-33"><a id="__codelineno-29-33" name="__codelineno-29-33"></a><a href="#__codelineno-29-33"><span class="linenos" data-linenos="33 "></span></a>                  v               v
</span><span id="__span-29-34"><a id="__codelineno-29-34" name="__codelineno-29-34"></a><a href="#__codelineno-29-34"><span class="linenos" data-linenos="34 "></span></a>             è¶‹åŠ¿åˆ†é‡        å­£èŠ‚æ€§åˆ†é‡
</span><span id="__span-29-35"><a id="__codelineno-29-35" name="__codelineno-29-35"></a><a href="#__codelineno-29-35"><span class="linenos" data-linenos="35 "></span></a>          trend_init [B,L,D]  seasonal_init [B,L,D]
</span><span id="__span-29-36"><a id="__codelineno-29-36" name="__codelineno-29-36"></a><a href="#__codelineno-29-36"><span class="linenos" data-linenos="36 "></span></a>                  |               |
</span><span id="__span-29-37"><a id="__codelineno-29-37" name="__codelineno-29-37"></a><a href="#__codelineno-29-37"><span class="linenos" data-linenos="37 "></span></a>                  +       +       +
</span><span id="__span-29-38"><a id="__codelineno-29-38" name="__codelineno-29-38"></a><a href="#__codelineno-29-38"><span class="linenos" data-linenos="38 "></span></a>                          |
</span><span id="__span-29-39"><a id="__codelineno-29-39" name="__codelineno-29-39"></a><a href="#__codelineno-29-39"><span class="linenos" data-linenos="39 "></span></a>                          v
</span><span id="__span-29-40"><a id="__codelineno-29-40" name="__codelineno-29-40"></a><a href="#__codelineno-29-40"><span class="linenos" data-linenos="40 "></span></a>                è¿”å›åˆ°Model.forward()
</span><span id="__span-29-41"><a id="__codelineno-29-41" name="__codelineno-29-41"></a><a href="#__codelineno-29-41"><span class="linenos" data-linenos="41 "></span></a>                è¿›è¡Œåç»­å¤„ç†
</span></code></pre></div>
<p>è®²å›¾ é€å­—ç¨¿ï¼š</p>
<p>ï¼ˆ1ï¼‰<strong>Model.forward()</strong> è°ƒç”¨ self.decomp(x_enc)è¿›è¡Œåºåˆ—åˆ†è§£</p>
<p>ï¼ˆ2ï¼‰<strong>series_decomp.forward(x)</strong></p>
<blockquote>
<p>åŒ…å«ä¸¤ä¸ªä¸»è¦æ­¥éª¤:</p>
<ul>
<li>è°ƒç”¨ self.moving_avg(x)è®¡ç®—ç§»åŠ¨å¹³å‡ï¼Œå¾—åˆ°è¶‹åŠ¿åˆ†é‡</li>
<li>è®¡ç®—åŸåºåˆ—ä¸è¶‹åŠ¿åˆ†é‡çš„å·®å€¼ï¼Œå¾—åˆ°å­£èŠ‚æ€§åˆ†é‡</li>
</ul>
</blockquote>
<p>ï¼ˆ3ï¼‰<strong>moving_avg.forward(x)</strong></p>
<blockquote>
<p>æ‰§è¡Œç§»åŠ¨å¹³å‡è®¡ç®—:</p>
<ul>
<li>é€šè¿‡é‡å¤é¦–å°¾å…ƒç´ è¿›è¡Œåºåˆ—å¡«å……</li>
</ul>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1"></a><a href="#__codelineno-30-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">front</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> 
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2"></a><a href="#__codelineno-30-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">end</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3"></a><a href="#__codelineno-30-3"><span class="linenos" data-linenos="3 "></span></a> <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">front</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">end</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></code></pre></div>
<ul>
<li>åº”ç”¨ä¸€ç»´å¹³å‡æ± åŒ–æ“ä½œ</li>
</ul>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1"></a><a href="#__codelineno-31-1"><span class="linenos" data-linenos="1 "></span></a>x = self.avg(x.permute(0, 2, 1))
</span></code></pre></div>
<p><strong>è¯´æ˜ ä¸ºä»€ä¹ˆå¡«å……ï¼Œæ˜¯ä¸ºäº† ä¿è¯åºåˆ—åœ¨å¹³å‡æ± åŒ–å é•¿åº¦ä¸å˜</strong></p>
<ul>
<li>è¿”å›å¹³æ»‘åçš„è¶‹åŠ¿åˆ†é‡</li>
</ul>
<p>è¿™éƒ¨åˆ†çš„å½¢çŠ¶å˜åŒ–ï¼š </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250319224010427.png"><img alt="image-20250319224010427" src="../images/image-20250319224010427.png"></a> </p>
</blockquote>
<p>ç°åœ¨å¼€å§‹ è¿”å› <strong>moving_avg.forward(x)</strong> æ˜¯åˆ©ç”¨ 1D å¹³å‡æ± åŒ– å¾—åˆ° è¶‹åŠ¿åºåˆ—ï¼Œå°†ç»“æœè¿”å›ç»™ <strong>series_decomp</strong> ï¼Œä¹Ÿå°±æ˜¯è¿™å¥ä»£ç  <code>moving_mean = self.moving_avg(x)</code>ï¼Œå¾—åˆ°è¶‹åŠ¿åºåˆ—ä»¥åï¼Œæ°¸è¿œåºåˆ—å‡è¶‹åŠ¿åºåˆ— <code>res = x - moving_mean</code> ï¼Œå¾—åˆ°å­£èŠ‚åˆ†é‡ï¼Œä¹Ÿå°±æ˜¯å‘¨æœŸæ€§ä¿¡æ¯ã€‚å…·ä½“çš„ä»£ç ï¼š</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250319224315222.png"><img alt="image-20250319224315222" src="../images/image-20250319224315222.png"></a></p>
<p>æœ€ç»ˆ å°†ç»“æœ è¿”å›ç»™ Autoformer forward ä¸­çš„ seasonal_init, trend_init</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250319224700908.png"><img alt="image-20250319224700908" src="../images/image-20250319224700908.png"></a></p>
<p>å¹¶ä¸” ç”¨è¿™ä¸¤ä¸ª init åˆå§‹åŒ– è§£ç å™¨çš„è¾“å…¥ã€‚</p>
<p>è¿™é‡Œå¾—æ³¨æ„ä¸€ä¸‹ï¼Œå¯¹äº æ ‡ç­¾åºåˆ—ï¼Œä¹Ÿå°±æ˜¯ è¾“å…¥åºåˆ—çš„è¶‹åŠ¿ä¿¡æ¯çš„æå–ç”¨çš„æ˜¯ 1Då¹³å‡æ± åŒ–ï¼Œè€Œå¯¹é¢„æµ‹ predict length çš„è¶‹åŠ¿ä¿¡æ¯åˆå§‹åŒ– å°±ç›´æ¥ç”¨çš„ è¾“å…¥åºåˆ—çš„å‡å€¼</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1"></a><a href="#__codelineno-32-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">mean</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x_enc</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pred_len</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></code></pre></div>
<p>å‘¨æœŸæ€§è¶‹åŠ¿ä¹Ÿæ˜¯ï¼Œlabel length çš„å­£èŠ‚è¶‹åŠ¿æ˜¯ æ®‹å·®ï¼Œä¹Ÿå°±æ˜¯ åŸå§‹åºåˆ— å‡å» è¶‹åŠ¿åºåˆ—ï¼Œè€Œ predict length çš„ å­£èŠ‚è¶‹åŠ¿å°±æ˜¯ç›´æ¥åˆå§‹åŒ–ä¸º 0 äº†ã€‚</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1"></a><a href="#__codelineno-33-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">zeros</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">x_dec</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pred_len</span><span class="p">,</span> <span class="n">x_dec</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="n">device</span><span class="o">=</span><span class="n">x_enc</span><span class="o">.</span><span class="n">device</span><span class="p">)</span> 
</span></code></pre></div>
<p>è¿™é‡Œæ˜¯ å°å°çš„åŒºåˆ«ï¼Œå°å°çš„æ³¨æ„ã€‚</p>
<p>å¥½äº† è¿™éƒ¨åˆ†ï¼Œåºåˆ—åˆ†è§£è¯´å®Œäº†ï¼Œä»£ç è®²äº†ï¼ŒåŸæ–‡è®²äº†ï¼Œå…¬å¼å¯¹åº”ä¸Šäº†ï¼Œå›¾ä¹Ÿè¯´äº†ã€‚åŸæ–‡ <code>Series decomposition block</code>  å°±è¿‡å•¦</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250319225341745.png"><img alt="image-20250319225341745" src="../images/image-20250319225341745.png"></a> </p>
<p>åºåˆ—åˆ†è§£ over</p>
<hr>
<h3 id="model-inputs">model inputs<a class="headerlink" href="#model-inputs" title="Permanent link">Â¶</a></h3>
<p>ä¸‹é¢å¼€å§‹ æ¨¡å‹çš„è¾“å…¥ï¼Œå…ˆä»è®ºæ–‡å¼€å§‹è®²è§£ï¼š</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250319225433558.png"><img alt="image-20250319225433558" src="../images/image-20250319225433558.png"></a> </p>
<p>æ¨¡å‹çš„è¾“å…¥éƒ¨åˆ†ï¼Œæ¨¡å‹çš„è¾“å…¥åŒ…æ‹¬ç¼–ç å™¨çš„è¾“å…¥å’Œè§£ç å™¨çš„è¾“å…¥ã€‚å…·ä½“æ¥è¯´ï¼Œ</p>
<p>ç¼–ç å™¨çš„è¾“å…¥æ˜¯è¿‡å» <span class="arithmatex">\(I\)</span> ä¸ªæ—¶é—´æ­¥ï¼Œæ–‡ä¸­ç»™å‡ºçš„ç¬¦å·è¡¨ç¤º <span class="arithmatex">\(\mathcal{X}^{I \times d}\)</span> ï¼Œ<span class="arithmatex">\(I\)</span> è¡¨ç¤ºæ—¶é—´æ­¥é•¿ï¼Œ<span class="arithmatex">\(d\)</span> è¡¨ç¤ºæ¯ä¸ªæ—¶é—´æ­¥çš„ç‰¹å¾æ•°ã€‚</p>
<p>è§£ç å™¨çš„è¾“å…¥åŒ…æ‹¬äº† å­£èŠ‚æ€§åºåˆ— å’Œ è¶‹åŠ¿æ€§åºåˆ—ï¼Œå…·ä½“çš„ç¬¦å·è¡¨ç¤ºåˆ†åˆ«æ˜¯ <span class="arithmatex">\(\mathcal{X}_{des}\)</span>  å’Œ <span class="arithmatex">\(\mathcal{X}_{det}\)</span>    å½¢çŠ¶æ˜¯ä¸€æ ·çš„ï¼š<span class="arithmatex">\((\frac{I}{2}+O)\)</span>  ã€<span class="arithmatex">\(\frac{I}{2}\)</span> æ˜¯ label length çš„é•¿åº¦ï¼Œå–çš„æ˜¯åŸå§‹è¾“å…¥åºåˆ—é•¿åº¦çš„ ä¸€åŠã€‚O æ˜¯ é¢„æµ‹æ­¥é•¿ predict lengthã€‚d åŒæ ·æ˜¯æ¯ä¸ªæ—¶é—´æ­¥çš„ç‰¹å¾æ•°ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹å…¬å¼æ˜¯æ€ä¹ˆè¡¨ç¤ºçš„ï¼š</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320085551155.png"><img alt="image-20250320085551155" src="../images/image-20250320085551155.png"></a></p>
<p><span class="arithmatex">\(\mathcal{X}_{ens}ã€\mathcal{X}_{ent}\)</span>  åˆ†åˆ«è¡¨ç¤º ä» åŸå§‹ è¾“å…¥åºåˆ— <span class="arithmatex">\(\mathcal{X}_{en}\)</span> åˆ†è§£å‡ºçš„å­£èŠ‚æˆåˆ†å’Œè¶‹åŠ¿æˆåˆ†ï¼Œæˆªå–å‡ºååŠéƒ¨åˆ† <span class="arithmatex">\(\frac{I}{2}:I\)</span> ä½œä¸º label lengthï¼Œä¸é•¿åº¦ä¸º predict  length çš„æ—¶é—´æ­¥è¿›è¡Œæ‹¼æ¥ï¼Œç”¨ 0 å¡«å……çš„é•¿åº¦ä¸º predict lengthçš„å‘é‡è®°ä½œ <span class="arithmatex">\(\mathcal{X}_0\)</span> ï¼Œç”¨è¾“å…¥æ—¶é—´åºåˆ—æ—¶é—´æ­¥å‡å€¼å¡«å……çš„é•¿åº¦ä¸º predict length çš„å‘é‡è®°ä½œ <span class="arithmatex">\(\mathcal{X}_{mean}\)</span></p>
<p>ç„¶åï¼Œ<span class="arithmatex">\(\mathcal{X}_{ens}\)</span> ä¸ <span class="arithmatex">\(\mathcal{X}_0\)</span> è¿›è¡Œ concat å¾—åˆ° è§£ç å™¨å­£èŠ‚æˆåˆ†çš„åˆå§‹å€¼  <span class="arithmatex">\(\mathcal{X}_{des}\)</span></p>
<p>å¯¹åº”ç€çš„ <span class="arithmatex">\(\mathcal{X}_{ent}\)</span> ä¸ <span class="arithmatex">\(\mathcal{X}_{mean}\)</span> concat å¾—åˆ°è§£ç å™¨è¶‹åŠ¿æˆåˆ†çš„åˆå§‹å€¼ <span class="arithmatex">\(\mathcal{X}_{mean}\)</span></p>
<p><strong>å†å¼ºè°ƒä¸€ä¸‹ï¼Œè¿™é‡Œæ‰€æ¶‰åŠçš„å‘é‡çš„è®°å·å’Œå½¢çŠ¶ï¼š</strong> </p>
<ul>
<li>ç¼–ç å™¨çš„è¾“å…¥æ˜¯ è¿‡å» <span class="arithmatex">\(I\)</span> ä¸ªæ—¶é—´æ­¥ï¼Œè¡¨ç¤º <span class="arithmatex">\(\mathcal{X}^{I \times d}\)</span> ï¼Œ<span class="arithmatex">\(I\)</span> è¡¨ç¤ºæ—¶é—´æ­¥é•¿ï¼Œ<span class="arithmatex">\(d\)</span> è¡¨ç¤ºæ¯ä¸ªæ—¶é—´æ­¥çš„ç‰¹å¾æ•°ã€‚</li>
<li>è§£ç å™¨å­£èŠ‚æˆåˆ†çš„è¾“å…¥æ˜¯ <span class="arithmatex">\(\mathcal{X}_{des} ^{(\frac{I}{2}+O)\times d}\)</span> ã€è§£ç å™¨è¶‹åŠ¿æˆåˆ†çš„è¾“å…¥æ˜¯ <span class="arithmatex">\(\mathcal{X}_{det} ^{(\frac{I}{2}+O)\times d}\)</span> </li>
<li>æ¶‰åŠåˆ°çš„ä¸­é—´å˜é‡ï¼Œ<span class="arithmatex">\(\mathcal{X}^{\frac{I}{2} \times d}_{ens}\)</span> ï¼Œ<span class="arithmatex">\(\mathcal{X}^{\frac{I}{2} \times d}_{ent}\)</span> å¯ä»¥ç†è§£ä¸ºæ ‡ç­¾åºåˆ—çš„å­£èŠ‚æˆåˆ†å’Œè¶‹åŠ¿æˆåˆ†ï¼Œå°±æ˜¯ä»è¾“å…¥åºåˆ—åˆ†è§£çš„å­£èŠ‚æˆåˆ†å’Œè¶‹åŠ¿æˆåˆ†ä¸­æˆªå–çš„ååŠæ®µã€‚</li>
<li>é¢„æµ‹åºåˆ—å­£èŠ‚æˆåˆ†çš„åˆå§‹å€¼æ˜¯ <span class="arithmatex">\(\mathcal{X}_0 ^{O \times d}\)</span> ï¼Œè¶‹åŠ¿æˆåˆ†åˆå§‹å€¼æ˜¯ <span class="arithmatex">\(\mathcal{X}^{O \times d} _{Mean}\)</span></li>
</ul>
<p>ä¹Ÿå°±æ˜¯è®ºæ–‡ä¸­æ¨¡å‹ç»“æ„å›¾çš„ï¼š</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320091412914.png"><img alt="image-20250320091412914" src="../images/image-20250320091412914.png"></a></p>
<p>å…·ä½“åˆ°ä»£ç ï¼Œå°±æ˜¯ autoformer forwardçš„å‰ 5 è¡Œï¼Œå…¶ä¸­ self.decompæ˜¯æˆ‘ä»¬åˆšåˆšä»”ç»†è®²è¿‡çš„ åºåˆ—åˆ†è§£æ¨¡å— Series decomposition blockï¼š</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320091921116.png"><img alt="image-20250320091921116" src="../images/image-20250320091921116.png"></a></p>
<p>è¿™éƒ¨åˆ†ä»£ç æ¯”è¾ƒå¥½ç†è§£ï¼Œå°±è¿™æ ·ï¼Œä»¥ä¸Šéƒ¨åˆ†å®Œæˆäº†å¯¹åŸæ–‡ model inputs éƒ¨åˆ†çš„è®²è§£ï¼Œä»£ç ï¼Œè®ºæ–‡ï¼Œå›¾ï¼Œå…¬å¼éƒ½è®²äº†ã€‚</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320092158923.png"><img alt="image-20250320092158923" src="../images/image-20250320092158923.png"></a></p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320092214513.png"><img alt="image-20250320092214513" src="../images/image-20250320092214513.png"></a></p>
<h3 id="encoder">Encoder<a class="headerlink" href="#encoder" title="Permanent link">Â¶</a></h3>
<p><strong>æ¥ä¸‹æ¥è¿›å…¥è®ºæ–‡çš„ Encoder éƒ¨åˆ†</strong> </p>
<p>ä¼šåŒæ ·æŒ‰ç…§ï¼Œè®ºæ–‡ã€å›¾ã€å…¬å¼ã€ä»£ç ä¸€ä¸€å¯¹åº”çš„é€»è¾‘è¿›è¡Œè®²è§£</p>
<p><strong>é¦–å…ˆï¼ŒAutoformer éµå¾ªåŸå§‹ Transformer çš„ç»“æ„ï¼Œ</strong> </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320092445230.png"><img alt="image-20250320092445230" src="../images/image-20250320092445230.png"></a></p>
<p>ç¼–ç å™¨ï¼Œè§£ç å™¨ï¼Œç¼–ç å™¨æ¥æ”¶çš„ input æ˜¯ word embedding + positional embeddingï¼Œç„¶åé€šè¿‡è‡ªæ³¨æ„åŠ›æœºåˆ¶å’Œå‰é¦ˆç¥ç»ç½‘ç»œã€‚è§£ç å™¨æ¥æ”¶çš„ è¾“å…¥æ˜¯ outputï¼Œé¢„æµ‹éƒ¨åˆ†ï¼ŒåŒæ ·æ˜¯ word embedding+positional embeddingï¼Œç„¶ååˆ†åˆ«ç»è¿‡è§£ç å™¨è¾“å…¥çš„ è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼Œä»¥åŠå’Œç¼–ç å™¨è¾“å‡º çš„ äº¤å‰æ³¨æ„åŠ›ï¼Œæœ€åç»è¿‡ å…¨è¿æ¥å±‚ï¼Œå¾—åˆ°æœ€ç»ˆçš„è¾“å‡ºã€‚</p>
<p>é¦–å…ˆå¼ºè°ƒä¸€ä¸‹å…³äºTransformer ä¸ºä»€ä¹ˆæ˜¯æ³¨æ„åŠ›æœºåˆ¶å’Œå…¨è¿æ¥å±‚çš„è®¾è®¡ï¼Ÿ</p>
<blockquote>
<p>é¦–å…ˆï¼ŒTransformer åœ¨ NLPä¸­æ¥æ”¶çš„æ•°æ®æ ¼å¼ æ˜¯ [B,L,D]ï¼Œbatch sizeï¼Œä¸€ä¸ª batch ä¸­æœ‰å¤šå°‘ä¸ªå¥å­ï¼Œä¸€ä¸ªå¥å­ä¸­æœ‰å‡ ä¸ªè¯ Lï¼Œæ¯ä¸ªè¯çš„åµŒå…¥Dï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªè¯ç”¨é•¿åº¦ä¸ºå¤šå°‘çš„å‘é‡è¡¨ç¤º</p>
<p>æœ€ç›´è§‚çš„è®²è§£ï¼Œå°±æ˜¯ æ³¨æ„åŠ›æœºåˆ¶è¿›è¡Œ L å±‚é¢çš„äº¤äº’ï¼Œå‰é¦ˆç¥ç»ç½‘ç»œè¿›è¡Œ D å±‚é¢çš„äº¤äº’ã€‚</p>
<p><strong>L å±‚é¢ä¹Ÿå°±æ˜¯æ³¨æ„åˆ°äº† è¯ä¸è¯ä¹‹é—´çš„äº¤äº’ï¼ŒD å±‚é¢å°±æ˜¯è¯ä¸è¯ä¹‹é—´ç‰¹å¾çš„äº¤äº’</strong> </p>
<blockquote>
<p>åœ¨Lå±‚é¢ï¼ˆå•è¯å±‚é¢ï¼‰è¿›è¡Œäº¤äº’ï¼Œè®¡ç®—æ¯ä¸ªå•è¯å¯¹å…¶ä»–å•è¯çš„æ³¨æ„åŠ›æƒé‡ï¼Œæ•æ‰è¯ä¸è¯ä¹‹é—´çš„å…³ç³»ï¼›</p>
<p>åœ¨Då±‚é¢ï¼ˆå³å•è¯åµŒå…¥çš„ç‰¹å¾å±‚é¢ï¼‰è¿›è¡Œäº¤äº’ï¼Œå¯¹æ¯ä¸ªå•è¯çš„åµŒå…¥å‘é‡è¿›è¡Œéçº¿æ€§å˜æ¢ï¼Œæ•æ‰è¯ä¸è¯ä¹‹é—´çš„ç‰¹å¾äº¤äº’ </p>
</blockquote>
<p><strong>å¯¹åº”åˆ°æ—¶é—´åºåˆ—ä¸­</strong></p>
<p>1ï¸âƒ£ æ ‡å‡† <mark>è¾“å…¥</mark> æ ¼å¼ä¹Ÿæ˜¯ BLDï¼Œå…·ä½“çš„è§£é‡Šï¼š </p>
<blockquote>
<p>B = 32 (æ‰¹é‡å¤§å°ï¼Œ32ä¸ªæ—¶é—´åºåˆ—æ ·æœ¬)
L = 36 (æ¯ä¸ªæ ·æœ¬æœ‰36ä¸ªæ—¶é—´æ­¥ï¼Œå¦‚è¿‡å»36å¤©çš„æ•°æ®)
D = 7 (æ¯ä¸ªæ—¶é—´æ­¥æœ‰7ä¸ªç‰¹å¾ï¼Œå¦‚å¯¹äºè‚¡ç¥¨å¯èƒ½åŒ…æ‹¬å¼€ç›˜ä»·ã€æ”¶ç›˜ä»·ã€æœ€é«˜ä»·ã€æœ€ä½ä»·ã€äº¤æ˜“é‡ç­‰)</p>
</blockquote>
<p>2ï¸âƒ£ <mark>å¤„ç†</mark>   æ³¨æ„åŠ›æœºåˆ¶</p>
<p>ç¼–ç å™¨ä¸­ï¼Œæ³¨æ„åŠ›åœ¨æ‰€æœ‰36ä¸ªæ—¶é—´æ­¥ä¹‹é—´å»ºç«‹è¿æ¥
è§£ç å™¨ä¸­ï¼Œæ³¨æ„åŠ›æ—¢åœ¨é¢„æµ‹åºåˆ—å†…éƒ¨å»ºç«‹è¿æ¥ï¼Œä¹Ÿä¸ç¼–ç å™¨è¾“å‡ºå»ºç«‹è¿æ¥</p>
<p>æ—¶é—´æ­¥ä¹‹é—´çš„å»ºæ¨¡ å¯ä»¥ å‘ç°è‚¡ç¥¨ä»·æ ¼æ¯å‘¨äº”å¯èƒ½ä¸‹è·Œï¼Œæˆ–è€…æ¯æœˆåˆå¯èƒ½ä¸Šæ¶¨çš„æ¨¡å¼</p>
<p>3ï¸âƒ£ <mark>å¤„ç†</mark>  å‰é¦ˆå…¨è¿æ¥å±‚</p>
<p>å¤„ç†æ¯ä¸ªæ—¶é—´æ­¥å†…7ä¸ªç‰¹å¾ä¹‹é—´çš„å…³ç³»</p>
<p>ä¾‹å¦‚ï¼Œäº¤æ˜“é‡ä¸ä»·æ ¼å˜åŠ¨çš„å…³ç³»ï¼Œæˆ–å¼€ç›˜ä»·ä¸æ”¶ç›˜ä»·çš„å…³ç³»</p>
</blockquote>
<p>è¯¶ï¼Œè¯´èµ·è¿™ä¸ªï¼Œå…³äºç”¨ç°å®ä¾‹å­ç†è§£è¿™äº›æ¨¡å‹ï¼Œ</p>
<p><strong>é¦–å…ˆï¼Œå·ç§¯æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</strong> </p>
<p>å‡å¦‚æˆ‘ä»¬è¦è®¤è¯†ä¸€ä¸ªäººAï¼ŒB æ˜¯ A çš„ç›´æ¥æœ‹å‹ï¼Œå½¢æˆäº†B å¯¹ A çš„ç¬¬ä¸€æ¬¡è®¤è¯†ï¼ŒB å°±ç›¸å½“äºå·ç§¯æ ¸äº†ï¼Œé‚£ç›´æ¥è®¤è¯† Açš„è‚¯å®šä¸æ­¢ä¸€ä¸ªäººï¼Œè¿˜æœ‰B1ï¼ŒB2ï¼ŒB3...ç­‰ï¼Œæ¯ä¸ªäººå¯¹å½¢æˆäº†å¯¹ A çš„ç¬¬ä¸€æ¬¡è®¤è¯†ï¼Œçˆ¶æ¯è®¤è¯† Aæ›´å…³æ³¨ç”Ÿæ´»å±‚é¢ï¼Œå­¦æ ¡ä¸­ç›´æ¥è®¤è¯†çš„ A æ›´å…³äºä¸ºäººå¤„äº‹éƒ¨åˆ†ï¼Œå·¥ä½œä¸­ç›´æ¥è®¤è¯†çš„ A æ›´å…³äº A çš„ç”Ÿäº§æ€§ã€‚è¿™é‡Œç›´æ¥è®¤è¯† A çš„B1ï¼ŒB2ï¼ŒB3...å°±æ˜¯æ¯ä¸€å±‚ä¸­ å·ç§¯æ ¸çš„ä¸ªæ•°ã€‚é™¤äº†ç›´æ¥è®¤è¯† A çš„ï¼Œè¿˜æœ‰é€šè¿‡ç›´æ¥è®¤è¯† A çš„äººB è®¤è¯† Aï¼Œè¿™æ³¢äººå« Cï¼Œé‚£è¿˜æœ‰é€šè¿‡ C è®¤è¯† A çš„ï¼Œé‚£ C åˆè®¤è¯† Dï¼ŒD åˆé€šè¿‡ C è®¤è¯† Aã€‚é™¤äº†åˆ«äººè®¤è¯† Aï¼ŒA è‡ªå·±ä¹Ÿæœ‰å¯¹è‡ªå·±çš„è®¤è¯†ã€‚</p>
<p><strong>Transformeræ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</strong></p>
<p>é™¤äº†åˆšåˆšè¯´çš„ æ³¨æ„åŠ›æœºåˆ¶å’Œå‰é¦ˆå…¨è¿æ¥å±‚çš„ç†è§£ï¼Œè¿˜æœ‰ Encoder ã€Decoder ã€å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶çš„ç†è§£ã€‚</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></label> Encoder&amp;Decoder çš„äº¤äº’æ€ä¹ˆç†è§£ï¼Ÿ</li>
</ul>
<p>é¦–å…ˆï¼Œæ•´ä½“ä¸Šçš„è¿™ä¸ªå›¾ï¼š</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320095403477.png"><img alt="image-20250320095403477" src="../images/image-20250320095403477.png"></a></p>
<p>ç¼–ç å™¨ç›¸å½“äºç”²æ–¹ï¼Œè§£ç å™¨ç›¸å½“äºä¹™æ–¹ï¼Œç”²æ–¹æœ‰éœ€æ±‚ï¼Œè‡ªå·±å…¬å¸å†…éƒ¨ä¸€çº§ä¸€çº§æ²Ÿé€šï¼Œä»æœ€å¼€å§‹çš„æƒ³æ³•æœ€ç»ˆå½¢æˆæ–¹æ³•äº¤ç»™æœ€åä¸€ä¸ªäººï¼Œè¿™ä¸ªäººå»å’Œä¹™å…¬å¸æ²Ÿé€šï¼Œä¹™å…¬å¸åˆæœ‰å¾ˆå¤šä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†åˆ†åˆ«å®Œæˆç”²å…¬å¸æå‡ºçš„æ–¹æ¡ˆçš„ä¸€éƒ¨åˆ†ï¼Œè¿™ä¸€ä¸ªè¿‡ç¨‹ä¸­éœ€è¦ä¸æ–­çš„ä¸ç”²å…¬å¸æ‰‹æ‹¿æœ€ç»ˆæ–¹æ¡ˆçš„äººä¸æ–­æ²Ÿé€šï¼Œæœ€ç»ˆä¹™å…¬å¸å®Œæˆæ–¹æ¡ˆã€‚</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></label> å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶æ€ä¹ˆç†è§£</li>
</ul>
<p>å¯¹äº BLD çš„åºåˆ—ï¼Œé¦–å…ˆæ˜ç™½çš„æ˜¯ï¼Œé‚£ä¸ªç»´åº¦åˆ†å¤šå¤´äº†ï¼Œæ˜¯ D ç»´åº¦åˆ†æˆ num headç»´åº¦å’Œ head dimï¼Œå…¶ä¸­ num head Ã— head dim = embedding dimï¼ˆDï¼‰ï¼Œç›¸å½“äºä»€ä¹ˆæ„æ€ï¼Œä¸€ä¸ªäººå­¦çŸ¥è¯†ï¼ˆB =1ï¼‰ï¼ŒL æ˜¯è¦å­¦çš„å‡ æœ¬ä¹¦ï¼ŒD æ˜¯æ¯æœ¬ä¹¦æœ‰å‡ ä¸ªç« èŠ‚ï¼Œä¸€èˆ¬æ˜¯ä¸€ä¸ªè€å¸ˆæ•™æˆ‘ä»¬å­¦ä¸€æ•´æœ¬ä¹¦ï¼Œä½†å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶çš„æ„æ€æ˜¯ï¼Œä¸€æœ¬ä¹¦çš„å‡ ä¸ªç« èŠ‚ï¼Œåˆ†å¼€ï¼Œæ¯”å¦‚ç¬¬ä¸€ä¸ªè€å¸ˆæ•™ç¬¬ä¸€ç« å’Œç¬¬äºŒç« ï¼Œç¬¬äºŒä¸ªè€å¸ˆæ•™ç¬¬ä¸‰ç« å’Œç¬¬å››ç« ï¼Œæœ€åä¸¤å¼ ç¬¬ä¸‰ä¸ªè€å¸ˆæ•™ï¼Œè¿™æ ·å­¦ä¹ çš„æ—¶å€™ï¼ŒåŒæ ·æ˜¯ä¸€ä¸ªå­¦æœŸï¼Œä¸€ä¸ªè€å¸ˆåªéœ€è¦å…³æ³¨ä¸¤ç« çš„å†…å®¹ï¼Œå¯¹äºè¯¾ç¨‹èŠ‚å¥çš„æŠŠæ¡çŸ¥è¯†ç†è§£çš„æ›´é€å½»ï¼Œæ•ˆæœä¼šæ¯”ä¸€ä¸ªè€å¸ˆæ•™ä¸€æ•´æœ¬ä¹¦çš„å†…å®¹è¦å¥½ä¸€äº›ã€‚</p>
<p>B=3ï¼Œå°±æ˜¯ç­é‡Œçš„ 3 ä¸ªäººï¼Œæ¯ä¸ªäººè¿™å­¦æœŸéƒ½è¦ä¸Šè¿™å‡ æœ¬è¯¾ï¼ŒåŒæ ·çš„ LDã€‚</p>
<blockquote>
<p>æœ€åä¸€ä¸ª linear å±‚ï¼Œåº”è¯¥æ˜¯ä¸ºäº†è¿˜åŸåŸå§‹ç»´åº¦çš„ã€‚</p>
</blockquote>
<h4 id="_8">è®ºæ–‡<a class="headerlink" href="#_8" title="Permanent link">Â¶</a></h4>
<p><strong>å¥½äº†ï¼Œæ‰©å±•çš„è¿œäº†ï¼Œå›åˆ°è®ºæ–‡ä¸­Encoder éƒ¨åˆ†</strong> </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320092249326.png"><img alt="image-20250320092249326" src="../images/image-20250320092249326.png"></a></p>
<p>åŸæ–‡ä¸­è¯´ï¼Œé¦–å…ˆç¼–ç å™¨æ›´ä¸“æ³¨å­£èŠ‚éƒ¨åˆ†çš„å»ºæ¨¡ï¼Œç¼–ç å™¨çš„è¾“å‡ºåŒ…å«è¿‡å»çš„å­£èŠ‚æ€§ä¿¡æ¯ï¼Œå¹¶å°†ä½œä¸ºäº¤å‰ä¿¡æ¯å¸®åŠ©è§£ç å™¨ç»†åŒ–é¢„æµ‹ç»“æœï¼Œå‡è®¾æœ‰ N ä¸ªç¼–ç å™¨ï¼Œåˆ™ç¬¬ i å±‚ç¼–ç å™¨çš„æ€»ä½“æ–¹ç¨‹å¯ä»¥è¡¨ç¤ºä¸º <span class="arithmatex">\(\mathcal{X}_{en}^l = Encoder(\mathcal{X}_{en}^{l-1})\)</span> ï¼Œå°±æ˜¯è¯´ ç¬¬ <span class="arithmatex">\(l\)</span> å±‚ç¼–ç å™¨æ¥æ”¶ ç¬¬ <span class="arithmatex">\(l-1\)</span> å±‚ç¼–ç å™¨çš„è¾“å‡ºä½œä¸ºè¾“å…¥ï¼Œå…·ä½“çš„ç»†èŠ‚æ˜¯åŸæ–‡çš„å…¬å¼(3)</p>
<p><strong>ä¸‹é¢å¯¹ å…¬å¼ 3 è¿›è¡Œè®²è§£</strong></p>
<p>é¦–å…ˆï¼Œç­‰å·å·¦è¾¹ï¼Œä¸‹åˆ’çº¿è¡¨ç¤ºå¿½ç•¥æ‰å­£èŠ‚æˆåˆ†ï¼Œåªå…³æ³¨å­£èŠ‚æˆåˆ†ã€‚</p>
<p><span class="arithmatex">\(\mathcal{X}_{en}^l = \mathcal{S}_{en}^{l,2},l \in {1,...,N}\)</span>  è¡¨ç¤º ç¬¬ <span class="arithmatex">\(l\)</span> å±‚ç¼–ç å™¨çš„è¾“å‡ºã€‚</p>
<ul class="task-list">
<li>
<p>åˆå§‹å€¼ï¼Œä¹Ÿå°±æ˜¯ç¼–ç å™¨çš„è¾“å…¥æ˜¯ <span class="arithmatex">\(\mathcal{X}_{en}^0\)</span> æ˜¯ è¾“å…¥æ—¶é—´åºåˆ—çš„ <span class="arithmatex">\(\mathcal{X}_{en}\)</span> çš„ word embedding</p>
</li>
<li class="task-list-item">
<p><label class="task-list-control"><input disabled="" type="checkbox"><span class="task-list-indicator"></span></label> <span class="arithmatex">\(\mathcal{S}_{en}^{l,i},i \in {1,2}\)</span> è¡¨ç¤º ç¬¬ <span class="arithmatex">\(l\)</span>å±‚ä¸­ ç¬¬ i ä¸ªåºåˆ—åˆ†è§£æ¨¡å—ä¹‹åçš„å­£èŠ‚æ€§æˆåˆ†ï¼Œç„¶åå…¬å¼ä¸­çš„ Auto-correlation åé¢å†è¯´ï¼Œè¿™æ˜¯æœ¬æ–‡çš„ä¸€ä¸ªåˆ›æ–°ç‚¹ã€‚ï¼ˆpsï¼Œåé¢è¦é‡ç‚¹çœ‹è¿™ä¸ªæ˜¯ä»€ä¹ˆæ„æ€ã€‚ï¼‰</p>
</li>
</ul>
<blockquote>
<p>ï¼ˆæˆ‘æœ€å¼€å§‹çœ‹è§è¿™é‡Œçš„ç–‘é—®ï¼Œä¸ç”¨è®²ï¼Œå¿½ç•¥æ‰å³å¯ï¼‰å…ˆçœ‹å…¬å¼ç­‰å·çš„å·¦è¾¹ï¼Œ <span class="arithmatex">\(\mathcal{S}_{en}^{l,1}\)</span> é¦–å…ˆï¼Œä¸‹æ ‡ <span class="arithmatex">\(en\)</span> å°±æ˜¯è¡¨ç¤º ç¼–ç å™¨ï¼Œ<span class="arithmatex">\(l\)</span> è¡¨ç¤ºç¬¬å‡ ä¸ªç¼–ç å™¨ï¼Œé‚£è¿™ä¸ª <span class="arithmatex">\(1\)</span>æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</p>
</blockquote>
<p><strong>åŸæ–‡å’Œå…¬å¼è¯´äº†ï¼Œæ¥ä¸‹æ¥æ¥çœ‹ä»£ç ï¼ŒEncoder æ˜¯æ€ä¹ˆå®ç°çš„ã€‚</strong></p>
<h4 id="encoder-embedding_1">Encoder Embedding<a class="headerlink" href="#encoder-embedding_1" title="Permanent link">Â¶</a></h4>
<p><mark>é¦–å…ˆï¼Œæ„é€  Encoder çš„è¾“å…¥</mark> ï¼Œç¼–ç å™¨åµŒå…¥ã€‚</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320143146767.png"><img alt="image-20250320143146767" src="../images/image-20250320143146767.png"></a></p>
<p>å…·ä½“æ€ä¹ˆåšçš„çœ‹autoformer çš„ init éƒ¨åˆ†ï¼š</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320143228968.png"><img alt="image-20250320143228968" src="../images/image-20250320143228968.png"></a></p>
<p>çœ‹åˆ°è¿™è¾¹è°ƒç”¨çš„ <code>DataEmbedding_wo_pos</code> è¿™ä¸ªç±»ï¼Œå…¶ä¸­å…·ä½“åœ° valueEmbedding å’ŒTemporaryEmbedding åˆåˆ†åˆ«åœ¨ init ä¸­æ˜¾ç¤ºè°ƒç”¨äº† <code>TokenEmbedding</code> ç±»å’Œ <code>TemporalEmbedding</code> ç±»</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320143256379.png"><img alt="image-20250320143256379" src="../images/image-20250320143256379.png"></a></p>
<h5 id="_9">ç±»å›¾<a class="headerlink" href="#_9" title="Permanent link">Â¶</a></h5>
<p>åµŒå…¥éƒ¨åˆ†çš„è°ƒç”¨å…³ç³»ç”¨æµç¨‹å›¾æ¥è¡¨ç¤ºï¼š</p>
<pre class="mermaid"><code>classDiagram
    class DataEmbedding_wo_pos {
        +TokenEmbedding value_embedding
        +PositionalEmbedding position_embedding
        +TemporalEmbedding temporal_embedding
        +Dropout dropout
        +forward(x, x_mark)
    }

    class TokenEmbedding {
        +Conv1d tokenConv
        +forward(x)
    }

    class PositionalEmbedding {
        +Tensor pe
        +forward(x)
    }

    class TemporalEmbedding {
        +Embedding minute_embed
        +Embedding hour_embed
        +Embedding weekday_embed
        +Embedding day_embed
        +Embedding month_embed
        +forward(x)
    }

    class TimeFeatureEmbedding {
        +Linear embed
        +forward(x)
    }

    DataEmbedding_wo_pos --&gt; TokenEmbedding
    DataEmbedding_wo_pos --&gt; PositionalEmbedding
    DataEmbedding_wo_pos --&gt; TemporalEmbedding
    TemporalEmbedding --&gt; TimeFeatureEmbedding
</code></pre>
<p>é¦–å…ˆï¼Œè·Ÿå¤§å®¶è¯´è¿™ä¸ªå›¾æ€ä¹ˆç”»ï¼Œé¦–å…ˆåœ¨è°ƒè¯•çš„è¿‡ç¨‹ä¸­ï¼Œçœ‹åˆ°è°ƒç”¨ç›¸å…³çš„ä»£ç ï¼Œå°±ç²˜è´´ç»™ gptï¼Œç„¶åè®© gpt ç”»ã€‚è¿™ä¸ªå›¾å°±æ˜¯ gpt ç»™æˆ‘ç”»çš„ï¼Œå®ƒç”¨çš„ mermaid ï¼Œç”Ÿæˆä»£ç ï¼Œç„¶åæˆ‘ç²˜è´´åˆ°æˆ‘çš„ markdown æ–‡æ¡£ä¸­ï¼Œæˆ‘ç”¨çš„ markdown ç¼–è¾‘å™¨æ˜¯ Typoraï¼Œå¯ä»¥è§£æ mermaidï¼Œç”¨åœ¨çº¿mermaid ä¹Ÿå¯ä»¥æ˜¾ç¤ºå‡ºå›¾ã€‚ç›´æ¥æœ åœ¨çº¿ mermaidã€‚æˆ–è€…è·Ÿ gpt è¯´ï¼Œç”¨ç®€å•çš„æµç¨‹å›¾ç”»ï¼Œä¸ç”¨ mermaidï¼Œéƒ½èƒ½å¸®ä½ æŠŠè‡ªå·±çš„ä»£ç ç†æ¸…æ¥šã€‚</p>
<p>mermaid ç”»å‡ºçš„ç±»è°ƒç”¨å›¾ï¼Œä¸€ä¸ªç±»ç”¨ä¸‰è¡Œè¡¨ç¤ºï¼Œç¬¬ä¸€è¡Œ ç±»åã€ç¬¬äºŒè¡Œï¼Œinit éƒ¨åˆ†çš„å®šä¹‰ã€ç¬¬ä¸‰è¡Œç±»ä¸­æ–¹æ³•çš„å®šä¹‰</p>
<p><strong>å¥½äº†ï¼Œç°åœ¨å¼€å§‹è®²å›¾ï¼Œ</strong> </p>
<p>å¯ä»¥çœ‹åˆ° <code>DataEmbedding_wo_pos</code> ç±» çš„ init åˆ†åˆ«è°ƒç”¨äº† <code>TokenEmbedding</code>ç±»ã€<code>PositionalEmbedding</code>ç±»å’Œ <code>TemporalEmbedding</code>ç±»ï¼ŒåŒæ—¶è¿˜å®šä¹‰äº†ä¸€ä¸ª dropout å±‚ã€‚</p>
<p>ğŸ”µ è°ƒç”¨ <code>tokenEmbedding</code>ç±»ï¼Œinit éƒ¨åˆ†æ˜¯ä½¿ç”¨ä¸€ä¸ª <code>nn.Conv1d</code> åˆå§‹åŒ–äº†ä¸€ä¸ªå·ç§¯å±‚ï¼Œä¼ ç»™ <code>self.tokenConv</code> ï¼Œåé¢åœ¨ è¿™ä¸ªç±»ä¸­çš„ forward æ–¹æ³•ä¸­ç”¨ã€‚</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320144456851.png"><img alt="image-20250320144456851" src="../images/image-20250320144456851.png"></a></p>
<p>é€šä¿—ç‚¹è¯´ï¼Œè¿™é‡Œçš„ tokenEmbedding å°±æ˜¯é€šè¿‡ä¸€ä¸ª1D å·ç§¯å®ç°çš„ï¼Œå…·ä½“çš„å½¢çŠ¶å˜åŒ–æ³¨é‡Šä¸­ä¹Ÿç»™å‡ºäº†ã€‚</p>
<blockquote>
<p>æ€ä¹ˆç”Ÿæˆæ³¨é‡Šï¼Ÿ</p>
<p>é¦–å…ˆæŠŠä»£ç ç²˜ç»™ gptï¼Œç„¶åï¼Œè·Ÿå®ƒè¯´ï¼š<code>ä¸ºæ¯è¡Œä»£ç  æ·»åŠ  ä¸¤è¡Œæ³¨é‡Šï¼Œä¸€è¡Œè¯´æ˜è¿™è¡Œä»£ç çš„ç›®çš„ï¼Œä¸€è¡Œè¯´æ˜ å½¢çŠ¶çš„å˜åŒ–å’Œæ“ä½œ å½¢çŠ¶-&gt;æ“ä½œ-&gt;å½¢çŠ¶çš„æ ¼å¼ï¼Œæ“ä½œçš„æ ¼å¼ç±»ä¼¼ DecoderLayer.forward æ˜¾ç¤ºå‡ºè°ƒç”¨çš„ä»€ä¹ˆç±»å.æ–¹æ³•</code></p>
</blockquote>
<p>ğŸ”µ æ¥ä¸‹æ¥çœ‹ ä½ç½®ç¼–ç  Positional Embeddingï¼Œç”±äºè¿™é‡Œæ²¡æœ‰ç”¨ï¼Œå°±ä¸è¯´äº†ã€‚</p>
<p>ğŸ”µ æœ€åï¼Œæ—¶é—´æˆ³ç¼–ç ï¼Œ</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320145727249.png"><img alt="image-20250320145727249" src="../images/image-20250320145727249.png"></a></p>
<p>æ³¨æ„è¿™é‡Œçš„æ—¶é—´æˆ³ç¼–ç æ˜¯æœ‰ä¸€ä¸ªåˆ¤æ–­çš„ï¼Œç»è¿‡è°ƒè¯•ï¼Œæˆ‘ä»¬è¿™é‡Œè°ƒç”¨çš„æ˜¯ <code>TimeFeatureEmbedding</code> ç±»ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ä»€ä¹ˆæ„æ€ï¼Œè¿™ä¸ªå›¾ç”»çš„æœ‰é—®é¢˜ï¼Œä¸è¿‡æ„æ€ä¹Ÿæ˜¯å¯¹çš„ï¼Œå°±ä¸æ·±ç©¶äº†ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è·³åˆ° <code>TimeFeatureEmbedding</code> è¿™ä¸ªç±»çš„å®šä¹‰ã€‚</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320150012753.png"><img alt="image-20250320150012753" src="../images/image-20250320150012753.png"></a> </p>
<p>å°±æ˜¯é€šè¿‡ä¸€ä¸ªçº¿æ€§å±‚ï¼Œå°† æ—¶é—´æˆ³ç‰¹å¾åµŒå…¥åˆ°æŒ‡å®šç»´åº¦ã€‚</p>
<p>é¦–å…ˆï¼ŒåµŒå…¥åˆ°æŒ‡å®šç»´åº¦æ˜¯å› ä¸ºé«˜ç»´å‘é‡è¡¨ç¤ºç‰¹å¾æ›´ç²¾ç»†ã€‚</p>
<p>å…¶æ¬¡ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„æ˜¯ç–¾ç—…æ•°æ®é›†ï¼Œæ˜¯å°æ—¶çš„ï¼Œæ‰€ä»¥ç»´åº¦ 4ï¼Œè¡¨ç¤ºçš„çš„æ˜¯ï¼Œå°æ—¶-å¤©ï¼Œå¤©-å‘¨ï¼Œå¤©-æœˆï¼Œå¤©-å¹´ã€‚è¿™ä¸€éƒ¨åˆ†ä¹Ÿè¯´è¿‡å¾ˆå¤šæ¬¡äº†ï¼Œå†è¯´ä¸€æ¬¡ï¼ŒåŠ æ·±å°è±¡ã€‚</p>
<p>å…·ä½“æ¥è¯´è¾“å…¥çš„ <code>x_mark.shape=32,36,4 â†’ nn.Linear â†’ 32,36,512</code></p>
<p>æ¥ä¸‹æ¥ï¼Œæ€»ç»“ä¸€ä¸‹è¿™é‡Œçš„åµŒå…¥ã€‚é¦–å…ˆ æœ¬æ–‡ç”¨åˆ°çš„æ‰€æœ‰åµŒå…¥éƒ½å®šä¹‰åœ¨äº†  <code>Embed.py</code>æ–‡ä»¶ä¸­</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320150552474.png"><img alt="image-20250320150552474" src="../images/image-20250320150552474.png"></a></p>
<p>è€Œè¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œåˆå®šä¹‰äº†æ‰€æœ‰çš„åµŒå…¥ç±»ï¼Œåˆæœ‰ 8 ä¸ªã€‚</p>
<blockquote>
<p>é¢˜å¤–è¯ï¼Œè¿™ä¸ªæ€ä¹ˆçœ‹ï¼Œæ˜¯ vscode çš„å¤§çº²è§†å›¾ï¼Œæ‰¾å‡ºæ¥ï¼Œå°±èƒ½çœ‹åˆ°äº†</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320150811010.png"><img alt="image-20250320150811010" src="../images/image-20250320150811010.png"></a></p>
<p>å¤§çº²è§†å›¾ä¸­ï¼Œç«‹æ–¹ä½“è¡¨ç¤ºå®šä¹‰çš„å‡½æ•°ï¼Œå°æ ‘æˆçš„ä¸œè¥¿æ˜¯ç±»ï¼Œç±»ä¸­æœ‰å°ç«‹æ–¹ä½“ï¼Œæ˜¯ç±»ä¸­å®šä¹‰çš„å‡½æ•°ï¼Œç±»ä¸­å®šä¹‰çš„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯å°ç«‹æ–¹ä½“ä¸­ï¼ŒæŠ˜å çš„éƒ¨åˆ†æ˜¯ ä½¿ç”¨è¿™ä¸ªå‡½æ•°æˆ–è€…ç±»æ‰€éœ€è¦çš„åˆå§‹åŒ–å‚æ•°ã€‚æ–¹æ‹¬å·+å°ç«‹æ–¹ä½“åŒ…æ‹¬çš„éƒ¨åˆ†æ˜¯ ç±»ä¸­è°ƒç”¨çš„ç±»çš„å¯¹è±¡åï¼Œæ¯”å¦‚è¿™é‡Œï¼š</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320151133019.png"><img alt="image-20250320151133019" src="../images/image-20250320151133019.png"></a></p>
<p>ä»¥è¿™ä¸ª TemporalEmbedding ç±»ä¸ºä¾‹ï¼Œ è¿™ä¸ªTemporalEmbedding ç±»ä¸­æœ‰ä¸¤ä¸ªæ–¹æ³•æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯ init å’Œ forwardã€‚</p>
<p>init æŠ˜å çš„éƒ¨åˆ†æ˜¯ åˆå§‹åŒ–è¿™ä¸ªç±»æ‰€éœ€è¦çš„å‚æ•°ï¼Œ forward æŠ˜å çš„éƒ¨åˆ†æ˜¯è°ƒç”¨è¿™ä¸ªæ—¶æ‰€éœ€è¦çš„å‚æ•°ï¼Œå…¶ä¸­ init éƒ¨åˆ†è¿˜å®ä¾‹åŒ–äº† 5 ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡ååˆ†åˆ«æ˜¯ mintue_embedã€hour_embedã€weekday_embedã€day_embedã€month_embedï¼Œä½†æ˜¯è¿™é‡Œå…·ä½“å®ä¾‹åŒ–çš„å“ªä¸ªç±»ã€‚è¿™é‡Œæ˜¯æ²¡æœ‰æ˜¾ç¤ºçš„ï¼Œå¾—ç‚¹è¿›å»è‡ªå·±çœ‹ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªå¯¹è±¡å…¶å®éƒ½æ˜¯å®ä¾‹åŒ–çš„Embed è¿™ä¸ªç±»ï¼Œå¾ˆæ˜æ˜¾æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„ï¼Œæƒ³çœ‹è¿˜å¾—æ­¥è¿›çœ‹å…·ä½“å®ä¾‹åŒ–çš„å“ªä¸ªç±»ã€‚</p>
</blockquote>
<p>ä»¥ä¸Šå®Œæˆäº† Encoder Input çš„ Embedding éƒ¨åˆ†ï¼Œåˆ†åˆ«è¿›è¡Œäº† token Embedding å’Œ TemporaryEmbeddingæ¥å¯¹å†å²æ—¶é—´æ­¥ç‰¹å¾è¿›è¡ŒåµŒå…¥å’Œæ—¶é—´ç‰¹å¾è¿›è¡ŒåµŒå…¥ã€‚</p>
<p>æ±‡æ€»è¿™é‡Œçš„ç»´åº¦å½¢çŠ¶å˜åŒ–ï¼š</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1"></a><a href="#__codelineno-34-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># x [B, L, D] â†’ permute â†’ [B, D, L] â†’ å·ç§¯ â†’ [B, d_model, L] â†’ transpose â†’ [B, L, d_model]</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2"></a><a href="#__codelineno-34-2"><span class="linenos" data-linenos="2 "></span></a><span class="c1"># x_mark [B, L, d_inp] â†’ çº¿æ€§å±‚å˜æ¢(æ—¶é—´ç‰¹å¾æ•´ä½“æ˜ å°„) â†’ [B, L, d_model]</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3"></a><a href="#__codelineno-34-3"><span class="linenos" data-linenos="3 "></span></a><span class="c1"># [B, L, d_model] + [B, L, d_model] â†’ [B, L, d_model]</span>
</span></code></pre></div>
<p><strong>æ¥ä¸‹æ¥æƒ³ç»™å¤§å®¶è¯´çš„æ˜¯ï¼Œ 1D å·ç§¯æ€ä¹ˆè¿›è¡Œçš„ tokenEmbeddingï¼š</strong> </p>
<p>å°å°çš„ç‚¹ï¼Œå°å°çš„æ³¨æ„ã€‚</p>
<p>æ¥æ”¶çš„æ ‡å‡†è¾“å…¥æ˜¯ BLD</p>
<ul>
<li>é¦–å…ˆè¿›è¡Œçš„æ˜¯ permuteï¼Œå°†æƒ³è¦åµŒå…¥çš„ç»´åº¦<code>D</code> ç§»åˆ°ä¸­é—´ï¼Œç„¶åè¿›è¡Œ 1D å·ç§¯ï¼ŒåµŒå…¥åˆ° <code>d_model</code>  ï¼ˆ <code>Embedding dim</code>ï¼‰ï¼Œå¯¹åº”åˆ° 1D å·ç§¯ä¸­ï¼Œå°±æ˜¯è¾“å…¥é€šé“æ˜¯ Dï¼Œè¾“å‡ºé€šé“æ˜¯ <code>d_model</code></li>
</ul>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320152707837.png"><img alt="image-20250320152707837" src="../images/image-20250320152707837.png"></a></p>
<ul>
<li>ä¸ºä»€ä¹ˆè¿™ä¹ˆåšï¼Ÿå› ä¸ºå·ç§¯æœ€å¼€å§‹ä¸»è¦ç”¨äºå›¾åƒï¼Œå›¾åƒçš„æ ‡å‡†æ ¼å¼æ˜¯ BCHWï¼Œå›¾åƒä¸­çš„ HW å°±è¡¨ç¤ºå›¾åƒçš„ç‰¹å¾ï¼Œåªä¸è¿‡æ˜¯ç”¨ 2Dçš„çŸ©é˜µ è¡¨ç¤ºçš„ï¼Œè€Œä¸”è¿™ä¸ª 2D çŸ©é˜µä¿å­˜äº†ä½ç½®ä¿¡æ¯ï¼Œä¸èƒ½éšæ„å±•å¹³ã€‚é‚£æ­¤æ—¶ï¼ŒC ä¹Ÿå°±å¯ä»¥ç†è§£ä¸ºæ¯ä¸ªåƒç´ çš„ç‰¹å¾æ•°ã€‚æ¯”å¦‚æ¯ä¸ªåƒç´ ç”¨å½©è‰²çš„ RGB ä¸‰ä¸ªå…ƒç´ è¡¨ç¤ºã€‚</li>
<li>æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œçš„æ—¶é—´åºåˆ—ä¸­çš„ 1D å·ç§¯ï¼Œä¹Ÿä»¿ç…§å›¾åƒä¸­å·ç§¯çš„å®šä¹‰ï¼Œæ¯ä¸ªæ—¶é—´æ­¥çš„ç‰¹å¾æ•°æ”¾åˆ°ä¸­é—´ï¼Œè¡¨ç¤ºè¾“å…¥é€šé“æ•°ï¼Œç„¶åå°†æ¯ä¸ªæ—¶é—´æ­¥çš„ç‰¹å¾ï¼Œæ˜ å°„åˆ°è¾“å‡ºç»´åº¦å¤§å°ï¼Œè¿™é‡Œè¡¨ç¤ºä¸º <code>Embedding dim</code>ï¼Œä¹Ÿå°±æ˜¯ <code>d_model</code>ã€‚</li>
</ul>
<p>ç”¨ä¸€å¼ å›¾æ¥è¡¨ç¤ºï¼Œ(è¿™é‡Œå…¶å®å¾ˆåƒ SegRNN çš„è§†è§’è½¬æ¢)ï¼š</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320154515642.png"><img alt="image-20250320154515642" src="../images/image-20250320154515642.png"></a></p>
<p>è€Œ æ—¶é—´æˆ³ç‰¹å¾çš„ nn.Linearå°±æ˜¯ç›´æ¥å¯¹æœ€åä¸€ä¸ªç»´åº¦è¿›è¡ŒåµŒå…¥äº†</p>
<p><code>x_mark [B, L, d_inp] â†’ çº¿æ€§å±‚å˜æ¢(æ—¶é—´ç‰¹å¾æ•´ä½“æ˜ å°„) â†’ [B, L, d_model]</code></p>
<p>pytorchä¸­å¸¸ç”¨çš„æ˜¯ç»´åº¦å˜æ¢å‡½æ•° permuteã€transposeã€view éƒ½æ˜¯ç›´æ¥å†™ç»´åº¦å˜æ¢ã€‚</p>
<p>å¸¦ç€èµ°ä¸€éä»£ç ã€‚</p>
<h4 id="encoder-forward">Encoder forward<a class="headerlink" href="#encoder-forward" title="Permanent link">Â¶</a></h4>
<p><strong>è¡Œäº†ï¼ŒåµŒå…¥è®²å®Œäº†ï¼Œæ¥ä¸‹æ¥ï¼Œè¿›å…¥æ­£å¼çš„ Encoder çš„éƒ¨åˆ†çš„æ•°æ®æµåŠ¨ã€‚</strong></p>
<p>ï¼ˆç»ˆäºï¼‰</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320160444391.png"><img alt="image-20250320160444391" src="../images/image-20250320160444391.png"></a></p>
<p>ä» Autoformer forward çš„ self.encoder è¿›å…¥ã€‚</p>
<p>åœ¨æ­¥è¿›ä¹‹å‰çœ‹ä¸€çœ¼æ€ä¹ˆåˆå§‹åŒ–çš„ã€‚éå¸¸å¤æ‚ï¼š</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320160615516.png"><img alt="image-20250320160615516" src="../images/image-20250320160615516.png"></a></p>
<p>æ¥ç›´æ¥çœ‹å›¾å§ï¼Œå…·ä½“æ€ä¹ˆå¤æ‚ã€‚</p>
<h5 id="_10">ç±»å›¾<a class="headerlink" href="#_10" title="Permanent link">Â¶</a></h5>
<pre class="mermaid"><code>classDiagram
    class Model {
        +Encoder encoder
    }

    class Encoder {
        +List~EncoderLayer~ layers
        +my_Layernorm norm_layer
        +forward(x, attn_mask)
    }

    class EncoderLayer {
        +AutoCorrelationLayer attention
        +Conv1d conv1
        +Conv1d conv2
        +series_decomp decomp1
        +series_decomp decomp2
        +Dropout dropout
        +activation
        +forward(x, attn_mask)
    }

    class AutoCorrelationLayer {
        +AutoCorrelation attention
        +Linear query_projection
        +Linear key_projection
        +Linear value_projection
        +Linear out_projection
        +forward(queries, keys, values, attn_mask)
    }

    class AutoCorrelation {
        +bool mask_flag
        +int factor
        +float scale
        +Dropout dropout
        +bool output_attention
        +time_delay_agg_training(values, corr)
        +time_delay_agg_inference(values, corr)
        +forward(queries, keys, values, attn_mask)
    }

    Model --&gt; Encoder
    Encoder --&gt; EncoderLayer
    EncoderLayer --&gt; AutoCorrelationLayer
    EncoderLayer --&gt; Conv1d
    EncoderLayer --&gt; series_decomp
    AutoCorrelationLayer --&gt; AutoCorrelation
</code></pre>
<p>é¦–å…ˆå›¾ä¸­æ¸…æ¥šçš„å±•ç¤ºäº†ï¼Œå°±å›¾æ¥è¯´ï¼š</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320161544932.png"><img alt="image-20250320161544932" src="../images/image-20250320161544932.png"></a> </p>
<p>é€šè¿‡ Autoformer å®šä¹‰çš„ model ä¸­ï¼Œå®šä¹‰äº†è¿™ä¸ª Encoder ç±»ï¼Œä¼ ç»™äº† self.encoder ã€‚</p>
<p>æ¥ç€çœ‹è¿™ä¸ª Encoder ç±»çš„å®šä¹‰ï¼Œè¿™ä¸ª Encoder çš„åˆå§‹åŒ–è°ƒç”¨äº†EncoderLayerç±»ï¼Œä¼ ç»™äº† layersï¼ˆå°±æ˜¯EncoderLayerç±»çš„å®ä¾‹åŒ–å¯¹è±¡ï¼‰ã€‚</p>
<p>å¯¹åº”åˆ°ä»£ç ï¼š</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320161505407.png"><img alt="image-20250320161505407" src="../images/image-20250320161505407.png"></a></p>
<p>æ¥ç€ï¼ŒEncoder ç±»è°ƒç”¨äº† EncoderLayer ç±»ï¼Œé‚£æ¥ä¸‹æ¥å°±çœ‹ EncoderLayer çš„å®šä¹‰ï¼š</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320161704846.png"><img alt="image-20250320161704846" src="../images/image-20250320161704846.png"></a></p>
<p>çœ‹å›¾ä»¥åŠä»£ç ï¼š</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320162010963.png"><img alt="image-20250320162010963" src="../images/image-20250320162010963.png"></a></p>
<p>ï¼ˆçœ‹ä»£ç ï¼‰ï¼šçº¢æ¡†æ˜¯ä¸Šé¢è®²çš„ï¼Œ<code>Encoder</code> çš„åˆå§‹åŒ–éœ€è¦è°ƒç”¨ <code>EncoderLayer</code> ç±»</p>
<p>ç¬¬ä¸€ä¸ªçº¢æ¡†è¡¨ç¤ºï¼Œ<code>EncoderLayer</code> ä¸­çš„ <code>init</code> åˆå§‹åŒ–ä¸­åˆè°ƒç”¨äº† <code>AutoCorrelationLayer</code> ç±»ï¼Œå¹¶ä¸”ä¼ å…¥äº†  <code>EncoderLayer</code> åˆå§‹åŒ–è¿‡ç¨‹ä¸­æ‰€éœ€è¦çš„å‚æ•° ï¼Œå» <code>EncoderLayer</code> è¿™ä¸ªç±»ã€‚</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320162631428.png"><img alt="image-20250320162631428" src="../images/image-20250320162631428.png"></a></p>
<p>ç»“åˆ å›¾ å’Œ ä»£ç ï¼Œè¿™éƒ¨åˆ†å°±å¯ä»¥ç†è§£äº†ã€‚</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320163036643.png"><img alt="image-20250320163036643" src="../images/image-20250320163036643.png"></a> </p>
<p>ä¸»è¦çš„å¤æ‚ç‚¹å°±æ˜¯åˆå§‹åŒ–ä¸€ä¸ªç±»çš„åŒæ—¶åˆéœ€è¦åˆå§‹åŒ–å¦ä¸€ä¸ªç±»ï¼Œåˆå§‹åŒ–å¦ä¸€ä¸ªç±»åˆéœ€è¦åˆå§‹åŒ–ç±»ã€‚å¥½å¥½çœ‹çœ‹æ˜¯å¯ä»¥ç†è§£çš„ã€‚</p>
<p>åé¢è¿˜æœ‰ AutoCorrelationLayer çš„åˆå§‹åŒ–ï¼Œåˆè¦è°ƒç”¨ AutoCorrelation ç±»</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320163322154.png"><img alt="image-20250320163322154" src="../images/image-20250320163322154.png"></a></p>
<p>ç†è§£çš„é€»è¾‘æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>é¦–å…ˆä»£ç  Autoformer forward Encoderçš„åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œç»™å‡ºäº†æ¯ä¸ªç±»åˆå§‹åŒ–æ‰€éœ€è¦çš„ä¼ å…¥å‚æ•°</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320163438704.png"><img alt="image-20250320163438704" src="../images/image-20250320163438704.png"></a></p>
<p>è€Œä¸Šé¢ mermaid ç”»çš„å›¾ï¼Œå±•ç¤ºäº†æ¯ä¸ªç±»ä¸­ init ä¸­å…·ä½“è°ƒç”¨çš„ç±»å’Œå®ä¾‹åŒ–çš„å¯¹è±¡åã€‚ä»¥åŠé™¤äº† init æ–¹æ³•å¤–ï¼Œè¿˜æœ‰ç±»ä¸­å¯ä»¥è°ƒç”¨çš„æ–¹æ³•ï¼Œæ¯”å¦‚ AutoCorrelationä¸­ï¼Œé™¤äº† initã€forward ä»¥å¤–ï¼Œè¿˜æœ‰ <code>time_delay_agg_training</code>  å’Œ <code>time_delay_agg_inference</code> </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320163849697.png"><img alt="image-20250320163849697" src="../images/image-20250320163849697.png"></a></p>
<p>è¿™éƒ¨åˆ†è°ƒç”¨å…³ç³»å¸Œæœ›æˆ‘è®²æ˜ç™½äº†ï¼Œå†ç”¨ä¸€å¼ å›¾è¯´æ˜ä¸€ä¸‹ï¼š</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="https://i-blog.csdnimg.cn/direct/f98d7865ca134201a76ece97f66b7e51.png"><img alt="img" src="https://i-blog.csdnimg.cn/direct/f98d7865ca134201a76ece97f66b7e51.png"></a></p>
<p>å°±æ˜¯è¯´åœ¨æˆ‘ä»¬åœ¨ Encoder forward ä¸­ä¼ å…¥åˆ°çš„xï¼Œä¼šä¼ å…¥åˆ° EncoderLayer ä¸­çš„ forward ä¸­è¿›è¡Œå¤„ç†ï¼Œè€Œ   EncoderLayer forward ä¸­åˆè°ƒç”¨äº† AutoCorrelation Layer ä¸­çš„ forwardï¼Œç„¶åå‘¢ï¼ŒAutoCorrelation Layer ä¸­çš„ forwardåˆè°ƒç”¨äº† AutoCorrelationçš„ forwardï¼Œæœ€åAutoCorrelationåˆè°ƒç”¨äº†è‡ªå·± AutoCorrelation time delay agg tranning æˆ–è€… inferenceã€‚</p>
<p>ï¼ˆè°æ‡‚å•Šã€‚å½“åˆé€æ­¥è°ƒè¯•çš„æ—¶å€™ï¼Œæ­¥è¿›ä¸€ä¸ªåˆæ­¥è¿›ä¸€ä¸ªï¼Œéƒ½æ‰¾ä¸åˆ°å¤´ T_Tï¼‰ï¼Œä¸ºä»€ä¹ˆè¯´è¿™éƒ¨åˆ†è°ƒç”¨ä¸å¥½ç†è§£ï¼Œæ˜¯å› ä¸ºæŒ‰ç†è¯´ï¼Œforward ä¸­æœ‰è°ƒç”¨ï¼Œå» init ä¸­æ‰¾ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼ŒAutoformer çš„ forward ä¸­è°ƒç”¨äº† <code>self.encoder</code> ï¼Œåœ¨ init ä¸­æ‰¾åˆ°äº†</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320164728075.png"><img alt="image-20250320164728075" src="../images/image-20250320164728075.png"></a></p>
<p>é‚£æŒ‰ä½ commandï¼Œè·³è¿›Encoder çš„å®šä¹‰ï¼Œä¸ç®¡æ˜¯ init è¿˜æ˜¯ forward ä¸­éƒ½æ²¡æœ‰æ˜¾ç¤ºçš„è¯´æ˜ attn_layeræ˜¯è°ƒç”¨çš„ä»€ä¹ˆã€‚</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320164939255.png"><img alt="image-20250320164939255" src="../images/image-20250320164939255.png"></a></p>
<p>æ‰€ä»¥æœ€å¼€å§‹æ­¥è¿›è¿™é‡Œçš„æ—¶å€™ï¼Œå°±å¾ˆæ™•ã€‚å…¶å®è¿™é‡Œæ‰€æœ‰çš„åˆå§‹åŒ–ä»¥åŠè°ƒç”¨éƒ½åœ¨æœ€æœ€å¼€å§‹çš„  Autoformer çš„ self.encoderçš„åˆå§‹åŒ–ä¸­ç»™äº†ã€‚åœ¨åé¢å®šä¹‰çš„ç±»ä¸­ï¼ŒæŒ‰ä½ command ä¸èƒ½è·³åˆ°ç±»çš„å®šä¹‰ã€‚å¾—ä»å¤´å¼€å§‹ã€‚å½“ç„¶äº†ï¼Œæ­¥è¿›å°±ä¸ç”¨ç®¡è¿™äº›äº†ã€‚è‡ªå·±å°±è·³æ¥è·³å»äº†ã€‚</p>
<p><strong>å¥½äº† ä»¥ä¸Šå®Œæˆäº† self.encoderçš„åˆå§‹åŒ–ï¼Œåˆšåˆšæ˜¯å¯¹ ç¼–ç å™¨æ‰€æ¥æ”¶çš„è¾“å…¥è¿›è¡ŒåµŒå…¥ï¼Œè¿™é‡Œæ˜¯æ¨¡å‹çš„å®šä¹‰</strong></p>
<p>åŸºäºä»¥ä¸Šçš„è®¤è¯†ï¼Œæ¥ä¸‹æ¥è¿›å…¥ forward ä¸­ï¼Œçœ‹æ•°æ®çš„æµåŠ¨è¿‡ç¨‹ã€‚</p>
<h4 id="encoderlayer">EncoderLayer<a class="headerlink" href="#encoderlayer" title="Permanent link">Â¶</a></h4>
<p>é¦–å…ˆï¼Œä» â¬‡ï¸ å¼€å§‹æ­¥è¿›ã€‚</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1"></a><a href="#__codelineno-35-1"><span class="linenos" data-linenos="1 "></span></a> <span class="n">enc_out</span><span class="p">,</span> <span class="n">attns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">(</span><span class="n">enc_out</span><span class="p">,</span> <span class="n">attn_mask</span><span class="o">=</span><span class="n">enc_self_mask</span><span class="p">)</span>
</span></code></pre></div>
<p>å¦‚æˆ‘ä»¬æ‰€æ–™ï¼Œæ­¥è¿›åˆ°äº† Encoder ç±»çš„ forwardï¼š</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320165637015.png"><img alt="image-20250320165637015" src="../images/image-20250320165637015.png"></a></p>
<p>ç»§ç»­æ­¥è¿›ï¼Œä¸€æ­¥æ­¥æ‰§è¡Œï¼š</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320165724095.png"><img alt="image-20250320165724095" src="../images/image-20250320165724095.png"></a></p>
<p>æ¡ä»¶åˆ¤æ–­æ‰§è¡Œ elseï¼Œè·³åˆ°</p>
<blockquote>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></label> æ¯ä¸€æ­¥çš„ç°å®æ„ä¹‰åœ¨åšä»€ä¹ˆ</li>
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></label> å½¢çŠ¶å˜åŒ–ã€è°ƒç”¨å…³ç³»</li>
</ul>
</blockquote>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320211248706.png"><img alt="image-20250320211248706" src="../images/image-20250320211248706.png"></a></p>
<p>EncoderLayer çš„ forward ä¸­è°ƒç”¨äº†è‡ªç›¸å…³æœºåˆ¶ï¼ˆè‡ªç›¸å…³æœºåˆ¶=AutoCorrelation Layer + AutoCorrelationï¼‰ï¼Œè¿™æ˜¯æœ¬æ–‡çš„åˆ›æ–°ç‚¹ï¼Œåé¢å†è¯´ã€‚è®ºæ–‡ä¸­ä¹Ÿæ˜¯è¯´äº†åé¢å†è¯´ï¼Œä½œè€…è®¾è®¡äº†è¿™ä¸ªæ¨¡å—å°±å°±æ˜¯ä»£æ›¿äº†åŸå§‹ Transformer çš„ self attention çš„è®¡ç®—ï¼Œä½ çœ‹è¿™ä¸ªå‘½åï¼Œè™½ç„¶è°ƒç”¨çš„æ˜¯AutoCorrelation Layerï¼Œä½†æ˜¯å˜é‡å‘½åæ—¶ï¼Œä»ç„¶æ˜¯ self.attention ä¹Ÿå°±å¯ä»¥ç†è§£ä¸ºä½œè€…æ˜¯æ”¹è¿›äº†åŸå§‹ Transformer ä¸­çš„è‡ªæ³¨æ„åŠ›æœºåˆ¶ã€‚</p>
<p>å› æ­¤æˆ‘ä»¬è¿™é‡Œåœ¨è°ƒè¯• Encoder çš„å…·ä½“è¿‡ç¨‹æ—¶ï¼Œæš‚æ—¶ä¸æ­¥è¿›åˆ° self.attentionçš„å…·ä½“çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ã€‚</p>
<p>å•ä¸ª Encoder çš„æ‰§è¡Œå°±æ˜¯ æ‰§è¡Œä¸€æ¬¡ EncoderLayerï¼Œæœ‰å‡ ä¸ª Encoderå°±æ‰§è¡Œå‡ æ¬¡ EncoderLayerã€‚</p>
<p>ç°åœ¨è¯´æ˜è¿™ä¸ª EncoderLayer çš„æ‰§è¡Œè¿‡ç¨‹ï¼š</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1"></a><a href="#__codelineno-36-1"><span class="linenos" data-linenos="1 "></span></a>def forward(self, x, attn_mask=None)
</span></code></pre></div>
<p>é¦–å…ˆ EncoderLayer æ¥æ”¶çš„è¾“å…¥æ˜¯ xï¼Œmask æ˜¯å¯é€‰å‚æ•°ã€‚</p>
<p>è¾“å…¥<code>x</code>å½¢çŠ¶ä¸º[B, L, d_model]</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1"></a><a href="#__codelineno-37-1"><span class="linenos" data-linenos="1 "></span></a>       new_x, attn = self.attention(
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2"></a><a href="#__codelineno-37-2"><span class="linenos" data-linenos="2 "></span></a>            x, x, x,
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3"></a><a href="#__codelineno-37-3"><span class="linenos" data-linenos="3 "></span></a>            attn_mask=attn_mask
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4"></a><a href="#__codelineno-37-4"><span class="linenos" data-linenos="4 "></span></a>        )
</span></code></pre></div>
<p>æ¥ä¸‹æ¥è¿›è¡Œ Encoder éƒ¨åˆ†çš„è‡ªæ³¨æ„åŠ›æœºåˆ¶çš„è®¡ç®—ï¼Œè¿™é‡Œå®é™…è°ƒç”¨çš„æ˜¯ä½œè€…çš„åˆ›æ–°æ¨¡å—ï¼Œè‡ªç›¸å…³å±‚ã€‚åé¢ä¸å†åŒºåˆ†å«æ³•ã€‚</p>
<p>è‡ªæ³¨æ„åŠ›æœºåˆ¶==æ¥æ”¶==çš„å‚æ•° qkvéƒ½ç­‰äº xï¼Œå› ä¸ºæ˜¯è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼Œå½¢çŠ¶æ˜¯ä¸€æ ·çš„ [B, L, d_model]ã€‚</p>
<p>è¿™é‡Œçš„ <code>attn_mask=None</code></p>
<p>è‡ªæ³¨æ„åŠ›æœºåˆ¶è¿”å›çš„ å˜é‡æœ‰ <code>new_x</code>, <code>attn</code>ï¼Œå½¢çŠ¶åˆ†åˆ«æ˜¯</p>
<p>new_x<code>[B, L, d_model]</code>å’Œæ³¨æ„åŠ›æƒé‡attn<code>[B, n_heads, L, L]</code></p>
<p>è¿™é‡Œçš„ new_x æ„æ€æ˜¯ æœ‰äº†å¯¹å…¶ä»–æ—¶é—´æ­¥æƒé‡çš„ xï¼Œattn å­˜çš„æ˜¯ä¸¤ä¸¤æ—¶é—´æ­¥ä¹‹é—´çš„æ³¨æ„åŠ›å¾—åˆ†ã€‚ï¼ˆå½“ç„¶äº†ï¼Œè¿™æ˜¯åŸå§‹ è‡ªæ³¨æ„åŠ›æœºåˆ¶ <span class="arithmatex">\(softmax(\frac{QK^T}{\sqrt{d_k}})V\)</span> çš„è®¡ç®—ï¼Œè®ºæ–‡å®ç°çš„è¿™é‡Œé¢æ˜¯å•¥å†è¯´ï¼‰</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1"></a><a href="#__codelineno-38-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="n">new_x</span><span class="p">)</span>
</span></code></pre></div>
<p>æ¥ä¸‹æ¥ï¼Œå•ä¸ª Encoder çš„è¾“å‡º æ˜¯ <code>dropout(new_x)</code> ï¼Œå†ç»è¿‡æ®‹å·®è¿æ¥ã€‚è¿™é‡Œå°±æ˜¯<span id="åŸå§‹ Transformer æ¶æ„">åŸå§‹ Transformer æ¶æ„</span>ã€è§<a href="#é™„å½•">é™„å½•</a>ã€‘ä¸­çš„ä¸œè¥¿ï¼Œä¹Ÿå°±æ˜¯ç»è¿‡è‡ªæ³¨æ„åŠ›æœºåˆ¶ä»¥åè¿›è¡Œ æ®‹å·®è¿æ¥å’Œå½’ä¸€åŒ–ã€‚</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1"></a><a href="#__codelineno-39-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">x</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decomp1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></code></pre></div>
<p>æ¥ä¸‹æ¥ï¼Œæ˜¯åºåˆ—åˆ†è§£</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320214539531.png"><img alt="image-20250320214539531" src="../images/image-20250320214539531.png"></a></p>
<p>åºåˆ—åˆ†è§£çš„ç¬¬ä¸€ä¸ªè¿”å›å€¼æ˜¯å­£èŠ‚æˆåˆ†ï¼Œç¬¬äºŒä¸ªè¿”å›å€¼æ˜¯ä½¿ç”¨ç§»åŠ¨å¹³å‡å¾—åˆ°è¶‹åŠ¿æ€§æˆåˆ†</p>
<p>åœ¨ Encoder ä¸­ä½¿ç”¨çš„åºåˆ—åˆ†è§£æ—¶ï¼Œä¸è¦è¶‹åŠ¿æˆåˆ†ï¼Œåªç•™ä¸‹å­£èŠ‚æˆåˆ†</p>
<p>æ¥æ”¶çš„å‚æ•° x æ˜¯è¦åˆ†è§£çš„åŸå§‹åºåˆ—ï¼Œå½¢çŠ¶æ˜¯ [B, L, d_model]</p>
<p>è¿”å›çš„å‚æ•° x æ˜¯åˆ†è§£ä»¥åçš„å­£èŠ‚æˆåˆ†ï¼Œå½¢çŠ¶ä¾ç„¶æ˜¯ [B, L, d_model]</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320215159566.png"><img alt="image-20250320215159566" src="../images/image-20250320215159566.png"></a> </p>
<p>è¿™éƒ¨åˆ†ä»£ç å°±æ˜¯åŸæ–‡å…¬å¼ 3 çš„ç¬¬ä¸€è¡Œå…¬å¼ã€‚</p>
<p>æŠŠä»£ç è´´åˆ°è¿™é‡Œå†ä½“ä¼šä¸€ä¸‹ï¼š</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320215324397.png"><img alt="image-20250320215324397" src="../images/image-20250320215324397.png"></a></p>
<p>å¯¹ç¬¬ <code>l-1</code> å±‚ Encoder çš„è¾“å‡ºè¿›è¡Œè‡ªç›¸å…³æœºåˆ¶çš„è®¡ç®—ï¼Œå¾—åˆ°çš„è¾“å‡ºä¸åŸå§‹çš„ x è¿›è¡Œæ®‹å·®è¿æ¥ï¼Œæœ€åå¯¹æ®‹å·®è¿æ¥ä»¥åçš„è¾“å‡ºè¿›è¡Œè¶‹åŠ¿åˆ†è§£ï¼ŒåŒæ—¶åªä¿ç•™ å­£èŠ‚æˆåˆ†ï¼Œå¿½ç•¥æ‰è¶‹åŠ¿æˆåˆ†ã€‚</p>
<p><strong>æ¥ä¸‹æ¥ï¼Œè¿›è¡Œå…¬å¼ 3 çš„ç¬¬äºŒè¡Œå…¬å¼æ‰€å¯¹åº”çš„ä»£ç è®²è§£ï¼š</strong> </p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1"></a><a href="#__codelineno-40-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">y</span> <span class="o">=</span> <span class="n">x</span>
</span></code></pre></div>
<p>ä¸‹ä¸€å¥ï¼Œæ–°å»º x çš„å‰¯æœ¬ï¼Œä¿å­˜æˆ yï¼Œåé¢éƒ½å¯¹ x çš„å‰¯æœ¬ ä¹Ÿå°±æ˜¯è¿™ä¸ª y æ“ä½œï¼Œx å…ˆæ”¾ç€ä¸ç”¨ï¼Œåé¢ç”¨äº FFN ä»¥åçš„ æ®‹å·®è¿æ¥ã€‚</p>
<p>é‚£å…·ä½“è¿™é‡Œçš„ FFN æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿ</p>
<p>çœ‹åˆ°ä»£ç </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320215804289.png"><img alt="image-20250320215804289" src="../images/image-20250320215804289.png"></a></p>
<p>ä¸çœ‹dropout å’Œæ¿€æ´»å±‚ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªæ“ä½œå¹¶ä¸ä¼šæ”¹å˜è¾“å…¥å¼ é‡çš„å½¢çŠ¶ï¼Œæ¥ä¸‹æ¥çœ‹åˆ°FFN æ˜¯ç”±ä¸¤ä¸ª 1d å·ç§¯ä¹Ÿå°±æ˜¯conv1d å®ç°çš„ã€‚</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320215914272.png"><img alt="image-20250320215914272" src="../images/image-20250320215914272.png"></a></p>
<p>æ¥ä¸‹æ¥ï¼Œå†çœ‹ Encoder çš„ init éƒ¨åˆ†ï¼Œè¿™ä¸¤ä¸ª 1d å·ç§¯æ˜¯æ€ä¹ˆå®šä¹‰çš„ï¼Œè¯¶ï¼Œå°±æ˜¯ä¸€ä¸ªå…ˆå‡ç»´åé™ç»´çš„æ“ä½œï¼Œå°±å®Œæˆäº† FFNã€‚</p>
<p>å°±æ˜¯è¯´ self.conv1æ˜¯å°†å•ä¸ªæ—¶é—´æ­¥åµŒå…¥ç»´åº¦ <code>d_model</code>å‡ç»´åˆ° <code>d_ff</code>ï¼›æ¥ä¸‹æ¥ self.conv2å°±æ˜¯å°† <code>d_ff</code> åˆæ¢å¤æˆåŸå§‹å½¢çŠ¶ <code>d_model</code>ã€‚å¤šè¯´ä¸€å¥ï¼Œå¥½åƒæ²¡æ„ä¹‰ï¼Œå…¶å®æœ‰æ„ä¹‰ï¼Œç¬¬äºŒæ¬¡æ¢å¤çš„ <code>d_model</code> å…¶å®æ˜¯ç²¾ç»†åŒ–çš„å­¦ä¹ äº† ç‰¹å¾ä¸ç‰¹å¾ä¹‹é—´çš„ç›¸å…³å…³ç³»ï¼Œå¹¶è¿”å›ç»™äº† <code>d_model</code> ä¸­è¿›è¡Œä¿å­˜ã€‚</p>
<p>çœ‹åˆ°ä»£ç ï¼š</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320220835532.png"><img alt="image-20250320220835532" src="../images/image-20250320220835532.png"></a></p>
<p>å…³äºè¿™é‡Œï¼Œæˆ‘æœ‰ä»¥ä¸‹å‡ ç‚¹æƒ³è¯´ï¼š</p>
<p>ç¬¬ä¸€ç‚¹ï¼Œå‡ç»´çš„æ“ä½œï¼Œç»è¿‡ conv1d ä»¥åï¼Œç›¸å½“äºè¿›è¡Œäº†å…¨è¿æ¥ï¼Œä¹Ÿå°±æ˜¯ç›¸å½“äºnn.Linearçš„ä½œç”¨ï¼Œé‚£å†™è¿‡ä»£ç çš„éƒ½æ˜¯åˆ°ï¼Œnn.Linearä»¥åè¿›è¡Œæ¿€æ´»ï¼Œç›®çš„æ˜¯ä¸ºäº†å¢åŠ æ¨¡å‹çš„éçº¿æ€§è¡¨è¾¾èƒ½åŠ›ï¼Œè¿™ç‚¹ææ²çš„ä¹¦ä¸Šä¹Ÿæåˆ°è¿‡ã€‚è¿™é‡Œå°±ä»¿ç…§ç€ conv1d çš„è¾“å‡ºä¹ŸåŠ ä¸Šäº†æ¿€æ´»å‡½æ•°ã€‚åŠ çš„æ‰€æœ‰ dropout éƒ½æ˜¯ä¸ºäº†é˜²æ­¢è¿‡æ‹Ÿåˆï¼Œéšæœºå¤±æ´»ä¸€äº›èŠ‚ç‚¹ã€‚</p>
<blockquote>
<p>æ ‡å‡†å‰é¦ˆç¥ç»ç½‘ç»œçš„è®¾è®¡æ¨¡å¼ï¼šçº¿æ€§å˜æ¢â†’éçº¿æ€§æ¿€æ´»â†’çº¿æ€§å˜æ¢ï¼›</p>
<p>åœ¨TransformeråŸå§‹è®¾è®¡ä¸­ï¼ŒFFNéƒ¨åˆ†è¡¨ç¤ºä¸ºï¼š</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1"></a><a href="#__codelineno-41-1"><span class="linenos" data-linenos="1 "></span></a>FFN(x) = max(0, xWâ‚ + bâ‚)Wâ‚‚ + bâ‚‚
</span></code></pre></div>
<p>ReLU æ¿€æ´»å‡½æ•°å’Œä¸¤ä¸ª nn.Linear</p>
</blockquote>
<p>ç¬¬äºŒç‚¹ï¼Œå‰é¢å·²ç»è¯´è¿‡ï¼Œ1d å·ç§¯å‡ç»´é™ç»´æŒ‡çš„æ˜¯é€šé“ç»´åº¦ï¼Œä¹Ÿå°±æ˜¯ dim=1ï¼Œæ‰€ä»¥è¿™é‡Œè¿›è¡Œ 1d å·ç§¯ä¹‹å‰ä¹Ÿæ˜¯è¿›è¡Œäº† transposeã€‚</p>
<p><del>ç¬¬ä¸‰ç‚¹ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œæ˜¯ conv1dï¼Œè€Œä¸æ˜¯ nn.Linearï¼Œå› ä¸ºæ—¶é—´åºåˆ—è¦ä¿æŒæ—¶é—´æ­¥çš„å‰åå…³ç³»ï¼Œæ‰€ä»¥ç”¨ conv1dï¼Œç±»ä¼¼æ»‘åŠ¨çª—å£ï¼Œæ²¿ç€æ—¶é—´æ­¥çš„å‰åé¡ºåºé€æ­¥æ»‘åŠ¨ï¼Œæ¯æ¬¡ç§»åŠ¨ stride ä¸ªæ­¥é•¿ã€‚</del> ï¼ˆæˆ‘ç†è§£çš„ä¸å¯¹ï¼‰åŠŸèƒ½ä¸Šå°±æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯æ•°æ®çš„ç»„ç»‡å½¢å¼ä¸åŒï¼Œä¸ç”¨åˆ»æ„çš„åŒºåˆ†ã€‚</p>
<p>ç¬¬å››ç‚¹ï¼Œè¿™é‡Œçš„ d_ff å‰é¦ˆç¥ç»ç½‘ç»œçš„åµŒå…¥æ˜¯ 2048ã€‚</p>
<blockquote>
<p>d_ffé€šå¸¸è®¾ç½®ä¸ºd_modelçš„4å€ï¼Œå¯¹äºd_model=512çš„æƒ…å†µï¼Œd_ffå°±æ˜¯2048ã€‚è¿™ä¹Ÿæ˜¯TransformeråŸå§‹è®ºæ–‡ä¸­çš„è®¾ç½®ã€‚å¢å¤§ä¸­é—´å±‚ç»´åº¦å¯ä»¥æé«˜æ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›ã€‚</p>
</blockquote>
<p>ç¬¬äº”ç‚¹ï¼Œself.conv2dçš„è¾“å‡ºï¼Œåœ¨è¿›è¡Œå½¢çŠ¶å˜æ¢<code>transpose</code>çš„ç›®çš„æ˜¯ä¸ºäº†æ¢å¤æˆæ—¶é—´åºåˆ—çš„æ ‡å‡†æ•°æ®æ ¼å¼ã€‚</p>
<blockquote>
<p>å°†æ•°æ®æ ¼å¼ä»å·ç§¯å‹å¥½çš„<code>[B, C, L]</code>è½¬å›åˆ°Transformeræ¶æ„é€šç”¨çš„<code>[B, L, D]</code>æ ¼å¼</p>
</blockquote>
<p>å†æ¬¡ç›´è§‚åœ°è¯´æ˜è¿™ä¸€éƒ¨åˆ†å°±æ˜¯è¿™æ ·çš„ï¼š</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1"></a><a href="#__codelineno-42-1"><span class="linenos" data-linenos=" 1 "></span></a># ç¬¬ä¸€æ­¥ï¼šè½¬ç½®ä½¿ç‰¹å¾ç»´åº¦æˆä¸ºé€šé“ç»´åº¦
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2"></a><a href="#__codelineno-42-2"><span class="linenos" data-linenos=" 2 "></span></a>y.transpose(-1, 1)  # [B, L, d_model] -&gt; [B, d_model, L]
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3"></a><a href="#__codelineno-42-3"><span class="linenos" data-linenos=" 3 "></span></a>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4"></a><a href="#__codelineno-42-4"><span class="linenos" data-linenos=" 4 "></span></a># ç¬¬äºŒæ­¥ï¼šåº”ç”¨ç¬¬ä¸€ä¸ªå·ç§¯æ‰©å±•é€šé“ç»´åº¦
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5"></a><a href="#__codelineno-42-5"><span class="linenos" data-linenos=" 5 "></span></a>self.conv1(...)  # [B, d_model, L] -&gt; [B, d_ff, L]
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6"></a><a href="#__codelineno-42-6"><span class="linenos" data-linenos=" 6 "></span></a>
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7"></a><a href="#__codelineno-42-7"><span class="linenos" data-linenos=" 7 "></span></a># ç¬¬ä¸‰æ­¥ï¼šåº”ç”¨ç¬¬äºŒä¸ªå·ç§¯æ¢å¤åŸå§‹é€šé“ç»´åº¦
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8"></a><a href="#__codelineno-42-8"><span class="linenos" data-linenos=" 8 "></span></a>self.conv2(...)  # [B, d_ff, L] -&gt; [B, d_model, L]
</span><span id="__span-42-9"><a id="__codelineno-42-9" name="__codelineno-42-9"></a><a href="#__codelineno-42-9"><span class="linenos" data-linenos=" 9 "></span></a>
</span><span id="__span-42-10"><a id="__codelineno-42-10" name="__codelineno-42-10"></a><a href="#__codelineno-42-10"><span class="linenos" data-linenos="10 "></span></a># ç¬¬å››æ­¥ï¼šè½¬ç½®å›åŸå§‹åºåˆ—æ ¼å¼
</span><span id="__span-42-11"><a id="__codelineno-42-11" name="__codelineno-42-11"></a><a href="#__codelineno-42-11"><span class="linenos" data-linenos="11 "></span></a>(...).transpose(-1, 1)  # [B, d_model, L] -&gt; [B, L, d_model]
</span></code></pre></div>
<p><strong>åè®°ï¼š</strong> </p>
<blockquote>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></label> <span id="ä¸ºä»€ä¹ˆConv2ä¹‹åæ²¡æœ‰è¿›è¡Œæ¿€æ´»å‡½æ•°çš„åº”ç”¨">äº§ç”Ÿçš„ç–‘é—®</span>ï¼š<a href="#é™„å½•">ä¸ºä»€ä¹ˆConv2ä¹‹åæ²¡æœ‰è¿›è¡Œæ¿€æ´»å‡½æ•°çš„åº”ç”¨</a> </li>
</ul>
<p>ç›´è§‚çš„ç†è§£æˆ‘çš„ç–‘é—®ï¼š</p>
<p><strong>ç°æœ‰è®¾è®¡ (ç¬¬äºŒå±‚æ— æ¿€æ´»)ï¼š</strong></p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1"></a><a href="#__codelineno-43-1"><span class="linenos" data-linenos="1 "></span></a>y = Conv1 -&gt; ReLU -&gt; Dropout -&gt; Conv2 -&gt; Dropout
</span></code></pre></div>
<p><strong>æ›¿ä»£è®¾è®¡ (ä¸¤å±‚éƒ½æœ‰æ¿€æ´»)</strong> </p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1"></a><a href="#__codelineno-44-1"><span class="linenos" data-linenos="1 "></span></a>y = Conv1 -&gt; ReLU -&gt; Dropout -&gt; Conv2 -&gt; ReLU -&gt; Dropout
</span></code></pre></div>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></label> ä¸ºä»€ä¹ˆæ˜¯ conv1dï¼Œè€Œä¸æ˜¯ nn.Linear</li>
</ul>
<p>æ²¡å•¥å¿…è¦äº†ï¼Œä¸»è¦æ˜¯åœ¨æ•°æ®ç»„ç»‡å’Œè®¡ç®—æ•ˆç‡æ–¹é¢æœ‰å·®å¼‚ï¼ŒAutoformeré€‰æ‹©Conv1Dè€ŒéLinearï¼Œæ˜¯åŸºäºæ¶æ„ä¸€è‡´æ€§ã€è®¡ç®—æ•ˆç‡å’Œæœªæ¥æ‰©å±•æ€§ï¼ˆè®¾ç½® kernel size ä»¥åå¯ä»¥æ•æ‰æ—¶é—´æ­¥ä¹‹é—´çš„å±€éƒ¨ç›¸å…³æ€§ï¼‰çš„è€ƒè™‘ï¼ŒåŠŸèƒ½ä¸Šæ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></label> æ‰“å°äº†å•ä¸ª EncoderLayerçš„æ¨¡å‹å‚æ•°</li>
</ul>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321163630773.png"><img alt="image-20250321163630773" src="../images/image-20250321163630773.png"></a> </p>
</blockquote>
<p>æœ€åè¿˜æœ‰ä¸€å¥ï¼Œå°†åŸå§‹ç‰¹å¾xä¸å˜æ¢åçš„ç‰¹å¾yç›¸åŠ ï¼Œå†æ¬¡åº”ç”¨åºåˆ—åˆ†è§£æå–å­£èŠ‚æ€§éƒ¨åˆ†</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1"></a><a href="#__codelineno-45-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># å°†åŸå§‹ç‰¹å¾xä¸å˜æ¢åçš„ç‰¹å¾yç›¸åŠ ï¼Œå†æ¬¡åº”ç”¨åºåˆ—åˆ†è§£æå–å­£èŠ‚æ€§éƒ¨åˆ†</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2"></a><a href="#__codelineno-45-2"><span class="linenos" data-linenos="2 "></span></a><span class="c1"># (x + y)[B, L, d_model] -&gt; åºåˆ—åˆ†è§£ -&gt; è¾“å‡ºres[B, L, d_model]å’Œæœªä½¿ç”¨çš„è¶‹åŠ¿åˆ†é‡_[B, L, d_model]</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3"></a><a href="#__codelineno-45-3"><span class="linenos" data-linenos="3 "></span></a><span class="n">res</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decomp2</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>
</span></code></pre></div>
<p><strong>åˆ°äº†è¿™ä¸€æ­¥ï¼Œå…¶å®ä»£ç è¯¥è®²çš„ä¹Ÿè®²å®Œäº†ï¼Œæ›´é‡è¦çš„åœ¨äºå¼€å§‹æ€è€ƒï¼Œä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ</strong></p>
<ul>
<li>ç²˜è´´è‡ª gpt çš„ç­”æ¡ˆè´´åœ¨é™„å½•ä¸­äº†ï¼Œè§£é‡Šå¾—æŒºå¥½çš„ï¼Œè¿˜æœ‰å’Œä¼ ç»Ÿ Transformer çš„å¯¹æ¯”</li>
<li>ï¼ˆæˆ‘ç†è§£çš„éƒ¨åˆ†è‡ªå·±å¤è¿°ï¼‰ä½¿å¾—ç¼–ç å™¨åœ¨é€å±‚ç¼–ç çš„è¿‡ç¨‹ä¸­ï¼Œæ›´å…³æ³¨é«˜é¢‘çš„å­£èŠ‚æˆåˆ†ï¼Œæ‰€ä»¥æ¯æ¬¡ä¼ è¿›ç¼–ç å™¨çš„æ˜¯ï¼ŒæŠ›å¼ƒäº†è¶‹åŠ¿æˆåˆ†çš„å­£èŠ‚æˆåˆ†ã€‚</li>
</ul>
<p>ç¼–ç å™¨ä¸­å…³äºå­£èŠ‚æˆåˆ†ã€è¶‹åŠ¿æˆåˆ†çš„ç†è§£ï¼š</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1"></a><a href="#__codelineno-46-1"><span class="linenos" data-linenos=" 1 "></span></a>è¾“å…¥ x [B,L,D] (æ··åˆå­£èŠ‚æ€§å’Œè¶‹åŠ¿)
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2"></a><a href="#__codelineno-46-2"><span class="linenos" data-linenos=" 2 "></span></a>  â†“
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3"></a><a href="#__codelineno-46-3"><span class="linenos" data-linenos=" 3 "></span></a>è‡ªæ³¨æ„åŠ›å¤„ç†
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4"></a><a href="#__codelineno-46-4"><span class="linenos" data-linenos=" 4 "></span></a>  â†“
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5"></a><a href="#__codelineno-46-5"><span class="linenos" data-linenos=" 5 "></span></a>æ®‹å·®è¿æ¥ x + dropout(new_x) (ä»å«æ··åˆæˆåˆ†)
</span><span id="__span-46-6"><a id="__codelineno-46-6" name="__codelineno-46-6"></a><a href="#__codelineno-46-6"><span class="linenos" data-linenos=" 6 "></span></a>  â†“
</span><span id="__span-46-7"><a id="__codelineno-46-7" name="__codelineno-46-7"></a><a href="#__codelineno-46-7"><span class="linenos" data-linenos=" 7 "></span></a>åºåˆ—åˆ†è§£1 
</span><span id="__span-46-8"><a id="__codelineno-46-8" name="__codelineno-46-8"></a><a href="#__codelineno-46-8"><span class="linenos" data-linenos=" 8 "></span></a>  â†“          â†˜
</span><span id="__span-46-9"><a id="__codelineno-46-9" name="__codelineno-46-9"></a><a href="#__codelineno-46-9"><span class="linenos" data-linenos=" 9 "></span></a>å­£èŠ‚æ€§åˆ†é‡x    è¶‹åŠ¿åˆ†é‡ (ä¸¢å¼ƒ)
</span><span id="__span-46-10"><a id="__codelineno-46-10" name="__codelineno-46-10"></a><a href="#__codelineno-46-10"><span class="linenos" data-linenos="10 "></span></a>  â†“
</span><span id="__span-46-11"><a id="__codelineno-46-11" name="__codelineno-46-11"></a><a href="#__codelineno-46-11"><span class="linenos" data-linenos="11 "></span></a>å‰é¦ˆç½‘ç»œå¤„ç† (Conv1D â†’ ReLU â†’ Conv1D)
</span><span id="__span-46-12"><a id="__codelineno-46-12" name="__codelineno-46-12"></a><a href="#__codelineno-46-12"><span class="linenos" data-linenos="12 "></span></a>  â†“
</span><span id="__span-46-13"><a id="__codelineno-46-13" name="__codelineno-46-13"></a><a href="#__codelineno-46-13"><span class="linenos" data-linenos="13 "></span></a>å‰é¦ˆè¾“å‡º y (å­£èŠ‚æ€§ç‰¹å¾)
</span><span id="__span-46-14"><a id="__codelineno-46-14" name="__codelineno-46-14"></a><a href="#__codelineno-46-14"><span class="linenos" data-linenos="14 "></span></a>  â†“
</span><span id="__span-46-15"><a id="__codelineno-46-15" name="__codelineno-46-15"></a><a href="#__codelineno-46-15"><span class="linenos" data-linenos="15 "></span></a>å­£èŠ‚æ€§åˆ†é‡x + å‰é¦ˆè¾“å‡ºy (æ··åˆå­£èŠ‚æ€§)
</span><span id="__span-46-16"><a id="__codelineno-46-16" name="__codelineno-46-16"></a><a href="#__codelineno-46-16"><span class="linenos" data-linenos="16 "></span></a>  â†“
</span><span id="__span-46-17"><a id="__codelineno-46-17" name="__codelineno-46-17"></a><a href="#__codelineno-46-17"><span class="linenos" data-linenos="17 "></span></a>åºåˆ—åˆ†è§£2
</span><span id="__span-46-18"><a id="__codelineno-46-18" name="__codelineno-46-18"></a><a href="#__codelineno-46-18"><span class="linenos" data-linenos="18 "></span></a>  â†“          â†˜
</span><span id="__span-46-19"><a id="__codelineno-46-19" name="__codelineno-46-19"></a><a href="#__codelineno-46-19"><span class="linenos" data-linenos="19 "></span></a>å­£èŠ‚æ€§åˆ†é‡res  è¶‹åŠ¿åˆ†é‡ (ä¸¢å¼ƒ)
</span><span id="__span-46-20"><a id="__codelineno-46-20" name="__codelineno-46-20"></a><a href="#__codelineno-46-20"><span class="linenos" data-linenos="20 "></span></a>  â†“
</span><span id="__span-46-21"><a id="__codelineno-46-21" name="__codelineno-46-21"></a><a href="#__codelineno-46-21"><span class="linenos" data-linenos="21 "></span></a>è¾“å‡ºåˆ°ä¸‹ä¸€å±‚ res (çº¯å­£èŠ‚æ€§)
</span></code></pre></div>
<p>æœ€åè®°ä¸‹ä¸¤å¥è¯æŠŠï¼š</p>
<ul>
<li>é¢‘ç‡åŸŸåˆ†æï¼šä»é¢‘ç‡è§’åº¦çœ‹ï¼Œè¶‹åŠ¿å¯¹åº”ä½é¢‘æˆåˆ†ï¼Œå­£èŠ‚æ€§å¯¹åº”é«˜é¢‘æˆåˆ†ï¼Œåˆ†å¼€å¤„ç†æœ‰åŠ©äºæå–å„è‡ªçš„ç‰¹ç‚¹ã€‚</li>
<li>ç¼–ç å™¨ï¼šä¸“æ³¨äºæ•è·å‘¨æœŸæ€§å’Œå­£èŠ‚æ€§æ¨¡å¼ï¼ˆé«˜é¢‘æˆåˆ†ï¼‰</li>
<li>è™½ç„¶åœ¨ç¼–ç å™¨å±‚å†…éƒ¨ä¸¢å¼ƒäº†è¶‹åŠ¿ä¿¡æ¯ï¼Œä½†Autoformerå¹¶æ²¡æœ‰å®Œå…¨å¿½ç•¥è¶‹åŠ¿ã€‚</li>
<li>é€šè¿‡åœ¨æ¯ä¸€å±‚éƒ½ä¸¢å¼ƒè¶‹åŠ¿æˆåˆ†ï¼Œæ¨¡å‹èƒ½å¤Ÿåœ¨å¤šå±‚å †å è¿‡ç¨‹ä¸­æŒç»­å…³æ³¨å­£èŠ‚æ€§å˜åŒ–ï¼Œè€Œä¸è¢«è¶‹åŠ¿å˜åŒ–å¹²æ‰°ã€‚</li>
<li>è§£ç å™¨ä¸­å•ç‹¬ç´¯ç§¯è¶‹åŠ¿ï¼Œé¿å…è¶‹åŠ¿é¢„æµ‹å¯¹å­£èŠ‚æ€§é¢„æµ‹çš„å¹²æ‰°</li>
<li>æ¸è¿›å¼åˆ†è§£æ¶æ„</li>
<li>æ¯å±‚éƒ½åº”ç”¨åºåˆ—åˆ†è§£ï¼Œé€æ­¥æç‚¼å­£èŠ‚æ€§ç‰¹å¾ï¼Œå¤šå±‚å †å å¯ä»¥æ•è·ä¸åŒå°ºåº¦çš„å­£èŠ‚æ€§æ¨¡å¼</li>
</ul>
<p>è¡Œäº†ï¼Œä¸Šé¢å…³äºç¼–ç å™¨çš„éƒ¨åˆ†è®²çš„å·®ä¸å¤šäº†</p>
<p><strong>å…¬å¼</strong> </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321103256921.png"><img alt="image-20250321103256921" src="../images/image-20250321103256921.png"></a></p>
<p>æœ€å¼€å§‹ä¸Šæ ‡çš„ 1 å’Œ 2 ä¸æ˜ç™½ï¼Œç°åœ¨ä¹Ÿæ˜ç™½äº†ï¼Œå¯ä»¥ç†è§£ä¸º 1 æ˜¯è‡ªæ³¨æ„åŠ›æœºåˆ¶çš„è¾“å‡ºï¼Œåªä¿ç•™çš„å­£èŠ‚æˆåˆ†ï¼›2 æ˜¯ç»è¿‡å‰é¦ˆç½‘çš„è¾“å‡ºï¼Œåªä¿ç•™äº†å­£èŠ‚æˆåˆ†ã€‚</p>
<p>è¿™äº›è‡ªæ³¨æ„åŠ›æœºåˆ¶ å’Œ å‰é¦ˆç½‘ åé¢éƒ½æœ‰æ®‹å·®è¿æ¥ã€‚è¿™ä¸­é—´è¿˜æœ‰ dropoutã€æ¿€æ´»ç­‰ã€‚</p>
<p><strong>ä»£ç </strong></p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1"></a><a href="#__codelineno-47-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">attn_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2"></a><a href="#__codelineno-47-2"><span class="linenos" data-linenos=" 2 "></span></a>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3"></a><a href="#__codelineno-47-3"><span class="linenos" data-linenos=" 3 "></span></a>    <span class="n">new_x</span><span class="p">,</span> <span class="n">attn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attention</span><span class="p">(</span>
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4"></a><a href="#__codelineno-47-4"><span class="linenos" data-linenos=" 4 "></span></a>        <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span>
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5"></a><a href="#__codelineno-47-5"><span class="linenos" data-linenos=" 5 "></span></a>        <span class="n">attn_mask</span><span class="o">=</span><span class="n">attn_mask</span>
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6"></a><a href="#__codelineno-47-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="p">)</span>
</span><span id="__span-47-7"><a id="__codelineno-47-7" name="__codelineno-47-7"></a><a href="#__codelineno-47-7"><span class="linenos" data-linenos=" 7 "></span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="n">new_x</span><span class="p">)</span>
</span><span id="__span-47-8"><a id="__codelineno-47-8" name="__codelineno-47-8"></a><a href="#__codelineno-47-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="n">x</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decomp1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-47-9"><a id="__codelineno-47-9" name="__codelineno-47-9"></a><a href="#__codelineno-47-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">x</span>
</span><span id="__span-47-10"><a id="__codelineno-47-10" name="__codelineno-47-10"></a><a href="#__codelineno-47-10"><span class="linenos" data-linenos="10 "></span></a>
</span><span id="__span-47-11"><a id="__codelineno-47-11" name="__codelineno-47-11"></a><a href="#__codelineno-47-11"><span class="linenos" data-linenos="11 "></span></a>
</span><span id="__span-47-12"><a id="__codelineno-47-12" name="__codelineno-47-12"></a><a href="#__codelineno-47-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">activation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conv1</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))))</span>
</span><span id="__span-47-13"><a id="__codelineno-47-13" name="__codelineno-47-13"></a><a href="#__codelineno-47-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conv2</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="__span-47-14"><a id="__codelineno-47-14" name="__codelineno-47-14"></a><a href="#__codelineno-47-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="n">res</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decomp2</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>
</span><span id="__span-47-15"><a id="__codelineno-47-15" name="__codelineno-47-15"></a><a href="#__codelineno-47-15"><span class="linenos" data-linenos="15 "></span></a>
</span><span id="__span-47-16"><a id="__codelineno-47-16" name="__codelineno-47-16"></a><a href="#__codelineno-47-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="k">return</span> <span class="n">res</span><span class="p">,</span> <span class="n">attn</span>
</span></code></pre></div>
<p>å†æ¥çœ‹ä¸€çœ¼**æ–‡ä¸­æ¨¡å‹ç»“æ„å›¾**ï¼š</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321103610423.png"><img alt="image-20250321103610423" src="../images/image-20250321103610423.png"></a> </p>
<p>å¯ä»¥çœ‹åˆ° éƒ½æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚</p>
<p>å¯¹ï¼Œè¿˜æœ‰ä¸€ä¸ªï¼ŒåŸæ–‡å †å  Encoder çš„å±‚æ•°=2ã€‚</p>
<hr>
<h3 id="decoder">Decoder<a class="headerlink" href="#decoder" title="Permanent link">Â¶</a></h3>
<p><strong>ä¸‹é¢è¿›å…¥è§£ç å™¨éƒ¨åˆ†ï¼Œç¦ç”¨æ‰€æœ‰æ–­ç‚¹ï¼Œåªä¿ç•™è°ƒç”¨è§£ç çš„éƒ¨åˆ†ï¼š</strong> </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321104519139.png"><img alt="image-20250321104519139" src="../images/image-20250321104519139.png"></a></p>
<p>å¯åŠ¨å‘½ä»¤ï¼š</p>
<div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1"></a><a href="#__codelineno-48-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="o">(</span>base<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>conda<span class="w"> </span>env<span class="w"> </span>list
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2"></a><a href="#__codelineno-48-2"><span class="linenos" data-linenos=" 2 "></span></a>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3"></a><a href="#__codelineno-48-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="c1"># conda environments:</span>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4"></a><a href="#__codelineno-48-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="c1">#</span>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5"></a><a href="#__codelineno-48-5"><span class="linenos" data-linenos=" 5 "></span></a>base<span class="w">                 </span>*<span class="w"> </span>/home/student2023/xiehr2023/miniconda3
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6"></a><a href="#__codelineno-48-6"><span class="linenos" data-linenos=" 6 "></span></a>Autoformer<span class="w">             </span>/home/student2023/xiehr2023/miniconda3/envs/Autoformer
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7"></a><a href="#__codelineno-48-7"><span class="linenos" data-linenos=" 7 "></span></a>SegRNN<span class="w">                 </span>/home/student2023/xiehr2023/miniconda3/envs/SegRNN
</span><span id="__span-48-8"><a id="__codelineno-48-8" name="__codelineno-48-8"></a><a href="#__codelineno-48-8"><span class="linenos" data-linenos=" 8 "></span></a>timesNet<span class="w">               </span>/home/student2023/xiehr2023/miniconda3/envs/timesNet
</span><span id="__span-48-9"><a id="__codelineno-48-9" name="__codelineno-48-9"></a><a href="#__codelineno-48-9"><span class="linenos" data-linenos=" 9 "></span></a>
</span><span id="__span-48-10"><a id="__codelineno-48-10" name="__codelineno-48-10"></a><a href="#__codelineno-48-10"><span class="linenos" data-linenos="10 "></span></a><span class="o">(</span>base<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>conda<span class="w"> </span>activate<span class="w"> </span>Autoformer
</span><span id="__span-48-11"><a id="__codelineno-48-11" name="__codelineno-48-11"></a><a href="#__codelineno-48-11"><span class="linenos" data-linenos="11 "></span></a><span class="o">(</span>Autoformer<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>sh<span class="w"> </span>scripts/ILI_script/Autoformer.sh
</span></code></pre></div>
<p>åœ¨æ­¥è¿›ä»£ç ä¹‹å‰ï¼Œå…ˆçœ‹mermaid ç”»çš„ç±»å›¾ï¼Œçœ‹æ¸…è§£ç å™¨çš„è°ƒç”¨æµç¨‹ï¼š  </p>
<h4 id="_11">ç±»å›¾<a class="headerlink" href="#_11" title="Permanent link">Â¶</a></h4>
<pre class="mermaid"><code>
classDiagram
    class Model {
        +int seq_len
        +int label_len
        +int pred_len
        +bool output_attention
        +series_decomp decomp
        +DataEmbedding_wo_pos enc_embedding
        +DataEmbedding_wo_pos dec_embedding
        +Encoder encoder
        +Decoder decoder
        +forward(x_enc, x_mark_enc, x_dec, x_mark_dec, enc_self_mask, dec_self_mask, dec_enc_mask)
    }

    class series_decomp {
        +moving_avg moving_avg
        +forward(x) res, moving_mean
    }
    class moving_avg {
        +int kernel_size
        +AvgPool1d avg
        +forward(x)
    }

    class DataEmbedding_wo_pos {
        +TokenEmbedding value_embedding
        +PositionalEmbedding position_embedding
        +TemporalEmbedding temporal_embedding
        +Dropout dropout
        +forward(x, x_mark)
    }

    class Encoder {
        +List~EncoderLayer~ layers
        +my_Layernorm norm_layer
        +forward(x, attn_mask)
    }

    class EncoderLayer {
        +AutoCorrelationLayer attention
        +Conv1d conv1
        +Conv1d conv2
        +series_decomp decomp1
        +series_decomp decomp2
        +Dropout dropout
        +activation
        +forward(x, attn_mask)
    }

    class AutoCorrelationLayer {
        +AutoCorrelation attention
        +Linear query_projection
        +Linear key_projection
        +Linear value_projection
        +Linear out_projection
        +forward(queries, keys, values, attn_mask)
    }

    class AutoCorrelation {
        +bool mask_flag
        +int factor
        +float scale
        +Dropout dropout
        +bool output_attention
        +time_delay_agg_training(values, corr)
        +time_delay_agg_inference(values, corr)
        +forward(queries, keys, values, attn_mask)
    }

    class Decoder {
        +List~DecoderLayer~ layers
        +my_Layernorm norm_layer
        +Linear projection
        +forward(x, enc_out, x_mask, cross_mask, trend)
    }

    class DecoderLayer {
        +AutoCorrelationLayer self_attention
        +AutoCorrelationLayer cross_attention
        +Conv1d conv1
        +Conv1d conv2
        +series_decomp decomp1
        +series_decomp decomp2
        +series_decomp decomp3
        +Dropout dropout
        +activation
        +forward(x, enc_out, x_mask, cross_mask, trend)
    }

    Model --&gt; series_decomp
    Model --&gt; DataEmbedding_wo_pos
    Model --&gt; Encoder
    Model --&gt; Decoder
    Encoder --&gt; EncoderLayer
    EncoderLayer --&gt; AutoCorrelationLayer
    EncoderLayer --&gt; Conv1d
    EncoderLayer --&gt; series_decomp
    AutoCorrelationLayer --&gt; AutoCorrelation
    Decoder --&gt; DecoderLayer
    DecoderLayer --&gt; AutoCorrelationLayer
    DecoderLayer --&gt; Conv1d
    DecoderLayer --&gt; series_decomp   
    series_decomp --&gt; moving_avg
    moving_avg --&gt; AvgPool1d
</code></pre>
<p>ä¸‹é¢å¼€å§‹è®²å›¾ã€‚</p>
<p><strong>Mode init</strong> </p>
<p>é¦–å…ˆï¼Œä»ç¬¬ä¸€æ¡†å¼€å§‹ï¼Œmodel å°±æ˜¯æŒ‡çš„ Autoformerï¼Œé¦–å…ˆ Autoformer çš„ init éƒ¨åˆ†æœ‰ è¾“å…¥åºåˆ—é•¿åº¦ï¼Œsequence lengthï¼›æ ‡ç­¾åºåˆ—çš„é•¿åº¦ label lengthï¼Œæ ‡ç­¾åºåˆ—ç”¨äºæŒ‡å¯¼é¢„æµ‹ï¼Œæœ¬æ–‡æˆªå–è¾“å…¥åºåˆ—é•¿åº¦çš„ä¸€åŠï¼›é¢„æµ‹åºåˆ—é•¿åº¦ predict lengthï¼Œå› ä¸ºæœ¬æ–‡è®¾ç½®çš„æ ‡ç­¾åºåˆ—ï¼Œæ‰€ä»¥è§£ç å™¨å®é™…çš„è¾“å‡ºæ—¶é—´æ­¥æ˜¯ label length+predict lengthï¼Œæ‰€ä»¥é¢„æµ‹çš„éƒ¨åˆ†ï¼Œè¿˜è¦æŠŠ label length æˆªæ‰ã€‚attention æš‚æ—¶ä¸çœ‹ï¼Œæˆ‘ä¹Ÿä¸æ˜ç™½æœ‰å•¥ç”¨ï¼Œå¤§æ¦‚å°±æ˜¯ä¸€ä¸ªåˆå§‹åŒ–å§ã€‚</p>
<p>ç„¶åå°±æ˜¯åºåˆ—åˆ†è§£å‡½æ•°ï¼Œåˆ†è§£å­£èŠ‚æˆåˆ†å’Œè¶‹åŠ¿æˆåˆ†ã€‚è¶‹åŠ¿æˆåˆ†æ˜¯ä½é¢‘æˆåˆ†ï¼Œè¡¨ç¤ºæ—¶é—´åºåˆ—é•¿æœŸç¨³å®šçš„è¶‹åŠ¿ï¼Œç”¨çš„æ˜¯ç§»åŠ¨å¹³å‡ï¼Œåœ¨ä»£ç å®ç°ä¸­ï¼Œå…·ä½“ç”¨çš„æ˜¯ 1D å¹³å‡æ± åŒ–ã€‚å­£èŠ‚æˆåˆ†æ˜¯é«˜é¢‘æˆåˆ†ï¼Œè¡¨ç¤ºå‘¨æœŸæ€§ä¿¡æ¯ï¼Œåˆ†è§£ä¸­çš„åšæ³•æ˜¯ åŸå§‹åºåˆ—å‡å»å­£èŠ‚æˆåˆ†ã€‚res = åŸå§‹åºåˆ— <code>x</code> - è¶‹åŠ¿æˆåˆ† <code>move_average</code></p>
<p>ä¸‹é¢æ˜¯ä¸¤ä¸ªåµŒå…¥å±‚ï¼Œç›®çš„æ˜¯è¿›è¡Œ token Embedding å’Œ temporal Embeddingï¼Œå°†åŸå§‹æ—¶é—´æ­¥ç‰¹å¾åµŒå…¥åˆ°æŒ‡å®šç»´åº¦ï¼Œæ›´ç²¾ç»†çš„è¡¨ç¤ºç‰¹å¾ã€‚ä¸¾ä¸ªä¾‹å­ï¼šæ—¶é—´æ­¥ç‰¹å¾[32,36,7] â†’ [32,36,512]   [32,42,7] â†’[32,42,512] ï¼›ï¼ˆæ—¶é—´æ­¥ï¼‰æ—¶é—´ç‰¹å¾[32,36,4] â†’ [32,36,512]   [32,42,4] â†’[32,42,512] </p>
<p>æ¥ä¸‹æ¥å°±æ˜¯ Encoder å’Œ Decoderï¼Œå…¶ä¸­ Encoder ä¼šå †å  EncoderLayerï¼ŒDecoder å †å  DecoderLayerï¼Œ</p>
<p>å…¶ä¸­ EncoderLayer å †å äº† 2 å±‚ï¼Œç»“åˆå›¾å’Œä»£ç ï¼Œçœ‹å•å±‚ EncoderLayer å’Œ DecoderLayer çš„ ç›¸åŒä¸ä¸åŒã€‚</p>
<p>ï¼ˆ1ï¼‰Decoder æ¯” Encoder å¤šäº†ä¸€ä¸ªçº¿æ€§å±‚ <code>nn.Linear</code> ï¼ˆéµå¾ªäº†æ ‡å‡† Transformer æ¶æ„ï¼‰</p>
<p>ï¼ˆ2ï¼‰DecoderLayer è°ƒç”¨äº†ä¸¤æ¬¡ è‡ªç›¸å…³å±‚ï¼Œè¿™æ˜¯å› ä¸º Decoder ä¸­è¿›è¡Œä¸¤ç§æ³¨æ„åŠ›æœºåˆ¶çš„è¿ç®—ï¼Œè‡ªæ³¨æ„åŠ›æœºåˆ¶å’Œäº¤å‰æ³¨æ„æœºåˆ¶ï¼Œå¹¶ä¸”å†æ¬¡è¯´æ˜ï¼Œè‡ªæ³¨æ„åŠ›å±‚ã€äº¤å‰æ³¨æ„åŠ›å±‚ã€FFN ä»¥åï¼Œä¼šè¿›è¡Œæ®‹å·®è¿æ¥ã€‚</p>
<p>ï¼ˆ3ï¼‰DecoderLayer è¿›è¡Œäº†ä¸‰æ¬¡åºåˆ—åˆ†è§£ï¼ŒçŒœæµ‹ï¼Œåˆ†åˆ«æ˜¯åœ¨è‡ªæ³¨æ„æœºåˆ¶ã€äº¤å‰æ³¨æ„åŠ›æœºåˆ¶ä»¥åŠ FFN ä»¥åï¼Œåˆ†åˆ«è¿›è¡Œåˆ†è§£</p>
<p>ï¼ˆ4ï¼‰åŒæ—¶åœ¨ DecoderLayer ä¸­ï¼Œåº”è¯¥å°¤å…¶æ³¨æ„ è¶‹åŠ¿æˆåˆ†æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Œå› ä¸º EncoderLayer ä¸­ï¼Œå¿½ç•¥æ‰äº†è¶‹åŠ¿æˆåˆ†ã€‚</p>
<p>ï¼ˆ5ï¼‰æ¥ä¸‹æ¥å…±åŒè°ƒç”¨çš„ è‡ªç›¸å…³å±‚ï¼Œå•ä¸ªè‡ªç›¸å…³å±‚ã€ä»¥åŠåºåˆ—åˆ†è§£æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321160449357.png"><img alt="image-20250321160449357" src="../images/image-20250321160449357.png"></a></p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1"></a><a href="#__codelineno-49-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="bp">self</span><span class="o">.</span><span class="n">encoder</span> <span class="o">=</span> <span class="n">Encoder</span><span class="p">(</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2"></a><a href="#__codelineno-49-2"><span class="linenos" data-linenos=" 2 "></span></a>    <span class="p">[</span>
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3"></a><a href="#__codelineno-49-3"><span class="linenos" data-linenos=" 3 "></span></a>        <span class="n">EncoderLayer</span><span class="p">(</span>
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4"></a><a href="#__codelineno-49-4"><span class="linenos" data-linenos=" 4 "></span></a>            <span class="n">AutoCorrelationLayer</span><span class="p">(</span>
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5"></a><a href="#__codelineno-49-5"><span class="linenos" data-linenos=" 5 "></span></a>                <span class="n">AutoCorrelation</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">configs</span><span class="o">.</span><span class="n">factor</span><span class="p">,</span> <span class="n">attention_dropout</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">dropout</span><span class="p">,</span>
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6"></a><a href="#__codelineno-49-6"><span class="linenos" data-linenos=" 6 "></span></a>                                <span class="n">output_attention</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">output_attention</span><span class="p">),</span>
</span><span id="__span-49-7"><a id="__codelineno-49-7" name="__codelineno-49-7"></a><a href="#__codelineno-49-7"><span class="linenos" data-linenos=" 7 "></span></a>                <span class="n">configs</span><span class="o">.</span><span class="n">d_model</span><span class="p">,</span> <span class="n">configs</span><span class="o">.</span><span class="n">n_heads</span><span class="p">),</span>
</span><span id="__span-49-8"><a id="__codelineno-49-8" name="__codelineno-49-8"></a><a href="#__codelineno-49-8"><span class="linenos" data-linenos=" 8 "></span></a>            <span class="n">configs</span><span class="o">.</span><span class="n">d_model</span><span class="p">,</span>
</span><span id="__span-49-9"><a id="__codelineno-49-9" name="__codelineno-49-9"></a><a href="#__codelineno-49-9"><span class="linenos" data-linenos=" 9 "></span></a>            <span class="n">configs</span><span class="o">.</span><span class="n">d_ff</span><span class="p">,</span>
</span><span id="__span-49-10"><a id="__codelineno-49-10" name="__codelineno-49-10"></a><a href="#__codelineno-49-10"><span class="linenos" data-linenos="10 "></span></a>            <span class="n">moving_avg</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">moving_avg</span><span class="p">,</span>
</span><span id="__span-49-11"><a id="__codelineno-49-11" name="__codelineno-49-11"></a><a href="#__codelineno-49-11"><span class="linenos" data-linenos="11 "></span></a>            <span class="n">dropout</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">dropout</span><span class="p">,</span>
</span><span id="__span-49-12"><a id="__codelineno-49-12" name="__codelineno-49-12"></a><a href="#__codelineno-49-12"><span class="linenos" data-linenos="12 "></span></a>            <span class="n">activation</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">activation</span>
</span><span id="__span-49-13"><a id="__codelineno-49-13" name="__codelineno-49-13"></a><a href="#__codelineno-49-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">configs</span><span class="o">.</span><span class="n">e_layers</span><span class="p">)</span>
</span><span id="__span-49-14"><a id="__codelineno-49-14" name="__codelineno-49-14"></a><a href="#__codelineno-49-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="p">],</span>
</span><span id="__span-49-15"><a id="__codelineno-49-15" name="__codelineno-49-15"></a><a href="#__codelineno-49-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="n">norm_layer</span><span class="o">=</span><span class="n">my_Layernorm</span><span class="p">(</span><span class="n">configs</span><span class="o">.</span><span class="n">d_model</span><span class="p">)</span>
</span><span id="__span-49-16"><a id="__codelineno-49-16" name="__codelineno-49-16"></a><a href="#__codelineno-49-16"><span class="linenos" data-linenos="16 "></span></a><span class="p">)</span>
</span><span id="__span-49-17"><a id="__codelineno-49-17" name="__codelineno-49-17"></a><a href="#__codelineno-49-17"><span class="linenos" data-linenos="17 "></span></a><span class="c1"># Decoder</span>
</span><span id="__span-49-18"><a id="__codelineno-49-18" name="__codelineno-49-18"></a><a href="#__codelineno-49-18"><span class="linenos" data-linenos="18 "></span></a><span class="bp">self</span><span class="o">.</span><span class="n">decoder</span> <span class="o">=</span> <span class="n">Decoder</span><span class="p">(</span>
</span><span id="__span-49-19"><a id="__codelineno-49-19" name="__codelineno-49-19"></a><a href="#__codelineno-49-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="p">[</span>
</span><span id="__span-49-20"><a id="__codelineno-49-20" name="__codelineno-49-20"></a><a href="#__codelineno-49-20"><span class="linenos" data-linenos="20 "></span></a>        <span class="n">DecoderLayer</span><span class="p">(</span>
</span><span id="__span-49-21"><a id="__codelineno-49-21" name="__codelineno-49-21"></a><a href="#__codelineno-49-21"><span class="linenos" data-linenos="21 "></span></a>            <span class="n">AutoCorrelationLayer</span><span class="p">(</span>
</span><span id="__span-49-22"><a id="__codelineno-49-22" name="__codelineno-49-22"></a><a href="#__codelineno-49-22"><span class="linenos" data-linenos="22 "></span></a>                <span class="n">AutoCorrelation</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">configs</span><span class="o">.</span><span class="n">factor</span><span class="p">,</span> <span class="n">attention_dropout</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">dropout</span><span class="p">,</span>
</span><span id="__span-49-23"><a id="__codelineno-49-23" name="__codelineno-49-23"></a><a href="#__codelineno-49-23"><span class="linenos" data-linenos="23 "></span></a>                                <span class="n">output_attention</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
</span><span id="__span-49-24"><a id="__codelineno-49-24" name="__codelineno-49-24"></a><a href="#__codelineno-49-24"><span class="linenos" data-linenos="24 "></span></a>                <span class="n">configs</span><span class="o">.</span><span class="n">d_model</span><span class="p">,</span> <span class="n">configs</span><span class="o">.</span><span class="n">n_heads</span><span class="p">),</span>
</span><span id="__span-49-25"><a id="__codelineno-49-25" name="__codelineno-49-25"></a><a href="#__codelineno-49-25"><span class="linenos" data-linenos="25 "></span></a>            <span class="n">AutoCorrelationLayer</span><span class="p">(</span>
</span><span id="__span-49-26"><a id="__codelineno-49-26" name="__codelineno-49-26"></a><a href="#__codelineno-49-26"><span class="linenos" data-linenos="26 "></span></a>                <span class="n">AutoCorrelation</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">configs</span><span class="o">.</span><span class="n">factor</span><span class="p">,</span> <span class="n">attention_dropout</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">dropout</span><span class="p">,</span>
</span><span id="__span-49-27"><a id="__codelineno-49-27" name="__codelineno-49-27"></a><a href="#__codelineno-49-27"><span class="linenos" data-linenos="27 "></span></a>                                <span class="n">output_attention</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
</span><span id="__span-49-28"><a id="__codelineno-49-28" name="__codelineno-49-28"></a><a href="#__codelineno-49-28"><span class="linenos" data-linenos="28 "></span></a>                <span class="n">configs</span><span class="o">.</span><span class="n">d_model</span><span class="p">,</span> <span class="n">configs</span><span class="o">.</span><span class="n">n_heads</span><span class="p">),</span>
</span><span id="__span-49-29"><a id="__codelineno-49-29" name="__codelineno-49-29"></a><a href="#__codelineno-49-29"><span class="linenos" data-linenos="29 "></span></a>            <span class="n">configs</span><span class="o">.</span><span class="n">d_model</span><span class="p">,</span>
</span><span id="__span-49-30"><a id="__codelineno-49-30" name="__codelineno-49-30"></a><a href="#__codelineno-49-30"><span class="linenos" data-linenos="30 "></span></a>            <span class="n">configs</span><span class="o">.</span><span class="n">c_out</span><span class="p">,</span>
</span><span id="__span-49-31"><a id="__codelineno-49-31" name="__codelineno-49-31"></a><a href="#__codelineno-49-31"><span class="linenos" data-linenos="31 "></span></a>            <span class="n">configs</span><span class="o">.</span><span class="n">d_ff</span><span class="p">,</span>
</span><span id="__span-49-32"><a id="__codelineno-49-32" name="__codelineno-49-32"></a><a href="#__codelineno-49-32"><span class="linenos" data-linenos="32 "></span></a>            <span class="n">moving_avg</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">moving_avg</span><span class="p">,</span>
</span><span id="__span-49-33"><a id="__codelineno-49-33" name="__codelineno-49-33"></a><a href="#__codelineno-49-33"><span class="linenos" data-linenos="33 "></span></a>            <span class="n">dropout</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">dropout</span><span class="p">,</span>
</span><span id="__span-49-34"><a id="__codelineno-49-34" name="__codelineno-49-34"></a><a href="#__codelineno-49-34"><span class="linenos" data-linenos="34 "></span></a>            <span class="n">activation</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">activation</span><span class="p">,</span>
</span><span id="__span-49-35"><a id="__codelineno-49-35" name="__codelineno-49-35"></a><a href="#__codelineno-49-35"><span class="linenos" data-linenos="35 "></span></a>        <span class="p">)</span>
</span><span id="__span-49-36"><a id="__codelineno-49-36" name="__codelineno-49-36"></a><a href="#__codelineno-49-36"><span class="linenos" data-linenos="36 "></span></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">configs</span><span class="o">.</span><span class="n">d_layers</span><span class="p">)</span>
</span><span id="__span-49-37"><a id="__codelineno-49-37" name="__codelineno-49-37"></a><a href="#__codelineno-49-37"><span class="linenos" data-linenos="37 "></span></a>    <span class="p">],</span>
</span><span id="__span-49-38"><a id="__codelineno-49-38" name="__codelineno-49-38"></a><a href="#__codelineno-49-38"><span class="linenos" data-linenos="38 "></span></a>    <span class="n">norm_layer</span><span class="o">=</span><span class="n">my_Layernorm</span><span class="p">(</span><span class="n">configs</span><span class="o">.</span><span class="n">d_model</span><span class="p">),</span>
</span><span id="__span-49-39"><a id="__codelineno-49-39" name="__codelineno-49-39"></a><a href="#__codelineno-49-39"><span class="linenos" data-linenos="39 "></span></a>    <span class="n">projection</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">configs</span><span class="o">.</span><span class="n">d_model</span><span class="p">,</span> <span class="n">configs</span><span class="o">.</span><span class="n">c_out</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-49-40"><a id="__codelineno-49-40" name="__codelineno-49-40"></a><a href="#__codelineno-49-40"><span class="linenos" data-linenos="40 "></span></a><span class="p">)</span>
</span></code></pre></div>
<p>è¯´ç€è¯´ç€å°±è¿œäº†</p>
<h4 id="_12">è®ºæ–‡<a class="headerlink" href="#_12" title="Permanent link">Â¶</a></h4>
<p>ç»§ç»­æŒ‰ç…§è®ºæ–‡ã€å…¬å¼ã€ä»£ç ã€å›¾çš„é€»è¾‘è¿›è¡Œè®²è§£</p>
<p>çœ‹è®ºæ–‡æŠŠã€‚</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321163503744.png"><img alt="image-20250321163503744" src="../images/image-20250321163503744.png"></a></p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321163514281.png"><img alt="image-20250321163514281" src="../images/image-20250321163514281.png"></a></p>
<p>ä¸€å¥ä¸€å¥çœ‹å§ï¼š</p>
<p>ğŸŸ¢   </p>
<blockquote>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321164634097.png"><img alt="image-20250321164634097" src="../images/image-20250321164634097.png"></a></p>
<p>è§£ç å™¨</p>
<p>è§£ç å™¨åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼Œè¡¨ç¤ºè¶‹åŠ¿æˆåˆ†çš„ç´¯ç§¯ç»“æ„ å’Œ å­£èŠ‚æˆåˆ†å †å çš„è‡ªç›¸å…³æœºåˆ¶</p>
<p>æ¯ä¸ªçš„DecoderLayer åŒ…å«äº†å†…éƒ¨è‡ªç›¸å…³æœºåˆ¶(è‡ªæ³¨æ„åŠ›æœºåˆ¶)å’Œç¼–ç å™¨å’Œè§£ç å™¨ç›¸å…³æœºåˆ¶(äº¤å‰æ³¨æ„åŠ›æœºåˆ¶)ï¼Œç›®çš„æ˜¯ä¸ºäº†  â‘  ç»†åŒ–é¢„æµ‹ å¹¶ä¸” â‘¡ å……åˆ†åˆ©ç”¨å†å²çš„å­£èŠ‚ä¿¡æ¯</p>
</blockquote>
<p>ğŸŸ¢ </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321164717926.png"><img alt="image-20250321164717926" src="../images/image-20250321164717926.png"></a> </p>
<blockquote>
<p>æ³¨æ„ï¼Œæ¨¡å‹æå–æ½œåœ¨çš„è¶‹åŠ¿ä¿¡æ¯ï¼Œåœ¨è§£ç å™¨ä¸­ï¼Œé€šè¿‡ä¸­é—´çš„éšè—å˜é‡ã€‚</p>
<p>ï¼ˆæ³¨æ„ï¼Œåœ¨è§£ç å™¨ä¸­ï¼Œæ¨¡å‹ é€šè¿‡ä¸­é—´çš„éšè—å˜é‡ æå–æ½œåœ¨çš„è¶‹åŠ¿ä¿¡æ¯ï¼‰</p>
<p>è¿™ç§æœºåˆ¶ ä½¿å¾—Autoformer é€æ­¥ ä¼˜åŒ– è¶‹åŠ¿é¢„æµ‹ å¹¶ä¸” æ¶ˆé™¤ å¹²æ‰°ä¿¡æ¯</p>
<p>ä»¥ä¾¿åœ¨è‡ªç›¸å…³æœºåˆ¶ä¸­ å‘ç° åŸºäºå‘¨æœŸçš„ä¾èµ–å…³ç³»ã€‚</p>
<blockquote>
<p>æˆ‘ï¼šï¼ˆå°±æ˜¯è¯´ éšè—çš„ä¸­é—´å˜é‡é¢„æµ‹è¶‹åŠ¿ä¿¡æ¯ï¼Œåœ¨è‡ªç›¸å…³æœºåˆ¶ä¸­ é¢„æµ‹å­£èŠ‚ä¿¡æ¯ï¼‰</p>
</blockquote>
<p>å‡è®¾ è§£ç å™¨ æœ‰ M å±‚ï¼Œç»“åˆæ¥è‡ªç¼–ç å™¨çš„æ½œåœ¨å˜é‡ <span class="arithmatex">\(\mathcal{X}_{en}^N\)</span> ï¼ˆæˆ‘ï¼šåº”è¯¥æ˜¯ç¼–ç å™¨çš„æœ€åä¸€å±‚è¾“å‡ºï¼‰ï¼Œç¬¬ l å±‚è§£ç å™¨çš„æ–¹ç¨‹å¯ä»¥è¡¨ç¤ºä¸º $ \mathcal{X}<em de="de">{de}^{l} = Decoder(\mathcal{X}</em><sup>{l-1},\mathcal{X}_{en}</sup>N)$ ï¼ˆæˆ‘ï¼šç¬¬ <span class="arithmatex">\(l\)</span> å±‚è§£ç å™¨çš„è¾“å…¥ï¼Œæ¥æ”¶æ¥è‡ª==ä¸Šä¸€å±‚è§£ç å™¨çš„è¾“å‡º==  å’Œ <mark>æœ€åä¸€å±‚ç¼–ç å™¨çš„è¾“å‡º</mark> ä½œä¸ºè¾“å…¥ï¼‰</p>
</blockquote>
<p>ğŸŸ¢ å•ä¸ª DecoderLayer çš„è¿‡ç¨‹ï¼Œå¯ä»¥æ¦‚æ‹¬å¦‚ä¸‹ï¼š</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321165833556.png"><img alt="image-20250321165833556" src="../images/image-20250321165833556.png"></a> </p>
<p>ç¬¦å·è§£é‡Š</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321171255673.png"><img alt="image-20250321171255673" src="../images/image-20250321171255673.png"></a> </p>
<ul>
<li><span class="arithmatex">\(\mathcal{X}_{de}^l = \mathcal{S}_{de}^{l,3},l \in \{1,...,M\}\)</span> è¡¨ç¤ºç¬¬ <span class="arithmatex">\(l\)</span> å±‚è§£ç å±‚çš„è¾“å‡ºï¼ŒM æ˜¯ DecoderLayer çš„å±‚æ•°</li>
</ul>
<blockquote>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input disabled="" type="checkbox"><span class="task-list-indicator"></span></label> 3 æ˜¯å•¥ï¼Ÿ</li>
</ul>
</blockquote>
<ul>
<li><span class="arithmatex">\(\mathcal{X}_{de}^0\)</span> æ˜¯å¯¹åŸå§‹è§£ç å™¨è¾“å…¥ <span class="arithmatex">\(\mathcal{X}_{des}\)</span>  çš„åµŒå…¥ ï¼ˆ <span class="arithmatex">\(\mathcal{X}_{des}\)</span> â†’ åµŒå…¥å±‚ â†’  <span class="arithmatex">\(\mathcal{X}_{de}^0\)</span>ï¼‰ </li>
</ul>
<blockquote>
<p>(outputs)ï¼ˆå°±æ˜¯åŸå§‹æ•°æ®è¡¨ç¤ºã€Transformer ç»“æ„å³ä¾§è§£ç å™¨çš„è¾“å…¥ï¼ˆçœŸæœäº†ï¼Œä¸ºäº†æ€•è‡ªå·±å¿˜ï¼Œç”¨ç€è¿™ä¹ˆå¤šè§£é‡ŠT.Tï¼‰ï¼‰</p>
</blockquote>
<ul>
<li><span class="arithmatex">\(\mathcal{T}_{de}^0 = \mathcal{X}_{det}\)</span> ç”¨äºç´¯ç§¯==ï¼ˆæ‰€ä»¥å°±æ˜¯è¶‹åŠ¿åˆ†é‡æ˜¯ç´¯åŠ æ¥çš„ï¼‰==    </li>
</ul>
<blockquote>
<p>çœŸæ™•å•Šï¼Œéƒ½å•¥ç¬¦å·å•Šã€‚çœŸæœäº†ã€‚ç¿»æŠŠã€‚æ¯•ç«Ÿç¬¦å·æ˜¯ç»Ÿä¸€çš„ã€‚</p>
<p>æ‰¾åˆ°äº†ï¼</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321171042677.png"><img alt="image-20250321171042677" src="../images/image-20250321171042677.png"></a> </p>
<ul>
<li>de è§£ç å™¨ ã€s å­£èŠ‚åˆ†é‡ã€t è¶‹åŠ¿åˆ†é‡</li>
<li><span class="arithmatex">\(\mathcal{X}\)</span> åŸå§‹æ•°æ®ï¼Œæœªç»åµŒå…¥</li>
<li>ä¸Šæ ‡ 0 è¡¨ç¤ºåˆå§‹å€¼</li>
<li>s æˆåˆ†ï¼ˆå­£èŠ‚æˆåˆ†ï¼‰çš„åˆå§‹åŒ–æ˜¯ 0 å¡«å……çš„ã€t æˆåˆ†ï¼ˆè¶‹åŠ¿æˆåˆ†ï¼‰çš„åˆå§‹åŒ–æ˜¯ å‡å€¼å¡«å……çš„</li>
<li><span class="arithmatex">\(\mathcal{T}\)</span> è¡¨ç¤ºè¶‹åŠ¿åˆ†é‡ï¼Œï¼ˆTrendï¼‰</li>
<li><span class="arithmatex">\(\mathcal{S}\)</span> è¡¨ç¤º å­£èŠ‚åˆ†é‡ï¼Œï¼ˆSeasonï¼‰</li>
</ul>
<blockquote>
<p>ä¸é”™ï¼Œå‘½åè¿˜æŒºè®²ç©¶çš„ã€‚æ¥è‡ªæˆ‘çš„è¶…é«˜è¯„ä»·ï¼Œå®³ï¼Œç ”ç©¶è¿™ä¸ªçš„ï¼Œå“ªæœ‰å‡ ä¸ªç²¾ç¥ç¾ä¸½çš„ï¼Œå¹²æ´»äº†ã€‚</p>
</blockquote>
</blockquote>
<ul>
<li><span class="arithmatex">\(\mathcal{S}_{de}^{l,i}\)</span> ã€<span class="arithmatex">\(\mathcal{T}_{de}^{l,i}\)</span> $   i  \in {1,2,3}$ åˆ†åˆ«è¡¨ç¤º ç¬¬<span class="arithmatex">\(l\)</span> å±‚çš„DecoderLayer ä¸­ï¼Œç¬¬ <span class="arithmatex">\(i\)</span> æ¬¡åºåˆ—åˆ†è§£å¿«ä¹‹åå¾—åˆ°çš„å­£èŠ‚æˆåˆ†å’Œè¶‹åŠ¿æˆåˆ†ã€‚(<span class="arithmatex">\(l\)</span> è¡¨ç¤º <span class="arithmatex">\(l\)</span> å±‚ï¼Œç¼–ç å™¨è§£ç å™¨ä¸­åŒç†)</li>
<li><span class="arithmatex">\(\mathcal{W}_{l,i} , i\in \{1,2,3\}\)</span>  è¡¨ç¤º å¯¹ ç¬¬ <span class="arithmatex">\(i\)</span> ä¸ªæå–çš„è¶‹åŠ¿åˆ†é‡ <span class="arithmatex">\(\mathcal{T}_{de}^{l,i}\)</span> çš„ çº¿æ€§æŠ•å½±ã€‚ï¼ˆW æ˜¯ä»€ä¹ˆçš„ç¼©å†™ï¼Ÿï¼‰</li>
</ul>
<p>ğŸŸ¢</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321172443831.png"><img alt="image-20250321172443831" src="../images/image-20250321172443831.png"></a> </p>
<p>æœ€ç»ˆçš„é¢„æµ‹ç»“æœ æ˜¯å¯¹ä¸¤ä¸ªåˆ†è§£æˆåˆ†çš„åŠ å’Œï¼Œå…¬å¼è¡¨ç¤ºä¸º <span class="arithmatex">\(\mathcal{W}_\mathcal{S} * \mathcal{X}_{de}^M + \mathcal{T}_{de}^M\)</span> </p>
<ul>
<li>è¿™é‡Œçš„ <span class="arithmatex">\(\mathcal{W}\)</span> éƒ½è¡¨ç¤ºçº¿æ€§æŠ•å½±ã€‚</li>
<li><span class="arithmatex">\(\mathcal{W}_\mathcal{S}\)</span> å°† æœ€åä¸€å±‚ è§£ç å™¨çš„è¾“å‡º æŠ•å½±åˆ°ç›®æ ‡ç»´åº¦</li>
</ul>
<blockquote>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321173400693.png"><img alt="image-20250321173400693" src="../images/image-20250321173400693.png"></a> </p>
</blockquote>
<p>æˆ‘ï¼šè¿™ä¸ªå…¬å¼  <span class="arithmatex">\(\mathcal{X}_{de}^{l} = \mathcal{S}_{de}^{l,3}\)</span> ä¹Ÿå°±æ˜¯è¡¨ç¤ºäº† è§£ç å™¨ä¸­æ•°æ®çš„çš„æµåŠ¨ä¹Ÿæ˜¯å­£èŠ‚æˆåˆ†ã€‚</p>
<h4 id="_13">ä»£ç <a class="headerlink" href="#_13" title="Permanent link">Â¶</a></h4>
<p><strong>å¥½äº†ï¼Œè®ºæ–‡çœ‹å®Œäº†ï¼Œç°åœ¨çœ‹ä»£ç ã€‚</strong></p>
<ul>
<li>ä» Autoformer forward å‡ºå‘</li>
</ul>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321173752060.png"><img alt="image-20250321173752060" src="../images/image-20250321173752060.png"></a></p>
<ul>
<li>è¿›å…¥ Decoder forward</li>
</ul>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321173851471.png"><img alt="image-20250321173851471" src="../images/image-20250321173851471.png"></a> </p>
<ul>
<li>Decoder çš„åˆå§‹åŒ–</li>
</ul>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321173954060.png"><img alt="image-20250321173954060" src="../images/image-20250321173954060.png"></a></p>
<p>å…¶ä¸­ <code>d_layers = 1</code> ï¼ˆå…¨å±€æœç´¢ï¼‰</p>
<p>åŒ…æ‹¬äº†ä¸€å±‚ DecoderLayerã€è‡ªæ³¨æ„åŠ›æœºåˆ¶ã€äº¤å‰æ³¨æ„åŠ›æœºåˆ¶ï¼Œæœ€åçš„æŠ•å½±å±‚æ˜¯ä¸ºäº†æŠŠåµŒå…¥ç»´åº¦ è¿˜åŸä¸º åŸå§‹ç»´åº¦ã€‚</p>
<h4 id="decoderlayer-forward">DecoderLayer  forward<a class="headerlink" href="#decoderlayer-forward" title="Permanent link">Â¶</a></h4>
<ul>
<li>æ­¥è¿›ï¼Œæœç„¶è¿›å…¥äº† DecoderLayer çš„ forward</li>
</ul>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321174221181.png"><img alt="image-20250321174221181" src="../images/image-20250321174221181.png"></a> </p>
<ul>
<li>é€æ­¥æ­¥è¿›æ‰§è¡Œï¼Œæœç„¶è¿›å…¥äº† AutoCorrelationLayer çš„ forward</li>
</ul>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321174253332.png"><img alt="image-20250321174253332" src="../images/image-20250321174253332.png"></a> </p>
<p>æ¥ä¸‹æ¥å°±æ˜¯ qkv çš„è®¡ç®—ï¼Œè¿™è¡Œå…³é”®ï¼Œä¼šæ­¥è¿›åˆ°å…·ä½“çš„ AutoCorrelationçš„è®¡ç®—ã€‚çœ‹ç»´åº¦ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œè¿˜ç”¨çš„<span id="è¿”å›ç†è§£å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶"><a href="#è·³åˆ°ç†è§£å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶">å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶</a></span>ã€‚  </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321174359890.png"><img alt="image-20250321174359890" src="../images/image-20250321174359890.png"></a> </p>
<ul>
<li>æ­¥è¿›ï¼Œæœç„¶ è·³åˆ°äº† AutoCorrelation-forward</li>
</ul>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321175357208.png"><img alt="image-20250321175357208" src="../images/image-20250321175357208.png"></a> </p>
<p><strong>å…¶å®ï¼Œè·³è¿›æ¥æ²¡ç”¨ï¼Œå› ä¸ºæš‚æ—¶ä¸çœ‹è‡ªç›¸å…³æœºåˆ¶çš„è®¡ç®—ï¼Œè¿™æ˜¯æœ¬æ–‡çš„åˆ›æ–°ã€‚é€æ­¥è·³å‡ºï¼Œçœ‹ DecoderLayer çš„å¤„ç†ã€‚</strong></p>
<p>ä¸¤ä¸ªæ³¨æ„åŠ›è®¡ç®—ï¼Œä¸‰ä¸ªè¶‹åŠ¿åˆ†è§£ï¼Œä¸€ä¸ªè¿˜åŸç»´åº¦çš„çº¿æ€§å±‚ã€‚</p>
<p><strong>DecoderLayerä»£ç æ‰§è¡Œçš„æµç¨‹å›¾</strong> </p>
<div class="language-markdown highlight"><span class="filename">Markdown</span><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1"></a><a href="#__codelineno-50-1"><span class="linenos" data-linenos=" 1 "></span></a>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2"></a><a href="#__codelineno-50-2"><span class="linenos" data-linenos=" 2 "></span></a>â”‚ è¾“å…¥åºåˆ— x [B,L,d_model] â”‚
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3"></a><a href="#__codelineno-50-3"><span class="linenos" data-linenos=" 3 "></span></a>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4"></a><a href="#__codelineno-50-4"><span class="linenos" data-linenos=" 4 "></span></a>               â†“
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5"></a><a href="#__codelineno-50-5"><span class="linenos" data-linenos=" 5 "></span></a>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6"></a><a href="#__codelineno-50-6"><span class="linenos" data-linenos=" 6 "></span></a>â”‚     è‡ªæ³¨æ„åŠ› + æ®‹å·®è¿æ¥    â”‚    x = x + dropout(self_attention(x,x,x))
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7"></a><a href="#__codelineno-50-7"><span class="linenos" data-linenos=" 7 "></span></a>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span><span id="__span-50-8"><a id="__codelineno-50-8" name="__codelineno-50-8"></a><a href="#__codelineno-50-8"><span class="linenos" data-linenos=" 8 "></span></a>               â†“
</span><span id="__span-50-9"><a id="__codelineno-50-9" name="__codelineno-50-9"></a><a href="#__codelineno-50-9"><span class="linenos" data-linenos=" 9 "></span></a>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span><span id="__span-50-10"><a id="__codelineno-50-10" name="__codelineno-50-10"></a><a href="#__codelineno-50-10"><span class="linenos" data-linenos="10 "></span></a>â”‚       åºåˆ—åˆ†è§£ 1         â”‚    x, trend1 = decomp1(x)
</span><span id="__span-50-11"><a id="__codelineno-50-11" name="__codelineno-50-11"></a><a href="#__codelineno-50-11"><span class="linenos" data-linenos="11 "></span></a>â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span><span id="__span-50-12"><a id="__codelineno-50-12" name="__codelineno-50-12"></a><a href="#__codelineno-50-12"><span class="linenos" data-linenos="12 "></span></a>       â”‚                  â†˜
</span><span id="__span-50-13"><a id="__codelineno-50-13" name="__codelineno-50-13"></a><a href="#__codelineno-50-13"><span class="linenos" data-linenos="13 "></span></a>       â”‚                   trend1 [B,L,d_model] â†’ ä¿å­˜
</span><span id="__span-50-14"><a id="__codelineno-50-14" name="__codelineno-50-14"></a><a href="#__codelineno-50-14"><span class="linenos" data-linenos="14 "></span></a>       â†“
</span><span id="__span-50-15"><a id="__codelineno-50-15" name="__codelineno-50-15"></a><a href="#__codelineno-50-15"><span class="linenos" data-linenos="15 "></span></a>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span><span id="__span-50-16"><a id="__codelineno-50-16" name="__codelineno-50-16"></a><a href="#__codelineno-50-16"><span class="linenos" data-linenos="16 "></span></a>â”‚ äº¤å‰æ³¨æ„åŠ›(ç¼–ç å™¨è¾“å‡º)     â”‚    x = x + dropout(cross_attention(x,cross,cross))
</span><span id="__span-50-17"><a id="__codelineno-50-17" name="__codelineno-50-17"></a><a href="#__codelineno-50-17"><span class="linenos" data-linenos="17 "></span></a>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span><span id="__span-50-18"><a id="__codelineno-50-18" name="__codelineno-50-18"></a><a href="#__codelineno-50-18"><span class="linenos" data-linenos="18 "></span></a>               â†“
</span><span id="__span-50-19"><a id="__codelineno-50-19" name="__codelineno-50-19"></a><a href="#__codelineno-50-19"><span class="linenos" data-linenos="19 "></span></a>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span><span id="__span-50-20"><a id="__codelineno-50-20" name="__codelineno-50-20"></a><a href="#__codelineno-50-20"><span class="linenos" data-linenos="20 "></span></a>â”‚       åºåˆ—åˆ†è§£ 2         â”‚    x, trend2 = decomp2(x)
</span><span id="__span-50-21"><a id="__codelineno-50-21" name="__codelineno-50-21"></a><a href="#__codelineno-50-21"><span class="linenos" data-linenos="21 "></span></a>â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span><span id="__span-50-22"><a id="__codelineno-50-22" name="__codelineno-50-22"></a><a href="#__codelineno-50-22"><span class="linenos" data-linenos="22 "></span></a>       â”‚                  â†˜
</span><span id="__span-50-23"><a id="__codelineno-50-23" name="__codelineno-50-23"></a><a href="#__codelineno-50-23"><span class="linenos" data-linenos="23 "></span></a>       â”‚                   trend2 [B,L,d_model] â†’ ä¿å­˜
</span><span id="__span-50-24"><a id="__codelineno-50-24" name="__codelineno-50-24"></a><a href="#__codelineno-50-24"><span class="linenos" data-linenos="24 "></span></a>       â†“
</span><span id="__span-50-25"><a id="__codelineno-50-25" name="__codelineno-50-25"></a><a href="#__codelineno-50-25"><span class="linenos" data-linenos="25 "></span></a>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span><span id="__span-50-26"><a id="__codelineno-50-26" name="__codelineno-50-26"></a><a href="#__codelineno-50-26"><span class="linenos" data-linenos="26 "></span></a>â”‚        å‰é¦ˆç½‘ç»œ          â”‚
</span><span id="__span-50-27"><a id="__codelineno-50-27" name="__codelineno-50-27"></a><a href="#__codelineno-50-27"><span class="linenos" data-linenos="27 "></span></a>â”‚  y=x (å¤åˆ¶æ“ä½œ)          â”‚
</span><span id="__span-50-28"><a id="__codelineno-50-28" name="__codelineno-50-28"></a><a href="#__codelineno-50-28"><span class="linenos" data-linenos="28 "></span></a>â”‚  å·ç§¯1 + æ¿€æ´» + Dropout  â”‚    y = dropout(activation(conv1(y.transpose)))
</span><span id="__span-50-29"><a id="__codelineno-50-29" name="__codelineno-50-29"></a><a href="#__codelineno-50-29"><span class="linenos" data-linenos="29 "></span></a>â”‚  å·ç§¯2 + Dropout        â”‚    y = dropout(conv2(y).transpose)
</span><span id="__span-50-30"><a id="__codelineno-50-30" name="__codelineno-50-30"></a><a href="#__codelineno-50-30"><span class="linenos" data-linenos="30 "></span></a>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span><span id="__span-50-31"><a id="__codelineno-50-31" name="__codelineno-50-31"></a><a href="#__codelineno-50-31"><span class="linenos" data-linenos="31 "></span></a>               â†“
</span><span id="__span-50-32"><a id="__codelineno-50-32" name="__codelineno-50-32"></a><a href="#__codelineno-50-32"><span class="linenos" data-linenos="32 "></span></a>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span><span id="__span-50-33"><a id="__codelineno-50-33" name="__codelineno-50-33"></a><a href="#__codelineno-50-33"><span class="linenos" data-linenos="33 "></span></a>â”‚ æ®‹å·®è¿æ¥ (x + y)         â”‚
</span><span id="__span-50-34"><a id="__codelineno-50-34" name="__codelineno-50-34"></a><a href="#__codelineno-50-34"><span class="linenos" data-linenos="34 "></span></a>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span><span id="__span-50-35"><a id="__codelineno-50-35" name="__codelineno-50-35"></a><a href="#__codelineno-50-35"><span class="linenos" data-linenos="35 "></span></a>               â†“
</span><span id="__span-50-36"><a id="__codelineno-50-36" name="__codelineno-50-36"></a><a href="#__codelineno-50-36"><span class="linenos" data-linenos="36 "></span></a>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span><span id="__span-50-37"><a id="__codelineno-50-37" name="__codelineno-50-37"></a><a href="#__codelineno-50-37"><span class="linenos" data-linenos="37 "></span></a>â”‚       åºåˆ—åˆ†è§£ 3         â”‚    x, trend3 = decomp3(x + y)
</span><span id="__span-50-38"><a id="__codelineno-50-38" name="__codelineno-50-38"></a><a href="#__codelineno-50-38"><span class="linenos" data-linenos="38 "></span></a>â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span><span id="__span-50-39"><a id="__codelineno-50-39" name="__codelineno-50-39"></a><a href="#__codelineno-50-39"><span class="linenos" data-linenos="39 "></span></a>       â”‚                  â†˜
</span><span id="__span-50-40"><a id="__codelineno-50-40" name="__codelineno-50-40"></a><a href="#__codelineno-50-40"><span class="linenos" data-linenos="40 "></span></a>       â”‚                   trend3 [B,L,d_model] â†’ ä¿å­˜
</span><span id="__span-50-41"><a id="__codelineno-50-41" name="__codelineno-50-41"></a><a href="#__codelineno-50-41"><span class="linenos" data-linenos="41 "></span></a>       â†“
</span><span id="__span-50-42"><a id="__codelineno-50-42" name="__codelineno-50-42"></a><a href="#__codelineno-50-42"><span class="linenos" data-linenos="42 "></span></a>       â”‚
</span><span id="__span-50-43"><a id="__codelineno-50-43" name="__codelineno-50-43"></a><a href="#__codelineno-50-43"><span class="linenos" data-linenos="43 "></span></a>       â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span><span id="__span-50-44"><a id="__codelineno-50-44" name="__codelineno-50-44"></a><a href="#__codelineno-50-44"><span class="linenos" data-linenos="44 "></span></a>       â”‚    â”‚   åˆå¹¶è¶‹åŠ¿: trend1 + trend2 + trend3 â”‚
</span><span id="__span-50-45"><a id="__codelineno-50-45" name="__codelineno-50-45"></a><a href="#__codelineno-50-45"><span class="linenos" data-linenos="45 "></span></a>       â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span><span id="__span-50-46"><a id="__codelineno-50-46" name="__codelineno-50-46"></a><a href="#__codelineno-50-46"><span class="linenos" data-linenos="46 "></span></a>       â”‚                    â†“
</span><span id="__span-50-47"><a id="__codelineno-50-47" name="__codelineno-50-47"></a><a href="#__codelineno-50-47"><span class="linenos" data-linenos="47 "></span></a>       â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span><span id="__span-50-48"><a id="__codelineno-50-48" name="__codelineno-50-48"></a><a href="#__codelineno-50-48"><span class="linenos" data-linenos="48 "></span></a>       â”‚    â”‚   è¶‹åŠ¿æŠ•å½± (ç»´åº¦è°ƒæ•´)               â”‚    residual_trend = projection(residual_trend)
</span><span id="__span-50-49"><a id="__codelineno-50-49" name="__codelineno-50-49"></a><a href="#__codelineno-50-49"><span class="linenos" data-linenos="49 "></span></a>       â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span><span id="__span-50-50"><a id="__codelineno-50-50" name="__codelineno-50-50"></a><a href="#__codelineno-50-50"><span class="linenos" data-linenos="50 "></span></a>       â”‚                    â†“
</span><span id="__span-50-51"><a id="__codelineno-50-51" name="__codelineno-50-51"></a><a href="#__codelineno-50-51"><span class="linenos" data-linenos="51 "></span></a>       â”‚                    â”‚
</span><span id="__span-50-52"><a id="__codelineno-50-52" name="__codelineno-50-52"></a><a href="#__codelineno-50-52"><span class="linenos" data-linenos="52 "></span></a>â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span><span id="__span-50-53"><a id="__codelineno-50-53" name="__codelineno-50-53"></a><a href="#__codelineno-50-53"><span class="linenos" data-linenos="53 "></span></a>â”‚ å­£èŠ‚æ€§è¾“å‡º x   â”‚  â”‚ è¶‹åŠ¿è¾“å‡º         â”‚
</span><span id="__span-50-54"><a id="__codelineno-50-54" name="__codelineno-50-54"></a><a href="#__codelineno-50-54"><span class="linenos" data-linenos="54 "></span></a>â”‚ [B,L,d_model] â”‚  â”‚ [B,L,c_out]      â”‚
</span><span id="__span-50-55"><a id="__codelineno-50-55" name="__codelineno-50-55"></a><a href="#__codelineno-50-55"><span class="linenos" data-linenos="55 "></span></a>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></code></pre></div>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></label> ä¸ºä»€ä¹ˆåªå¯¹è¶‹åŠ¿æˆåˆ†è¿›è¡ŒæŠ•å½±ï¼Ÿï¼ˆç­”ï¼šéƒ½æŠ•å½±äº†ï¼Œåªæ˜¯ä½ç½®ä¸åŒï¼‰</li>
</ul>
<blockquote>
<p>é€šè¿‡æŠ•å½±å±‚å°†è¶‹åŠ¿ç»´åº¦ä»d_modelè°ƒæ•´ä¸ºc_out(è¾“å‡ºç‰¹å¾ç»´åº¦)</p>
<p>é¦–å…ˆï¼Œéœ€è¦æ˜ç¡®ï¼Œè¶‹åŠ¿æˆåˆ†å’Œå­£èŠ‚æˆåˆ†æœ€åéƒ½éœ€è¦ ä» <code>d_model</code> è¿˜åŸä¸º <code>feature dim</code> ä¹Ÿå°±æ˜¯åŸå§‹çš„æ•°æ®ç»´åº¦ï¼Œä½†æ˜¯è¿™é‡Œè¶‹åŠ¿æˆåˆ†å’Œå­£èŠ‚æˆåˆ†è¿˜åŸçš„ä½ç½®ä¸åŒï¼Œæ–¹å¼ä¸åŒã€‚</p>
<p><strong>ç¬¬ä¸€ä¸ªè¿˜åŸä½ç½®</strong></p>
<p>â‘  é¦–å…ˆæ˜ç¡® Decoder è°ƒç”¨ DecoderLayer è¿›è¡Œå•ä¸ªè§£ç å™¨çš„å¤„ç†</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1"></a><a href="#__codelineno-51-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># è¿”å›å­£èŠ‚æ€§æˆåˆ†(ä¸è¿›è¡ŒæŠ•å½±)å’ŒæŠ•å½±åçš„è¶‹åŠ¿æˆåˆ†</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2"></a><a href="#__codelineno-51-2"><span class="linenos" data-linenos="2 "></span></a><span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">residual_trend</span>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3"></a><a href="#__codelineno-51-3"><span class="linenos" data-linenos="3 "></span></a><span class="c1"># x: [B, L, d_model], residual_trend: [B, L, c_out]</span>
</span></code></pre></div>
<p>å•ä¸ª DecoderLayer è¿”å›çš„å­£èŠ‚æˆåˆ†å’Œè¶‹åŠ¿æˆåˆ†çš„ç»´åº¦å°±æ˜¯ä¸ä¸€æ ·çš„</p>
<p>â‘¡ å­£èŠ‚æˆåˆ†åœ¨ Decoder ä¸­è¿˜åŸç»´åº¦ï¼Œé€šè¿‡ if åˆ¤æ–­</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1"></a><a href="#__codelineno-52-1"><span class="linenos" data-linenos="1 "></span></a>        <span class="c1"># å¦‚æœå­˜åœ¨æŠ•å½±å±‚ï¼Œåˆ™å¯¹è¾“å‡ºè¿›è¡ŒæŠ•å½±å¤„ç†</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2"></a><a href="#__codelineno-52-2"><span class="linenos" data-linenos="2 "></span></a>        <span class="c1"># x[B, L, d_model] -&gt; Linear -&gt; x[B, L, c_out]</span>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3"></a><a href="#__codelineno-52-3"><span class="linenos" data-linenos="3 "></span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4"></a><a href="#__codelineno-52-4"><span class="linenos" data-linenos="4 "></span></a>            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></code></pre></div>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></label> é‚£å…·ä½“ä»€ä¹ˆæ—¶å€™è§¦å‘å‘¢ï¼Ÿæ¯æ¬¡ DecoderLayer æ‰§è¡Œå®Œï¼Ÿè¿˜æ˜¯æ‰€æœ‰ DecoderLayer æœ€ç»ˆæ‰§è¡Œå®Œï¼Ÿ å›ç­”ï¼šåè€…ï¼Œç†ç”±ï¼š</li>
</ul>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1"></a><a href="#__codelineno-53-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">cross</span><span class="p">,</span> <span class="n">x_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cross_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trend</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2"></a><a href="#__codelineno-53-2"><span class="linenos" data-linenos=" 2 "></span></a>    <span class="c1"># éå†æ¯ä¸ªè§£ç å™¨å±‚ï¼Œå¤„ç†è¾“å…¥åºåˆ—xå’Œäº¤å‰åºåˆ—cross</span>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3"></a><a href="#__codelineno-53-3"><span class="linenos" data-linenos=" 3 "></span></a>    <span class="c1"># x[B, L, d_model] -&gt; DecoderLayer.forward -&gt; x[B, L, d_model], residual_trend[B, L, c_out]</span>
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4"></a><a href="#__codelineno-53-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5"></a><a href="#__codelineno-53-5"><span class="linenos" data-linenos=" 5 "></span></a>        <span class="c1"># è°ƒç”¨è§£ç å™¨å±‚çš„å‰å‘ä¼ æ’­æ–¹æ³•ï¼Œæ›´æ–°xå’Œæ®‹å·®è¶‹åŠ¿</span>
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6"></a><a href="#__codelineno-53-6"><span class="linenos" data-linenos=" 6 "></span></a>        <span class="c1"># x[B, L, d_model], cross[B, L, d_model] -&gt; DecoderLayer.forward -&gt; x[B, L, d_model], residual_trend[B, L, c_out]</span>
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7"></a><a href="#__codelineno-53-7"><span class="linenos" data-linenos=" 7 "></span></a>        <span class="n">x</span><span class="p">,</span> <span class="n">residual_trend</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cross</span><span class="p">,</span> <span class="n">x_mask</span><span class="o">=</span><span class="n">x_mask</span><span class="p">,</span> <span class="n">cross_mask</span><span class="o">=</span><span class="n">cross_mask</span><span class="p">)</span>
</span><span id="__span-53-8"><a id="__codelineno-53-8" name="__codelineno-53-8"></a><a href="#__codelineno-53-8"><span class="linenos" data-linenos=" 8 "></span></a>        <span class="c1"># æ›´æ–°è¶‹åŠ¿ä¿¡æ¯ï¼Œå°†æ®‹å·®è¶‹åŠ¿æ·»åŠ åˆ°å½“å‰è¶‹åŠ¿</span>
</span><span id="__span-53-9"><a id="__codelineno-53-9" name="__codelineno-53-9"></a><a href="#__codelineno-53-9"><span class="linenos" data-linenos=" 9 "></span></a>        <span class="c1"># trend[B, L, c_out] + residual_trend[B, L, c_out] -&gt; trend[B, L, c_out]</span>
</span><span id="__span-53-10"><a id="__codelineno-53-10" name="__codelineno-53-10"></a><a href="#__codelineno-53-10"><span class="linenos" data-linenos="10 "></span></a>        <span class="n">trend</span> <span class="o">=</span> <span class="n">trend</span> <span class="o">+</span> <span class="n">residual_trend</span>
</span><span id="__span-53-11"><a id="__codelineno-53-11" name="__codelineno-53-11"></a><a href="#__codelineno-53-11"><span class="linenos" data-linenos="11 "></span></a>
</span><span id="__span-53-12"><a id="__codelineno-53-12" name="__codelineno-53-12"></a><a href="#__codelineno-53-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="c1"># å¦‚æœå­˜åœ¨å½’ä¸€åŒ–å±‚ï¼Œåˆ™å¯¹è¾“å‡ºè¿›è¡Œå½’ä¸€åŒ–å¤„ç†</span>
</span><span id="__span-53-13"><a id="__codelineno-53-13" name="__codelineno-53-13"></a><a href="#__codelineno-53-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="c1"># x[B, L, d_model] -&gt; LayerNorm -&gt; x[B, L, d_model]</span>
</span><span id="__span-53-14"><a id="__codelineno-53-14" name="__codelineno-53-14"></a><a href="#__codelineno-53-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-53-15"><a id="__codelineno-53-15" name="__codelineno-53-15"></a><a href="#__codelineno-53-15"><span class="linenos" data-linenos="15 "></span></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-53-16"><a id="__codelineno-53-16" name="__codelineno-53-16"></a><a href="#__codelineno-53-16"><span class="linenos" data-linenos="16 "></span></a>
</span><span id="__span-53-17"><a id="__codelineno-53-17" name="__codelineno-53-17"></a><a href="#__codelineno-53-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="c1"># å¦‚æœå­˜åœ¨æŠ•å½±å±‚ï¼Œåˆ™å¯¹è¾“å‡ºè¿›è¡ŒæŠ•å½±å¤„ç†</span>
</span><span id="__span-53-18"><a id="__codelineno-53-18" name="__codelineno-53-18"></a><a href="#__codelineno-53-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="c1"># x[B, L, d_model] -&gt; Linear -&gt; x[B, L, c_out]</span>
</span><span id="__span-53-19"><a id="__codelineno-53-19" name="__codelineno-53-19"></a><a href="#__codelineno-53-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-53-20"><a id="__codelineno-53-20" name="__codelineno-53-20"></a><a href="#__codelineno-53-20"><span class="linenos" data-linenos="20 "></span></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></code></pre></div>
<p>for å¾ªç¯æ˜¯ä¸ºå¾ªç¯ DecoderLayerï¼ŒDecoderLayer æ‰§è¡Œå®Œäº†ï¼Œå°±æ˜¯æœ€åçš„å¤„ç†äº†ã€‚</p>
</blockquote>
<h4 id="_14">æ•°æ®æµåŠ¨å›¾<a class="headerlink" href="#_14" title="Permanent link">Â¶</a></h4>
<blockquote>
<p>â‘¢ è¶‹åŠ¿æˆåˆ† åœ¨æ¯æ¬¡ DecoderLayer  forward çš„æœ€åå°±ä¼šè¿›è¡Œè¿˜åŸç»´åº¦</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250322100529812.png"><img alt="image-20250322100529812" src="../images/image-20250322100529812.png"></a></p>
<p><strong>ç”»å›¾ç›´è§‚ç†è§£ Decoder å’Œ DecoderLayer ä¸­å…³äºå­£èŠ‚æˆåˆ†å’Œè¶‹åŠ¿æˆåˆ†çš„ç†è§£</strong></p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1"></a><a href="#__codelineno-54-1"><span class="linenos" data-linenos="  1 "></span></a><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2"></a><a href="#__codelineno-54-2"><span class="linenos" data-linenos="  2 "></span></a><span class="err">â”‚</span>                         <span class="n">Decoder</span><span class="o">.</span><span class="n">forward</span>                              <span class="err">â”‚</span>
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3"></a><a href="#__codelineno-54-3"><span class="linenos" data-linenos="  3 "></span></a><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4"></a><a href="#__codelineno-54-4"><span class="linenos" data-linenos="  4 "></span></a>                                 <span class="err">â†“</span>
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5"></a><a href="#__codelineno-54-5"><span class="linenos" data-linenos="  5 "></span></a><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
</span><span id="__span-54-6"><a id="__codelineno-54-6" name="__codelineno-54-6"></a><a href="#__codelineno-54-6"><span class="linenos" data-linenos="  6 "></span></a><span class="err">â”‚</span>  <span class="n">è¾“å…¥</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">d_model</span><span class="p">],</span> <span class="n">cross</span><span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">d_model</span><span class="p">],</span> <span class="n">trend</span><span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">c_out</span><span class="p">],</span> <span class="n">masks</span>            <span class="err">â”‚</span>
</span><span id="__span-54-7"><a id="__codelineno-54-7" name="__codelineno-54-7"></a><a href="#__codelineno-54-7"><span class="linenos" data-linenos="  7 "></span></a><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</span><span id="__span-54-8"><a id="__codelineno-54-8" name="__codelineno-54-8"></a><a href="#__codelineno-54-8"><span class="linenos" data-linenos="  8 "></span></a>                                 <span class="err">â†“</span>
</span><span id="__span-54-9"><a id="__codelineno-54-9" name="__codelineno-54-9"></a><a href="#__codelineno-54-9"><span class="linenos" data-linenos="  9 "></span></a>
</span><span id="__span-54-10"><a id="__codelineno-54-10" name="__codelineno-54-10"></a><a href="#__codelineno-54-10"><span class="linenos" data-linenos=" 10 "></span></a><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span> <span class="n">DecoderLayer</span> <span class="mi">1</span> <span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
</span><span id="__span-54-11"><a id="__codelineno-54-11" name="__codelineno-54-11"></a><a href="#__codelineno-54-11"><span class="linenos" data-linenos=" 11 "></span></a><span class="err">â”‚</span>  <span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>                                                              <span class="err">â”‚</span>
</span><span id="__span-54-12"><a id="__codelineno-54-12" name="__codelineno-54-12"></a><a href="#__codelineno-54-12"><span class="linenos" data-linenos=" 12 "></span></a><span class="err">â”‚</span>  <span class="err">â”‚</span> <span class="n">è¾“å…¥åºåˆ—</span> <span class="n">x</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">d_model</span><span class="p">]</span> <span class="err">â”‚</span>                                                              <span class="err">â”‚</span>
</span><span id="__span-54-13"><a id="__codelineno-54-13" name="__codelineno-54-13"></a><a href="#__codelineno-54-13"><span class="linenos" data-linenos=" 13 "></span></a><span class="err">â”‚</span>  <span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>                                                              <span class="err">â”‚</span>
</span><span id="__span-54-14"><a id="__codelineno-54-14" name="__codelineno-54-14"></a><a href="#__codelineno-54-14"><span class="linenos" data-linenos=" 14 "></span></a><span class="err">â”‚</span>                 <span class="err">â†“</span>                                                                         <span class="err">â”‚</span>
</span><span id="__span-54-15"><a id="__codelineno-54-15" name="__codelineno-54-15"></a><a href="#__codelineno-54-15"><span class="linenos" data-linenos=" 15 "></span></a><span class="err">â”‚</span>  <span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>                                                              <span class="err">â”‚</span>
</span><span id="__span-54-16"><a id="__codelineno-54-16" name="__codelineno-54-16"></a><a href="#__codelineno-54-16"><span class="linenos" data-linenos=" 16 "></span></a><span class="err">â”‚</span>  <span class="err">â”‚</span>   <span class="n">è‡ªæ³¨æ„åŠ›</span> <span class="o">+</span> <span class="n">æ®‹å·®è¿æ¥</span>     <span class="err">â”‚</span>    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">dropout</span><span class="p">(</span><span class="n">self_attention</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">))</span>                    <span class="err">â”‚</span>
</span><span id="__span-54-17"><a id="__codelineno-54-17" name="__codelineno-54-17"></a><a href="#__codelineno-54-17"><span class="linenos" data-linenos=" 17 "></span></a><span class="err">â”‚</span>  <span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>                                                              <span class="err">â”‚</span>
</span><span id="__span-54-18"><a id="__codelineno-54-18" name="__codelineno-54-18"></a><a href="#__codelineno-54-18"><span class="linenos" data-linenos=" 18 "></span></a><span class="err">â”‚</span>                 <span class="err">â†“</span>                                                                         <span class="err">â”‚</span>
</span><span id="__span-54-19"><a id="__codelineno-54-19" name="__codelineno-54-19"></a><a href="#__codelineno-54-19"><span class="linenos" data-linenos=" 19 "></span></a><span class="err">â”‚</span>  <span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>                                                              <span class="err">â”‚</span>
</span><span id="__span-54-20"><a id="__codelineno-54-20" name="__codelineno-54-20"></a><a href="#__codelineno-54-20"><span class="linenos" data-linenos=" 20 "></span></a><span class="err">â”‚</span>  <span class="err">â”‚</span>       <span class="n">åºåˆ—åˆ†è§£</span> <span class="mi">1</span>         <span class="err">â”‚</span>    <span class="n">x</span><span class="p">,</span> <span class="n">trend1</span> <span class="o">=</span> <span class="n">decomp1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>                                    <span class="err">â”‚</span>
</span><span id="__span-54-21"><a id="__codelineno-54-21" name="__codelineno-54-21"></a><a href="#__codelineno-54-21"><span class="linenos" data-linenos=" 21 "></span></a><span class="err">â”‚</span>  <span class="err">â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>                                                              <span class="err">â”‚</span>
</span><span id="__span-54-22"><a id="__codelineno-54-22" name="__codelineno-54-22"></a><a href="#__codelineno-54-22"><span class="linenos" data-linenos=" 22 "></span></a><span class="err">â”‚</span>         <span class="err">â”‚</span>                  <span class="err">â†˜</span>                                                              <span class="err">â”‚</span>
</span><span id="__span-54-23"><a id="__codelineno-54-23" name="__codelineno-54-23"></a><a href="#__codelineno-54-23"><span class="linenos" data-linenos=" 23 "></span></a><span class="err">â”‚</span>         <span class="err">â”‚</span>                   <span class="n">trend1</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">d_model</span><span class="p">]</span> <span class="err">â†’</span> <span class="n">ä¿å­˜</span>                                    <span class="err">â”‚</span>
</span><span id="__span-54-24"><a id="__codelineno-54-24" name="__codelineno-54-24"></a><a href="#__codelineno-54-24"><span class="linenos" data-linenos=" 24 "></span></a><span class="err">â”‚</span>         <span class="err">â†“</span>                                                                                 <span class="err">â”‚</span>
</span><span id="__span-54-25"><a id="__codelineno-54-25" name="__codelineno-54-25"></a><a href="#__codelineno-54-25"><span class="linenos" data-linenos=" 25 "></span></a><span class="err">â”‚</span>  <span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>                                                              <span class="err">â”‚</span>
</span><span id="__span-54-26"><a id="__codelineno-54-26" name="__codelineno-54-26"></a><a href="#__codelineno-54-26"><span class="linenos" data-linenos=" 26 "></span></a><span class="err">â”‚</span>  <span class="err">â”‚</span> <span class="n">äº¤å‰æ³¨æ„åŠ›</span><span class="p">(</span><span class="n">ç¼–ç å™¨è¾“å‡º</span><span class="p">)</span>     <span class="err">â”‚</span>    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">dropout</span><span class="p">(</span><span class="n">cross_attention</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">cross</span><span class="p">,</span><span class="n">cross</span><span class="p">))</span>          <span class="err">â”‚</span>
</span><span id="__span-54-27"><a id="__codelineno-54-27" name="__codelineno-54-27"></a><a href="#__codelineno-54-27"><span class="linenos" data-linenos=" 27 "></span></a><span class="err">â”‚</span>  <span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>                                                              <span class="err">â”‚</span>
</span><span id="__span-54-28"><a id="__codelineno-54-28" name="__codelineno-54-28"></a><a href="#__codelineno-54-28"><span class="linenos" data-linenos=" 28 "></span></a><span class="err">â”‚</span>                 <span class="err">â†“</span>                                                                         <span class="err">â”‚</span>
</span><span id="__span-54-29"><a id="__codelineno-54-29" name="__codelineno-54-29"></a><a href="#__codelineno-54-29"><span class="linenos" data-linenos=" 29 "></span></a><span class="err">â”‚</span>  <span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>                                                              <span class="err">â”‚</span>
</span><span id="__span-54-30"><a id="__codelineno-54-30" name="__codelineno-54-30"></a><a href="#__codelineno-54-30"><span class="linenos" data-linenos=" 30 "></span></a><span class="err">â”‚</span>  <span class="err">â”‚</span>       <span class="n">åºåˆ—åˆ†è§£</span> <span class="mi">2</span>         <span class="err">â”‚</span>    <span class="n">x</span><span class="p">,</span> <span class="n">trend2</span> <span class="o">=</span> <span class="n">decomp2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>                                    <span class="err">â”‚</span>
</span><span id="__span-54-31"><a id="__codelineno-54-31" name="__codelineno-54-31"></a><a href="#__codelineno-54-31"><span class="linenos" data-linenos=" 31 "></span></a><span class="err">â”‚</span>  <span class="err">â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>                                                              <span class="err">â”‚</span>
</span><span id="__span-54-32"><a id="__codelineno-54-32" name="__codelineno-54-32"></a><a href="#__codelineno-54-32"><span class="linenos" data-linenos=" 32 "></span></a><span class="err">â”‚</span>         <span class="err">â”‚</span>                  <span class="err">â†˜</span>                                                              <span class="err">â”‚</span>
</span><span id="__span-54-33"><a id="__codelineno-54-33" name="__codelineno-54-33"></a><a href="#__codelineno-54-33"><span class="linenos" data-linenos=" 33 "></span></a><span class="err">â”‚</span>         <span class="err">â”‚</span>                   <span class="n">trend2</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">d_model</span><span class="p">]</span> <span class="err">â†’</span> <span class="n">ä¿å­˜</span>                                    <span class="err">â”‚</span>
</span><span id="__span-54-34"><a id="__codelineno-54-34" name="__codelineno-54-34"></a><a href="#__codelineno-54-34"><span class="linenos" data-linenos=" 34 "></span></a><span class="err">â”‚</span>         <span class="err">â†“</span>                                                                                 <span class="err">â”‚</span>
</span><span id="__span-54-35"><a id="__codelineno-54-35" name="__codelineno-54-35"></a><a href="#__codelineno-54-35"><span class="linenos" data-linenos=" 35 "></span></a><span class="err">â”‚</span>  <span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>                                                              <span class="err">â”‚</span>
</span><span id="__span-54-36"><a id="__codelineno-54-36" name="__codelineno-54-36"></a><a href="#__codelineno-54-36"><span class="linenos" data-linenos=" 36 "></span></a><span class="err">â”‚</span>  <span class="err">â”‚</span>        <span class="n">å‰é¦ˆç½‘ç»œ</span>          <span class="err">â”‚</span>                                                              <span class="err">â”‚</span>
</span><span id="__span-54-37"><a id="__codelineno-54-37" name="__codelineno-54-37"></a><a href="#__codelineno-54-37"><span class="linenos" data-linenos=" 37 "></span></a><span class="err">â”‚</span>  <span class="err">â”‚</span>  <span class="n">y</span><span class="o">=</span><span class="n">x</span> <span class="p">(</span><span class="n">å¤åˆ¶æ“ä½œ</span><span class="p">)</span>          <span class="err">â”‚</span>                                                              <span class="err">â”‚</span>
</span><span id="__span-54-38"><a id="__codelineno-54-38" name="__codelineno-54-38"></a><a href="#__codelineno-54-38"><span class="linenos" data-linenos=" 38 "></span></a><span class="err">â”‚</span>  <span class="err">â”‚</span>  <span class="n">å·ç§¯1</span> <span class="o">+</span> <span class="n">æ¿€æ´»</span> <span class="o">+</span> <span class="n">Dropout</span>  <span class="err">â”‚</span>    <span class="n">y</span> <span class="o">=</span> <span class="n">dropout</span><span class="p">(</span><span class="n">activation</span><span class="p">(</span><span class="n">conv1</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">transpose</span><span class="p">)))</span>              <span class="err">â”‚</span>
</span><span id="__span-54-39"><a id="__codelineno-54-39" name="__codelineno-54-39"></a><a href="#__codelineno-54-39"><span class="linenos" data-linenos=" 39 "></span></a><span class="err">â”‚</span>  <span class="err">â”‚</span>  <span class="n">å·ç§¯2</span> <span class="o">+</span> <span class="n">Dropout</span>        <span class="err">â”‚</span>    <span class="n">y</span> <span class="o">=</span> <span class="n">dropout</span><span class="p">(</span><span class="n">conv2</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">)</span>                          <span class="err">â”‚</span>
</span><span id="__span-54-40"><a id="__codelineno-54-40" name="__codelineno-54-40"></a><a href="#__codelineno-54-40"><span class="linenos" data-linenos=" 40 "></span></a><span class="err">â”‚</span>  <span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>                                                              <span class="err">â”‚</span>
</span><span id="__span-54-41"><a id="__codelineno-54-41" name="__codelineno-54-41"></a><a href="#__codelineno-54-41"><span class="linenos" data-linenos=" 41 "></span></a><span class="err">â”‚</span>                 <span class="err">â†“</span>                                                                         <span class="err">â”‚</span>
</span><span id="__span-54-42"><a id="__codelineno-54-42" name="__codelineno-54-42"></a><a href="#__codelineno-54-42"><span class="linenos" data-linenos=" 42 "></span></a><span class="err">â”‚</span>  <span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>                                                              <span class="err">â”‚</span>
</span><span id="__span-54-43"><a id="__codelineno-54-43" name="__codelineno-54-43"></a><a href="#__codelineno-54-43"><span class="linenos" data-linenos=" 43 "></span></a><span class="err">â”‚</span>  <span class="err">â”‚</span> <span class="n">æ®‹å·®è¿æ¥</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>         <span class="err">â”‚</span>                                                              <span class="err">â”‚</span>
</span><span id="__span-54-44"><a id="__codelineno-54-44" name="__codelineno-54-44"></a><a href="#__codelineno-54-44"><span class="linenos" data-linenos=" 44 "></span></a><span class="err">â”‚</span>  <span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>                                                              <span class="err">â”‚</span>
</span><span id="__span-54-45"><a id="__codelineno-54-45" name="__codelineno-54-45"></a><a href="#__codelineno-54-45"><span class="linenos" data-linenos=" 45 "></span></a><span class="err">â”‚</span>                 <span class="err">â†“</span>                                                                         <span class="err">â”‚</span>
</span><span id="__span-54-46"><a id="__codelineno-54-46" name="__codelineno-54-46"></a><a href="#__codelineno-54-46"><span class="linenos" data-linenos=" 46 "></span></a><span class="err">â”‚</span>  <span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>                                                              <span class="err">â”‚</span>
</span><span id="__span-54-47"><a id="__codelineno-54-47" name="__codelineno-54-47"></a><a href="#__codelineno-54-47"><span class="linenos" data-linenos=" 47 "></span></a><span class="err">â”‚</span>  <span class="err">â”‚</span>       <span class="n">åºåˆ—åˆ†è§£</span> <span class="mi">3</span>         <span class="err">â”‚</span>    <span class="n">x</span><span class="p">,</span> <span class="n">trend3</span> <span class="o">=</span> <span class="n">decomp3</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>                                <span class="err">â”‚</span>
</span><span id="__span-54-48"><a id="__codelineno-54-48" name="__codelineno-54-48"></a><a href="#__codelineno-54-48"><span class="linenos" data-linenos=" 48 "></span></a><span class="err">â”‚</span>  <span class="err">â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>                                                              <span class="err">â”‚</span>
</span><span id="__span-54-49"><a id="__codelineno-54-49" name="__codelineno-54-49"></a><a href="#__codelineno-54-49"><span class="linenos" data-linenos=" 49 "></span></a><span class="err">â”‚</span>         <span class="err">â”‚</span>                  <span class="err">â†˜</span>                                                              <span class="err">â”‚</span>
</span><span id="__span-54-50"><a id="__codelineno-54-50" name="__codelineno-54-50"></a><a href="#__codelineno-54-50"><span class="linenos" data-linenos=" 50 "></span></a><span class="err">â”‚</span>         <span class="err">â”‚</span>                   <span class="n">trend3</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">d_model</span><span class="p">]</span> <span class="err">â†’</span> <span class="n">ä¿å­˜</span>                                    <span class="err">â”‚</span>
</span><span id="__span-54-51"><a id="__codelineno-54-51" name="__codelineno-54-51"></a><a href="#__codelineno-54-51"><span class="linenos" data-linenos=" 51 "></span></a><span class="err">â”‚</span>         <span class="err">â”‚</span>                                                                                 <span class="err">â”‚</span>
</span><span id="__span-54-52"><a id="__codelineno-54-52" name="__codelineno-54-52"></a><a href="#__codelineno-54-52"><span class="linenos" data-linenos=" 52 "></span></a><span class="err">â”‚</span>         <span class="err">â”‚</span>    <span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>                                      <span class="err">â”‚</span>
</span><span id="__span-54-53"><a id="__codelineno-54-53" name="__codelineno-54-53"></a><a href="#__codelineno-54-53"><span class="linenos" data-linenos=" 53 "></span></a><span class="err">â”‚</span>         <span class="err">â”‚</span>    <span class="err">â”‚</span> <span class="n">ç´¯åŠ è¶‹åŠ¿</span><span class="p">:</span> <span class="n">trend1</span> <span class="o">+</span> <span class="n">trend2</span> <span class="o">+</span> <span class="n">trend3</span>   <span class="err">â”‚</span>     <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">d_model</span><span class="p">]</span>                    <span class="err">â”‚</span>
</span><span id="__span-54-54"><a id="__codelineno-54-54" name="__codelineno-54-54"></a><a href="#__codelineno-54-54"><span class="linenos" data-linenos=" 54 "></span></a><span class="err">â”‚</span>         <span class="err">â”‚</span>    <span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>                                      <span class="err">â”‚</span>
</span><span id="__span-54-55"><a id="__codelineno-54-55" name="__codelineno-54-55"></a><a href="#__codelineno-54-55"><span class="linenos" data-linenos=" 55 "></span></a><span class="err">â”‚</span>         <span class="err">â”‚</span>                    <span class="err">â†“</span>                                                            <span class="err">â”‚</span>
</span><span id="__span-54-56"><a id="__codelineno-54-56" name="__codelineno-54-56"></a><a href="#__codelineno-54-56"><span class="linenos" data-linenos=" 56 "></span></a><span class="err">â”‚</span>         <span class="err">â”‚</span>    <span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>                                      <span class="err">â”‚</span>
</span><span id="__span-54-57"><a id="__codelineno-54-57" name="__codelineno-54-57"></a><a href="#__codelineno-54-57"><span class="linenos" data-linenos=" 57 "></span></a><span class="err">â”‚</span>         <span class="err">â”‚</span>    <span class="err">â”‚</span> <span class="n">è¶‹åŠ¿æŠ•å½±</span><span class="p">:</span> <span class="n">å·ç§¯</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>    <span class="err">â”‚</span>     <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">d_model</span><span class="p">]</span> <span class="err">â†’</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">c_out</span><span class="p">]</span>      <span class="err">â”‚</span>
</span><span id="__span-54-58"><a id="__codelineno-54-58" name="__codelineno-54-58"></a><a href="#__codelineno-54-58"><span class="linenos" data-linenos=" 58 "></span></a><span class="err">â”‚</span>         <span class="err">â”‚</span>    <span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>                                      <span class="err">â”‚</span>
</span><span id="__span-54-59"><a id="__codelineno-54-59" name="__codelineno-54-59"></a><a href="#__codelineno-54-59"><span class="linenos" data-linenos=" 59 "></span></a><span class="err">â”‚</span>         <span class="err">â”‚</span>                    <span class="err">â†“</span>                                                            <span class="err">â”‚</span>
</span><span id="__span-54-60"><a id="__codelineno-54-60" name="__codelineno-54-60"></a><a href="#__codelineno-54-60"><span class="linenos" data-linenos=" 60 "></span></a><span class="err">â”‚</span>  <span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”</span>    <span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>                                                <span class="err">â”‚</span>
</span><span id="__span-54-61"><a id="__codelineno-54-61" name="__codelineno-54-61"></a><a href="#__codelineno-54-61"><span class="linenos" data-linenos=" 61 "></span></a><span class="err">â”‚</span>  <span class="err">â”‚</span> <span class="n">å­£èŠ‚æ€§è¾“å‡º</span> <span class="n">x</span>   <span class="err">â”‚</span>    <span class="err">â”‚</span> <span class="n">è¶‹åŠ¿è¾“å‡º</span> <span class="n">residual_trend</span> <span class="err">â”‚</span>                                         <span class="err">â”‚</span>
</span><span id="__span-54-62"><a id="__codelineno-54-62" name="__codelineno-54-62"></a><a href="#__codelineno-54-62"><span class="linenos" data-linenos=" 62 "></span></a><span class="err">â”‚</span>  <span class="err">â”‚</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">d_model</span><span class="p">]</span> <span class="err">â”‚</span>    <span class="err">â”‚</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">c_out</span><span class="p">]</span>       <span class="err">â”‚</span>                                                <span class="err">â”‚</span>
</span><span id="__span-54-63"><a id="__codelineno-54-63" name="__codelineno-54-63"></a><a href="#__codelineno-54-63"><span class="linenos" data-linenos=" 63 "></span></a><span class="err">â”‚</span>  <span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜</span>    <span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>                                                <span class="err">â”‚</span>
</span><span id="__span-54-64"><a id="__codelineno-54-64" name="__codelineno-54-64"></a><a href="#__codelineno-54-64"><span class="linenos" data-linenos=" 64 "></span></a><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</span><span id="__span-54-65"><a id="__codelineno-54-65" name="__codelineno-54-65"></a><a href="#__codelineno-54-65"><span class="linenos" data-linenos=" 65 "></span></a>           <span class="err">â”‚</span>                     <span class="err">â†“</span>
</span><span id="__span-54-66"><a id="__codelineno-54-66" name="__codelineno-54-66"></a><a href="#__codelineno-54-66"><span class="linenos" data-linenos=" 66 "></span></a>           <span class="err">â”‚</span>             <span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
</span><span id="__span-54-67"><a id="__codelineno-54-67" name="__codelineno-54-67"></a><a href="#__codelineno-54-67"><span class="linenos" data-linenos=" 67 "></span></a>           <span class="err">â”‚</span>             <span class="err">â”‚</span> <span class="n">Decoderä¸­ç´¯ç§¯è¶‹åŠ¿</span>   <span class="err">â”‚</span>     <span class="n">trend</span> <span class="o">+=</span> <span class="n">residual_trend</span>
</span><span id="__span-54-68"><a id="__codelineno-54-68" name="__codelineno-54-68"></a><a href="#__codelineno-54-68"><span class="linenos" data-linenos=" 68 "></span></a>           <span class="err">â”‚</span>             <span class="err">â”‚</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">c_out</span><span class="p">]</span>        <span class="err">â”‚</span>     <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">c_out</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">c_out</span><span class="p">]</span>
</span><span id="__span-54-69"><a id="__codelineno-54-69" name="__codelineno-54-69"></a><a href="#__codelineno-54-69"><span class="linenos" data-linenos=" 69 "></span></a>           <span class="err">â”‚</span>             <span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</span><span id="__span-54-70"><a id="__codelineno-54-70" name="__codelineno-54-70"></a><a href="#__codelineno-54-70"><span class="linenos" data-linenos=" 70 "></span></a>           <span class="err">â†“</span>                       <span class="err">â†“</span>
</span><span id="__span-54-71"><a id="__codelineno-54-71" name="__codelineno-54-71"></a><a href="#__codelineno-54-71"><span class="linenos" data-linenos=" 71 "></span></a><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>    <span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
</span><span id="__span-54-72"><a id="__codelineno-54-72" name="__codelineno-54-72"></a><a href="#__codelineno-54-72"><span class="linenos" data-linenos=" 72 "></span></a><span class="err">â”‚</span>  <span class="n">xä¼ å…¥ä¸‹ä¸€å±‚</span>        <span class="err">â”‚</span>    <span class="err">â”‚</span>  <span class="n">trendä¼ å…¥ä¸‹ä¸€å±‚</span>    <span class="err">â”‚</span>
</span><span id="__span-54-73"><a id="__codelineno-54-73" name="__codelineno-54-73"></a><a href="#__codelineno-54-73"><span class="linenos" data-linenos=" 73 "></span></a><span class="err">â”‚</span>  <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">d_model</span><span class="p">]</span>     <span class="err">â”‚</span>    <span class="err">â”‚</span>  <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">c_out</span><span class="p">]</span>       <span class="err">â”‚</span>
</span><span id="__span-54-74"><a id="__codelineno-54-74" name="__codelineno-54-74"></a><a href="#__codelineno-54-74"><span class="linenos" data-linenos=" 74 "></span></a><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>    <span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</span><span id="__span-54-75"><a id="__codelineno-54-75" name="__codelineno-54-75"></a><a href="#__codelineno-54-75"><span class="linenos" data-linenos=" 75 "></span></a>         <span class="err">â†“</span>                           <span class="err">â†“</span>
</span><span id="__span-54-76"><a id="__codelineno-54-76" name="__codelineno-54-76"></a><a href="#__codelineno-54-76"><span class="linenos" data-linenos=" 76 "></span></a><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
</span><span id="__span-54-77"><a id="__codelineno-54-77" name="__codelineno-54-77"></a><a href="#__codelineno-54-77"><span class="linenos" data-linenos=" 77 "></span></a><span class="err">â”‚</span>                         <span class="n">DecoderLayer</span> <span class="mi">2</span>                             <span class="err">â”‚</span>
</span><span id="__span-54-78"><a id="__codelineno-54-78" name="__codelineno-54-78"></a><a href="#__codelineno-54-78"><span class="linenos" data-linenos=" 78 "></span></a><span class="err">â”‚</span>                          <span class="p">(</span><span class="n">é‡å¤æµç¨‹</span><span class="p">)</span>                                 <span class="err">â”‚</span>
</span><span id="__span-54-79"><a id="__codelineno-54-79" name="__codelineno-54-79"></a><a href="#__codelineno-54-79"><span class="linenos" data-linenos=" 79 "></span></a><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</span><span id="__span-54-80"><a id="__codelineno-54-80" name="__codelineno-54-80"></a><a href="#__codelineno-54-80"><span class="linenos" data-linenos=" 80 "></span></a>         <span class="err">â†“</span>                                   <span class="err">â†“</span>
</span><span id="__span-54-81"><a id="__codelineno-54-81" name="__codelineno-54-81"></a><a href="#__codelineno-54-81"><span class="linenos" data-linenos=" 81 "></span></a>         <span class="o">.</span>                                   <span class="o">.</span>
</span><span id="__span-54-82"><a id="__codelineno-54-82" name="__codelineno-54-82"></a><a href="#__codelineno-54-82"><span class="linenos" data-linenos=" 82 "></span></a>         <span class="o">.</span>                                   <span class="o">.</span>
</span><span id="__span-54-83"><a id="__codelineno-54-83" name="__codelineno-54-83"></a><a href="#__codelineno-54-83"><span class="linenos" data-linenos=" 83 "></span></a>         <span class="err">â†“</span>                                   <span class="err">â†“</span>
</span><span id="__span-54-84"><a id="__codelineno-54-84" name="__codelineno-54-84"></a><a href="#__codelineno-54-84"><span class="linenos" data-linenos=" 84 "></span></a><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
</span><span id="__span-54-85"><a id="__codelineno-54-85" name="__codelineno-54-85"></a><a href="#__codelineno-54-85"><span class="linenos" data-linenos=" 85 "></span></a><span class="err">â”‚</span>                         <span class="n">DecoderLayer</span> <span class="n">N</span>                             <span class="err">â”‚</span>
</span><span id="__span-54-86"><a id="__codelineno-54-86" name="__codelineno-54-86"></a><a href="#__codelineno-54-86"><span class="linenos" data-linenos=" 86 "></span></a><span class="err">â”‚</span>                          <span class="p">(</span><span class="n">é‡å¤æµç¨‹</span><span class="p">)</span>                                 <span class="err">â”‚</span>
</span><span id="__span-54-87"><a id="__codelineno-54-87" name="__codelineno-54-87"></a><a href="#__codelineno-54-87"><span class="linenos" data-linenos=" 87 "></span></a><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</span><span id="__span-54-88"><a id="__codelineno-54-88" name="__codelineno-54-88"></a><a href="#__codelineno-54-88"><span class="linenos" data-linenos=" 88 "></span></a>         <span class="err">â†“</span>                                   <span class="err">â†“</span>
</span><span id="__span-54-89"><a id="__codelineno-54-89" name="__codelineno-54-89"></a><a href="#__codelineno-54-89"><span class="linenos" data-linenos=" 89 "></span></a><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>             <span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
</span><span id="__span-54-90"><a id="__codelineno-54-90" name="__codelineno-54-90"></a><a href="#__codelineno-54-90"><span class="linenos" data-linenos=" 90 "></span></a><span class="err">â”‚</span>  <span class="n">æœ€ç»ˆå­£èŠ‚æ€§</span> <span class="n">x</span>       <span class="err">â”‚</span>             <span class="err">â”‚</span>  <span class="n">ç´¯ç§¯è¶‹åŠ¿</span> <span class="n">trend</span>     <span class="err">â”‚</span>
</span><span id="__span-54-91"><a id="__codelineno-54-91" name="__codelineno-54-91"></a><a href="#__codelineno-54-91"><span class="linenos" data-linenos=" 91 "></span></a><span class="err">â”‚</span>  <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">d_model</span><span class="p">]</span>     <span class="err">â”‚</span>             <span class="err">â”‚</span>  <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">c_out</span><span class="p">]</span>       <span class="err">â”‚</span>
</span><span id="__span-54-92"><a id="__codelineno-54-92" name="__codelineno-54-92"></a><a href="#__codelineno-54-92"><span class="linenos" data-linenos=" 92 "></span></a><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>             <span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</span><span id="__span-54-93"><a id="__codelineno-54-93" name="__codelineno-54-93"></a><a href="#__codelineno-54-93"><span class="linenos" data-linenos=" 93 "></span></a>         <span class="err">â†“</span>                                    <span class="err">â”‚</span>
</span><span id="__span-54-94"><a id="__codelineno-54-94" name="__codelineno-54-94"></a><a href="#__codelineno-54-94"><span class="linenos" data-linenos=" 94 "></span></a><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>                        <span class="err">â”‚</span>
</span><span id="__span-54-95"><a id="__codelineno-54-95" name="__codelineno-54-95"></a><a href="#__codelineno-54-95"><span class="linenos" data-linenos=" 95 "></span></a><span class="err">â”‚</span> <span class="n">å½’ä¸€åŒ–</span><span class="p">(</span><span class="n">å¦‚æœå­˜åœ¨</span><span class="p">)</span>    <span class="err">â”‚</span>                        <span class="err">â”‚</span>
</span><span id="__span-54-96"><a id="__codelineno-54-96" name="__codelineno-54-96"></a><a href="#__codelineno-54-96"><span class="linenos" data-linenos=" 96 "></span></a><span class="err">â”‚</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">d_model</span><span class="p">]</span>      <span class="err">â”‚</span>                        <span class="err">â”‚</span>
</span><span id="__span-54-97"><a id="__codelineno-54-97" name="__codelineno-54-97"></a><a href="#__codelineno-54-97"><span class="linenos" data-linenos=" 97 "></span></a><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>                        <span class="err">â”‚</span>
</span><span id="__span-54-98"><a id="__codelineno-54-98" name="__codelineno-54-98"></a><a href="#__codelineno-54-98"><span class="linenos" data-linenos=" 98 "></span></a>         <span class="err">â†“</span>                                    <span class="err">â”‚</span>
</span><span id="__span-54-99"><a id="__codelineno-54-99" name="__codelineno-54-99"></a><a href="#__codelineno-54-99"><span class="linenos" data-linenos=" 99 "></span></a><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>                        <span class="err">â”‚</span>
</span><span id="__span-54-100"><a id="__codelineno-54-100" name="__codelineno-54-100"></a><a href="#__codelineno-54-100"><span class="linenos" data-linenos="100 "></span></a><span class="err">â”‚</span> <span class="n">æŠ•å½±</span><span class="p">(</span><span class="n">å¦‚æœå­˜åœ¨</span><span class="p">)</span>      <span class="err">â”‚</span>     <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">d_model</span><span class="p">]</span> <span class="err">â†’</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">c_out</span><span class="p">]</span>
</span><span id="__span-54-101"><a id="__codelineno-54-101" name="__codelineno-54-101"></a><a href="#__codelineno-54-101"><span class="linenos" data-linenos="101 "></span></a><span class="err">â”‚</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">c_out</span><span class="p">]</span>        <span class="err">â”‚</span>                        <span class="err">â”‚</span>
</span><span id="__span-54-102"><a id="__codelineno-54-102" name="__codelineno-54-102"></a><a href="#__codelineno-54-102"><span class="linenos" data-linenos="102 "></span></a><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>                        <span class="err">â”‚</span>
</span><span id="__span-54-103"><a id="__codelineno-54-103" name="__codelineno-54-103"></a><a href="#__codelineno-54-103"><span class="linenos" data-linenos="103 "></span></a>         <span class="err">â†“</span>                                    <span class="err">â†“</span>
</span><span id="__span-54-104"><a id="__codelineno-54-104" name="__codelineno-54-104"></a><a href="#__codelineno-54-104"><span class="linenos" data-linenos="104 "></span></a><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>             <span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
</span><span id="__span-54-105"><a id="__codelineno-54-105" name="__codelineno-54-105"></a><a href="#__codelineno-54-105"><span class="linenos" data-linenos="105 "></span></a><span class="err">â”‚</span>  <span class="n">Decoderå­£èŠ‚æ€§è¾“å‡º</span>  <span class="err">â”‚</span>             <span class="err">â”‚</span>  <span class="n">Decoderè¶‹åŠ¿è¾“å‡º</span>   <span class="err">â”‚</span>
</span><span id="__span-54-106"><a id="__codelineno-54-106" name="__codelineno-54-106"></a><a href="#__codelineno-54-106"><span class="linenos" data-linenos="106 "></span></a><span class="err">â”‚</span>  <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">c_out</span><span class="p">]</span>       <span class="err">â”‚</span>             <span class="err">â”‚</span>  <span class="p">[</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">c_out</span><span class="p">]</span>       <span class="err">â”‚</span>
</span><span id="__span-54-107"><a id="__codelineno-54-107" name="__codelineno-54-107"></a><a href="#__codelineno-54-107"><span class="linenos" data-linenos="107 "></span></a><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>             <span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</span></code></pre></div>
<p><strong>ç¬¬äºŒä¸ª è¿˜åŸæ“ä½œ</strong></p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1"></a><a href="#__codelineno-55-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># è§£ç å™¨å±‚å†…çš„è¶‹åŠ¿æŠ•å½±ï¼ˆä½¿ç”¨å·ç§¯ï¼‰</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2"></a><a href="#__codelineno-55-2"><span class="linenos" data-linenos="2 "></span></a><span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv1d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="n">d_model</span><span class="p">,</span> <span class="n">out_channels</span><span class="o">=</span><span class="n">c_out</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> 
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3"></a><a href="#__codelineno-55-3"><span class="linenos" data-linenos="3 "></span></a>                           <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">padding_mode</span><span class="o">=</span><span class="s1">'circular'</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4"></a><a href="#__codelineno-55-4"><span class="linenos" data-linenos="4 "></span></a>
</span><span id="__span-55-5"><a id="__codelineno-55-5" name="__codelineno-55-5"></a><a href="#__codelineno-55-5"><span class="linenos" data-linenos="5 "></span></a><span class="c1"># Decoderç±»ä¸­çš„å­£èŠ‚æ€§æŠ•å½±ï¼ˆé€šå¸¸æ˜¯çº¿æ€§å±‚ï¼‰</span>
</span><span id="__span-55-6"><a id="__codelineno-55-6" name="__codelineno-55-6"></a><a href="#__codelineno-55-6"><span class="linenos" data-linenos="6 "></span></a><span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">d_model</span><span class="p">,</span> <span class="n">c_out</span><span class="p">)</span> <span class="k">if</span> <span class="n">projection</span> <span class="k">else</span> <span class="kc">None</span>
</span></code></pre></div>
<p>è¶‹åŠ¿ä½¿ç”¨å·ç§¯æŠ•å½±æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼šï¼ˆè¶‹åŠ¿çš„åˆå§‹åŒ–æœ¬æ¥ä½¿ç”¨çš„æ˜¯å¹³å‡æ± åŒ–ï¼Œè¿™é‡Œçš„ 1D å·ç§¯å°±ç›¸å½“äºå…¨è¿æ¥ï¼Œåªæ˜¯ä¸åŒçš„æ•°æ®ç»„ç»‡æ–¹å¼ï¼‰</p>
<ul>
<li>å¯ä»¥æ•è·å±€éƒ¨æ—¶é—´ä¾èµ–å…³ç³»ï¼ˆkernel_size=3ï¼‰</li>
<li>ä½¿ç”¨å¾ªç¯å¡«å……ï¼ˆcircular paddingï¼‰é€‚åˆå¤„ç†æ—¶é—´åºåˆ—çš„å‘¨æœŸæ€§</li>
<li>å¯ä»¥å¹³æ»‘å¤„ç†è¶‹åŠ¿å˜åŒ–ï¼Œå‡å°‘å™ªå£°</li>
</ul>
</blockquote>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></label> å•ä¸ª DecoderLayer è¿”å›çš„æ˜¯ çº¯å­£èŠ‚æ€§æˆåˆ† x[B,L,d_model] å’Œ è½¬æ¢åçš„è¶‹åŠ¿æˆåˆ† residual_trend[B,L,c_out]</li>
</ul>
<blockquote>
<p>ğŸŸ¢ <strong>å½¢çŠ¶å˜åŒ–ç†è§£ï¼š</strong></p>
<p><strong>ğŸ”µ å­£èŠ‚æ€§æˆåˆ†:</strong></p>
<p>â–¶ï¸ <strong>DecoderLayerå†…éƒ¨:</strong></p>
<ul>
<li>å§‹ç»ˆä¿æŒå½¢çŠ¶ [B,L,d_model]</li>
<li>ç»è¿‡å¤šä¸ªå­æ¨¡å—å¤„ç†(è‡ªæ³¨æ„åŠ›ã€äº¤å‰æ³¨æ„åŠ›ã€å‰é¦ˆç½‘ç»œ)ï¼Œä½†ç»´åº¦ä¸å˜</li>
<li>è¾“å‡ºåˆ°Decoderæ—¶ä»ä¸º [B,L,d_model]</li>
</ul>
<p><strong>â–¶ï¸ Decoderæœ€ç»ˆå¤„ç†:</strong> </p>
<ul>
<li>é€šè¿‡æ‰€æœ‰DecoderLayeråä»ä¸º [B,L,d_model]</li>
<li>ç»è¿‡å¯é€‰çš„å½’ä¸€åŒ–å±‚ï¼Œç»´åº¦ä¸å˜</li>
<li>ç»è¿‡å¯é€‰çš„æŠ•å½±å±‚åï¼Œå˜ä¸º [B,L,c_out]</li>
</ul>
<p>ğŸ”µ <strong>è¶‹åŠ¿æˆåˆ†:</strong></p>
<p>â–¶ï¸ <strong>DecoderLayerå†…éƒ¨è¶‹åŠ¿æå–:</strong></p>
<p>ä¸‰ä¸ªè¶‹åŠ¿åˆ†é‡(trend1/2/3)éƒ½æ˜¯ [B,L,d_model]</p>
<p>ä¸‰ä¸ªè¶‹åŠ¿ç´¯åŠ åä»ä¸º [B,L,d_model]</p>
<p>ç»è¿‡æŠ•å½±å±‚åï¼Œå˜ä¸º [B,L,c_out]</p>
<p>â–¶ï¸ <strong>Decoderä¸­çš„è¶‹åŠ¿ç´¯ç§¯:</strong></p>
<p>Decoderè¾“å…¥çš„åˆå§‹è¶‹åŠ¿trendä¸º [B,L,c_out]</p>
<p>æ¯ä¸ªDecoderLayerè¾“å‡ºçš„residual_trendä¸º [B,L,c_out]</p>
<p>ç´¯ç§¯åçš„è¶‹åŠ¿ç»´åº¦ä¿æŒ [B,L,c_out]</p>
<p><strong>ğŸŒˆå„å±‚é—´çš„æ•°æ®ä¼ é€’</strong> </p>
<p>ğŸ«§ <strong>å­£èŠ‚æ€§æˆåˆ†ä¼ é€’:</strong></p>
<p>å­£èŠ‚æ€§æˆåˆ†xåœ¨å„DecoderLayerä¹‹é—´ä¼ é€’</p>
<p>æ¯ä¸ªDecoderLayerå¤„ç†åçš„å­£èŠ‚æ€§æˆåˆ†ä½œä¸ºä¸‹ä¸€å±‚çš„è¾“å…¥</p>
<p>æœ€åä¸€å±‚çš„å­£èŠ‚æ€§æˆåˆ†è¾“å‡ºåç»è¿‡å½’ä¸€åŒ–å’ŒæŠ•å½±</p>
<p>ğŸ«§ <strong>è¶‹åŠ¿æˆåˆ†ä¼ é€’:</strong> </p>
<p>DecoderLayerå†…éƒ¨æå–çš„ä¸‰ä¸ªè¶‹åŠ¿æˆåˆ†åœ¨å±‚å†…ç´¯åŠ å’ŒæŠ•å½±</p>
<p>æ¯ä¸ªDecoderLayeræä¾›ä¸€ä¸ªè¶‹åŠ¿è´¡çŒ®residual_trend</p>
<p><mark>Decoderç»´æŠ¤ä¸€ä¸ªç´¯ç§¯è¶‹åŠ¿trendï¼Œå‚ç›´ç´¯ç§¯å„å±‚çš„è´¡çŒ®</mark></p>
<p>æœ€ç»ˆç´¯ç§¯åçš„è¶‹åŠ¿ä¸éœ€è¦é¢å¤–å¤„ç†ï¼Œç›´æ¥ä½œä¸ºè¾“å‡º</p>
<p>ğŸ‹ <strong>DecoderLayerçš„è¾“å…¥è¾“å‡º:</strong></p>
<p><strong>è¾“å…¥:</strong> å­£èŠ‚æ€§æˆåˆ†<code>x[B,L,d_model]</code>å’Œç¼–ç å™¨è¾“å‡º<code>cross[B,L,d_model]</code></p>
<p><strong>è¾“å‡º:</strong> å¤„ç†åçš„å­£èŠ‚æ€§æˆåˆ†<code>x[B,L,d_model]</code>å’Œè¶‹åŠ¿è´¡çŒ®<code>residual_trend[B,L,c_out]</code></p>
</blockquote>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></label> <a href="#ç¼–ç å™¨çš„è¾“å‡ºä½œä¸º K å’Œ Vï¼Œè§£ç å™¨çš„è¾“å…¥ä½œä¸º Q"><span id="è¿”å›ç¼–ç å™¨çš„è¾“å‡ºä½œä¸º K å’Œ Vï¼Œè§£ç å™¨çš„è¾“å…¥ä½œä¸º Q">ç¼–ç å™¨çš„è¾“å‡ºä½œä¸º K å’Œ Vï¼Œè§£ç å™¨çš„è¾“å…¥ä½œä¸º Q</span></a></li>
</ul>
<p>ç›®æ ‡åºåˆ—ç”ŸæˆæŸ¥è¯¢ï¼Œå¯¹ç…§æºåºåˆ—</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></label> å¯¹æ¯”ç¼–ç å™¨çš„è®¾è®¡</li>
</ul>
<blockquote>
<p>ä¸ç¼–ç å™¨çš„å…³é”®åŒºåˆ«</p>
<ul>
<li>è¶‹åŠ¿å¤„ç†æ–¹å¼: </li>
</ul>
<p>ç¼–ç å™¨: ä¸¢å¼ƒè¶‹åŠ¿æˆåˆ†ï¼Œåªä¿ç•™å­£èŠ‚æ€§</p>
<p>è§£ç å™¨: ä¿å­˜å¹¶ç´¯ç§¯è¶‹åŠ¿æˆåˆ†ï¼Œæœ€ç»ˆä¸å­£èŠ‚æ€§åˆ†å¼€è¾“å‡º</p>
<ul>
<li>åˆ†è§£æ¬¡æ•°:</li>
</ul>
<p>ç¼–ç å™¨: ä¸¤æ¬¡åˆ†è§£(æ³¨æ„åŠ›åå’Œå‰é¦ˆç½‘ç»œå)</p>
<p>è§£ç å™¨: ä¸‰æ¬¡åˆ†è§£(è‡ªæ³¨æ„åŠ›åã€äº¤å‰æ³¨æ„åŠ›åå’Œå‰é¦ˆç½‘ç»œå)</p>
<ul>
<li>è¶‹åŠ¿ç´¯ç§¯:</li>
</ul>
<p>ç¼–ç å™¨: æ— è¶‹åŠ¿ç´¯ç§¯</p>
<p>è§£ç å™¨: ä¸‰ä¸ªé˜¶æ®µçš„è¶‹åŠ¿ç›¸åŠ ï¼Œå½¢æˆå®Œæ•´è¶‹åŠ¿è¡¨ç¤º</p>
<ul>
<li>è¾“å‡ºç»´åº¦:</li>
</ul>
<p>ç¼–ç å™¨: è¾“å‡ºä¿æŒd_modelç»´åº¦</p>
<p>è§£ç å™¨: å¯¹è¶‹åŠ¿æˆåˆ†è¿›è¡ŒæŠ•å½±ï¼Œè°ƒæ•´ä¸ºc_outç»´åº¦
è¿™ç§è®¾è®¡ä½“ç°äº†Autoformerå¯¹æ—¶é—´åºåˆ—åˆ†è§£çš„ç²¾å¿ƒå¤„ç†ï¼Œé€šè¿‡åœ¨è§£ç å™¨ä¸­ç´¯ç§¯è¶‹åŠ¿ä¿¡æ¯ï¼Œç»“åˆç¼–ç å™¨æå–çš„å­£èŠ‚æ€§ç‰¹å¾ï¼Œæœ€ç»ˆèƒ½å¤Ÿå®ç°é«˜è´¨é‡çš„æ—¶é—´åºåˆ—é¢„æµ‹ã€‚</p>
</blockquote>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></label> é—®ï¼šä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡ï¼Ÿ</li>
</ul>
<blockquote>
<p>é—®é¢˜æè¿°ï¼š</p>
<p>è¶‹åŠ¿æˆåˆ†ï¼šåœ¨æ¯ä¸ªè§£ç å™¨å±‚å†…éƒ¨å°±è¿›è¡ŒæŠ•å½±ï¼Œå¹¶ä¸”å„å±‚çš„æŠ•å½±ç»“æœè¢«ç´¯ç§¯</p>
<p>å­£èŠ‚æ€§æˆåˆ†ï¼šä¿æŒåŸå§‹ç»´åº¦é€šè¿‡æ‰€æœ‰è§£ç å™¨å±‚ï¼Œåªåœ¨æœ€åè¿›è¡Œä¸€æ¬¡ç»Ÿä¸€æŠ•å½±</p>
</blockquote>
<p>æˆ‘çš„ç†è§£ï¼šå­£èŠ‚æ˜¯ä¸€ä¸ªé«˜é¢‘æˆåˆ†ï¼Œä¿æŒé«˜ç»´è¡¨ç¤ºèƒ½å¤Ÿæ›´å¥½çš„è¡¨ç¤ºç‰¹å¾ã€‚è¶‹åŠ¿æˆåˆ†æ˜¯ä¸€ä¸ªä½é¢‘æˆåˆ†ï¼Œä¸ç®¡æ˜¯å·ç§¯æˆ–è€…æ˜¯ DecoderLayer æœ€åçš„ conv éƒ½å¯ä»¥è¾¾åˆ°å¹³æ»‘å™ªå£°çš„ä½œç”¨ï¼Œä½¿å¾—ç½‘ç»œèƒ½å¤Ÿæ›´åŠ å…³æ³¨é•¿æœŸç¨³å®šçš„è¶‹åŠ¿</p>
<blockquote>
<p><strong>å¯¹å“¦~å¾—åˆ° gpt çš„è‚¯å®šã€‚okayï¼Œgoã€‚å®ƒçš„è¡¥å……ï¼š</strong> </p>
<p>Autoformerçš„è®¾è®¡ç†å¿µç¡®å®å›´ç»•ç€å¯¹æ—¶é—´åºåˆ—æ•°æ®ä¸­ä¸åŒé¢‘ç‡æˆåˆ†çš„å·®å¼‚åŒ–å¤„ç†</p>
<p><strong>ğŸ”µ å­£èŠ‚æ€§æˆåˆ†ï¼ˆé«˜é¢‘ï¼‰çš„å¤„ç†ç­–ç•¥</strong></p>
<p><strong>ä¿æŒé«˜ç»´è¡¨ç¤º</strong></p>
<ul>
<li>å­£èŠ‚æ€§æˆåˆ†åœ¨DecoderLayerä¸­å§‹ç»ˆä¿æŒd_modelç»´åº¦ï¼ˆé€šå¸¸è¾ƒé«˜ï¼‰</li>
<li>åªåœ¨Decoderçš„æœ€åé˜¶æ®µæ‰æŠ•å½±åˆ°c_outç»´åº¦</li>
<li>è¿™ç§è®¾è®¡å…è®¸æ¨¡å‹ä½¿ç”¨ä¸°å¯Œçš„ç‰¹å¾ç©ºé—´æ¥è¡¨è¾¾å¤æ‚çš„å‘¨æœŸæ€§æ¨¡å¼</li>
</ul>
<p><strong>æ³¨æ„åŠ›æœºåˆ¶çš„ä¼˜åŠ¿</strong></p>
<ul>
<li>è‡ªæ³¨æ„åŠ›å’Œäº¤å‰æ³¨æ„åŠ›ç‰¹åˆ«é€‚åˆæ•è·ä¸åŒæ—¶é—´ç‚¹ä¹‹é—´çš„å‘¨æœŸæ€§å…³ç³»</li>
<li>å­£èŠ‚æ€§æˆåˆ†ç»è¿‡å¤šæ¬¡æ³¨æ„åŠ›å¤„ç†ï¼Œå¯ä»¥è¯†åˆ«å¤æ‚çš„é‡å¤æ¨¡å¼</li>
</ul>
<p><strong>å¤šå±‚æ¸è¿›å¼å¤„ç†</strong> </p>
<ul>
<li>æ¯å±‚DecoderLayeréƒ½å¯¹å­£èŠ‚æ€§è¿›è¡Œè¿›ä¸€æ­¥ç²¾ç‚¼</li>
<li>é€šè¿‡å±‚å±‚ä¼ é€’ï¼Œå…è®¸æ¨¡å‹å­¦ä¹ åˆ°å±‚æ¬¡åŒ–çš„å­£èŠ‚æ¨¡å¼ï¼ˆå¦‚æ—¥å†…æ¨¡å¼ã€å‘¨å†…æ¨¡å¼ã€æœˆå†…æ¨¡å¼ï¼‰</li>
</ul>
<p>ğŸ”µ <strong>è¶‹åŠ¿æˆåˆ†ï¼ˆä½é¢‘ï¼‰çš„å¤„ç†ç­–ç•¥</strong></p>
<p><strong>æ—©æœŸé™ç»´å’Œå¹³æ»‘å¤„ç†</strong></p>
<ul>
<li>è¶‹åŠ¿æˆåˆ†åœ¨æ¯ä¸ªDecoderLayerå†…å°±é€šè¿‡å·ç§¯ï¼ˆkernel_size=3ï¼‰è¿›è¡ŒæŠ•å½±
  å·ç§¯çš„æœ¬è´¨æ˜¯ä¸€ç§å¹³æ»‘æ“ä½œï¼Œèƒ½å¤Ÿè¿‡æ»¤æ‰é«˜é¢‘å™ªå£°</li>
<li>å¾ªç¯å¡«å……ï¼ˆpadding_mode='circular'ï¼‰é€‚åˆå¤„ç†å‘¨æœŸæ€§æ—¶é—´åºåˆ—
  ç´¯ç§¯æœºåˆ¶çš„æ„ä¹‰</li>
</ul>
<p><strong>ä¸åŒå±‚æ•è·çš„è¶‹åŠ¿é€šè¿‡ç®€å•ç´¯åŠ çš„æ–¹å¼ç»„åˆ</strong></p>
<ul>
<li>è¶‹åŠ¿ä½¿ç”¨è¾ƒä½çš„ç»´åº¦ï¼ˆc_outï¼‰å°±è¶³ä»¥è¡¨è¾¾</li>
<li>è¶‹åŠ¿æœ¬è´¨ä¸Šæ˜¯ä½é¢‘ã€å¹³æ»‘çš„æˆåˆ†ï¼Œç‰¹å¾å¤æ‚åº¦ä½äºå­£èŠ‚æ€§</li>
</ul>
</blockquote>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></label> <a href="#è·³åˆ°ä¸ºä»€ä¹ˆå­£èŠ‚æˆåˆ†å’Œè¶‹åŠ¿æˆåˆ†">ä¸ºä»€ä¹ˆå­£èŠ‚æˆåˆ†å’Œè¶‹åŠ¿æˆåˆ†</a><a id="è¿”å›ä¸ºä»€ä¹ˆå­£èŠ‚æˆåˆ†å’Œè¶‹åŠ¿æˆåˆ†"></a>ï¼Œä¸€ä¸ªç”¨nn.Linearä¸€ä¸ªç”¨ nn.conv1Dï¼Ÿ</li>
</ul>
<p>è¡¥å……ï¼šè¶‹åŠ¿æˆåˆ†å·ç§¯æ—¶ç”¨åˆ°çš„<a href="#å¾ªç¯å¡«å……"><span id="è¿”å›å¾ªç¯å¡«å……">å¾ªç¯å¡«å……</span></a></p>
<p>è‡ªå·±çš„è¯ï¼škernel size=3ï¼Œå¹³æ»‘è¶‹åŠ¿ï¼Œè€ƒè™‘å±€éƒ¨ä¸Šä¸‹æ–‡ï¼Œè¿‡æ»¤å™ªå£°ï¼›ï¼ˆä¼šæœ‰ä¸€æ­¥å½¢çŠ¶å˜åŒ–ï¼Œä½†å› ä¸ºå·ç§¯æ ¸å‚æ•°å…±äº«ï¼Œå¯ä»¥è¯†åˆ«ç›¸åŒçš„å‘¨æœŸå˜åŒ–ï¼‰</p>
<p>å­£èŠ‚æˆåˆ†ä½¿ç”¨ nn.Linearï¼Œä¿ç•™é«˜é¢‘æˆåˆ†å’Œå¿«é€Ÿå˜åŒ–çš„éƒ¨åˆ†ã€‚</p>
<ul>
<li>å­£èŠ‚æ€§æˆåˆ†ï¼ˆé«˜é¢‘ã€å¤æ‚å˜åŒ–ï¼‰ï¼šä½¿ç”¨çº¿æ€§æŠ•å½±ä¿ç•™ç²¾ç»†ç»“æ„</li>
<li>è¶‹åŠ¿æˆåˆ†ï¼ˆä½é¢‘ã€å¹³æ»‘å˜åŒ–ï¼‰ï¼šä½¿ç”¨å·ç§¯æŠ•å½±å¼•å…¥å¹³æ»‘æ•ˆæœå’Œå±€éƒ¨ä¸Šä¸‹æ–‡</li>
</ul>
<p><strong>æœ€åçš„ä¸€ç‚¹å…³äºæŸ¥æ¼è¡¥ç¼º</strong></p>
<p>Decoder å¯¹åº”è®ºæ–‡ä¸­çš„è¿™é‡Œï¼š</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250322153705300.png"><img alt="image-20250322153705300" src="../images/image-20250322153705300.png"></a></p>
<p>å…¬å¼ä¸­ï¼Œ</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250322153735389.png"><img alt="image-20250322153735389" src="../images/image-20250322153735389.png"></a> </p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input checked="" disabled="" type="checkbox"><span class="task-list-indicator"></span></label> è¿™é‡Œçš„ <span class="arithmatex">\(\mathcal{W}_{l,}\)</span> æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</li>
</ul>
<p>é¦–å…ˆéœ€è¦æ˜ç¡®ï¼Œå„ä¸ªçš„å½¢çŠ¶</p>
<p><span class="arithmatex">\(\mathcal{T}_{de}^{l}ã€\mathcal{T}_{de}^{l-1} \in \mathbb{R}^{B \times L \times c_{out}}\)</span></p>
<p><span class="arithmatex">\(\mathcal{T}_{de}^{l,1} ã€\mathcal{T}_{de}^{l,2}ã€\mathcal{T}_{de}^{l,3}\in \mathbb{R}^{B \times L \times d_{model}}\)</span></p>
<p><strong>â†’</strong> <span class="arithmatex">\(\mathcal{W}_{l,1}ã€\mathcal{W}_{l,2}ã€\mathcal{W}_{l,3}\)</span> åˆ†åˆ«æ˜¯è°ƒæ•´ç»´åº¦æ‰€ç”¨åˆ°çš„å˜æ¢çŸ©é˜µ</p>
<h2 id="autoformer-forward_1">æ±‡æ€» Autoformer forward<a class="headerlink" href="#autoformer-forward_1" title="Permanent link">Â¶</a></h2>
<p>1</p>
<pre class="mermaid"><code>classDiagram
    class Model {
        +int seq_len
        +int label_len
        +int pred_len
        +bool output_attention
        +series_decomp decomp
        +DataEmbedding_wo_pos enc_embedding
        +DataEmbedding_wo_pos dec_embedding
        +Encoder encoder
        +Decoder decoder
        +forward(x_enc, x_mark_enc, x_dec, x_mark_dec, enc_self_mask, dec_self_mask, dec_enc_mask)
    }

    class series_decomp {
        +moving_avg moving_avg
        +forward(x) res, moving_mean
    }

    class moving_avg {
        +int kernel_size
        +AvgPool1d avg
        +forward(x)
    }

    class DataEmbedding_wo_pos {
        +TokenEmbedding value_embedding
        +PositionalEmbedding position_embedding
        +TemporalEmbedding or TimeFeatureEmbedding temporal_embedding  
        +Dropout dropout
        +forward(x, x_mark)
    }

    class TokenEmbedding {
        +Conv1d tokenConv
        +forward(x)
    }

    class TemporalEmbedding {
        +Embedding minute_embed
        +Embedding hour_embed
        +Embedding weekday_embed
        +Embedding day_embed
        +Embedding month_embed
        +forward(x)
    }

    class TimeFeatureEmbedding {
        +Linear embed
        +forward(x)
    }

    class Encoder {
        +List~EncoderLayer~ layers
        +my_Layernorm norm_layer
        +forward(x, attn_mask)
    }

    class EncoderLayer {
        +AutoCorrelationLayer attention
        +Conv1d conv1
        +Conv1d conv2
        +series_decomp decomp1
        +series_decomp decomp2
        +Dropout dropout
        +activation
        +forward(x, attn_mask)
    }

    class AutoCorrelationLayer {
        +AutoCorrelation attention
        +Linear query_projection
        +Linear key_projection
        +Linear value_projection
        +Linear out_projection
        +forward(queries, keys, values, attn_mask)
    }

    class AutoCorrelation {
        +bool mask_flag
        +int factor
        +float scale
        +Dropout dropout
        +bool output_attention
        +time_delay_agg_training(values, corr)
        +time_delay_agg_inference(values, corr)
        +forward(queries, keys, values, attn_mask)
    }

    class Decoder {
        +List~DecoderLayer~ layers
        +my_Layernorm norm_layer
        +Linear projection
        +forward(x, enc_out, x_mask, cross_mask, trend)
    }

    class DecoderLayer {
        +AutoCorrelationLayer self_attention
        +AutoCorrelationLayer cross_attention
        +Conv1d conv1
        +Conv1d conv2
        +series_decomp decomp1
        +series_decomp decomp2
        +series_decomp decomp3
        +Dropout dropout
        +activation
        +forward(x, enc_out, x_mask, cross_mask, trend)
    }

    %% æ ¸å¿ƒç»„ä»¶å…³ç³»
    Model --&gt; series_decomp
    Model --&gt; DataEmbedding_wo_pos
    Model --&gt; Encoder
    Model --&gt; Decoder

    %% åµŒå…¥å±‚å…³ç³» - ä¿®æ­£ä¸ºæ¡ä»¶å…³ç³»
    DataEmbedding_wo_pos --&gt; TokenEmbedding
    DataEmbedding_wo_pos ..&gt; TemporalEmbedding : å½“embed_type!='timeF'
    DataEmbedding_wo_pos ..&gt; TimeFeatureEmbedding : å½“embed_type='timeF'

    %% ç¼–ç å™¨ç»„ä»¶å…³ç³»
    Encoder --&gt; EncoderLayer
    EncoderLayer --&gt; AutoCorrelationLayer
    EncoderLayer --&gt; Conv1d
    EncoderLayer --&gt; series_decomp
    AutoCorrelationLayer --&gt; AutoCorrelation

    %% è§£ç å™¨ç»„ä»¶å…³ç³»
    Decoder --&gt; DecoderLayer
    DecoderLayer --&gt; AutoCorrelationLayer
    DecoderLayer --&gt; Conv1d
    DecoderLayer --&gt; series_decomp

    %% åºåˆ—åˆ†è§£å…³ç³»
    series_decomp --&gt; moving_avg
    moving_avg --&gt; AvgPool1d
</code></pre>
<p>2 </p>
<pre class="mermaid"><code>classDiagram
    class Model {
        +int seq_len
        +int label_len
        +int pred_len
        +bool output_attention
        +series_decomp decomp
        +DataEmbedding_wo_pos enc_embedding
        +DataEmbedding_wo_pos dec_embedding
        +Encoder encoder
        +Decoder decoder
        +forward(x_enc, x_mark_enc, x_dec, x_mark_dec, enc_self_mask, dec_self_mask, dec_enc_mask)
    }

    class series_decomp {
        +moving_avg moving_avg
        +forward(x) res, moving_mean
    }

    class moving_avg {
        +int kernel_size
        +AvgPool1d avg
        +forward(x)
    }

    class DataEmbedding_wo_pos {
        +TokenEmbedding value_embedding
        +TemporalEmbedding|TimeFeatureEmbedding temporal_embedding
        +Dropout dropout
        +forward(x, x_mark)
        +__init__(c_in, d_model, embed_type, freq, dropout)
    }

    class TokenEmbedding {
        +Conv1d tokenConv
        +forward(x)
    }

    class TemporalEmbedding {
        +Embedding minute_embed
        +Embedding hour_embed
        +Embedding weekday_embed
        +Embedding day_embed
        +Embedding month_embed
        +forward(x)
    }

    class TimeFeatureEmbedding {
        +Linear embed
        +forward(x)
    }

    class Encoder {
        +List~EncoderLayer~ layers
        +my_Layernorm norm_layer
        +forward(x, attn_mask)
    }

    class EncoderLayer {
        +AutoCorrelationLayer attention
        +Conv1d conv1
        +Conv1d conv2
        +series_decomp decomp1
        +series_decomp decomp2
        +Dropout dropout
        +activation
        +forward(x, attn_mask)
    }

    class AutoCorrelationLayer {
        +AutoCorrelation attention
        +Linear query_projection
        +Linear key_projection
        +Linear value_projection
        +Linear out_projection
        +forward(queries, keys, values, attn_mask)
    }

    class AutoCorrelation {
        +bool mask_flag
        +int factor
        +float scale
        +Dropout dropout
        +bool output_attention
        +time_delay_agg_training(values, corr)
        +time_delay_agg_inference(values, corr)
        +forward(queries, keys, values, attn_mask)
    }

    class Decoder {
        +List~DecoderLayer~ layers
        +my_Layernorm norm_layer
        +Linear projection
        +forward(x, enc_out, x_mask, cross_mask, trend)
    }

    class DecoderLayer {
        +AutoCorrelationLayer self_attention
        +AutoCorrelationLayer cross_attention
        +Conv1d conv1
        +Conv1d conv2
        +series_decomp decomp1
        +series_decomp decomp2
        +series_decomp decomp3
        +Dropout dropout
        +activation
        +forward(x, enc_out, x_mask, cross_mask, trend)
    }

    %% Modelä¸­çš„ç»„ä»¶å®ä¾‹åŒ–å…³ç³»
    Model *-- "1" series_decomp : åˆ›å»ºdecomp
    Model *-- "1" DataEmbedding_wo_pos : åˆ›å»ºenc_embedding
    Model *-- "1" DataEmbedding_wo_pos : åˆ›å»ºdec_embedding
    Model *-- "1" Encoder : åˆ›å»ºencoder
    Model *-- "1" Decoder : åˆ›å»ºdecoder

    %% DataEmbedding_wo_poså†…éƒ¨ç»„ä»¶
    DataEmbedding_wo_pos *-- "1" TokenEmbedding : åˆ›å»ºvalue_embedding
    DataEmbedding_wo_pos *-- "1" TemporalEmbedding : åˆ›å»ºtemporal_embedding(å½“embed_type!='timeF')
    DataEmbedding_wo_pos *-- "1" TimeFeatureEmbedding : åˆ›å»ºtemporal_embedding(å½“embed_type='timeF')

    %% å…¶ä»–ç»„ä»¶å…³ç³»
    series_decomp *-- "1" moving_avg
    Encoder *-- "e_layers" EncoderLayer
    EncoderLayer *-- "1" AutoCorrelationLayer
    EncoderLayer *-- "2" series_decomp : decomp1,decomp2
    AutoCorrelationLayer *-- "1" AutoCorrelation
    Decoder *-- "d_layers" DecoderLayer
    DecoderLayer *-- "2" AutoCorrelationLayer : selfå’Œcrossæ³¨æ„åŠ›
    DecoderLayer *-- "3" series_decomp : decomp1,2,3
</code></pre>
<h2 id="_15"><span id="é™„å½•">é™„å½•</span><a class="headerlink" href="#_15" title="Permanent link">Â¶</a></h2>
<p>åŸå§‹ Transformer æ¶æ„</p>
<p><a href="#åŸå§‹ Transformer æ¶æ„">è¿”å› æ­£æ–‡ä½ç½®ï¼šåŸå§‹ Transformer æ¶æ„</a> </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320213456149.png"><img alt="image-20250320213456149" src="../images/image-20250320213456149.png"></a></p>
<ul>
<li><code>d_model</code> æ˜¯åµŒå…¥ç»´åº¦ï¼Œä¹Ÿå°±æ˜¯ Embedding dimï¼ŒD æ˜¯å•ä¸ªæ—¶é—´æ­¥è§‚å¯Ÿçš„ç‰¹å¾æ•°ã€‚</li>
<li>å¾—åˆ° Embeddingdim çš„æ“ä½œï¼ŒNLP ä¸­ä¸€èˆ¬å« word embeddingï¼Œè¿™é‡Œå« tokenEmbeddingä¹Ÿè¿˜æŒºåˆç†çš„ï¼Œå•ä¸ªæ—¶é—´æ­¥å°±æ˜¯å•ä¸ª tokenã€‚</li>
</ul>
<h3 id="conv2">ç–‘é—®ä¸€ <a href="#ä¸ºä»€ä¹ˆConv2ä¹‹åæ²¡æœ‰è¿›è¡Œæ¿€æ´»å‡½æ•°çš„åº”ç”¨">ä¸ºä»€ä¹ˆConv2ä¹‹åæ²¡æœ‰è¿›è¡Œæ¿€æ´»å‡½æ•°çš„åº”ç”¨</a><a class="headerlink" href="#conv2" title="Permanent link">Â¶</a></h3>
<p>ï¼ˆ1ï¼‰éµå¾ªåŸå§‹Transformerçš„è®¾è®¡æ¨¡å¼ï¼Œåœ¨åŸå§‹Transformerè®¾è®¡ä¸­ï¼ŒFFNçš„ç»“æ„ä¸ºï¼š<code>FFN(x) = max(0, xWâ‚ + bâ‚)Wâ‚‚ + bâ‚‚</code>ï¼Œè¿™ç›¸å½“äºä¸¤ä¸ªçº¿æ€§å˜æ¢ï¼Œä¸­é—´æœ‰ä¸€ä¸ªReLUæ¿€æ´»å‡½æ•°ã€‚ç¬¬ä¸€ä¸ªçº¿æ€§å˜æ¢ååº”ç”¨æ¿€æ´»å‡½æ•°ï¼Œè€Œç¬¬äºŒä¸ªçº¿æ€§å˜æ¢åä¸åº”ç”¨æ¿€æ´»å‡½æ•°ã€‚Autoformerä½¿ç”¨1Då·ç§¯æ›¿ä»£çº¿æ€§å˜æ¢ï¼Œä½†ä¿æŒäº†ç›¸åŒçš„æ¿€æ´»å‡½æ•°æ¨¡å¼ã€‚</p>
<p>ï¼ˆ2ï¼‰ä¿æŒè¾“å‡ºçš„çº¿æ€§ç‰¹æ€§ï¼Œæœ€åä¸€å±‚ä¸ä½¿ç”¨æ¿€æ´»å‡½æ•°å¯ä»¥ä¿æŒè¾“å‡ºçš„çº¿æ€§ç‰¹æ€§ï¼Œè¿™å¯¹äºæ—¶é—´åºåˆ—é¢„æµ‹å°¤å…¶é‡è¦ã€‚å¦‚æœåœ¨ç¬¬äºŒä¸ªå·ç§¯å±‚ååº”ç”¨æ¿€æ´»å‡½æ•°ï¼š</p>
<ul>
<li>å¯¹äºReLUï¼šä¼šå¯¼è‡´è´Ÿå€¼è¢«æˆªæ–­ä¸ºé›¶ï¼Œé™åˆ¶æ¨¡å‹è¡¨è¾¾è´Ÿå‘è¶‹åŠ¿çš„èƒ½åŠ›</li>
<li>å¯¹äºå…¶ä»–æ¿€æ´»å‡½æ•°ï¼šä¼šå¼•å…¥éçº¿æ€§å˜æ¢ï¼Œå¯èƒ½é™åˆ¶æ¨¡å‹å¯¹çº¿æ€§è¶‹åŠ¿çš„å»ºæ¨¡èƒ½åŠ›</li>
<li>åœ¨æ—¶é—´åºåˆ—å»ºæ¨¡ä¸­ï¼Œä¿æŒä¸€å®šçš„çº¿æ€§ç‰¹æ€§å¾ˆé‡è¦ï¼Œå› ä¸ºè®¸å¤šæ—¶é—´åºåˆ—åŒ…å«å¼ºçº¿æ€§è¶‹åŠ¿ã€‚æœ€åä¸€å±‚ä¸ä½¿ç”¨æ¿€æ´»å‡½æ•°ï¼Œå¯ä»¥ä½¿æ¨¡å‹æ›´å¥½åœ°æ•æ‰è¿™äº›çº¿æ€§è¶‹åŠ¿ã€‚</li>
</ul>
<p>ï¼ˆ3ï¼‰æ€»ä¹‹ï¼Œ<strong>ç¬¬ä¸€ä¸ªå·ç§¯å±‚å’Œæ¿€æ´»å‡½æ•°**è´Ÿè´£æ•æ‰éçº¿æ€§ç‰¹å¾ï¼Œ**ç¬¬äºŒä¸ªå·ç§¯å±‚æ²¡æœ‰æ¿€æ´»å‡½æ•°</strong>ï¼Œä¿æŒäº†ä¸€å®šçš„çº¿æ€§æ˜ å°„èƒ½åŠ›ï¼Œè¿™ç§è®¾è®¡åœ¨éçº¿æ€§è¡¨è¾¾èƒ½åŠ›å’Œä¿æŒçº¿æ€§ç‰¹æ€§ä¹‹é—´å–å¾—äº†å¹³è¡¡</p>
<h3 id="2-conv1d-nnlinear">ç–‘é—® 2 ä¸ºä»€ä¹ˆæ˜¯ conv1dï¼Œè€Œä¸æ˜¯ nn.Linear<a class="headerlink" href="#2-conv1d-nnlinear" title="Permanent link">Â¶</a></h3>
<ul>
<li>é¦–å…ˆï¼Œå¿…é¡»æ˜ç¡®çš„æ˜¯ï¼Œä½¿ç”¨nn.Linear <strong>ä¸æ˜¯</strong> ä¸ºæ¯ä¸ªæ—¶é—´æ­¥åˆ›å»ºå•ç‹¬çš„å…¨è¿æ¥å±‚ï¼Œè€Œæ˜¯å¯¹æ‰€æœ‰æ—¶é—´æ­¥åº”ç”¨ç›¸åŒçš„æƒé‡ï¼ˆæƒé‡å…±äº«ï¼‰ã€‚</li>
</ul>
<p><mark>ä¾‹å­ï¼š</mark> </p>
<p><u>æ–¹å¼1ï¼šåº”ç”¨äºæ•´ä¸ªåºåˆ—ï¼ˆæ‰¹é‡å¤„ç†æ‰€æœ‰æ—¶é—´æ­¥ï¼‰</u> </p>
<p>å‡è®¾è¾“å…¥xå½¢çŠ¶ä¸º[B, L, D]</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1"></a><a href="#__codelineno-56-1"><span class="linenos" data-linenos="1 "></span></a>linear_layer = nn.Linear(D, D_out)
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2"></a><a href="#__codelineno-56-2"><span class="linenos" data-linenos="2 "></span></a>output = linear_layer(x)  # è¾“å‡ºå½¢çŠ¶ä¸º[B, L, D_out]
</span></code></pre></div>
<p><strong>åŒä¸€ä¸ªçº¿æ€§å±‚ä¼šåº”ç”¨åˆ°æ‰€æœ‰æ—¶é—´æ­¥ï¼Œæƒé‡æ˜¯å…±äº«çš„ã€‚è¿™ä¸kernel_size=1çš„Conv1Déå¸¸ç›¸ä¼¼</strong> </p>
<ul>
<li>kernel_size=1çš„Conv1Dåœ¨åŠŸèƒ½ä¸Šç±»ä¼¼äºç‹¬ç«‹åº”ç”¨äºæ¯ä¸ªæ—¶é—´æ­¥çš„å…¨è¿æ¥å±‚ï¼Œä½†å®ƒæœ‰ä¸€ä¸ªå…³é”®åŒºåˆ«ï¼šæƒé‡å…±äº«ã€‚ä½¿ç”¨å·ç§¯æ„å‘³ç€åŒä¸€ç»„æƒé‡åº”ç”¨äºæ‰€æœ‰æ—¶é—´æ­¥</li>
</ul>
<p><u>æ–¹å¼2ï¼šå¾ªç¯åº”ç”¨äºæ¯ä¸ªæ—¶é—´æ­¥</u> </p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1"></a><a href="#__codelineno-57-1"><span class="linenos" data-linenos="1 "></span></a># å‡è®¾è¾“å…¥xå½¢çŠ¶ä¸º[B, L, D]
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2"></a><a href="#__codelineno-57-2"><span class="linenos" data-linenos="2 "></span></a>linear_layer = nn.Linear(D, D_out)
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3"></a><a href="#__codelineno-57-3"><span class="linenos" data-linenos="3 "></span></a>outputs = []
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4"></a><a href="#__codelineno-57-4"><span class="linenos" data-linenos="4 "></span></a>for i in range(L):
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5"></a><a href="#__codelineno-57-5"><span class="linenos" data-linenos="5 "></span></a>    output_step = linear_layer(x[:, i, :])  # è¾“å‡ºå½¢çŠ¶ä¸º[B, D_out]
</span><span id="__span-57-6"><a id="__codelineno-57-6" name="__codelineno-57-6"></a><a href="#__codelineno-57-6"><span class="linenos" data-linenos="6 "></span></a>    outputs.append(output_step)
</span><span id="__span-57-7"><a id="__codelineno-57-7" name="__codelineno-57-7"></a><a href="#__codelineno-57-7"><span class="linenos" data-linenos="7 "></span></a>output = torch.stack(outputs, dim=1)  # è¾“å‡ºå½¢çŠ¶ä¸º[B, L, D_out]
</span></code></pre></div>
<p>è¿™ç§æ–¹å¼ä¹Ÿæ˜¯ä½¿ç”¨åŒä¸€ä¸ªçº¿æ€§å±‚ï¼Œæƒé‡ä»ç„¶æ˜¯å…±äº«çš„ã€‚</p>
<p>å…¶å®è¿™ä¸ªç–‘é—®çœ‹å›ç­”å…¶å®ä¹Ÿæ˜¯å¤§å¯ä¸å¿…çš„ã€‚çœ‹çœ‹å°±è¡Œäº†ï¼Œæƒ³ç€çœ‹æ˜ç™½ä¸å¤§å¯èƒ½ã€‚</p>
<p><strong>åœ¨Autoformerä¸­ä½¿ç”¨kernel_size=1çš„Conv1Dæ—¶ï¼Œå®ƒåœ¨åŠŸèƒ½ä¸Šä¸æ–¹å¼1ä¸­çš„nn.Linearéå¸¸ç›¸ä¼¼ï¼Œä¸»è¦åŒºåˆ«åœ¨äºï¼š</strong> </p>
<ol>
<li><strong>ç»´åº¦é¡ºåº</strong>ï¼š
   - Conv1DæœŸæœ›è¾“å…¥å½¢çŠ¶ä¸º<code>[B, C, L]</code>ï¼ˆæ‰¹æ¬¡å¤§å°ã€é€šé“æ•°ã€åºåˆ—é•¿åº¦ï¼‰
   - LinearæœŸæœ›è¾“å…¥å½¢çŠ¶ä¸º<code>[B, L, D]</code>ï¼ˆæ‰¹æ¬¡å¤§å°ã€åºåˆ—é•¿åº¦ã€ç‰¹å¾ç»´åº¦ï¼‰</li>
<li><strong>å®ç°æ•ˆç‡</strong>ï¼š
   - Conv1Dåœ¨GPUä¸Šå¯¹äºåºåˆ—æ•°æ®æœ‰æ›´ä¼˜åŒ–çš„å®ç°
   - ä½¿ç”¨Conv1Då¯ä»¥é¿å…reshapeæ“ä½œæˆ–å¾ªç¯å¤„ç†æ—¶é—´æ­¥</li>
<li><strong>æ¡†æ¶è®¾è®¡</strong>ï¼š
   - ä½¿ç”¨Conv1Dä¸Autoformerçš„æ•´ä½“æ¶æ„è®¾è®¡æ›´ä¸€è‡´
   - Conv1Dæä¾›äº†æ‰©å±•åˆ°æ›´å¤§kernel_sizeçš„å¯èƒ½æ€§</li>
</ol>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320225707561.png"><img alt="image-20250320225707561" src="../images/image-20250320225707561.png"></a> </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320225721285.png"><img alt="image-20250320225721285" src="../images/image-20250320225721285.png"></a></p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250320225730620.png"><img alt="image-20250320225730620" src="../images/image-20250320225730620.png"></a> </p>
<h3 id="_16">åºåˆ—åˆ†è§£çš„ç°å®æ„ä¹‰<a class="headerlink" href="#_16" title="Permanent link">Â¶</a></h3>
<p><strong>Autoformerä¸­åºåˆ—åˆ†è§£çš„ç‰¹æ®Šæ€§ä¸æ„ä¹‰</strong> </p>
<p>Autoformerä¸­çš„åºåˆ—åˆ†è§£ï¼ˆseries_decompï¼‰æ˜¯è¯¥æ¨¡å‹æœ€å…·åˆ›æ–°æ€§çš„ç‰¹ç‚¹ä¹‹ä¸€ï¼Œå®ƒæ·±åˆ»ä½“ç°äº†æ—¶é—´åºåˆ—æ•°æ®å¤„ç†çš„ç‰¹æ®Šéœ€æ±‚ã€‚è®©æˆ‘è¯¦ç»†è§£æè¿™ä¸€è®¾è®¡çš„æ„ä¹‰ï¼š</p>
<p>ğŸŸ¢ <strong><u>æ—¶é—´åºåˆ—çš„åŸºæœ¬ç»„æˆéƒ¨åˆ†</u></strong> </p>
<p>é¦–å…ˆï¼Œæ—¶é—´åºåˆ—æ•°æ®é€šå¸¸å¯ä»¥åˆ†è§£ä¸ºä¸‰ä¸ªåŸºæœ¬ç»„æˆéƒ¨åˆ†ï¼š
- <strong>è¶‹åŠ¿ï¼ˆTrendï¼‰</strong>ï¼šé•¿æœŸçš„å˜åŒ–æ–¹å‘ï¼Œå¦‚ç»æµå¢é•¿çš„æ€»ä½“è¶‹åŠ¿
- <strong>å­£èŠ‚æ€§ï¼ˆSeasonalityï¼‰</strong>ï¼šå‘¨æœŸæ€§çš„å˜åŒ–æ¨¡å¼ï¼Œå¦‚æ¯å¹´çš„å­£èŠ‚æ€§é”€å”®å˜åŒ–
- <strong>æ®‹å·®ï¼ˆResidualï¼‰</strong>ï¼šéšæœºæ³¢åŠ¨æˆ–å™ªå£°</p>
<p>ä¼ ç»Ÿæ—¶é—´åºåˆ—åˆ†ææ–¹æ³•ï¼ˆå¦‚ARIMAã€æŒ‡æ•°å¹³æ»‘æ³•ï¼‰é€šå¸¸ä¼šå…ˆåˆ†è§£æ—¶é—´åºåˆ—ï¼Œå†åˆ†åˆ«å»ºæ¨¡ã€‚</p>
<p><strong><u>ğŸŸ¢ Autoformerçš„åºåˆ—åˆ†è§£æœºåˆ¶</u></strong></p>
<p>Autoformeré€šè¿‡<code>series_decomp</code>å°†è¾“å…¥åºåˆ—åˆ†è§£ä¸ºå­£èŠ‚æ€§å’Œè¶‹åŠ¿ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1"></a><a href="#__codelineno-58-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">res</span><span class="p">,</span> <span class="n">moving_mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decomp1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></code></pre></div>
<p>è¿™é‡Œï¼š
- <code>res</code> æ˜¯å­£èŠ‚æ€§éƒ¨åˆ†ï¼ˆçŸ­æœŸå‘¨æœŸæ€§å˜åŒ–ï¼‰
- <code>moving_mean</code> æ˜¯è¶‹åŠ¿éƒ¨åˆ†ï¼ˆé•¿æœŸæ–¹å‘æ€§å˜åŒ–ï¼‰</p>
<p>å…³é”®ç‚¹æ˜¯ï¼Œ<strong>Autoformeråœ¨å¤šä¸ªä½ç½®ä½¿ç”¨åºåˆ—åˆ†è§£ï¼Œå¹¶æœ‰é€‰æ‹©åœ°ä¸¢å¼ƒè¶‹åŠ¿éƒ¨åˆ†</strong>ã€‚ä¾‹å¦‚ï¼š</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1"></a><a href="#__codelineno-59-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># å°†æ®‹å·®è¿æ¥ç»“æœåˆ†è§£ï¼Œä»…ä¿ç•™å­£èŠ‚æ€§éƒ¨åˆ†</span>
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2"></a><a href="#__codelineno-59-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">res</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decomp2</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>
</span></code></pre></div>
<p><u>ğŸŸ¢  <strong>è¿™ç§è®¾è®¡çš„æ·±å±‚æ„ä¹‰</strong></u> </p>
<p>ï¼ˆ1ï¼‰åˆ†ç¦»ä¸åŒæ—¶é—´å°ºåº¦çš„æ¨¡å¼</p>
<p>è¶‹åŠ¿å’Œå­£èŠ‚æ€§ä»£è¡¨ä¸åŒæ—¶é—´å°ºåº¦çš„å˜åŒ–æ¨¡å¼ï¼š
- è¶‹åŠ¿åæ˜ é•¿æœŸå˜åŒ–ï¼ˆä½é¢‘ä¿¡å·ï¼‰
- å­£èŠ‚æ€§åæ˜ çŸ­æœŸå‘¨æœŸå˜åŒ–ï¼ˆé«˜é¢‘ä¿¡å·ï¼‰</p>
<p>é€šè¿‡åˆ†ç¦»è¿™ä¸¤ç§æ¨¡å¼ï¼ŒAutoformerå¯ä»¥ï¼š
- è®©è‡ªæ³¨æ„åŠ›æœºåˆ¶ä¸“æ³¨äºæ•è·å­£èŠ‚æ€§æ¨¡å¼ï¼Œè¿™æ›´é€‚åˆå…¶æ“…é•¿æ•è·çš„å±€éƒ¨ä¾èµ–å…³ç³»
- å•ç‹¬å¤„ç†è¶‹åŠ¿éƒ¨åˆ†ï¼Œé¿å…æ··åˆä¸åŒé¢‘ç‡çš„ä¿¡å·å¯¼è‡´çš„å»ºæ¨¡å›°éš¾</p>
<p><strong>ï¼ˆ2ï¼‰æ¸è¿›å¼åˆ†è§£æ¶æ„</strong> </p>
<p>Autoformeré‡‡ç”¨"æ¸è¿›å¼åˆ†è§£"ï¼ˆProgressive Decompositionï¼‰æ¶æ„ï¼š
- æ¯ä¸€å±‚éƒ½è¿›è¡Œåºåˆ—åˆ†è§£ï¼Œé€æ­¥æå–å­£èŠ‚æ€§ç‰¹å¾
- é€šè¿‡ä¸¢å¼ƒä¸­é—´å±‚çš„è¶‹åŠ¿ä¿¡æ¯ï¼Œå¼ºåˆ¶æ¨¡å‹å…³æ³¨å­£èŠ‚æ€§æ¨¡å¼
- åœ¨è§£ç å™¨ä¸­ï¼Œåˆ†åˆ«ç´¯ç§¯å„å±‚çš„è¶‹åŠ¿ä¿¡æ¯ï¼Œå½¢æˆæœ€ç»ˆè¶‹åŠ¿é¢„æµ‹</p>
<p>è¿™ç§æ¶æ„è§£å†³äº†ä¼ ç»ŸTransformeråœ¨é•¿åºåˆ—é¢„æµ‹ä¸­çš„ç“¶é¢ˆï¼š
- ä¼ ç»ŸTransformeråœ¨é•¿æœŸé¢„æµ‹ä¸­å¾€å¾€å­˜åœ¨"é•¿æœŸé¢„æµ‹åå·®ç§¯ç´¯"é—®é¢˜
- åˆ†ç¦»è¶‹åŠ¿å’Œå­£èŠ‚æ€§å¯ä»¥å‡è½»è¿™ç§åå·®ç§¯ç´¯</p>
<p><strong>ï¼ˆ3ï¼‰å¢å¼ºå­£èŠ‚æ€§å’Œå‘¨æœŸæ€§æ¨¡å¼çš„å­¦ä¹ </strong> </p>
<p>æ—¶é—´åºåˆ—ä¸­çš„å­£èŠ‚æ€§æ¨¡å¼ï¼ˆå¦‚æ¯æ—¥ã€æ¯å‘¨ã€æ¯æœˆæˆ–æ¯å¹´çš„å‘¨æœŸæ€§ï¼‰æ˜¯é¢„æµ‹çš„é‡è¦ä¾æ®ã€‚é€šè¿‡ä¿ç•™å­£èŠ‚æ€§éƒ¨åˆ†ï¼š
- æ¨¡å‹å¯ä»¥æ›´å¥½åœ°æ•æ‰è¿™äº›é‡å¤å‡ºç°çš„æ¨¡å¼
- å¢å¼ºäº†å¯¹å‘¨æœŸæ€§è¡Œä¸ºçš„è¯†åˆ«èƒ½åŠ›
- é™ä½äº†è¶‹åŠ¿å˜åŒ–å¯¹å­£èŠ‚æ€§æ¨¡å¼è¯†åˆ«çš„å¹²æ‰°</p>
<p>ğŸŸ¢ <u><strong>å·¥ç¨‹å®ç°çš„å·§å¦™ä¹‹å¤„</strong></u> </p>
<p>ä»ä»£ç å®ç°çœ‹ï¼ŒAutoformerçš„åºåˆ—åˆ†è§£é‡‡ç”¨ç®€å•è€Œæœ‰æ•ˆçš„ç§»åŠ¨å¹³å‡æ–¹æ³•ï¼š
</p><div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1"></a><a href="#__codelineno-60-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># è®¡ç®—ç§»åŠ¨å¹³å‡ï¼Œæå–åºåˆ—è¶‹åŠ¿åˆ†é‡</span>
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2"></a><a href="#__codelineno-60-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">moving_mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moving_avg</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3"></a><a href="#__codelineno-60-3"><span class="linenos" data-linenos="3 "></span></a><span class="c1"># é€šè¿‡åŸå§‹åºåˆ—å‡å»è¶‹åŠ¿åˆ†é‡ï¼Œå¾—åˆ°æ®‹å·®(å­£èŠ‚æ€§åˆ†é‡)</span>
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4"></a><a href="#__codelineno-60-4"><span class="linenos" data-linenos="4 "></span></a><span class="n">res</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">moving_mean</span>
</span></code></pre></div><p></p>
<p>è¿™ä¸€ç®€å•æ“ä½œåœ¨è®¡ç®—æ•ˆç‡ä¸æ•ˆæœä¹‹é—´å–å¾—äº†å¾ˆå¥½çš„å¹³è¡¡ï¼š
- è®¡ç®—å¼€é”€ä½ï¼Œé€‚åˆå¤„ç†é•¿åºåˆ—
- æ•ˆæœæ˜¾è‘—ï¼Œèƒ½æœ‰æ•ˆåˆ†ç¦»ä¸åŒé¢‘ç‡çš„ä¿¡å·</p>
<p><u><strong>ğŸŸ¢ ä¸ä¼ ç»ŸTransformerçš„å…³é”®åŒºåˆ«</strong></u> </p>
<p>åœ¨ä¼ ç»ŸTransformerä¸­ï¼Œæ®‹å·®è¿æ¥ç›´æ¥å°†åŸå§‹è¾“å…¥å’Œå¤„ç†åçš„è¾“å‡ºç›¸åŠ ï¼š
</p><div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1"></a><a href="#__codelineno-61-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="n">new_x</span><span class="p">)</span>  <span class="c1"># ä¼ ç»ŸTransformer</span>
</span></code></pre></div><p></p>
<p>è€ŒAutoformeråœ¨ç›¸åŠ åè¿˜è¿›è¡Œäº†åºåˆ—åˆ†è§£ï¼š
</p><div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1"></a><a href="#__codelineno-62-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="n">new_x</span><span class="p">)</span>
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2"></a><a href="#__codelineno-62-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">x</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decomp1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># Autoformerçš„ç‰¹æ®Šå¤„ç†</span>
</span></code></pre></div><p></p>
<p>ä»¥åŠåœ¨å‰é¦ˆç½‘ç»œåï¼š
</p><div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1"></a><a href="#__codelineno-63-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">res</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decomp2</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>  <span class="c1"># ä¼ ç»ŸTransformeråªæœ‰ x = x + y</span>
</span></code></pre></div><p></p>
<p>è¿™ä¸€åˆ›æ–°è®¾è®¡ä»æ ¹æœ¬ä¸Šæ”¹å˜äº†ä¿¡æ¯åœ¨ç½‘ç»œä¸­çš„æµåŠ¨æ–¹å¼ï¼Œä½¿æ¨¡å‹æ›´é€‚åˆæ—¶é—´åºåˆ—é¢„æµ‹ä»»åŠ¡ã€‚</p>
<p><strong>ğŸŸ¢ å®é™…åº”ç”¨æ„ä¹‰</strong> </p>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™ç§åºåˆ—åˆ†è§£æœºåˆ¶å¸¦æ¥çš„å¥½å¤„åŒ…æ‹¬ï¼š</p>
<ol>
<li><strong>æé«˜é•¿æœŸé¢„æµ‹å‡†ç¡®æ€§</strong>ï¼šé€šè¿‡åˆ†ç¦»è¶‹åŠ¿å’Œå­£èŠ‚æ€§ï¼Œå‡å°‘é•¿æœŸé¢„æµ‹ä¸­çš„è¯¯å·®ç§¯ç´¯</li>
<li><strong>å¢å¼ºå¯è§£é‡Šæ€§</strong>ï¼šåˆ†è§£åçš„è¶‹åŠ¿å’Œå­£èŠ‚æ€§ç»„ä»¶æ›´å®¹æ˜“ç†è§£å’Œè§£é‡Š</li>
<li><strong>æ›´å¥½çš„æ³›åŒ–èƒ½åŠ›</strong>ï¼šå­¦ä¹ åˆ°çš„å­£èŠ‚æ€§æ¨¡å¼å¯ä»¥æ›´å¥½åœ°æ³›åŒ–åˆ°æ–°çš„æ—¶é—´æ®µ</li>
<li><strong>å‡è½»æ•°æ®é¢„å¤„ç†è´Ÿæ‹…</strong>ï¼šæ¨¡å‹å†…ç½®çš„åˆ†è§£æœºåˆ¶å‡å°‘äº†æ•°æ®é¢„å¤„ç†çš„éœ€æ±‚</li>
</ol>
<p><strong>ğŸŸ¢ ç»“è®º</strong> </p>
<p>Autoformerä¸­çš„åºåˆ—åˆ†è§£ä¸ä»…æ˜¯ä¸€ä¸ªæŠ€æœ¯ç»†èŠ‚ï¼Œè€Œæ˜¯ä¸€ä¸ªä½“ç°æ—¶é—´åºåˆ—æ•°æ®æœ¬è´¨ç‰¹æ€§çš„å…³é”®è®¾è®¡ã€‚å®ƒä½¿Autoformerèƒ½å¤Ÿæœ‰æ•ˆåŒºåˆ†å’Œå¤„ç†ä¸åŒé¢‘ç‡çš„ä¿¡å·ï¼Œæé«˜é•¿æœŸé¢„æµ‹èƒ½åŠ›ï¼Œå¹¶å¢å¼ºæ¨¡å‹çš„å¯è§£é‡Šæ€§ã€‚è¿™ä¸€è®¾è®¡å……åˆ†å±•ç¤ºäº†å¦‚ä½•å°†é¢†åŸŸçŸ¥è¯†ï¼ˆæ—¶é—´åºåˆ—åˆ†æï¼‰ä¸æ·±åº¦å­¦ä¹ æ¶æ„ï¼ˆTransformerï¼‰æœ‰æœºç»“åˆï¼Œåˆ›é€ å‡ºæ›´é€‚åˆç‰¹å®šä»»åŠ¡çš„æ¨¡å‹æ¶æ„ã€‚</p>
<h3 id="_17"><a href="#è¿”å›ç†è§£å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶"><span id="è·³åˆ°ç†è§£å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶">ç†è§£å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶</span></a><a class="headerlink" href="#_17" title="Permanent link">Â¶</a></h3>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="../images/image-20250321174539839.png"><img alt="image-20250321174539839" src="../images/image-20250321174539839.png"></a> </p>
<h3 id="k-v-q"><a href="#è¿”å›ç¼–ç å™¨çš„è¾“å‡ºä½œä¸º K å’Œ Vï¼Œè§£ç å™¨çš„è¾“å…¥ä½œä¸º Q"><span id="ç¼–ç å™¨çš„è¾“å‡ºä½œä¸º K å’Œ Vï¼Œè§£ç å™¨çš„è¾“å…¥ä½œä¸º Q">ç¼–ç å™¨çš„è¾“å‡ºä½œä¸º K å’Œ Vï¼Œè§£ç å™¨çš„è¾“å…¥ä½œä¸º Q</span></a><a class="headerlink" href="#k-v-q" title="Permanent link">Â¶</a></h3>
<p>ğŸŸ¢ æ³¨æ„åŠ›æœºåˆ¶æœ¬è´¨ä¸Šæ˜¯ä¸€ç§è½¯æ£€ç´¢ç³»ç»Ÿï¼š</p>
<ul>
<li>Queryï¼ˆæŸ¥è¯¢ï¼‰ï¼šè¡¨è¾¾å½“å‰è§£ç ä½ç½®éœ€è¦çš„ä¿¡æ¯ç±»å‹</li>
<li>Keyï¼ˆé”®ï¼‰ï¼šè¡¨ç¤ºæºåºåˆ—ä¸­å„ä½ç½®ä¿¡æ¯çš„"ç´¢å¼•"</li>
<li>Valueï¼ˆå€¼ï¼‰ï¼šè¡¨ç¤ºæºåºåˆ—ä¸­å„ä½ç½®çš„å®é™…å†…å®¹</li>
</ul>
<p>è§£ç å™¨é€šè¿‡å…¶éšè—çŠ¶æ€å½¢æˆæŸ¥è¯¢ï¼ˆQï¼‰ï¼Œç„¶åæ ¹æ®ä¸ç¼–ç å™¨éšè—çŠ¶æ€ï¼ˆKï¼‰çš„ç›¸å…³æ€§ï¼Œæå–ç›¸åº”çš„ç¼–ç å™¨ä¿¡æ¯ï¼ˆVï¼‰ã€‚</p>
<p>ğŸŸ¢ åœ¨åºåˆ—åˆ°åºåˆ—å­¦ä¹ ä¸­ï¼Œäº¤å‰æ³¨æ„åŠ›å®ç°äº†æ¡ä»¶ç”Ÿæˆï¼š</p>
<p>ç¼–ç å™¨ï¼šè´Ÿè´£ç†è§£è¾“å…¥åºåˆ—ï¼ˆå¦‚æºè¯­è¨€æ–‡æœ¬æˆ–å†å²æ—¶é—´åºåˆ—ï¼‰</p>
<p>è§£ç å™¨ï¼šè´Ÿè´£åŸºäºè¾“å…¥åºåˆ—ç”Ÿæˆè¾“å‡ºåºåˆ—ï¼ˆå¦‚ç›®æ ‡è¯­è¨€æ–‡æœ¬æˆ–æœªæ¥æ—¶é—´åºåˆ—ï¼‰</p>
<p>è§£ç å™¨éœ€è¦"æœ‰æ¡ä»¶åœ°"ç”Ÿæˆè¾“å‡ºï¼Œè¿™ä¸ªæ¡ä»¶å°±æ˜¯ç¼–ç å™¨å¤„ç†çš„è¾“å…¥åºåˆ—ï¼Œäº¤å‰æ³¨æ„åŠ›æä¾›äº†è¿™ç§æ¡ä»¶æœºåˆ¶ã€‚</p>
<p>ğŸŸ¢ åœ¨Autoformerè¿™æ ·çš„æ—¶é—´åºåˆ—é¢„æµ‹æ¨¡å‹ä¸­ï¼Œè¿™ç§è®¾è®¡æœ‰å…¶ç‰¹æ®Šæ„ä¹‰ï¼š</p>
<p>ç¼–ç å™¨ï¼šå¤„ç†å†å²æ—¶é—´åºåˆ—ï¼Œæå–å…³é”®æ¨¡å¼å’Œç‰¹å¾</p>
<p>è§£ç å™¨ï¼šåŸºäºè¿™äº›æ¨¡å¼ç”Ÿæˆæœªæ¥æ—¶é—´åºåˆ—</p>
<p>äº¤å‰æ³¨æ„åŠ›è®©è§£ç å™¨èƒ½å¤Ÿåœ¨ç”Ÿæˆæ¯ä¸ªæœªæ¥æ—¶é—´æ­¥æ—¶ï¼Œé€‰æ‹©æ€§åœ°å…³æ³¨å†å²åºåˆ—ä¸­çš„ç›¸å…³æ¨¡å¼ï¼Œå°¤å…¶æ˜¯é‚£äº›ä¸å½“å‰é¢„æµ‹ä½ç½®ç›¸å…³çš„å­£èŠ‚æ€§æˆ–å‘¨æœŸæ€§æ¨¡å¼ã€‚</p>
<h3 id="_18"><a href="#è¿”å›å¾ªç¯å¡«å……"><span id="å¾ªç¯å¡«å……">å¾ªç¯å¡«å……</span></a><a class="headerlink" href="#_18" title="Permanent link">Â¶</a></h3>
<p>é€‚ç”¨ï¼šç‰¹åˆ«é€‚åˆå¤„ç†å…·æœ‰å‘¨æœŸæ€§ç‰¹å¾çš„æ—¶é—´åºåˆ—æ•°æ®</p>
<p>æœ¬æ–‡ä½¿ç”¨å¾ªç¯å¡«å……çš„ä½ç½®ï¼Œå¯¹è¶‹åŠ¿æˆåˆ†è¿˜åŸåŸå§‹ç»´åº¦çš„æ—¶å€™ï¼š</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1"></a><a href="#__codelineno-64-1"><span class="linenos" data-linenos="1 "></span></a><span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv1d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="n">d_model</span><span class="p">,</span> 
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2"></a><a href="#__codelineno-64-2"><span class="linenos" data-linenos="2 "></span></a>                            <span class="n">out_channels</span><span class="o">=</span><span class="n">c_out</span><span class="p">,</span> 
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3"></a><a href="#__codelineno-64-3"><span class="linenos" data-linenos="3 "></span></a>                            <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> 
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4"></a><a href="#__codelineno-64-4"><span class="linenos" data-linenos="4 "></span></a>                            <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5"></a><a href="#__codelineno-64-5"><span class="linenos" data-linenos="5 "></span></a>                            <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
</span><span id="__span-64-6"><a id="__codelineno-64-6" name="__codelineno-64-6"></a><a href="#__codelineno-64-6"><span class="linenos" data-linenos="6 "></span></a>                            <span class="n">padding_mode</span><span class="o">=</span><span class="s1">'circular'</span><span class="p">,</span> 
</span><span id="__span-64-7"><a id="__codelineno-64-7" name="__codelineno-64-7"></a><a href="#__codelineno-64-7"><span class="linenos" data-linenos="7 "></span></a>                            <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></code></pre></div>
<p>åŒºåˆ†å‡ ç§å¡«å……æ–¹å¼</p>
<p>ã€ä¸»è¦è§‚å¯Ÿï¼Œ<mark>a,b,c,dçš„å·¦å³</mark> ã€‘</p>
<p>ï¼ˆ1ï¼‰0 å¡«å……ï¼šé›¶å¡«å……ï¼ˆé»˜è®¤ï¼Œ'zeros'ï¼‰ï¼šç”¨0å€¼å¡«å……åºåˆ—è¾¹ç•Œ</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1"></a><a href="#__codelineno-65-1"><span class="linenos" data-linenos="1 "></span></a>åŸåºåˆ—: [a, b, c, d]
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2"></a><a href="#__codelineno-65-2"><span class="linenos" data-linenos="2 "></span></a>å¡«å……å: [0, 0, a, b, c, d, 0, 0]
</span></code></pre></div>
<p>ï¼ˆ2ï¼‰é‡å¤å¡«å……ï¼šé‡å¤å¡«å……ï¼ˆ'replicate'ï¼‰ï¼šå¤åˆ¶è¾¹ç•Œå€¼</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1"></a><a href="#__codelineno-66-1"><span class="linenos" data-linenos="1 "></span></a>åŸåºåˆ—: [a, b, c, d]
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2"></a><a href="#__codelineno-66-2"><span class="linenos" data-linenos="2 "></span></a>å¡«å……å: [a, a, a, b, c, d, d, d]
</span></code></pre></div>
<p>(3)å¾ªç¯å¡«å……ï¼ˆ'circular'ï¼‰ï¼šå°†åºåˆ—è§†ä¸ºå¾ªç¯ç»“æ„</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1"></a><a href="#__codelineno-67-1"><span class="linenos" data-linenos="1 "></span></a>åŸåºåˆ—: [a, b, c, d]
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2"></a><a href="#__codelineno-67-2"><span class="linenos" data-linenos="2 "></span></a>å¡«å……å: [c, d, a, b, c, d, a, b]
</span></code></pre></div>
<p><mark>ä¸ºä»€ä¹ˆåºåˆ—å¡«å……ï¼Œä½¿ç”¨æ—¶é—´åºåˆ—</mark></p>
<p>å°†æ—¶é—´åºåˆ—è§†ä¸ºä¸€ä¸ªå¾ªç¯ï¼Œåºåˆ—æœ«å°¾è¿æ¥åˆ°åºåˆ—å¼€å¤´ï¼Œä¿æŒæ—¶é—´æ•°æ®çš„å‘¨æœŸæ€§ç‰¹æ€§ï¼Œä¸å¼•å…¥äººä¸ºçš„å€¼ï¼Œåªä½¿ç”¨å·²æœ‰æ•°æ®</p>
<p><strong>æ—¶é—´åºåˆ—å‘¨æœŸæ€§çš„æè¿°ï¼š</strong></p>
<ul>
<li>å¹´åº¦å‘¨æœŸï¼šæ¯å¹´åŒä¸€æ—¶é—´ç‚¹çš„æ•°æ®å¯èƒ½æœ‰ç›¸ä¼¼æ¨¡å¼</li>
<li>æœˆåº¦å‘¨æœŸï¼šæ¯æœˆå¯èƒ½æœ‰ç›¸ä¼¼çš„æ¨¡å¼ï¼ˆå¦‚æœˆåˆã€æœˆä¸­ã€æœˆæœ«ï¼‰</li>
<li>å‘¨åº¦å‘¨æœŸï¼šæ¯å‘¨çš„å·¥ä½œæ—¥å’Œå‘¨æœ«æ¨¡å¼å¾€å¾€ç±»ä¼¼</li>
<li>æ—¥å†…å‘¨æœŸï¼šæ¯å¤©å†…çš„æ´»åŠ¨æ¨¡å¼ï¼ˆå¦‚æ—©é«˜å³°ã€åˆä¼‘æ—¶é—´ï¼‰</li>
</ul>
<p>ä¾‹å­ï¼š</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1"></a><a href="#__codelineno-68-1"><span class="linenos" data-linenos="1 "></span></a>[å‘¨ä¸€, å‘¨äºŒ, å‘¨ä¸‰, å‘¨å››, å‘¨äº”, å‘¨å…­, å‘¨æ—¥]
</span></code></pre></div>
<p><strong>å¾ªç¯å¡«å……ä»¥åï¼š</strong> </p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1"></a><a href="#__codelineno-69-1"><span class="linenos" data-linenos="1 "></span></a>è¾¹ç•Œå¤„ç†åï¼š[å‘¨å…­, å‘¨æ—¥, å‘¨ä¸€, å‘¨äºŒ, ..., å‘¨æ—¥, å‘¨ä¸€, å‘¨äºŒ]
</span></code></pre></div>
<p>PyTorchä¸­çš„å¾ªç¯å¡«å……å®ç°ä¼šå°†åºåˆ—è§†ä¸ºç¯å½¢ç»“æ„ï¼š</p>
<ul>
<li>å¯¹äºéœ€è¦åœ¨å·¦ä¾§å¡«å……çš„éƒ¨åˆ†ï¼Œä»åºåˆ—å³ç«¯å–å€¼</li>
<li>å¯¹äºéœ€è¦åœ¨å³ä¾§å¡«å……çš„éƒ¨åˆ†ï¼Œä»åºåˆ—å·¦ç«¯å–å€¼</li>
</ul>
<h3 id="_19"><a href="#è¿”å›ä¸ºä»€ä¹ˆå­£èŠ‚æˆåˆ†å’Œè¶‹åŠ¿æˆåˆ†">ä¸ºä»€ä¹ˆå­£èŠ‚æˆåˆ†å’Œè¶‹åŠ¿æˆåˆ†ä¸åŒçš„è¿˜åŸç»´åº¦æ–¹æ³•</a> <a id="è·³åˆ°ä¸ºä»€ä¹ˆå­£èŠ‚æˆåˆ†å’Œè¶‹åŠ¿æˆåˆ†"></a><a class="headerlink" href="#_19" title="Permanent link">Â¶</a></h3>
<p><strong>é¦–å…ˆï¼Œæ˜ç¡®ï¼Œå­£èŠ‚æˆåˆ† ä½¿ç”¨çº¿æ€§å±‚æŠ•å½±</strong> </p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1"></a><a href="#__codelineno-70-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># Decoderç±»ä¸­çš„æŠ•å½±</span>
</span><span id="__span-70-2"><a id="__codelineno-70-2" name="__codelineno-70-2"></a><a href="#__codelineno-70-2"><span class="linenos" data-linenos="2 "></span></a><span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">=</span> <span class="n">projection</span>  <span class="c1"># é€šå¸¸æ˜¯nn.Linear(d_model, c_out)</span>
</span><span id="__span-70-3"><a id="__codelineno-70-3" name="__codelineno-70-3"></a><a href="#__codelineno-70-3"><span class="linenos" data-linenos="3 "></span></a>
</span><span id="__span-70-4"><a id="__codelineno-70-4" name="__codelineno-70-4"></a><a href="#__codelineno-70-4"><span class="linenos" data-linenos="4 "></span></a><span class="c1"># ä½¿ç”¨æ—¶</span>
</span><span id="__span-70-5"><a id="__codelineno-70-5" name="__codelineno-70-5"></a><a href="#__codelineno-70-5"><span class="linenos" data-linenos="5 "></span></a><span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-70-6"><a id="__codelineno-70-6" name="__codelineno-70-6"></a><a href="#__codelineno-70-6"><span class="linenos" data-linenos="6 "></span></a>    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># x: [B, L, d_model] -&gt; [B, L, c_out]</span>
</span></code></pre></div>
<p><strong>è¶‹åŠ¿æˆåˆ†ï¼šä½¿ç”¨å·ç§¯å±‚ï¼ˆConv1dï¼‰è¿›è¡ŒæŠ•å½±</strong></p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1"></a><a href="#__codelineno-71-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># DecoderLayerç±»ä¸­çš„æŠ•å½±</span>
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2"></a><a href="#__codelineno-71-2"><span class="linenos" data-linenos="2 "></span></a><span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv1d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="n">d_model</span><span class="p">,</span> <span class="n">out_channels</span><span class="o">=</span><span class="n">c_out</span><span class="p">,</span> 
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3"></a><a href="#__codelineno-71-3"><span class="linenos" data-linenos="3 "></span></a>                           <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-71-4"><a id="__codelineno-71-4" name="__codelineno-71-4"></a><a href="#__codelineno-71-4"><span class="linenos" data-linenos="4 "></span></a>                           <span class="n">padding_mode</span><span class="o">=</span><span class="s1">'circular'</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-71-5"><a id="__codelineno-71-5" name="__codelineno-71-5"></a><a href="#__codelineno-71-5"><span class="linenos" data-linenos="5 "></span></a>
</span><span id="__span-71-6"><a id="__codelineno-71-6" name="__codelineno-71-6"></a><a href="#__codelineno-71-6"><span class="linenos" data-linenos="6 "></span></a><span class="c1"># ä½¿ç”¨æ—¶</span>
</span><span id="__span-71-7"><a id="__codelineno-71-7" name="__codelineno-71-7"></a><a href="#__codelineno-71-7"><span class="linenos" data-linenos="7 "></span></a><span class="n">residual_trend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">(</span><span class="n">residual_trend</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></code></pre></div>
<p>ğŸ”µ è§£é‡Šè¿™ä¹ˆè®¾è®¡çš„ç†ç”±ï¼š</p>
<p>å­£èŠ‚æˆåˆ†ä½œä¸ºé«˜é¢‘æˆåˆ†ï¼Œ<mark>ä¸ä¼šå¹³æ»‘æ—¶é—´åºåˆ—ï¼Œä¿ç•™äº†å­£èŠ‚æ€§çš„å°–é”å˜åŒ–</mark></p>
<p>è¶‹åŠ¿æˆåˆ†ä½œä¸ºä½é¢‘æˆåˆ†ï¼Œè¶‹åŠ¿æœ¬è´¨ä¸Šæ˜¯==å¹³æ»‘==çš„</p>
<ul>
<li>è®¾ç½® <strong>kernel size = 3</strong>ï¼Œè€ƒè™‘äº†å±€éƒ¨ä¸Šä¸‹æ–‡æœ‰åŠ©äºç»´æŒè¿™ç§å¹³æ»‘æ€§</li>
<li>å·ç§¯æ“ä½œï¼ˆç‰¹åˆ«æ˜¯kernel_size=3ï¼‰èƒ½å¤Ÿå¹³æ»‘è¶‹åŠ¿ï¼Œè¿‡æ»¤æ‰ä¸å¿…è¦çš„é«˜é¢‘æ‰°åŠ¨</li>
<li>ï¼ˆå‚æ•°å…±äº«ï¼‰è·¨ä¸åŒæ—¶é—´ç‚¹çš„ç›¸åŒæ¨¡å¼å¯ä»¥è¢«ç›¸åŒçš„å·ç§¯æ ¸è¯†åˆ«</li>
</ul>
<div id="__comments"></div>
<!-- <h3>é¢œè‰²ä¸»é¢˜è°ƒæ•´</h3>
    <div class="tx-switch">
    <button class="button1" data-md-color-primary="red" style="background-color:red">red</button>
    <button class="button1" data-md-color-primary="pink" style="background-color:pink;color:black">pink</button>
    <button class="button1" data-md-color-primary="purple" style="background-color:purple">purple</button>
    <button class="button1" data-md-color-primary="indigo" style="background-color:indigo">indigo</button>
    <button class="button1" data-md-color-primary="blue" style="background-color:blue">blue</button>
    <button class="button1" data-md-color-primary="cyan" style="background-color:cyan;color:black">cyan</button>
    <button class="button1" data-md-color-primary="teal" style="background-color:teal">teal</button>
    <button class="button1" data-md-color-primary="green" style="background-color:green">green</button>
    <button class="button1" data-md-color-primary="lime" style="background-color:lime;color:black">lime</button>
    <button class="button1" data-md-color-primary="orange" style="background-color:orange;color:black">orange</button>
    <button class="button1" data-md-color-primary="brown" style="background-color:brown;border-radius=3px">brown</button>
    <button class="button1" data-md-color-primary="grey" style="background-color:grey">grey</button>
    <button class="button1" data-md-color-primary="black" style="background-color:black">black</button>
    <button class="button1" data-md-color-primary="white" style="background-color:white;color:black">white</button>
    </div> -->
<!-- Giscus -->
<script async="" crossorigin="anonymous" data-category="Announcements" data-category-id="DIC_kwDONhXY184ClgKT" data-emit-metadata="0" data-input-position="bottom" data-lang="zh-CN" data-mapping="pathname" data-reactions-enabled="1" data-repo="Auzers/notes" data-repo-id="R_kgDONhXY1w" data-strict="0" data-theme="preferred_color_scheme" src="https://giscus.app/client.js">
</script>
<script>
    var buttons = document.querySelectorAll("button[data-md-color-primary]")
    buttons.forEach(function (button) {
        button.addEventListener("click", function () {
            var attr = this.getAttribute("data-md-color-primary")
            document.body.setAttribute("data-md-color-primary", attr)
            localStorage.setItem("data-md-color-primary", attr);
        })
    })
</script>
<!-- Synchronize Giscus theme with palette -->
<script>
    var giscus = document.querySelector("script[src*=giscus]")
</script>
<script>
    var giscus = document.querySelector("script[src*=giscus]")

    /* Set palette on initial load */
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
        var theme = palette.color.scheme === "slate" ? "dark" : "light"
        giscus.setAttribute("data-theme", theme)
    }

    /* Register event handlers after documented loaded */
    document.addEventListener("DOMContentLoaded", function () {
        var ref = document.querySelector("[data-md-component=palette]")
        ref.addEventListener("change", function () {
            var palette = __md_get("__palette")
            if (palette && typeof palette.color === "object") {
                var theme = palette.color.scheme === "slate" ? "dark" : "light"

                /* Instruct Giscus to change theme */
                var frame = document.querySelector(".giscus-frame")
                frame.contentWindow.postMessage(
                    { giscus: { setConfig: { theme } } },
                    "https://giscus.app"
                )
            }
        })
    })
</script>
</article>
</div>
<script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["content.action.edit", "content.action.view", "toc.follow", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.code.annotate", "content.code.select", "content.tooltips", "content.footnote.tooltips", "content.tabs.link", "header.autohide", "navigation.tabs", "navigation.tracking", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.indexes", "navigation.top", "navigation.path"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
<script src="../../assets/javascripts/katex.js"></script>
<script src="../../assets/javascripts/mathjax.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-chtml.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-chtml-full.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-svg-full.js"></script>
<script src="../../assets/javascripts/tablesort.js"></script>
<script src="../../assets/javascripts/toc.js"></script>
<script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script src="../../mkdocs/javascripts/katex.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/contrib/auto-render.min.js"></script>
<script src="../../assets/javascripts/web-time.js"></script>
<script src="https://cdn.jsdelivr.net/gh/Wcowin/Wcowin.github.io@main/docs/javascripts/extra.js"></script>
<script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="../../assets/document_dates/tippy/popper.min.js"></script>
<script src="../../assets/document_dates/tippy/tippy.umd.min.js"></script>
<script src="../../assets/document_dates/core/default.config.js"></script>
<script src="../../assets/document_dates/user.config.js"></script>
<script src="../../assets/document_dates/core/utils.js"></script>
<script src="../../assets/document_dates/core/core.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
window.mermaidConfig = {default: {
    startOnLoad: false
}};</script>
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script><script>document.addEventListener('DOMContentLoaded', () => {
    let attempts = 0;
    const maxAttempts = 50;

    const waitForNav = setInterval(() => {
        attempts++;
        const nav = document.querySelector('.md-sidebar--secondary .md-nav__list');
        if (!nav) return;

        const navItems = Array.from(nav.querySelectorAll('.md-nav__item'));
        if (navItems.length === 0) {
            if (attempts >= maxAttempts) {
                clearInterval(waitForNav);
                console.error('ç›®å½•åŠ è½½è¶…æ—¶');
            }
            return;
        }

        clearInterval(waitForNav);
        console.log('ç›®å½•é¡¹æ•°é‡:', navItems.length);

        // è·å–ä¸»å†…å®¹åŒºåŸŸ
        const mainContent = document.querySelector('.md-content__inner');
        if (!mainContent) return;

        // è·å–æ‰€æœ‰æ ‡é¢˜
        const headings = Array.from(mainContent.querySelectorAll('h1, h2, h3, h4, h5, h6'));
        console.log('æ ‡é¢˜æ•°é‡:', headings.length);

        // æ”¶é›†æ‰€æœ‰åˆ†éš”çº¿ä½ç½®
        const walker = document.createTreeWalker(mainContent, NodeFilter.SHOW_TEXT, {
            acceptNode: (node) => {
                if (!node || !node.textContent) return NodeFilter.FILTER_REJECT;
                if (node.parentElement?.closest('pre, code, .md-nav, script, style')) {
                    return NodeFilter.FILTER_REJECT;
                }
                return NodeFilter.FILTER_ACCEPT;
            }
        }, false);

        const hrPositions = [];
        let node;
        while (node = walker.nextNode()) {
            const text = node.textContent.trim();
            const match = text.match(/^---(.+?)---$/);
            if (match) {
                hrPositions.push({
                    node,
                    content: match[1].trim()
                });
            }
        }

        // å¤„ç†æ¯ä¸ªåˆ†éš”çº¿
        hrPositions.forEach((hrData, index) => {
            // åˆ›å»ºåˆ†éš”çº¿
            const hr = document.createElement('hr');
            hr.setAttribute('data-content', hrData.content);
            hr.classList.add('custom-hr');
            hr.id = `hr-${index + 1}`;
            hrData.node.parentNode.replaceChild(hr, hrData.node);

            // åˆ›å»ºç›®å½•é¡¹
            const li = document.createElement('li');
            li.classList.add('md-nav__item', 'hr-nav-item');
            const a = document.createElement('a');
            a.classList.add('md-nav__link');
            a.href = `#hr-${index + 1}`;
            a.textContent = `${hrData.content}`; // ä¿®æ”¹è¿™é‡Œï¼Œæ·»åŠ å‰åçš„ç ´æŠ˜å·
            li.appendChild(a);



            // æ‰¾åˆ°åˆ†éš”çº¿åçš„ç¬¬ä¸€ä¸ªæ ‡é¢˜
            let nextHeadingIndex = -1;
            for (let i = 0; i < headings.length; i++) {
                const heading = headings[i];
                if (hr.compareDocumentPosition(heading) & Node.DOCUMENT_POSITION_FOLLOWING) {
                    nextHeadingIndex = i;
                    break;
                }
            }

            console.log('åˆ†éš”çº¿:', hrData.content, 'ä¸‹ä¸€ä¸ªæ ‡é¢˜ç´¢å¼•:', nextHeadingIndex);

            if (nextHeadingIndex !== -1) {
                // æ‰¾åˆ°å¯¹åº”çš„ç›®å½•é¡¹
                const nextHeading = headings[nextHeadingIndex];
                const nextNavItem = navItems.find(item => {
                    const link = item.querySelector('a');
                    const text = link?.textContent?.replace('Â¶', '').trim();
                    return text === nextHeading.textContent.replace('Â¶', '').trim();
                });

                if (nextNavItem) {
                    nav.insertBefore(li, nextNavItem);
                    console.log('æ’å…¥åˆ°æ ‡é¢˜å‰:', nextHeading.textContent);
                    return;
                }
            }

            nav.appendChild(li);
            console.log('è¿½åŠ åˆ°æœ«å°¾:', hrData.content);
        });
    }, 100);
});</script></body></html>